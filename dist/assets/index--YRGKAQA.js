import{r as c,a as ia,R as Ue}from"./vendor-bd6wVIFv.js";import{U as wt,M as Xe,L as yt,E as vt,a as ot,B as Te,G as qt,C as Et,X as Ae,b as Vt,V as We,c as ca,d as da,W as ma,K as Kt,I as ut,e as _e,A as Je,f as ua,g as jt,S as Tt,h as Ht,Z as ga,i as ht,j as Rt,k as pa,P as At,l as Jt,T as De,m as kt,R as gt,n as ha,H as It,F as xt,o as $e,p as xa,q as fa,r as ba,s as wa,Q as ya,t as va,u as ja,v as Ze,w as Na,x as Nt,y as lt,z as ve,D as it,J as ct,N as Sa,O as ft,Y as Ut}from"./ui-D-2MVVV8.js";import{c as Ca}from"./supabase-iw8X0Tgk.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=a(s);fetch(s.href,l)}})();var Yt={exports:{}},pt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _a=c,Ea=Symbol.for("react.element"),Ta=Symbol.for("react.fragment"),Aa=Object.prototype.hasOwnProperty,ka=_a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ia={key:!0,ref:!0,__self:!0,__source:!0};function Qt(i,t,a){var r,s={},l=null,n=null;a!==void 0&&(l=""+a),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(n=t.ref);for(r in t)Aa.call(t,r)&&!Ia.hasOwnProperty(r)&&(s[r]=t[r]);if(i&&i.defaultProps)for(r in t=i.defaultProps,t)s[r]===void 0&&(s[r]=t[r]);return{$$typeof:Ea,type:i,key:l,ref:n,props:s,_owner:ka.current}}pt.Fragment=Ta;pt.jsx=Qt;pt.jsxs=Qt;Yt.exports=pt;var e=Yt.exports,Xt,Dt=ia;Xt=Dt.createRoot,Dt.hydrateRoot;const La={languagePairs:[],currentLanguagePair:null,cards:[],currentCard:null,sessionStats:{cardsReviewed:0,correctAnswers:0,timeSpent:0,newCards:0,reviewCards:0},userStats:{streak:0,totalCards:0,learnedCards:0,masteredCards:0,reviewsDue:0},isSessionActive:!1};function Pa(i,t){switch(t.type){case"SET_LANGUAGE_PAIRS":return{...i,languagePairs:t.payload};case"SET_CURRENT_LANGUAGE_PAIR":return{...i,currentLanguagePair:t.payload};case"SET_CARDS":return{...i,cards:t.payload};case"UPDATE_CARD":console.log("🔄 AppContext: UPDATE_CARD action received"),console.log("🔄 AppContext: Payload:",t.payload),console.log("🔄 AppContext: Current cards count:",i.cards.length);const a=i.cards.map(s=>s.cardId===t.payload.cardId?(console.log("🔄 AppContext: Updating card:",s.cardId),t.payload):s);return console.log("🔄 AppContext: Updated cards count:",a.length),{...i,cards:a};case"ADD_CARD":console.log("🔄 AppContext: Adding card to state:",t.payload);const r=[...i.cards,t.payload];return console.log("🔄 AppContext: New cards array length:",r.length),{...i,cards:r};case"SET_CURRENT_CARD":return{...i,currentCard:t.payload};case"START_SESSION":return{...i,isSessionActive:!0};case"END_SESSION":return{...i,isSessionActive:!1,currentCard:null};case"UPDATE_SESSION_STATS":return{...i,sessionStats:{...i.sessionStats,...t.payload}};case"UPDATE_USER_STATS":return{...i,userStats:{...i.userStats,...t.payload}};default:return i}}const Zt=c.createContext(null),Ra=({children:i})=>{const[t,a]=c.useReducer(Pa,La);return e.jsx(Zt.Provider,{value:{state:t,dispatch:a},children:i})},Me=()=>{const i=c.useContext(Zt);if(!i)throw new Error("useAppContext must be used within AppProvider");return i},tt=[{code:"ru",name:"Русский",flag:"🇷🇺"},{code:"en",name:"English",flag:"🇺🇸"},{code:"es",name:"Español",flag:"🇪🇸"},{code:"fr",name:"Français",flag:"🇫🇷"},{code:"de",name:"Deutsch",flag:"🇩🇪"},{code:"it",name:"Italiano",flag:"🇮🇹"},{code:"pt",name:"Português",flag:"🇵🇹"},{code:"zh",name:"中文",flag:"🇨🇳"},{code:"ja",name:"日本語",flag:"🇯🇵"},{code:"ko",name:"한국어",flag:"🇰🇷"}],Ot=[{value:"Beginner",label:"Начинающий"},{value:"Elementary",label:"Элементарный"},{value:"Intermediate",label:"Средний"},{value:"Upper-Intermediate",label:"Выше среднего"},{value:"Advanced",label:"Продвинутый"},{value:"Proficient",label:"Профессиональный"}],Ua=({onRegister:i,onSwitchToLogin:t})=>{const[a,r]=c.useState({name:"",email:"",password:"",confirmPassword:"",knownLanguage:tt[0],learningLanguage:tt[2],level:"Beginner"}),[s,l]=c.useState(!1),[n,o]=c.useState(!1),[d,g]=c.useState(!1),[w,_]=c.useState(!1),[T,y]=c.useState(!1),[P,R]=c.useState({}),[u,C]=c.useState(!1),S=()=>{const f={};return a.name.trim()?a.name.trim().length<2&&(f.name="Имя должно содержать минимум 2 символа"):f.name="Имя обязательно",a.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(f.email="Некорректный формат email"):f.email="Email обязателен",a.password?a.password.length<6&&(f.password="Пароль должен содержать минимум 6 символов"):f.password="Пароль обязателен",a.confirmPassword?a.password!==a.confirmPassword&&(f.confirmPassword="Пароли не совпадают"):f.confirmPassword="Подтвердите пароль",a.knownLanguage||(f.knownLanguage="Выберите язык, который вы знаете"),a.learningLanguage||(f.learningLanguage="Выберите язык, который изучаете"),a.knownLanguage&&a.learningLanguage&&a.knownLanguage.code===a.learningLanguage.code&&(f.learningLanguage="Язык изучения должен отличаться от известного языка"),a.level||(f.level="Выберите уровень языка"),R(f),Object.keys(f).length===0},h=async f=>{if(f.preventDefault(),!(!S()||u)){C(!0);try{await new Promise(p=>setTimeout(p,1e3)),i({name:a.name.trim(),email:a.email.trim(),password:a.password,knownLanguage:a.knownLanguage,learningLanguage:a.learningLanguage,level:a.level})}catch(p){console.error("Registration error:",p)}finally{C(!1)}}},I=(f,p)=>{r(E=>({...E,[f]:p})),P[f]&&R(E=>({...E,[f]:""}))},U=(f,p)=>{r(E=>({...E,[`${f}Language`]:p})),P[`${f}Language`]&&R(E=>({...E,[`${f}Language`]:""})),f==="known"?g(!1):_(!1)},O=f=>{r(p=>({...p,level:f})),P.level&&R(p=>({...p,level:""})),y(!1)},$=({label:f,value:p,options:E,isOpen:G,onToggle:M,onSelect:z,error:L})=>e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:f}),e.jsxs("button",{type:"button",onClick:M,className:`w-full pl-10 pr-10 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-left flex items-center justify-between text-black ${L?"border-red-300 bg-red-50":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("span",{className:"ml-6",children:p})]}),e.jsx(Et,{className:`w-4 h-4 text-gray-400 transition-transform ${G?"rotate-180":""}`})]}),G&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:E.map((B,b)=>e.jsxs("button",{type:"button",onClick:()=>z(B),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 first:rounded-t-lg last:rounded-b-lg text-black",children:[B.flag&&e.jsx("span",{className:"text-lg",children:B.flag}),e.jsx("span",{children:B.label||B.name})]},b))}),L&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:L})]});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("img",{src:"/assets/Logo AmigosCards.png",alt:"AmigosCards Logo",className:"w-10 h-10",onError:f=>{const p=f.target;p.style.display="none",p.parentElement.innerHTML='<svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>'}})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Создать аккаунт"}),e.jsx("p",{className:"text-gray-600",children:"Начните изучать языки уже сегодня"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Имя"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"name",value:a.name,onChange:f=>I("name",f.target.value),placeholder:"Введите ваше имя",className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-black ${P.name?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),P.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",id:"email",value:a.email,onChange:f=>I("email",f.target.value),placeholder:"example@email.com",className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-black ${P.email?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(Xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),P.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:s?"text":"password",id:"password",value:a.password,onChange:f=>I("password",f.target.value),placeholder:"Минимум 6 символов",className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-black ${P.password?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("button",{type:"button",onClick:()=>l(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:s?e.jsx(vt,{className:"w-4 h-4"}):e.jsx(ot,{className:"w-4 h-4"})})]}),P.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Подтвердите пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n?"text":"password",id:"confirmPassword",value:a.confirmPassword,onChange:f=>I("confirmPassword",f.target.value),placeholder:"Повторите пароль",className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-black ${P.confirmPassword?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("button",{type:"button",onClick:()=>o(!n),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n?e.jsx(vt,{className:"w-4 h-4"}):e.jsx(ot,{className:"w-4 h-4"})})]}),P.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.confirmPassword})]}),e.jsxs("div",{className:"border-t pt-4 mt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-blue-600"}),"Языковые настройки"]}),e.jsx("div",{className:"mb-4",children:e.jsx($,{label:"Язык, который вы знаете",value:a.knownLanguage?`${a.knownLanguage.flag} ${a.knownLanguage.name}`:"Выберите язык",options:tt,isOpen:d,onToggle:()=>g(!d),onSelect:f=>U("known",f),error:P.knownLanguage})}),e.jsx("div",{className:"mb-4",children:e.jsx($,{label:"Язык, который изучаете",value:a.learningLanguage?`${a.learningLanguage.flag} ${a.learningLanguage.name}`:"Выберите язык",options:tt.filter(f=>f.code!==a.knownLanguage?.code),isOpen:w,onToggle:()=>_(!w),onSelect:f=>U("learning",f),error:P.learningLanguage})}),e.jsx("div",{className:"mb-4",children:e.jsx($,{label:"Уровень языка",value:Ot.find(f=>f.value===a.level)?.label||"Выберите уровень",options:Ot,isOpen:T,onToggle:()=>y(!T),onSelect:f=>O(f.value),error:P.level})})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors mt-6",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Создаем аккаунт..."]}):"Создать аккаунт"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Уже есть аккаунт?"," ",e.jsx("button",{onClick:t,className:"text-blue-600 hover:text-blue-700 font-medium transition-colors",children:"Войти"})]})})]}),e.jsxs("p",{className:"text-center text-xs text-gray-500 mt-6",children:["Создавая аккаунт, вы соглашаетесь с"," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Условиями использования"})," ","и"," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Политикой конфиденциальности"})]})]})})};var se=(i=>(i.LEARN="LEARN",i.REVIEW="REVIEW",i.SUSPENDED="SUSPENDED",i))(se||{}),Le=(i=>(i.KNOWN_TO_LEARNING="K_TO_L",i.LEARNING_TO_KNOWN="L_TO_K",i))(Le||{}),q=(i=>(i.DEMONSTRATION="DEMONSTRATION",i.WORD="WORD",i.TRANSLATION="TRANSLATION",i.TRANSLATION_TO_WORD="TRANSLATION_TO_WORD",i.LISTENING_1="LISTENING_1",i.LISTENING_2="LISTENING_2",i))(q||{});const ie={modes:{DEMONSTRATION:{name:"Демонстрация",description:"Автоматический показ перевода через 1.5 секунды",minProgress:0,maxProgress:19,showTranslationAutomatically:!0,translationDelay:1500,cardReturnDelay:2e3,showInputField:!1,showActionButtons:!0,requireInputForButtons:!1,showTranslationOnTap:!1,showWordOnTap:!1,nextCardOnEnter:!1,nextCardOnTap:!1,enterPressesToNext:0},WORD:{name:"Слово",description:"Показывается слово, перевод по тапу на карточку",minProgress:20,maxProgress:29,showTranslationAutomatically:!1,translationDelay:0,cardReturnDelay:1500,showInputField:!1,showActionButtons:!0,requireInputForButtons:!1,showTranslationOnTap:!0,showWordOnTap:!1,nextCardOnEnter:!1,nextCardOnTap:!1,enterPressesToNext:0},TRANSLATION:{name:"Перевод",description:"Показывается перевод, слово по тапу на карточку",minProgress:30,maxProgress:49,showTranslationAutomatically:!0,translationDelay:0,cardReturnDelay:1500,showInputField:!1,showActionButtons:!0,requireInputForButtons:!1,showTranslationOnTap:!1,showWordOnTap:!0,nextCardOnEnter:!1,nextCardOnTap:!1,enterPressesToNext:0,alternatesWith:["WORD"],alternateCondition:"even"},TRANSLATION_TO_WORD:{name:"Перевод к слову",description:"Пользователь видит испанское слово, вводит русский перевод, перевод показывается по тапу",minProgress:50,maxProgress:69,showTranslationAutomatically:!1,translationDelay:0,cardReturnDelay:2e3,showInputField:!0,showActionButtons:!0,requireInputForButtons:!0,showTranslationOnTap:!0,showWordOnTap:!1,nextCardOnEnter:!0,nextCardOnTap:!0,enterPressesToNext:2,alternatesWith:["TRANSLATION"],alternateCondition:"even"},LISTENING_1:{name:"Аудирование-1",description:"Произносится слово, по тапу показывается картинка, слово и перевод",minProgress:70,maxProgress:84,showTranslationAutomatically:!1,translationDelay:0,cardReturnDelay:0,showInputField:!1,showActionButtons:!1,requireInputForButtons:!1,showTranslationOnTap:!1,showWordOnTap:!1,nextCardOnEnter:!1,nextCardOnTap:!0,enterPressesToNext:0,alternatesWith:["LISTENING_2"],alternateCondition:"even"},LISTENING_2:{name:"Аудирование-2",description:"Произносится слово, пользователь вводит услышанное слово",minProgress:85,maxProgress:100,showTranslationAutomatically:!1,translationDelay:0,cardReturnDelay:2e3,showInputField:!0,showActionButtons:!1,requireInputForButtons:!1,showTranslationOnTap:!1,showWordOnTap:!1,nextCardOnEnter:!0,nextCardOnTap:!0,enterPressesToNext:2,alternatesWith:["LISTENING_1"],alternateCondition:"odd"}},general:{cardAnimation:!0,animationDuration:300,soundEffects:!0,visualFeedback:!0,autoSaveProgress:!0,autoSaveInterval:5e3,showProgressIndicator:!0,progressIndicatorSize:36,showProgressPercentage:!1},spacedRepetition:{incorrectAnswerDelay:6e4,progressIncrease:10,progressDecrease:20,resetSuccessfulReviewsThreshold:20,reviewIntervals:[{minutes:1},{minutes:10},{minutes:30},{hours:1},{days:1},{days:2}]},difficulty:{beginner:{translationDelay:2e3,cardReturnDelay:3e3,showActionButtons:!0,requireInputForButtons:!1},intermediate:{translationDelay:1500,cardReturnDelay:2e3,showActionButtons:!0,requireInputForButtons:!0},advanced:{translationDelay:1e3,cardReturnDelay:1e3,showActionButtons:!0,requireInputForButtons:!0,nextCardOnEnter:!0,enterPressesToNext:1}}};class K{static getDisplayMode(t,a=0){const r=ie.modes;for(const[s,l]of Object.entries(r))if(t>=l.minProgress&&t<=l.maxProgress)return l.alternatesWith&&l.alternateCondition&&(l.alternateCondition==="even"?a%2===0:a%2===1)&&l.alternatesWith.length>0?l.alternatesWith[0]:s;return"LISTENING_2"}static getModeConfig(t){return ie.modes[t]||null}static getModeConfigWithDifficulty(t,a="intermediate"){const r=this.getModeConfig(t);if(!r)return null;const s=ie.difficulty[a];return{...r,...s}}static shouldShowTranslationAutomatically(t){return this.getModeConfig(t)?.showTranslationAutomatically||!1}static getTranslationDelay(t,a="intermediate"){return this.getModeConfigWithDifficulty(t,a)?.translationDelay||0}static getCardReturnDelay(t,a="intermediate"){return this.getModeConfigWithDifficulty(t,a)?.cardReturnDelay||2e3}static shouldShowInputField(t){return this.getModeConfig(t)?.showInputField||!1}static shouldShowActionButtons(t){return this.getModeConfig(t)?.showActionButtons||!1}static requireInputForButtons(t){return this.getModeConfig(t)?.requireInputForButtons||!1}static getEnterPressesToNext(t){return this.getModeConfig(t)?.enterPressesToNext||0}static getAllModes(){return ie.modes}static getIncorrectAnswerDelay(){return ie.spacedRepetition.incorrectAnswerDelay}static getProgressIncrease(){return ie.spacedRepetition.progressIncrease}static getProgressDecrease(){return ie.spacedRepetition.progressDecrease}static getResetSuccessfulReviewsThreshold(){return ie.spacedRepetition.resetSuccessfulReviewsThreshold}static getReviewIntervals(){return ie.spacedRepetition.reviewIntervals}static getNextReviewInterval(t){const a=this.getReviewIntervals(),r=Math.min(t-1,a.length-1);return r<0?{minutes:1}:a[r]}static getGeneralSettings(){return ie.general}static shouldShowProgressIndicator(){return ie.general.showProgressIndicator}static getProgressIndicatorSize(){return ie.general.progressIndicatorSize}static shouldShowProgressPercentage(){return ie.general.showProgressPercentage}static updateConfig(t){Object.assign(ie,t)}static resetConfig(){window.location.reload()}}class Oe{static REVIEW_INTERVALS=[{minutes:1},{minutes:10},{minutes:30},{hours:24},{days:7},{days:24}];static processReview(t,a){const r={...t},s=new Date;if(a.correct){const l=K.getProgressIncrease();r.progress=Math.min(100,t.progress+l),r.successfulReviews+=1,r.reviewCount+=1,r.lastReviewedAt=s,r.updatedAt=s;const n=K.getNextReviewInterval(r.successfulReviews);r.dueAt=this.addInterval(s,n),console.log(`✅ SpacedRepetitionService: Card "${r.term}" correct answer, progress=${r.progress} (+${l}%), successfulReviews=${r.successfulReviews}, next interval=${JSON.stringify(n)}, dueAt=${r.dueAt}`)}else{const l=K.getProgressDecrease();r.progress=Math.max(0,t.progress-l),r.reviewCount+=1,r.lastReviewedAt=s,r.updatedAt=s;const n=K.getResetSuccessfulReviewsThreshold();r.progress<n&&(r.successfulReviews=Math.max(0,r.successfulReviews-1));const o=K.getIncorrectAnswerDelay();r.dueAt=new Date(s.getTime()+o),console.log(`❌ SpacedRepetitionService: Card "${r.term}" incorrect answer, progress=${r.progress} (-${l}%), successfulReviews=${r.successfulReviews}, resetThreshold=${n}%, delay=${o}ms, dueAt=${r.dueAt}`)}return r.state=this.getCardState(r.progress,r.dueAt),r}static getDisplayMode(t){const a=t.progress;return t.successfulReviews,a<20?q.DEMONSTRATION:a<30?q.WORD:a<50?t.reviewCount%2===0?q.WORD:q.TRANSLATION:a<70&&t.reviewCount%2===0?q.TRANSLATION:q.TRANSLATION_TO_WORD}static shouldUseInputMode(t){return t.progress>=50}static getReviewDirection(t){const a=t.progress;return a>=80?Math.random()<.5?Le.LEARNING_TO_KNOWN:Le.KNOWN_TO_LEARNING:a>=60&&Math.random()<.3?Le.LEARNING_TO_KNOWN:Le.KNOWN_TO_LEARNING}static addInterval(t,a){const r=new Date(t);return a.minutes?r.setMinutes(r.getMinutes()+a.minutes):a.hours?r.setHours(r.getHours()+a.hours):a.days&&r.setDate(r.getDate()+a.days),r}static getCardState(t,a){return a<=new Date?se.LEARN:t>=10&&t<70?se.REVIEW:se.SUSPENDED}static updateCardStateBasedOnDueTime(t){const a={...t};return a.state=this.getCardState(t.progress,t.dueAt),a}static getDueCards(t){const a=new Date;console.log("🔍 SpacedRepetitionService: getDueCards called with",t.length,"cards"),console.log("🔍 SpacedRepetitionService: Current time:",a);const r=t.filter(s=>{const l=s.dueAt<=a;return console.log(`🔍 Card "${s.term}": dueAt=${s.dueAt}, progress=${s.progress}, isDue=${l}`),l}).sort((s,l)=>s.dueAt.getTime()-l.dueAt.getTime());return console.log("🔍 SpacedRepetitionService: Found",r.length,"due cards"),r}static getLessonCardsInOrder(t,a){console.log("📚 SpacedRepetitionService: getLessonCardsInOrder called for lesson:",a);const s=t.filter(l=>l.lessonId===a&&l.lessonOrder!==null&&l.lessonOrder!==void 0).sort((l,n)=>(l.lessonOrder||0)-(n.lessonOrder||0));return console.log(`📚 SpacedRepetitionService: Found ${s.length} cards for lesson ${a}`),s}static getNextCardToShow(t,a){if(console.log("🎯 SpacedRepetitionService: getNextCardToShow called"),a){const l=this.getLessonCardsInOrder(t,a).find(n=>n.progress===0);if(l)return console.log("🎯 SpacedRepetitionService: Showing new lesson card:",l.term),l}const r=this.getDueCards(t);if(r.length>0){const s=r.sort((n,o)=>n.dueAt.getTime()-o.dueAt.getTime());return console.log("🎯 SpacedRepetitionService: Showing due card:",s[0].term),localStorage.getItem("currentLessonId")&&!s[0].lessonId&&(console.log("🎯 SpacedRepetitionService: Showing non-lesson card, clearing currentLessonId"),localStorage.removeItem("currentLessonId")),s[0]}return console.log("🎯 SpacedRepetitionService: No cards to show"),null}static getNextDueCard(t){const a=new Date,r=t.filter(s=>s.dueAt>a).sort((s,l)=>s.dueAt.getTime()-l.dueAt.getTime());return r.length>0?r[0]:null}static getSupportiveMode(t){return t<20?q.DEMONSTRATION:q.WORD}static getTimeUntilNext(t){if(!t)return"";const a=new Date,r=t.dueAt.getTime()-a.getTime(),s=Math.floor(r/6e4),l=Math.floor(s/60),n=Math.floor(l/24);return n>0?`через ${n}д`:l>0?`через ${l}ч`:s>0?`через ${s}м`:"сейчас"}static checkForDuplicates(t,a,r,s){return t.find(l=>l.languagePairId===s&&(l.term.toLowerCase()===a.toLowerCase()||l.translation.toLowerCase()===r.toLowerCase()))||null}}class fe{static userCardToCard(t){return console.log("🔍 SpacedRepetitionAdapter: Converting userCard to card:",{cardId:t.cardId,term:t.term,translation:t.translation,progress:t.progress}),{id:t.cardId.toString(),languagePairId:t.languagePairId,term:t.term,translation:t.translation,imageUrl:t.imageUrl,progress:t.progress,state:t.state,dueAt:t.dueAt,reviewCount:t.reviewCount,successfulReviews:t.successfulReviews,direction:t.direction,createdAt:t.createdAt,updatedAt:t.updatedAt,lastReviewedAt:t.lastReviewedAt,easeFactor:t.easeFactor,intervalDays:t.intervalDays,lessonId:t.lessonId,lessonOrder:t.lessonOrder}}static cardToUserCard(t,a){return{...a,cardId:parseInt(t.id),progress:t.progress,state:t.state,dueAt:t.dueAt,reviewCount:t.reviewCount,successfulReviews:t.successfulReviews,direction:t.direction,updatedAt:t.updatedAt,lastReviewedAt:t.lastReviewedAt,easeFactor:t.easeFactor,intervalDays:t.intervalDays}}static getDueCards(t){const a=t.map(this.userCardToCard);return Oe.getDueCards(a).map(s=>{const l=t.find(n=>n.cardId.toString()===s.id);return l?this.cardToUserCard(s,l):t[0]})}static getNextDueCard(t){const a=t.map(this.userCardToCard),r=Oe.getNextDueCard(a);if(!r)return null;const s=t.find(l=>l.cardId.toString()===r.id);return s?this.cardToUserCard(r,s):null}static getTimeUntilNext(t){const a=this.userCardToCard(t);return Oe.getTimeUntilNext(a)}static processReview(t,a){const r=this.userCardToCard(t),s=Oe.processReview(r,a);return this.cardToUserCard(s,t)}static checkForDuplicates(t,a,r,s){const l=t.map(this.userCardToCard),n=Oe.checkForDuplicates(l,a,r,s);return n&&t.find(d=>d.cardId.toString()===n.id)||null}static getDisplayMode(t){const a=this.userCardToCard(t);return Oe.getDisplayMode(a)}static getReviewDirection(t){const a=this.userCardToCard(t);return Oe.getReviewDirection(a)}static getNextCardToShow(t,a){const r=t.map(this.userCardToCard),s=Oe.getNextCardToShow(r,a);if(!s)return null;const l=t.find(n=>n.cardId.toString()===s.id);return l?this.cardToUserCard(s,l):null}}class xe{static STORAGE_KEYS={USER_PREFERENCES:"user_preferences",CARDS:"spaced_repetition_cards",USER_STATS:"user_stats"};static async saveLanguagePair(t){try{const a=this.getUserPreferences();a.language_pair=t,localStorage.setItem(this.STORAGE_KEYS.USER_PREFERENCES,JSON.stringify(a)),console.log("Language pair saved to database:",t)}catch(a){throw console.error("Error saving language pair:",a),a}}static getLanguagePair(){try{return this.getUserPreferences().language_pair||null}catch(t){return console.error("Error getting language pair:",t),null}}static getUserPreferences(){try{const t=localStorage.getItem(this.STORAGE_KEYS.USER_PREFERENCES);return t?JSON.parse(t):{language_pair:{known_language:"Русский",learning_language:"Español",known_language_code:"ru",learning_language_code:"es"},daily_goal:20,notifications_enabled:!0,sound_effects_enabled:!0}}catch(t){return console.error("Error getting user preferences:",t),{language_pair:{known_language:"Русский",learning_language:"Español",known_language_code:"ru",learning_language_code:"es"},daily_goal:20,notifications_enabled:!0,sound_effects_enabled:!0}}}static async saveUserPreferences(t){try{const r={...this.getUserPreferences(),...t};localStorage.setItem(this.STORAGE_KEYS.USER_PREFERENCES,JSON.stringify(r)),console.log("User preferences saved:",r)}catch(a){throw console.error("Error saving user preferences:",a),a}}static getCardsForLanguagePair(t){try{return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.CARDS)||"[]").filter(r=>r.languagePairId===t)}catch(a){return console.error("Error getting cards for language pair:",a),[]}}static async updateCardsLanguagePair(t,a){try{const s=JSON.parse(localStorage.getItem(this.STORAGE_KEYS.CARDS)||"[]").map(l=>l.languagePairId===t?{...l,languagePairId:a}:l);localStorage.setItem(this.STORAGE_KEYS.CARDS,JSON.stringify(s)),console.log("Cards language pair updated from",t,"to",a)}catch(r){throw console.error("Error updating cards language pair:",r),r}}static generateLanguagePairId(t,a){return`${t}-${a}`}static async validateLanguagePairChange(t,a){if(t===a)return{valid:!1,message:"Язык изучения должен отличаться от известного языка"};const r=this.getLanguagePair();if(r){const s=this.generateLanguagePairId(r.known_language_code,r.learning_language_code),l=this.getCardsForLanguagePair(s);if(l.length>0)return{valid:!0,message:`У вас есть ${l.length} карточек для текущей языковой пары. Они будут обновлены для новой пары.`}}return{valid:!0}}}const Da="https://nwtyjslkvwuxdfhlucgv.supabase.co",Oa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53dHlqc2xrdnd1eGRmaGx1Y2d2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNjQzMTksImV4cCI6MjA3MjY0MDMxOX0.2qlzaAfO8tDhRnz0idY51L8CQ8tlZzk7KIGPK1744FQ",k=Ca(Da,Oa);class X{static STORAGE_KEYS={USER:"current_user",USER_SETTINGS:"user_settings"};static getCurrentUser(){try{const t=localStorage.getItem(this.STORAGE_KEYS.USER);if(t){const a=JSON.parse(t);return{...a,created_at:new Date(a.created_at),updated_at:new Date(a.updated_at)}}return null}catch(t){return console.error("Error getting current user:",t),null}}static async getCurrentUserFromDB(){try{const{data:{user:t}}=await k.auth.getUser();if(!t)return console.log("No authenticated user found"),null;const{data:a,error:r}=await k.from("user_settings").select("*").eq("user_id",t.id).maybeSingle();return r?(console.error("Error fetching user settings from database:",r),{id:t.id,email:t.email||"",name:t.display_name||t.user_metadata?.name||t.user_metadata?.display_name||"User",avatar_url:t.user_metadata?.avatar_url||"/assets/Foto.png",level:t.user_metadata?.level||"Beginner",created_at:new Date(t.created_at),updated_at:new Date(t.updated_at||t.created_at)}):a?a?{id:t.id,email:t.email||"",name:t.display_name||a.name,avatar_url:a.avatar_url,level:a.level,created_at:new Date(a.created_at),updated_at:new Date(a.updated_at)}:null:(console.log("No user settings found, creating default user from auth data"),{id:t.id,email:t.email||"",name:t.display_name||t.user_metadata?.name||t.user_metadata?.display_name||"User",avatar_url:t.user_metadata?.avatar_url||"/assets/Foto.png",level:t.user_metadata?.level||"Beginner",created_at:new Date(t.created_at),updated_at:new Date(t.updated_at||t.created_at)})}catch(t){return console.error("Error getting user from database:",t),null}}static async getCurrentUserFromAuth(){try{const{data:{user:t}}=await k.auth.getUser();return t?{id:t.id,email:t.email||"",name:t.display_name||t.user_metadata?.name||t.user_metadata?.display_name||"User",avatar_url:t.user_metadata?.avatar_url||"/assets/Foto.png",level:t.user_metadata?.level||"Beginner",created_at:new Date(t.created_at),updated_at:new Date(t.updated_at||t.created_at)}:(console.log("No authenticated user found"),null)}catch(t){return console.error("Error getting user from auth:",t),null}}static async updateUserDisplayNameInAuth(t){try{const{data:{user:a}}=await k.auth.getUser();if(!a)return console.error("No authenticated user found"),!1;const{error:r}=await k.from("auth.users").update({display_name:t}).eq("id",a.id);return r?(console.error("Error updating display_name in auth.users:",r),!1):(console.log("Display name updated in auth.users:",t),!0)}catch(a){return console.error("Error updating display_name in auth.users:",a),!1}}static async createOrUpdateUserInDB(t){try{const{data:{user:a}}=await k.auth.getUser();if(!a)return console.error("No authenticated user found"),null;const{data:r}=await k.from("user_settings").select("*").eq("user_id",a.id).single(),s=t.name||r?.name||a.user_metadata?.name||"User";t.name&&t.name!==a.display_name&&await this.updateUserDisplayNameInAuth(t.name);const l={user_id:a.id,name:s,avatar_url:t.avatar_url||r?.avatar_url||a.user_metadata?.avatar_url||"/assets/Foto.png",level:t.level||r?.level||"Beginner",known_language:r?.known_language||"Русский",learning_language:r?.learning_language||"Español",known_language_code:r?.known_language_code||"ru",learning_language_code:r?.learning_language_code||"es",daily_goal:r?.daily_goal||20,notifications_enabled:r?.notifications_enabled??!0,sound_effects_enabled:r?.sound_effects_enabled??!0,app_language:r?.app_language||"ru",updated_at:new Date().toISOString()};let n;if(r){const{data:d,error:g}=await k.from("user_settings").update(l).eq("user_id",a.id).select().single();if(g)return console.error("Error updating user in database:",g),null;n=d}else{const{data:d,error:g}=await k.from("user_settings").insert({...l,created_at:new Date().toISOString()}).select().single();if(g)return console.error("Error creating user in database:",g),null;n=d}const o={id:a.id,email:a.email||"",name:n.name,avatar_url:n.avatar_url,level:n.level,created_at:new Date(n.created_at),updated_at:new Date(n.updated_at)};return localStorage.setItem(this.STORAGE_KEYS.USER,JSON.stringify(o)),o}catch(a){return console.error("Error creating/updating user in database:",a),null}}static async saveUser(t){try{const a=this.getCurrentUser(),r=new Date,s={id:a?.id||`user-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,email:t.email||a?.email||"",name:t.name||a?.name||"",avatar_url:t.avatar_url||a?.avatar_url||"/assets/Foto.png",level:t.level||a?.level||"Beginner",created_at:a?.created_at||r,updated_at:r};return localStorage.setItem(this.STORAGE_KEYS.USER,JSON.stringify(s)),console.log("User saved:",s),s}catch(a){throw console.error("Error saving user:",a),a}}static async updateUser(t){try{t.name&&await this.updateUserDisplayNameInAuth(t.name);const a=await this.createOrUpdateUserInDB(t);if(a)return console.log("User updated in database:",a),a;const r=this.getCurrentUser();if(!r)throw new Error("No current user found");const s={...r,...t,updated_at:new Date};return localStorage.setItem(this.STORAGE_KEYS.USER,JSON.stringify(s)),console.log("User updated in localStorage:",s),s}catch(a){throw console.error("Error updating user:",a),a}}static getUserSettings(){try{const t=localStorage.getItem(this.STORAGE_KEYS.USER_SETTINGS);if(t){const a=JSON.parse(t);return{...a,created_at:new Date(a.created_at),updated_at:new Date(a.updated_at)}}return null}catch(t){return console.error("Error getting user settings:",t),null}}static async saveUserSettings(t){try{const a=this.getCurrentUser(),r=this.getUserSettings(),s=new Date,l={id:r?.id||`settings-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,user_id:a?.id||"default-user",name:t.name||r?.name||a?.name||"User",avatar_url:t.avatar_url||r?.avatar_url||a?.avatar_url||"/assets/Foto.png",level:t.level||r?.level||a?.level||"Beginner",known_language:t.known_language||r?.known_language||"Русский",learning_language:t.learning_language||r?.learning_language||"Español",known_language_code:t.known_language_code||r?.known_language_code||"ru",learning_language_code:t.learning_language_code||r?.learning_language_code||"es",daily_goal:t.daily_goal||r?.daily_goal||20,notifications_enabled:t.notifications_enabled??r?.notifications_enabled??!0,sound_effects_enabled:t.sound_effects_enabled??r?.sound_effects_enabled??!0,app_language:t.app_language||r?.app_language||"ru",created_at:r?.created_at||s,updated_at:s};return localStorage.setItem(this.STORAGE_KEYS.USER_SETTINGS,JSON.stringify(l)),console.log("User settings saved:",l),l}catch(a){throw console.error("Error saving user settings:",a),a}}static async updateUserSettings(t){try{const a=this.getUserSettings();if(!a)return this.saveUserSettings(t);const r={...a,...t,updated_at:new Date};return localStorage.setItem(this.STORAGE_KEYS.USER_SETTINGS,JSON.stringify(r)),console.log("User settings updated:",r),r}catch(a){throw console.error("Error updating user settings:",a),a}}static async initializeDefaultUser(){try{let t=this.getCurrentUser(),a=this.getUserSettings();return t||(t=await this.saveUser({email:"anna@example.com",name:"Anna",level:"Intermediate",avatar_url:"/assets/Foto.png"})),a||(a=await this.saveUserSettings({user_id:t.id,name:t.name,avatar_url:t.avatar_url,level:t.level,known_language:"Русский",learning_language:"Español",known_language_code:"ru",learning_language_code:"es",daily_goal:20})),{user:t,settings:a}}catch(t){throw console.error("Error initializing default user:",t),t}}static clearUserData(){try{localStorage.removeItem(this.STORAGE_KEYS.USER),localStorage.removeItem(this.STORAGE_KEYS.USER_SETTINGS),console.log("User data cleared")}catch(t){console.error("Error clearing user data:",t)}}}const Ga={OPENAI_API_KEY:"sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",HUGGING_FACE_API_KEY:"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",COHERE_API_KEY:"lGYuJlyPVw5jWZewMAGLyXHZ7w1lPe5CeSe1wSij",LEONARDO_API_KEY:"2a9ab5c6-27d8-4d6a-8541-ece719f4cd5b",GOOGLE_TRANSLATE_API_KEY:"AIzaSyA6XURB2soxZcritvBPtPkBUjKbsNjVJ-U",GEMINI_API_KEY:"AIzaSyCkIv__LSy7yshaIgDkUGn9jucmENWkPtg",GOOGLE_TTS_API_KEY:"AIzaSyBphJBFocsINvoOrnSKEpPpTZlGRIBvY9Y"},ea={OPENAI:{enabled:!1,name:"ChatGPT",description:"OpenAI GPT-3.5/4 API"},HUGGING_FACE:{enabled:!0,name:"Hugging Face",description:"Бесплатные открытые модели ИИ"},COHERE:{enabled:!0,name:"Cohere",description:"Бесплатный тариф до 1000 запросов/месяц"},LEONARDO:{enabled:!0,name:"Leonardo.ai",description:"Генерация изображений с помощью ИИ"},GOOGLE_TRANSLATE:{enabled:!0,name:"Google Translate",description:"Автоматический перевод слов"},GEMINI:{enabled:!0,name:"Google Gemini",description:"Google Gemini AI для генерации слов"},GOOGLE_TTS:{enabled:!0,name:"Google Text-to-Speech",description:"Преобразование текста в речь"}};function Ee(i){const t=Ga[i];return t.includes("xxxxxxxx")||t.includes("your-")||t.includes("here")?null:t}function be(i){return ea[i].enabled}function Wa(){return Object.entries(ea).map(([i,t])=>({key:i,name:t.name,description:t.description,enabled:t.enabled}))}function ta(){return["GEMINI","OPENAI","HUGGING_FACE","COHERE"]}function $a(){return["LEONARDO"]}function Ma(){const i=ta();for(const t of i)if(be(t))return t;return null}function Fa(){const i=$a();for(const t of i)if(be(t))return t;return null}class Ba{logServerUrl="http://localhost:3001/log";isServerAvailable=!0;async sendToServer(t){if(this.isServerAvailable)try{(await fetch(this.logServerUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,timestamp:t.timestamp||new Date().toISOString(),source:t.source||"browser"})})).ok||(this.isServerAvailable=!1,console.warn("Log server not available, falling back to console only"))}catch{this.isServerAvailable=!1,console.warn("Log server not available, falling back to console only")}}logInternal(t,a,r,s){const l={level:t,message:a,data:r,source:s||"app"},n=console[t]||console.log;r?n(`[${l.source}] ${a}`,r):n(`[${l.source}] ${a}`),this.sendToServer(l)}log(t,a,r){this.logInternal("log",t,a,r)}info(t,a,r){this.logInternal("info",t,a,r)}warn(t,a,r){this.logInternal("warn",t,a,r)}error(t,a,r){this.logInternal("error",t,a,r)}debug(t,a,r){this.logInternal("debug",t,a,r)}}const Lt=new Ba,Z=(i,t,a)=>{Lt.info(i,t,a)},dt=(i,t,a)=>{Lt.warn(i,t,a)},Se=(i,t,a)=>{Lt.error(i,t,a)};class Ne{static PUBLIC_BUCKET="cards";static PRIVATE_BUCKET="user-images";static MAX_FILE_SIZE=5*1024*1024;static async uploadPublicCardImage(t,a,r){try{if(!k)throw new Error("Supabase not configured");const s=`cards/${a}/orig.webp`,{data:l,error:n}=await k.storage.from(this.PUBLIC_BUCKET).upload(s,t,{upsert:!0,contentType:"image/webp",metadata:r||{}});if(n)throw n;const o=this.getPublicImageUrl(s);return{path:s,url:o,metadata:r}}catch(s){throw console.error("Error uploading public card image:",s),s}}static async uploadUserCardImage(t,a,r,s){try{if(Z("🔄 ImageStorageService: Starting uploadUserCardImage",{userId:a,cardId:r,fileSize:t.size,fileType:t.type},"ImageStorageService"),!k)throw Se("❌ ImageStorageService: Supabase not configured",null,"ImageStorageService"),new Error("Supabase not configured");const l=`${a}/cards/${r}/orig.webp`;Z("🔄 ImageStorageService: Upload path",{path:l},"ImageStorageService");const{data:n,error:o}=await k.storage.from(this.PRIVATE_BUCKET).upload(l,t,{upsert:!0,contentType:"image/webp",metadata:s||{}});if(o)throw Se("❌ ImageStorageService: Upload error",o,"ImageStorageService"),o;const d=this.getPublicImageUrl(l,this.PRIVATE_BUCKET);return Z("✅ ImageStorageService: Upload successful",{path:l,publicUrl:d},"ImageStorageService"),{path:l,url:d,metadata:s}}catch(l){throw Se("❌ ImageStorageService: Error uploading user card image",l,"ImageStorageService"),l}}static async importImageFromUrl(t,a,r,s=!1,l){try{const n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch image: ${n.statusText}`);const o=await n.blob();return s?await this.uploadPublicCardImage(o,r,l):await this.uploadUserCardImage(o,a,r,l)}catch(n){throw console.error("Error importing image from URL:",n),n}}static getPublicImageUrl(t,a=this.PUBLIC_BUCKET){if(!t)return"";const{data:r}=k?.storage.from(a).getPublicUrl(t)||{data:{publicUrl:""}};return r.publicUrl}static async createSignedUrl(t,a=3600){try{if(!k||!t)return"";const{data:r,error:s}=await k.storage.from(this.PRIVATE_BUCKET).createSignedUrl(t,a);if(s)throw s;return r.signedUrl}catch(r){return console.error("Error creating signed URL:",r),""}}static getImageUrlWithTransform(t,a={},r=!0,s){if(!t)return"";const l=r?this.getPublicImageUrl(t,s||this.PUBLIC_BUCKET):t;if(!r)return l;const n=new URLSearchParams;a.width&&n.append("width",a.width.toString()),a.height&&n.append("height",a.height.toString()),a.quality&&n.append("quality",a.quality.toString()),a.resize&&n.append("resize",a.resize),a.format&&n.append("format",a.format);const o=n.toString();return o?`${l}?${o}`:l}static async deleteImage(t,a=!0){try{if(!k||!t)return;const r=a?this.PUBLIC_BUCKET:this.PRIVATE_BUCKET,{error:s}=await k.storage.from(r).remove([t]);if(s)throw s}catch(r){throw console.error("Error deleting image:",r),r}}static async deleteCardImages(t){try{if(!k)return;const a=`cards/${t}/orig.webp`;await this.deleteImage(a,!0)}catch(a){throw console.error("Error deleting card images:",a),a}}static async deleteUserCardImages(t,a){try{if(!k)return;const r=`${t}/cards/${a}/orig.webp`;await this.deleteImage(r,!1)}catch(r){throw console.error("Error deleting user card images:",r),r}}static async convertToWebP(t){return new Promise((a,r)=>{const s=document.createElement("canvas"),l=s.getContext("2d"),n=new Image;n.onload=()=>{s.width=n.width,s.height=n.height,l?.drawImage(n,0,0),s.toBlob(o=>{o?a(o):r(new Error("Failed to convert image to WebP"))},"image/webp",.9)},n.onerror=()=>r(new Error("Failed to load image")),n.src=URL.createObjectURL(t)})}static validateImageFile(t){const a=["image/jpeg","image/png","image/webp"],r=this.MAX_FILE_SIZE;return a.includes(t.type)?t.size>r?{valid:!1,error:`File size too large. Maximum size is ${Math.round(r/1024/1024)}MB.`}:{valid:!0}:{valid:!1,error:"Invalid file type. Please upload JPEG, PNG, or WebP images."}}static getThumbnailPath(t){return t.replace("/orig.webp","/thumb.webp")}static getThumbnailUrl(t,a=!0,r=200){return t?this.getImageUrlWithTransform(t,{width:r,height:r,resize:"cover",quality:80},a):""}}class pe{static async getUserCards(){try{if(!k)return console.log("⚠️ CardService: Supabase not configured, returning empty array"),[];Z("🔍 CardService: Getting user cards...",null,"CardService");const{data:{user:t}}=await k.auth.getUser();if(!t)throw console.log("❌ CardService: User not authenticated"),new Error("User not authenticated");console.log("👤 CardService: User ID:",t.id);const{data:a,error:r}=await k.from("user_cards_with_content").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(r)throw console.error("❌ CardService: Database error:",r),r;return console.log("✅ CardService: Fetched cards:",a?.length||0),a.map(this.mapDatabaseToUserCardWithContent).map(n=>{const o={...n},d=new Date;return n.dueAt<=d?o.state="LEARN":n.progress>=10&&n.progress<70?o.state="REVIEW":o.state="SUSPENDED",o})}catch(t){return console.error("❌ CardService: Error fetching cards:",t),[]}}static async getCardsDueForReview(){try{if(!k)return console.log("⚠️ CardService: Supabase not configured, returning empty array"),[];const{data:{user:t}}=await k.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:a,error:r}=await k.from("cards_due_for_review").select("*").eq("user_id",t.id);if(r)throw r;return a.map(this.mapDatabaseToUserCardWithContent).map(n=>{const o={...n},d=new Date;return n.dueAt<=d?o.state="LEARN":n.progress>=10&&n.progress<70?o.state="REVIEW":o.state="SUSPENDED",o})}catch(t){return console.error("Error fetching cards due for review:",t),[]}}static async addCardToUser(t,a,r,s,l){try{if(!k)throw console.log("⚠️ CardService: Supabase not configured, cannot add card"),new Error("Supabase not configured");const{data:{user:n}}=await k.auth.getUser();if(!n)throw console.error("❌ CardService: User not authenticated"),new Error("User not authenticated");console.log("👤 CardService: User authenticated:",n.id);const{data:o,error:d}=await k.rpc("add_card_to_user",{p_user_id:n.id,p_language_pair_id:r,p_term:t,p_translation:a,p_image_url:s||null,p_english:l||null});if(d)throw console.error("❌ CardService: Database error:",d),console.error("❌ CardService: Error details:",JSON.stringify(d,null,2)),d;console.log("✅ CardService: Function response:",o);const{data:g,error:w}=await k.from("user_cards_with_content").select("*").eq("user_id",n.id).eq("term",t).eq("translation",a).eq("language_pair_id",r).single();return w?(console.error("❌ CardService: Error fetching added card:",w),null):(console.log("✅ CardService: Card added successfully"),this.mapDatabaseToUserCardWithContent(g))}catch(n){throw console.error("Error adding card to user:",n),n}}static async addCardToUserWithLesson(t,a,r="ru-es",s,l,n,o){try{if(!k)return console.log("⚠️ CardService: Supabase not configured, cannot add card"),null;const{data:{user:d}}=await k.auth.getUser();if(!d)throw console.error("❌ CardService: User not authenticated"),new Error("User not authenticated");Z("👤 CardService: User authenticated:",d.id,"CardService"),Z("📚 CardService: Adding card with lesson info:",{term:t,translation:a,languagePairId:r,lessonId:n,lessonOrder:o},"CardService");const{data:g,error:w}=await k.rpc("add_card_to_user_with_lesson",{p_language_pair_id:r,p_term:t,p_translation:a,p_image_url:s||null,p_english:l||null,p_lesson_id:n||null,p_lesson_order:o||null});if(w)throw Se("❌ CardService: Database function error:",w,"CardService"),w;Z("✅ CardService: Database function success:",g,"CardService"),Z("📚 CardService: Function result - is_new:",{is_new:g.is_new,message:g.message},"CardService");const{data:_,error:T}=await k.from("user_cards_with_content").select("*").eq("user_id",d.id).eq("card_id",g.card_id).single();return T?(Se("❌ CardService: Error fetching card:",T,"CardService"),null):(Z("✅ CardService: Successfully fetched card data:",_,"CardService"),Z("📚 CardService: Card lesson info - lesson_id:",{lesson_id:_.lesson_id,lesson_order:_.lesson_order},"CardService"),this.mapDatabaseToUserCardWithContent(_))}catch(d){return Se("❌ CardService: Error in addCardToUserWithLesson:",d,"CardService"),null}}static async updateUserCard(t){try{if(!k)throw console.log("⚠️ CardService: Supabase not configured, cannot update card"),new Error("Supabase not configured");const{data:{user:a}}=await k.auth.getUser();if(!a)throw new Error("User not authenticated");const{error:r}=await k.from("user_cards").update({state:t.state,progress:t.progress,review_count:t.reviewCount,successful_reviews:t.successfulReviews,direction:t.direction,ease_factor:t.easeFactor,interval_days:t.intervalDays,due_at:t.dueAt.toISOString(),last_reviewed_at:t.lastReviewedAt?.toISOString()||null}).eq("user_id",t.userId).eq("card_id",t.cardId).select().single();if(r)throw r;const{data:s,error:l}=await k.from("user_cards_with_content").select("*").eq("user_id",t.userId).eq("card_id",t.cardId).single();if(l)throw console.error("❌ CardService: Error fetching updated card with content:",l),l;return console.log("✅ CardService: User card updated successfully with content"),this.mapDatabaseToUserCardWithContent(s)}catch(a){throw console.error("❌ CardService: Error updating user card:",a),a}}static async updateCardContent(t,a,r,s,l){try{if(console.log("🔄 CardService: updateCardContent called"),console.log("🔄 CardService: Parameters:",{cardId:t,term:a,translation:r,imageUrl:s,english:l}),!k)throw console.log("⚠️ CardService: Supabase not configured, cannot update card content"),new Error("Supabase not configured");console.log("🔄 CardService: Getting user authentication...");const{data:{user:n}}=await k.auth.getUser();if(!n)throw console.log("❌ CardService: User not authenticated"),new Error("User not authenticated");console.log("✅ CardService: User authenticated:",n.id);const o={term:a.trim(),translation:r.trim(),image_url:s?.trim()||null,english:l?.trim()||null,updated_at:new Date().toISOString()};console.log("🔄 CardService: Update data:",o),console.log("🔄 CardService: Checking for duplicates...");const{data:d}=await k.from("cards").select("id, language_pair_id, term, translation").eq("id",t).single();if(!d)throw new Error("Card not found");const{data:g}=await k.from("cards").select("id").eq("language_pair_id",d.language_pair_id).eq("term",o.term).eq("translation",o.translation).neq("id",t).single();if(g)return console.log("⚠️ CardService: Duplicate card found, will merge with existing card"),await this.mergeWithExistingCard(t,g.id,n.id,o.image_url,o.english);console.log("🔄 CardService: Updating cards table...");const{error:w}=await k.from("cards").update(o).eq("id",t);if(w)throw console.error("❌ CardService: Error updating card content:",w),console.error("❌ CardService: Error details:",{message:w.message,details:w.details,hint:w.hint,code:w.code}),w;console.log("✅ CardService: Card content updated successfully")}catch(n){throw console.error("❌ CardService: Error updating card content:",n),console.error("❌ CardService: Full error object:",n),n}}static async mergeWithExistingCard(t,a,r,s,l){try{if(console.log("🔄 CardService: mergeWithExistingCard called"),console.log("🔄 CardService: Parameters:",{oldCardId:t,existingCardId:a,userId:r,newImageUrl:s,newEnglish:l}),!k)throw new Error("Supabase not configured");if(s||l){console.log("🔄 CardService: Updating existing card with new image/english...");const o={};s&&(o.image_url=s),l&&(o.english=l),o.updated_at=new Date().toISOString();const{error:d}=await k.from("cards").update(o).eq("id",a);if(d)throw console.error("❌ CardService: Error updating existing card:",d),d;console.log("✅ CardService: Existing card updated with new image/english")}const{data:n}=await k.from("user_cards").select("*").eq("user_id",r).eq("card_id",a).single();if(n){console.log("🔄 CardService: User already has the existing card, removing old card");const{error:o}=await k.from("user_cards").delete().eq("user_id",r).eq("card_id",t);if(o)throw console.error("❌ CardService: Error removing old user card:",o),o}else{console.log("🔄 CardService: User does not have existing card, transferring progress");const{data:o}=await k.from("user_cards").select("*").eq("user_id",r).eq("card_id",t).single();if(o){const{error:d}=await k.from("user_cards").insert({user_id:r,card_id:a,state:o.state,progress:o.progress,review_count:o.review_count,successful_reviews:o.successful_reviews,direction:o.direction,ease_factor:o.ease_factor,interval_days:o.interval_days,due_at:o.due_at,last_reviewed_at:o.last_reviewed_at,lesson_id:o.lesson_id,lesson_order:o.lesson_order});if(d)throw console.error("❌ CardService: Error creating new user card:",d),d;const{error:g}=await k.from("user_cards").delete().eq("user_id",r).eq("card_id",t);if(g)throw console.error("❌ CardService: Error removing old user card:",g),g}}console.log("✅ CardService: Successfully merged cards")}catch(n){throw console.error("❌ CardService: Error merging cards:",n),n}}static async removeCardFromUser(t){try{if(!k)throw console.log("⚠️ CardService: Supabase not configured, cannot remove card"),new Error("Supabase not configured");const{data:{user:a}}=await k.auth.getUser();if(!a)throw new Error("User not authenticated");const{error:r}=await k.from("user_cards").delete().eq("user_id",a.id).eq("card_id",t);if(r)throw r;console.log("✅ CardService: Card removed from user collection")}catch(a){throw console.error("❌ CardService: Error removing card from user:",a),a}}static async getCardsForLanguagePair(t){try{if(!k)return console.log("⚠️ CardService: Supabase not configured, returning empty array"),[];const{data:{user:a}}=await k.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:r,error:s}=await k.from("user_cards_with_content").select("*").eq("user_id",a.id).eq("language_pair_id",t).order("created_at",{ascending:!1});if(s)throw s;return r.map(this.mapDatabaseToUserCardWithContent)}catch(a){return console.error("Error fetching cards for language pair:",a),[]}}static async checkForDuplicates(t,a,r){try{if(!k)return console.log("⚠️ CardService: Supabase not configured, cannot check duplicates"),null;const{data:{user:s}}=await k.auth.getUser();if(!s)return null;const{data:l,error:n}=await k.from("user_cards_with_content").select("*").eq("user_id",s.id).eq("language_pair_id",r).eq("term",t).eq("translation",a).limit(1);return n?(console.error("❌ CardService: Error checking duplicates:",n),null):l.length>0?(console.log("🔍 CardService: Found duplicate card:",{term:t,translation:a}),this.mapDatabaseToUserCardWithContent(l[0])):null}catch(s){return console.error("Error checking for duplicates:",s),null}}static async hasUserCards(){try{if(!k)return console.log("⚠️ CardService: Supabase not configured"),!1;const{data:{user:t}}=await k.auth.getUser();if(!t)return!1;const{data:a,error:r}=await k.from("user_cards").select("card_id").eq("user_id",t.id).limit(1);return r?(console.error("❌ CardService: Error checking if user has cards:",r),!1):a.length>0}catch(t){return console.error("Error checking if user has cards:",t),!1}}static async getLessonCardsInOrder(t){try{if(!k)return console.log("⚠️ CardService: Supabase not configured"),[];const{data:{user:a}}=await k.auth.getUser();if(!a)return[];const{data:r,error:s}=await k.from("user_cards_with_content").select("*").eq("user_id",a.id).eq("lesson_id",t).not("lesson_order","is",null).order("lesson_order",{ascending:!0});return s?(console.error("❌ CardService: Error fetching lesson cards:",s),[]):r.map(this.mapDatabaseToUserCardWithContent)}catch(a){return console.error("Error fetching lesson cards:",a),[]}}static async addCardsFromLesson(t,a="ru-es",r){try{if(Z(`🔄 CardService: Starting addCardsFromLesson with ${t.length} words`,{lessonId:r,languagePairId:a},"CardService"),!k)return dt("⚠️ CardService: Supabase not configured, cannot add cards",null,"CardService"),{added:0,skipped:0};const{data:{user:s}}=await k.auth.getUser();if(!s)throw console.error("❌ CardService: User not authenticated in addCardsFromLesson"),new Error("User not authenticated");Z("👤 CardService: User authenticated in addCardsFromLesson:",s.id,"CardService");const{data:l,error:n}=await k.from("user_cards_with_content").select("term").eq("user_id",s.id);if(n)throw Se("❌ CardService: Error fetching existing cards:",n,"CardService"),n;const o=l?.map(w=>w.term.toLowerCase())||[];Z(`📊 CardService: Found ${o.length} existing cards for user`,null,"CardService");let d=0,g=0;for(let w=0;w<t.length;w++){const _=t[w],T=w+1;if(o.includes(_.term.toLowerCase())){Z(`⏭️ Skipping duplicate word: "${_.term}" - "${_.translation}"`,null,"CardService"),g++;continue}Z(`📚 Adding word ${w+1}/${t.length}: "${_.term}" - "${_.translation}" (order: ${T})`,null,"CardService");try{const y=await this.addCardToUserWithLesson(_.term,_.translation,a,void 0,_.english,r,T);y?(Z(`✅ Processed word: "${_.term}" - "${_.translation}" (card_id: ${y.cardId})`,null,"CardService"),d++):Se(`❌ Failed to add word: "${_.term}" - "${_.translation}"`,null,"CardService")}catch(y){Se(`❌ Error adding word "${_.term}":`,y,"CardService"),y instanceof Error&&y.message.includes("duplicate")&&g++}}return Z(`✅ CardService: Added ${d} cards, skipped ${g} duplicates`,null,"CardService"),{added:d,skipped:g}}catch(s){return console.error("❌ CardService: Error adding cards from lesson:",s),{added:0,skipped:0}}}static async recordReview(t,a,r,s,l,n){try{if(!k)throw console.log("⚠️ CardService: Supabase not configured, cannot record review"),new Error("Supabase not configured");const{data:{user:o}}=await k.auth.getUser();if(!o)throw new Error("User not authenticated");const{data:d,error:g}=await k.from("reviews").insert({user_id:o.id,card_id:t,rating:a,prev_interval:r,next_interval:s,prev_ef:l,next_ef:n}).select().single();if(g)throw g;return console.log("✅ CardService: Review recorded successfully"),this.mapDatabaseToReview(d)}catch(o){throw console.error("❌ CardService: Error recording review:",o),o}}static async getCardReviewHistory(t){try{if(!k)return console.log("⚠️ CardService: Supabase not configured, returning empty array"),[];const{data:{user:a}}=await k.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:r,error:s}=await k.from("reviews").select("*").eq("user_id",a.id).eq("card_id",t).order("reviewed_at",{ascending:!1});if(s)throw s;return r.map(this.mapDatabaseToReview)}catch(a){return console.error("Error fetching review history:",a),[]}}static mapDatabaseToUserCardWithContent(t){return{userId:t.user_id,cardId:t.card_id,languagePairId:t.language_pair_id,term:t.term,translation:t.translation,imageUrl:t.image_url,imagePath:t.image_path,imageMetadata:t.image_metadata,english:t.english,customImagePath:t.custom_image_path,customImageMetadata:t.custom_image_metadata,state:t.state,progress:t.progress,reviewCount:t.review_count,successfulReviews:t.successful_reviews,direction:t.direction,easeFactor:parseFloat(t.ease_factor),intervalDays:t.interval_days,dueAt:t.due_at?new Date(t.due_at):new Date,lastReviewedAt:t.last_reviewed_at?new Date(t.last_reviewed_at):void 0,lessonId:t.lesson_id,lessonOrder:t.lesson_order,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}}static mapDatabaseToUserCard(t){return{userId:t.user_id,cardId:t.card_id,state:t.state,progress:t.progress,reviewCount:t.review_count,successfulReviews:t.successful_reviews,direction:t.direction,easeFactor:parseFloat(t.ease_factor),intervalDays:t.interval_days,dueAt:new Date(t.due_at),lastReviewedAt:t.last_reviewed_at?new Date(t.last_reviewed_at):void 0,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}}static mapDatabaseToReview(t){return{id:t.id,userId:t.user_id,cardId:t.card_id,reviewedAt:new Date(t.reviewed_at),rating:t.rating,prevInterval:t.prev_interval,nextInterval:t.next_interval,prevEf:t.prev_ef,nextEf:t.next_ef}}static async createCard(t){return console.warn("⚠️ CardService: createCard is deprecated, use addCardToUser instead"),this.addCardToUser(t.term,t.translation,t.languagePairId||"ru-es",t.imageUrl,t.english)}static async updateCard(t){console.warn("⚠️ CardService: updateCard is deprecated, use updateUserCard instead");const a={userId:t.userId||"",cardId:parseInt(t.id),state:t.state,progress:t.progress,reviewCount:t.reviewCount,successfulReviews:t.successfulReviews,direction:t.direction,easeFactor:t.easeFactor,intervalDays:t.intervalDays,dueAt:t.dueAt,lastReviewedAt:t.lastReviewedAt,createdAt:t.createdAt,updatedAt:t.updatedAt};return this.updateUserCard(a)}static async deleteCard(t){return console.warn("⚠️ CardService: deleteCard is deprecated, use removeCardFromUser instead"),this.removeCardFromUser(parseInt(t))}static async uploadCardImage(t,a,r){try{const s=await Ne.uploadPublicCardImage(a,t,r);if(k){const{error:l}=await k.from("cards").update({image_path:s.path,image_metadata:r||{}}).eq("id",t);if(l)throw l}return{path:s.path,url:s.url}}catch(s){throw console.error("Error uploading card image:",s),s}}static async uploadUserCardImage(t,a,r){try{if(!k)throw new Error("Supabase not configured");const{data:{user:s}}=await k.auth.getUser();if(!s)throw new Error("User not authenticated");const l=await Ne.uploadUserCardImage(a,s.id,t,r),{error:n}=await k.from("user_cards").update({custom_image_path:l.path,custom_image_metadata:r||{}}).eq("user_id",s.id).eq("card_id",t);if(n)throw n;return{path:l.path,url:l.url}}catch(s){throw console.error("Error uploading user card image:",s),s}}static async importCardImageFromUrl(t,a,r=!1,s){try{if(!k)throw new Error("Supabase not configured");const{data:{user:l}}=await k.auth.getUser();if(!l)throw new Error("User not authenticated");const n=await Ne.importImageFromUrl(a,l.id,t,r,s);if(r){const{error:o}=await k.from("cards").update({image_path:n.path,image_metadata:s||{}}).eq("id",t);if(o)throw o}else{const{error:o}=await k.from("user_cards").update({custom_image_path:n.path,custom_image_metadata:s||{}}).eq("user_id",l.id).eq("card_id",t);if(o)throw o}return{path:n.path,url:n.url}}catch(l){throw console.error("Error importing card image from URL:",l),l}}static async deleteUserCardImage(t){try{if(!k)throw new Error("Supabase not configured");const{data:{user:a}}=await k.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:r}=await k.from("user_cards").select("custom_image_path").eq("user_id",a.id).eq("card_id",t).single();if(r?.custom_image_path){await Ne.deleteUserCardImages(a.id,t);const{error:s}=await k.from("user_cards").update({custom_image_path:null,custom_image_metadata:null}).eq("user_id",a.id).eq("card_id",t);if(s)throw s}}catch(a){throw console.error("Error deleting user card image:",a),a}}static async getCardImageUrl(t){try{return t.customImagePath?Ne.getPublicImageUrl(t.customImagePath,"user-images"):t.imagePath?Ne.getPublicImageUrl(t.imagePath,"cards"):t.imageUrl||""}catch(a){return console.error("Error getting card image URL:",a),t.imageUrl||""}}static async getCardThumbnailUrl(t,a=200){try{return t.customImagePath?Ne.getImageUrlWithTransform(t.customImagePath,{width:a,height:a,resize:"cover",quality:80},!0,"user-images"):t.imagePath?Ne.getThumbnailUrl(t.imagePath,!0,a):t.imageUrl||""}catch(r){return console.error("Error getting card thumbnail URL:",r),t.imageUrl||""}}}class nt{static API_BASE_URL="https://cloud.leonardo.ai/api/rest/v1";static AVAILABLE_MODELS={"leonardo-xl":{id:"6bef9f1b-29cb-40c7-b9df-32b51c1f67d3",name:"Leonardo Diffusion XL",description:"Основная модель Leonardo для высококачественной генерации",cost:6},"leonardo-diffusion":{id:"ac614f96-1082-45bf-be9d-757f2d31c174",name:"Leonardo Diffusion",description:"Классическая модель Leonardo",cost:6},"leonardo-creative":{id:"e316348f-7773-490e-adcd-46757c738eb7",name:"Leonardo Creative",description:"Креативная модель для художественных изображений",cost:6},flux:{id:"b2614463-296c-462a-9586-aafdb8f00e36",name:"FLUX",description:"Модель FLUX для высококачественной генерации",cost:11,styleUUID:"111dc692-d470-4eec-b791-3475abac4c46"}};static FALLBACK_IMAGES=["https://images.pexels.com/photos/102104/pexels-photo-102104.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/159711/books-bookstore-book-reading-159711.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?w=200&h=200&fit=crop&crop=face"];static async generateImage(t){console.log("🎨 LeonardoImageGeneratorService: Generating image for:",t);try{if(!be("LEONARDO"))return console.warn("⚠️ Leonardo.ai service is not enabled"),{success:!1,error:"Сервис Leonardo.ai отключен в настройках"};const a=Ee("LEONARDO_API_KEY");if(!a)return console.warn("⚠️ Leonardo.ai API key is not configured"),{success:!1,error:"API ключ Leonardo.ai не настроен"};const r=this.buildPrompt(t.word,t.language,t.style),s=this.getModelInfo(t.model||"flux"),l={prompt:r,modelId:s.id,width:320,height:320,num_images:1,seed:this.generateSeed(t.word)};t.model==="flux"?(l.contrast=3.5,l.ultra=!0,l.enhancePrompt=!0,s.styleUUID&&(l.styleUUID=s.styleUUID)):l.guidance_scale=4,console.log("🚀 Creating Leonardo.ai generation job...");const n=await this.createGeneration(l,a);if(!n.success||!n.generationId)return console.error("❌ Failed to create generation job:",n.error),{success:!1,error:`Не удалось создать задачу генерации: ${n.error||"Неизвестная ошибка"}`};console.log("⏳ Waiting for image generation to complete...");const o=await this.waitForGeneration(n.generationId,a);return o?(console.log("✅ Image generated successfully with Leonardo.ai"),{success:!0,imageUrl:o,service:"Leonardo.ai",prompt:r,model:s.name,seed:l.seed}):(console.warn("⚠️ Image generation failed"),{success:!1,error:"Генерация изображения не завершилась успешно"})}catch(a){return console.error("❌ LeonardoImageGeneratorService: Error generating image:",a),{success:!1,error:`Ошибка при генерации изображения: ${a instanceof Error?a.message:"Неизвестная ошибка"}`}}}static async createGeneration(t,a){try{const r=await fetch(`${this.API_BASE_URL}/generations`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({prompt:t.prompt,modelId:t.modelId||"b2614463-296c-462a-9586-aafdb8f00e36",width:t.width||320,height:t.height||320,num_images:t.num_images||1,seed:t.seed,...t.guidance_scale&&{guidance_scale:Math.round(t.guidance_scale)},...t.contrast&&{contrast:t.contrast},...t.ultra&&{ultra:t.ultra},...t.styleUUID&&{styleUUID:t.styleUUID},...t.enhancePrompt&&{enhancePrompt:t.enhancePrompt}})});if(!r.ok){const l=await r.text();throw new Error(`HTTP error! status: ${r.status}, message: ${l}`)}const s=await r.json();return s.sdGenerationJob&&s.sdGenerationJob.generationId?{success:!0,generationId:s.sdGenerationJob.generationId}:{success:!1,error:"No generation job created"}}catch(r){return console.error("Error creating generation:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}static async waitForGeneration(t,a,r=30){for(let s=0;s<r;s++)try{const l=await fetch(`${this.API_BASE_URL}/generations/${t}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const n=await l.json();if(!n.generations_by_pk)throw new Error("Generation not found");const o=n.generations_by_pk;if(console.log(`📊 Generation status: ${o.status} (attempt ${s+1}/${r})`),o.status==="COMPLETE"&&o.generated_images?.length>0)return o.generated_images[0].url;if(o.status==="FAILED")throw new Error("Generation failed");await new Promise(d=>setTimeout(d,3e3))}catch(l){if(console.error(`Error checking generation status (attempt ${s+1}):`,l),s===r-1)throw l;await new Promise(n=>setTimeout(n,3e3))}throw new Error("Generation timeout")}static buildPrompt(t,a,r="cartoon"){const n=`A single ${{es:{manzana:"apple",perro:"dog",casa:"house",agua:"water",libro:"book",gato:"cat",sol:"sun",luna:"moon",árbol:"tree",flor:"flower",coche:"car",avión:"airplane",comida:"food",música:"music",deporte:"sport",familia:"family",amigo:"friend",escuela:"school",trabajo:"work",tiempo:"time",dinero:"money",feliz:"happy",triste:"sad",grande:"big",pequeño:"small",rojo:"red",azul:"blue",verde:"green",amarillo:"yellow",negro:"black",blanco:"white",madre:"mother",padre:"father",hermana:"sister",hermano:"brother",abuela:"grandmother",abuelo:"grandfather",bebé:"baby",niño:"child",hombre:"man",mujer:"woman",plátano:"banana",naranja:"orange",pan:"bread",leche:"milk",café:"coffee",té:"tea",jugo:"juice",pastel:"cake",pizza:"pizza",pollo:"chicken",pescado:"fish",arroz:"rice",pasta:"pasta",pájaro:"bird",pez:"fish",caballo:"horse",vaca:"cow",cerdo:"pig",oveja:"sheep",conejo:"rabbit",ratón:"mouse",habitación:"room",cocina:"kitchen",dormitorio:"bedroom",baño:"bathroom",sala:"living room",mesa:"table",silla:"chair",cama:"bed",puerta:"door",ventana:"window",escalera:"stairs",gris:"gray",marrón:"brown",rosa:"pink",uno:"one",dos:"two",tres:"three",cuatro:"four",cinco:"five",seis:"six",siete:"seven",ocho:"eight",nueve:"nine",diez:"ten"}}[a]?.[t.toLowerCase()]||t}, clearly visible and recognizable, educational flashcard style`,o={cartoon:"cartoon illustration, bright colors, simple lines, child-friendly style, educational material",realistic:"realistic photograph, high quality, detailed, clear and sharp",artistic:"artistic illustration, beautiful colors, creative style, educational",simple:"simple line drawing, minimal style, clean and clear, educational"},d=o[r]||o.cartoon;return`${n}, ${d}, ${["pure white background","centered composition","no other objects","no text or words","no decorative elements","clear and recognizable","educational flashcard quality","high contrast","well-defined edges","FLUX quality"].join(", ")}`}static getImageWidth(){return 512}static getImageHeight(){return 512}static generateSeed(t){let a=0;for(let r=0;r<t.length;r++){const s=t.charCodeAt(r);a=(a<<5)-a+s,a=a&a}return Math.abs(a)}static getModelInfo(t){const a=this.AVAILABLE_MODELS[t];return a||(console.warn(`⚠️ Модель ${t} не найдена, используем FLUX`),this.AVAILABLE_MODELS.flux)}static getFallbackImage(){const t=Math.floor(Math.random()*this.FALLBACK_IMAGES.length);return{success:!0,imageUrl:this.FALLBACK_IMAGES[t],service:"Fallback"}}static getAvailableModels(){return Object.entries(this.AVAILABLE_MODELS).map(([t,a])=>({value:t,label:a.name,description:a.description,cost:a.cost,isFlux:t==="flux"}))}static getAvailableStyles(){return[{value:"cartoon",label:"Мультяшный"},{value:"realistic",label:"Реалистичный"},{value:"artistic",label:"Художественный"},{value:"simple",label:"Простой"}]}static getServiceInfo(){return{name:"Leonardo.ai",description:"Высококачественная генерация изображений с помощью ИИ (FLUX по умолчанию)",free:!1,defaultModel:"FLUX"}}static async generateAndSaveImage(t,a,r="es",s="cartoon",l=!1){try{console.log("🎨 LeonardoImageGenerator: Starting generation and save process");const n=await this.generateImage({word:a,language:r,style:s});if(!n.success||!n.imageUrl)return{success:!1,error:n.error||"Failed to generate image"};console.log("🎨 LeonardoImageGenerator: Image generated, importing to storage...");const o={source:"leonardo",prompt:n.prompt||a,model:n.model||"FLUX",seed:n.seed?.toString(),generated_at:new Date().toISOString(),original_url:n.imageUrl,style:s,language:r},d=await pe.importCardImageFromUrl(t,n.imageUrl,l,o);return console.log("🎨 LeonardoImageGenerator: Image saved to storage:",d.path),{success:!0,imageUrl:d.url}}catch(n){return console.error("🎨 LeonardoImageGenerator: Error in generateAndSaveImage:",n),{success:!1,error:n instanceof Error?n.message:"Unknown error occurred"}}}static async generateForCard(t,a,r,s,l="cartoon"){try{console.log("🎨 LeonardoImageGenerator: Generating image for card:",{cardId:t,term:a,translation:r,english:s});const n=this.createImagePrompt(a,r,s),o=await this.generateAndSaveImage(t,n,"es",l,!1);return o.success?console.log("🎨 LeonardoImageGenerator: Successfully generated and saved image for card:",t):console.error("🎨 LeonardoImageGenerator: Failed to generate image for card:",t,o.error),o}catch(n){return console.error("🎨 LeonardoImageGenerator: Error generating for card:",n),{success:!1,error:n instanceof Error?n.message:"Failed to generate image for card"}}}static createImagePrompt(t,a,r){const s=`A clear, simple illustration of "${t}" (${a})`;return r?`${s}, which means "${r}" in English`:s}static async generateMultipleVariants(t,a,r,s,l=3){try{console.log("🎨 LeonardoImageGenerator: Generating multiple variants for card:",t);const n=["cartoon","artistic","simple"],o=[];for(let d=0;d<Math.min(l,n.length);d++){const g=n[d],w=await this.generateForCard(t,a,r,s,g);w.success&&w.imageUrl&&o.push({url:w.imageUrl,style:g})}return o.length===0?{success:!1,error:"Failed to generate any images"}:(console.log("🎨 LeonardoImageGenerator: Generated",o.length,"variants for card:",t),{success:!0,images:o})}catch(n){return console.error("🎨 LeonardoImageGenerator: Error generating multiple variants:",n),{success:!1,error:n instanceof Error?n.message:"Failed to generate multiple variants"}}}}class Fe{static baseUrl="https://translation.googleapis.com/language/translate/v2";static async translate(t){try{if(console.log("🌍 Google Translate: Starting translation..."),console.log("Request:",t),!be("GOOGLE_TRANSLATE"))throw new Error("Google Translate service is not enabled");const a=Ee("GOOGLE_TRANSLATE_API_KEY");if(!a)throw new Error("Google Translate API key is not configured");const r=await fetch(`${this.baseUrl}?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:t.text,source:t.sourceLanguage,target:t.targetLanguage,format:"text"})});if(!r.ok){const l=await r.json();throw new Error(`Google Translate API error: ${l.error?.message||r.statusText}`)}const s=await r.json();if(s.data?.translations?.[0]?.translatedText){const l=s.data.translations[0].translatedText;return console.log("✅ Google Translate: Translation successful"),console.log(`"${t.text}" → "${l}"`),{translatedText:l,success:!0}}else throw new Error("Invalid response format from Google Translate API")}catch(a){return console.error("❌ Google Translate: Translation failed:",a),{translatedText:"",success:!1,error:a instanceof Error?a.message:"Translation failed"}}}static async translateToEnglish(t,a){return this.translate({text:t,sourceLanguage:a,targetLanguage:"en"})}static async translateFromEnglish(t,a){return this.translate({text:t,sourceLanguage:"en",targetLanguage:a})}static getServiceInfo(){return{name:"Google Translate",description:"Автоматический перевод слов с помощью Google Translate API",free:!1}}static isAvailable(){return be("GOOGLE_TRANSLATE")&&!!Ee("GOOGLE_TRANSLATE_API_KEY")}static getSetupInstructions(){return`
Для использования автоматического перевода необходимо настроить Google Translate API:

1. Перейдите в Google Cloud Console: https://console.cloud.google.com/
2. Создайте новый проект или выберите существующий
3. Включите Google Translate API:
   - Перейдите в "APIs & Services" > "Library"
   - Найдите "Cloud Translation API"
   - Нажмите "Enable"
4. Создайте API ключ:
   - Перейдите в "APIs & Services" > "Credentials"
   - Нажмите "Create Credentials" > "API Key"
   - Скопируйте созданный ключ
5. Замените YOUR_GOOGLE_TRANSLATE_API_KEY в src/config/apiKeys.ts
6. Установите enabled: true для GOOGLE_TRANSLATE в SERVICE_STATUS

Примечание: Google Translate API платный, но первые 500,000 символов в месяц бесплатны.
    `}}const Ye=({isOpen:i,onClose:t,onSave:a,editCard:r,existingCards:s=[]})=>{const[l,n]=c.useState({term:"",translation:"",english:"",imageUrl:""}),[o,d]=c.useState({}),[g,w]=c.useState(""),[_]=c.useState(()=>X.getUserSettings()),[T,y]=c.useState(!1),[P,R]=c.useState(!1),[u,C]=c.useState(!1),[S,h]=c.useState(!1),[I,U]=c.useState(null),[O,$]=c.useState("");c.useEffect(()=>{Z("🔄 AddWordModal: useEffect triggered",{editCard:r,isOpen:i},"AddWordModal"),r?(Z("🔄 AddWordModal: Initializing form with editCard data",{term:r.term,translation:r.translation,imageUrl:r.imageUrl},"AddWordModal"),n({term:r.term,translation:r.translation,english:"",imageUrl:r.imageUrl||""})):(Z("🔄 AddWordModal: Initializing form with empty data",null,"AddWordModal"),n({term:"",translation:"",english:"",imageUrl:""})),d({}),w(""),U(null),$("")},[r,i]);const f=()=>{const b={};return l.term.trim()||(b.term="Слово обязательно"),l.translation.trim()||(b.translation="Перевод обязателен"),l.imageUrl&&!E(l.imageUrl)&&(b.imageUrl="Некорректный URL изображения"),d(b),Object.keys(b).length===0},p=()=>{if(!l.term.trim()||!l.translation.trim())return;const b=r?.languagePairId||(()=>{const A=xe.getLanguagePair();return A?xe.generateLanguagePairId(A.known_language_code,A.learning_language_code):"ru-en"})(),N=fe.checkForDuplicates(s,l.term.trim(),l.translation.trim(),b);w(N&&N.cardId!==r?.cardId?`Похожая карточка уже существует: "${N.term}" - "${N.translation}"`:"")},E=b=>{try{return new URL(b),!0}catch{return!1}},G=async b=>{if(b.preventDefault(),Z("🔄 AddWordModal: handleSubmit called",{editCard:r,formData:l,imageFile:I},"AddWordModal"),!f()){dt("❌ AddWordModal: Form validation failed",null,"AddWordModal");return}let N=l.imageUrl.trim()||void 0;if(I){Z("🔄 AddWordModal: Uploading image file...",{fileName:I.name,fileSize:I.size},"AddWordModal"),h(!0);try{const v=Ne.validateImageFile(I);if(!v.valid){Se("❌ AddWordModal: File validation failed",v,"AddWordModal"),d(j=>({...j,imageUrl:v.error||"Invalid image file"})),h(!1);return}Z("🔄 AddWordModal: Converting image to WebP...",null,"AddWordModal");const m=await Ne.convertToWebP(I);Z("🔄 AddWordModal: Uploading to Supabase Storage...",{userId:_?.user_id||"anonymous",cardId:r?.cardId||Date.now()},"AddWordModal"),N=(await Ne.uploadUserCardImage(m,_?.user_id||"anonymous",r?.cardId||Date.now(),{source:"user_upload",original_filename:I.name,uploaded_at:new Date().toISOString()})).url,Z("✅ AddWordModal: Image uploaded successfully",{finalImageUrl:N},"AddWordModal")}catch(v){Se("❌ AddWordModal: Error uploading image",v,"AddWordModal"),d(m=>({...m,imageUrl:"Ошибка при загрузке изображения: "+(v instanceof Error?v.message:"Unknown error")})),h(!1);return}finally{h(!1)}}const A={term:l.term.trim(),translation:l.translation.trim(),imageUrl:N,languagePairId:r?.languagePairId||(()=>{const v=xe.getLanguagePair();return v?xe.generateLanguagePairId(v.known_language_code,v.learning_language_code):"ru-en"})(),progress:r?.progress||0,state:r?.state||se.LEARN,reviewCount:r?.reviewCount||0,successfulReviews:r?.successfulReviews||0,direction:r?.direction||Le.KNOWN_TO_LEARNING,easeFactor:r?.easeFactor||2.5,intervalDays:r?.intervalDays||0,dueAt:r?.dueAt||new Date,lastReviewedAt:r?.lastReviewedAt};Z("🔄 AddWordModal: Prepared cardData",A,"AddWordModal"),Z("🔄 AddWordModal: Calling onSave...",null,"AddWordModal"),a(A),Z("🔄 AddWordModal: Calling onClose...",null,"AddWordModal"),t()},M=(b,N)=>{n(A=>({...A,[b]:N})),o[b]&&d(A=>({...A,[b]:""})),setTimeout(p,300)},z=b=>{const N=b.target.files?.[0];if(!N)return;Z("🔄 AddWordModal: File selected",{fileName:N.name,fileSize:N.size,fileType:N.type},"AddWordModal");const A=Ne.validateImageFile(N);if(!A.valid){Se("❌ AddWordModal: File validation failed",A,"AddWordModal"),d(m=>({...m,imageUrl:A.error||"Invalid image file"}));return}U(N);const v=new FileReader;v.onload=m=>{const x=m.target?.result;$(x),n(j=>({...j,imageUrl:x})),Z("✅ AddWordModal: Image preview created",{previewSize:x.length},"AddWordModal")},v.readAsDataURL(N),o.imageUrl&&d(m=>({...m,imageUrl:""}))},L=async()=>{if(!l.term.trim()){d(b=>({...b,translation:"Сначала введите слово для перевода"}));return}if(!Fe.isAvailable()){alert("Google Translate API не настроен. Обратитесь к администратору для настройки.");return}R(!0),d(b=>({...b,translation:"",english:""}));try{console.log("🌍 Автоматический перевод слова:",l.term);const b=_?.learning_language_code||"es",N=await Fe.translate({text:l.term,sourceLanguage:b,targetLanguage:_?.known_language_code||"ru"}),A=await Fe.translateToEnglish(l.term,b);if(N.success&&A.success)n(v=>({...v,translation:N.translatedText,english:A.translatedText})),console.log("✅ Автоматический перевод успешен:"),console.log(`"${l.term}" → "${N.translatedText}" → "${A.translatedText}"`);else{const v=[];N.success||v.push(`Перевод: ${N.error}`),A.success||v.push(`Английский: ${A.error}`),d(m=>({...m,translation:v.join(", ")}))}}catch(b){console.error("❌ Ошибка при автоматическом переводе:",b);const N=b instanceof Error?b.message:"Неизвестная ошибка";d(A=>({...A,translation:`Ошибка перевода: ${N}`}))}finally{R(!1)}},B=async()=>{if(!l.term.trim()){d(b=>({...b,imageUrl:"Сначала введите слово для генерации изображения"}));return}y(!0),d(b=>({...b,imageUrl:"",translation:"",english:""}));try{if(console.log("🎨 Запуск процесса генерации изображения для слова:",l.term),Fe.isAvailable()){console.log("🌍 Шаг 1: Автоматический перевод...");const A=_?.learning_language_code||"es",v=await Fe.translate({text:l.term,sourceLanguage:A,targetLanguage:_?.known_language_code||"ru"}),m=await Fe.translateToEnglish(l.term,A);v.success&&m.success?(n(x=>({...x,translation:v.translatedText,english:m.translatedText})),console.log("✅ Автоматический перевод успешен:"),console.log(`"${l.term}" → "${v.translatedText}" → "${m.translatedText}"`)):console.log("⚠️ Автоматический перевод не удался, продолжаем с исходным словом")}else console.log("⚠️ Google Translate недоступен, продолжаем без перевода");console.log("🎨 Шаг 2: Генерация изображения...");const b=l.english.trim()||l.term.trim(),N=await nt.generateImage({word:b,language:"en",style:"cartoon"});N.success&&N.imageUrl?(n(A=>({...A,imageUrl:N.imageUrl})),console.log("✅ Изображение успешно сгенерировано:",N.imageUrl)):(d(A=>({...A,imageUrl:"Не удалось сгенерировать изображение. Попробуйте позже."})),console.error("❌ Ошибка генерации изображения:",N.error))}catch(b){console.error("❌ Ошибка при генерации изображения:",b),d(N=>({...N,imageUrl:"Произошла ошибка при генерации изображения"}))}finally{y(!1)}};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:r?"Редактировать":"Добавить слово"}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:G,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"term",className:"block text-sm font-medium text-gray-700 mb-2",children:_?.learning_language||"Español"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"term",value:l.term,onChange:b=>M("term",b.target.value),placeholder:`Например: ${_?.learning_language_code==="en"?"apple":_?.learning_language_code==="es"?"manzana":_?.learning_language_code==="fr"?"pomme":"word"}`,className:`w-full px-3 py-3 pr-20 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors ${o.term?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[Fe.isAvailable()&&e.jsx("button",{type:"button",onClick:L,disabled:P||!l.term.trim(),className:`p-1 rounded transition-colors ${P||!l.term.trim()?"text-gray-300 cursor-not-allowed":"text-green-600 hover:text-green-700 hover:bg-green-50"}`,title:"Автоматический перевод",children:P?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}):e.jsx(Vt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded transition-colors",title:"Произношение",children:e.jsx(We,{className:"w-4 h-4"})})]})]}),o.term&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.term}),g&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["⚠️ ",g]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"translation",className:"block text-sm font-medium text-gray-700 mb-2",children:_?.known_language||"Русский"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"translation",value:l.translation,onChange:b=>M("translation",b.target.value),placeholder:`Например: ${_?.known_language_code==="ru"?"яблоко":_?.known_language_code==="en"?"apple":_?.known_language_code==="es"?"manzana":"слово"}`,className:`w-full px-3 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors ${o.translation?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(We,{className:"w-4 h-4"})})]}),o.translation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.translation})]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>C(!u),className:"flex items-center justify-between w-full p-2 text-sm font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx("span",{children:"Английский"}),u?e.jsx(ca,{className:"w-4 h-4"}):e.jsx(Et,{className:"w-4 h-4"})]}),u&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",id:"english",value:l.english,onChange:b=>M("english",b.target.value),placeholder:"Например: apple, house, car",className:`w-full px-3 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors ${o.english?"border-red-300 bg-red-50":"border-gray-300"}`})}),o.english&&e.jsx("p",{className:"text-sm text-red-600",children:o.english})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Загрузить изображение"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:z,className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:`w-full flex items-center justify-center gap-2 px-4 py-3 border rounded-lg font-medium transition-colors cursor-pointer ${S?"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed":"border-blue-300 text-blue-700 bg-blue-50 hover:bg-blue-100 hover:border-blue-400"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{children:"Загружаем изображение..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"w-4 h-4"}),e.jsx("span",{children:"Выбрать файл"})]})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Поддерживаются форматы: JPEG, PNG, WebP (макс. 5MB)"})]}),e.jsxs("div",{className:"flex items-center my-4",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"px-3 text-sm text-gray-500",children:"или"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{type:"button",onClick:B,disabled:T||!l.term.trim(),className:`w-full flex items-center justify-center gap-2 px-4 py-3 border rounded-lg font-medium transition-colors ${T||!l.term.trim()?"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed":"border-purple-300 text-purple-700 bg-purple-50 hover:bg-purple-100 hover:border-purple-400"}`,children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-600"}),e.jsx("span",{children:"Переводим и генерируем..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ma,{className:"w-4 h-4"}),e.jsx("span",{children:"Сгенерировать изображение"})]})})}),o.imageUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.imageUrl})]}),(l.imageUrl||O)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Предварительный просмотр"}),e.jsx("div",{className:"w-full max-w-xs mx-auto",children:e.jsx("img",{src:O||l.imageUrl,alt:"Preview",className:"w-full h-auto object-contain rounded-lg border border-gray-200",onError:b=>{const N=b.target;N.style.display="none"}})}),I&&e.jsx("div",{className:"mt-2 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Файл: ",I.name," (",(I.size/1024/1024).toFixed(2)," MB)"]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:S,className:`flex-1 px-4 py-3 rounded-lg font-medium transition-colors ${S?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Загружаем..."]}):r?"Сохранить":"Добавить"})]})]})]})}):null};class mt{static async generateImage(t){console.log("🖼️ ImageGenerationService: Generating image for:",t);try{const a=this.getImageGenerationSettings();if(!this.shouldGenerateImage(a))return console.log("🚫 Image generation disabled by settings"),this.getFallbackImage(t);const r={word:t.word,language:t.language,style:t.style||"cartoon",size:t.size||"medium"},s=await nt.generateImage(r);return s.success&&s.imageUrl?(console.log(`✅ Image generated successfully using ${s.service}`),{success:!0,imageUrl:s.imageUrl,service:s.service}):(console.warn("⚠️ Leonardo.ai failed, using fallback"),this.getFallbackImage(t))}catch(a){return console.error("❌ ImageGenerationService: Error generating image:",a),this.getFallbackImage(t)}}static getFallbackImage(t){const a=["https://images.pexels.com/photos/102104/pexels-photo-102104.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/159711/books-bookstore-book-reading-159711.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?w=200&h=200&fit=crop&crop=face"],r=Math.floor(Math.random()*a.length);return{success:!0,imageUrl:a[r],service:"Fallback"}}static getAvailableStyles(){return nt.getAvailableStyles()}static getAvailableServices(){return[nt.getServiceInfo(),{name:"Fallback",description:"Резервные изображения",free:!0}]}static getImageGenerationSettings(){try{const t=localStorage.getItem("imageGenerationSettings");if(t)return JSON.parse(t)}catch(t){console.warn("Failed to parse image generation settings:",t)}return null}static shouldGenerateImage(t){return!t||!t.enabledServices?!0:t.enabledServices.length>0?t.enabledServices.some(s=>s!=="Fallback"&&s!=="Unsplash"&&s!=="Pexels"&&s!=="Pixabay"&&s!=="Craiyon")?!0:(console.log("🚫 Image generation disabled - only fallback services enabled"),!1):(console.log("🚫 Image generation disabled - no services enabled"),!1)}}class ke{static WORD_TEMPLATES={A1:{"ru-en":[{term:"mother",translation:"мама",example:"My mother is very kind."},{term:"father",translation:"папа",example:"My father works in an office."},{term:"sister",translation:"сестра",example:"My sister is younger than me."},{term:"brother",translation:"брат",example:"My brother plays football."},{term:"grandmother",translation:"бабушка",example:"Grandmother makes delicious cookies."},{term:"grandfather",translation:"дедушка",example:"Grandfather tells interesting stories."},{term:"baby",translation:"малыш",example:"The baby is sleeping."},{term:"child",translation:"ребёнок",example:"The child is playing in the park."},{term:"man",translation:"мужчина",example:"The man is reading a newspaper."},{term:"woman",translation:"женщина",example:"The woman is cooking dinner."},{term:"apple",translation:"яблоко",example:"I eat an apple every day."},{term:"banana",translation:"банан",example:"Bananas are yellow and sweet."},{term:"orange",translation:"апельсин",example:"I drink orange juice for breakfast."},{term:"bread",translation:"хлеб",example:"We buy fresh bread every morning."},{term:"milk",translation:"молоко",example:"Children drink milk to grow strong."},{term:"coffee",translation:"кофе",example:"I drink coffee in the morning."},{term:"tea",translation:"чай",example:"Would you like some tea?"},{term:"water",translation:"вода",example:"Water is essential for life."},{term:"juice",translation:"сок",example:"Apple juice is my favorite."},{term:"cake",translation:"торт",example:"We eat cake on birthdays."},{term:"pizza",translation:"пицца",example:"Pizza is popular around the world."},{term:"chicken",translation:"курица",example:"Grilled chicken is healthy."},{term:"fish",translation:"рыба",example:"Fish is good for your brain."},{term:"rice",translation:"рис",example:"Rice is a staple food in Asia."},{term:"pasta",translation:"паста",example:"Italian pasta is delicious."},{term:"dog",translation:"собака",example:"Dogs are loyal companions."},{term:"cat",translation:"кот",example:"Cats are independent animals."},{term:"bird",translation:"птица",example:"Birds can fly in the sky."},{term:"fish",translation:"рыба",example:"Fish live in water."},{term:"horse",translation:"лошадь",example:"Horses are strong animals."},{term:"cow",translation:"корова",example:"Cows give us milk."},{term:"pig",translation:"свинья",example:"Pigs are intelligent animals."},{term:"sheep",translation:"овца",example:"Sheep provide wool for clothing."},{term:"rabbit",translation:"кролик",example:"Rabbits hop quickly."},{term:"mouse",translation:"мышь",example:"The mouse is very small."},{term:"house",translation:"дом",example:"Our house has a beautiful garden."},{term:"room",translation:"комната",example:"My room is on the second floor."},{term:"kitchen",translation:"кухня",example:"We cook meals in the kitchen."},{term:"bedroom",translation:"спальня",example:"I sleep in my bedroom."},{term:"bathroom",translation:"ванная",example:"The bathroom has a big mirror."},{term:"table",translation:"стол",example:"We eat dinner at the table."},{term:"chair",translation:"стул",example:"Please sit on this chair."},{term:"bed",translation:"кровать",example:"I sleep in a comfortable bed."},{term:"sofa",translation:"диван",example:"We watch TV on the sofa."},{term:"window",translation:"окно",example:"The window overlooks the garden."},{term:"door",translation:"дверь",example:"Please close the door."},{term:"wall",translation:"стена",example:"The wall is painted blue."},{term:"floor",translation:"пол",example:"The floor is made of wood."},{term:"ceiling",translation:"потолок",example:"The ceiling is very high."},{term:"lamp",translation:"лампа",example:"Turn on the lamp, please."},{term:"shirt",translation:"рубашка",example:"He wears a white shirt to work."},{term:"pants",translation:"брюки",example:"These pants are too long."},{term:"dress",translation:"платье",example:"She looks beautiful in that dress."},{term:"shoes",translation:"туфли",example:"I need new running shoes."},{term:"hat",translation:"шляпа",example:"Wear a hat to protect from sun."},{term:"coat",translation:"пальто",example:"It's cold, wear your coat."},{term:"jacket",translation:"куртка",example:"This jacket is very warm."},{term:"socks",translation:"носки",example:"I need to buy new socks."},{term:"gloves",translation:"перчатки",example:"Wear gloves in winter."},{term:"scarf",translation:"шарф",example:"The scarf keeps my neck warm."},{term:"car",translation:"машина",example:"My car is red and fast."},{term:"bus",translation:"автобус",example:"I take the bus to work."},{term:"train",translation:"поезд",example:"The train arrives at 3 PM."},{term:"plane",translation:"самолёт",example:"We fly by plane to other countries."},{term:"bike",translation:"велосипед",example:"Riding a bike is good exercise."},{term:"boat",translation:"лодка",example:"We sail the boat on the lake."},{term:"taxi",translation:"такси",example:"Call a taxi to the airport."},{term:"truck",translation:"грузовик",example:"The truck carries heavy goods."},{term:"red",translation:"красный",example:"Roses are red and beautiful."},{term:"blue",translation:"синий",example:"The sky is blue today."},{term:"green",translation:"зелёный",example:"Grass is green in spring."},{term:"yellow",translation:"жёлтый",example:"The sun is bright yellow."},{term:"black",translation:"чёрный",example:"I wear a black suit to work."},{term:"white",translation:"белый",example:"Snow is white and cold."},{term:"brown",translation:"коричневый",example:"The tree trunk is brown."},{term:"pink",translation:"розовый",example:"She loves pink flowers."},{term:"purple",translation:"фиолетовый",example:"Purple is a royal color."},{term:"orange",translation:"оранжевый",example:"Orange leaves fall in autumn."},{term:"one",translation:"один",example:"I have one brother."},{term:"two",translation:"два",example:"Two plus two equals four."},{term:"three",translation:"три",example:"I have three cats."},{term:"four",translation:"четыре",example:"There are four seasons."},{term:"five",translation:"пять",example:"I wake up at five o'clock."},{term:"six",translation:"шесть",example:"Six months make half a year."},{term:"seven",translation:"семь",example:"There are seven days in a week."},{term:"eight",translation:"восемь",example:"I sleep eight hours every night."},{term:"nine",translation:"девять",example:"Nine plus one equals ten."},{term:"ten",translation:"десять",example:"I have ten fingers."},{term:"morning",translation:"утро",example:"I exercise every morning."},{term:"afternoon",translation:"день",example:"We have lunch in the afternoon."},{term:"evening",translation:"вечер",example:"I read books in the evening."},{term:"night",translation:"ночь",example:"Stars shine at night."},{term:"today",translation:"сегодня",example:"Today is a beautiful day."},{term:"tomorrow",translation:"завтра",example:"Tomorrow I will visit my friend."},{term:"yesterday",translation:"вчера",example:"Yesterday was very busy."},{term:"Monday",translation:"понедельник",example:"Monday is the first day of work."},{term:"Tuesday",translation:"вторник",example:"I have a meeting on Tuesday."},{term:"Wednesday",translation:"среда",example:"Wednesday is in the middle of the week."},{term:"Thursday",translation:"четверг",example:"Thursday comes before Friday."},{term:"Friday",translation:"пятница",example:"Friday is the last working day."},{term:"Saturday",translation:"суббота",example:"Saturday is perfect for relaxing."},{term:"Sunday",translation:"воскресенье",example:"Sunday is a day for family."},{term:"sun",translation:"солнце",example:"The sun gives us light and warmth."},{term:"moon",translation:"луна",example:"The moon is bright tonight."},{term:"star",translation:"звезда",example:"Stars twinkle in the dark sky."},{term:"cloud",translation:"облако",example:"White clouds float in the sky."},{term:"rain",translation:"дождь",example:"Plants need rain to grow."},{term:"snow",translation:"снег",example:"Snow covers the ground in winter."},{term:"wind",translation:"ветер",example:"The wind blows the leaves."},{term:"tree",translation:"дерево",example:"The old tree provides shade."},{term:"flower",translation:"цветок",example:"This flower smells wonderful."},{term:"grass",translation:"трава",example:"Green grass grows in the garden."},{term:"mountain",translation:"гора",example:"The mountain is very tall."},{term:"river",translation:"река",example:"Fish swim in the clear river."},{term:"sea",translation:"море",example:"We swim in the warm sea."},{term:"beach",translation:"пляж",example:"The beach has white sand."},{term:"forest",translation:"лес",example:"Many animals live in the forest."},{term:"school",translation:"школа",example:"Children learn many things at school."},{term:"teacher",translation:"учитель",example:"Our teacher is very patient."},{term:"student",translation:"ученик",example:"Every student has different talents."},{term:"book",translation:"книга",example:"This book tells an exciting story."},{term:"pen",translation:"ручка",example:"I write with a blue pen."},{term:"pencil",translation:"карандаш",example:"Draw the picture with a pencil."},{term:"paper",translation:"бумага",example:"Write your name on this paper."},{term:"desk",translation:"парта",example:"Each student has their own desk."},{term:"blackboard",translation:"доска",example:"The teacher writes on the blackboard."},{term:"lesson",translation:"урок",example:"Today's lesson is about animals."},{term:"work",translation:"работа",example:"I enjoy my work very much."},{term:"job",translation:"работа",example:"Finding a good job is important."},{term:"doctor",translation:"врач",example:"The doctor helps sick people."},{term:"nurse",translation:"медсестра",example:"The nurse takes care of patients."},{term:"teacher",translation:"учитель",example:"A teacher educates children."},{term:"police",translation:"полиция",example:"Police officers keep us safe."},{term:"cook",translation:"повар",example:"The cook makes delicious meals."},{term:"driver",translation:"водитель",example:"The bus driver is very careful."},{term:"farmer",translation:"фермер",example:"Farmers grow food for everyone."},{term:"artist",translation:"художник",example:"The artist paints beautiful pictures."},{term:"sport",translation:"спорт",example:"Sport keeps us healthy and strong."},{term:"football",translation:"футбол",example:"Football is popular worldwide."},{term:"basketball",translation:"баскетбол",example:"Basketball players are very tall."},{term:"tennis",translation:"теннис",example:"Tennis requires good coordination."},{term:"swimming",translation:"плавание",example:"Swimming is excellent exercise."},{term:"running",translation:"бег",example:"Running helps build endurance."},{term:"dancing",translation:"танцы",example:"Dancing is fun and artistic."},{term:"singing",translation:"пение",example:"Singing makes people happy."},{term:"reading",translation:"чтение",example:"Reading expands your knowledge."},{term:"writing",translation:"письмо",example:"Writing helps express thoughts."},{term:"computer",translation:"компьютер",example:"I use a computer for work."},{term:"phone",translation:"телефон",example:"My phone helps me stay connected."},{term:"internet",translation:"интернет",example:"The internet connects the world."},{term:"email",translation:"электронная почта",example:"I check my email every morning."},{term:"website",translation:"веб-сайт",example:"This website has useful information."},{term:"camera",translation:"камера",example:"I take photos with my camera."},{term:"television",translation:"телевизор",example:"We watch news on television."},{term:"radio",translation:"радио",example:"I listen to music on the radio."},{term:"money",translation:"деньги",example:"Money is needed to buy things."},{term:"shop",translation:"магазин",example:"I buy groceries at the shop."},{term:"market",translation:"рынок",example:"Fresh fruits are sold at the market."},{term:"price",translation:"цена",example:"The price of this book is reasonable."},{term:"buy",translation:"покупать",example:"I want to buy a new car."},{term:"sell",translation:"продавать",example:"They sell fresh vegetables."},{term:"pay",translation:"платить",example:"I pay with my credit card."},{term:"cheap",translation:"дешёвый",example:"This restaurant is cheap but good."},{term:"expensive",translation:"дорогой",example:"Diamond rings are very expensive."},{term:"free",translation:"бесплатный",example:"The museum entrance is free today."}],"ru-es":[{term:"madre",translation:"мама",example:"Mi madre es muy cariñosa."},{term:"padre",translation:"папа",example:"Mi padre trabaja en una oficina."},{term:"hermana",translation:"сестра",example:"Mi hermana es menor que yo."},{term:"hermano",translation:"брат",example:"Mi hermano juega al fútbol."},{term:"abuela",translation:"бабушка",example:"La abuela hace galletas deliciosas."},{term:"abuelo",translation:"дедушка",example:"El abuelo cuenta historias interesantes."},{term:"bebé",translation:"малыш",example:"El bebé está durmiendo."},{term:"niño",translation:"ребёнок",example:"El niño juega en el parque."},{term:"hombre",translation:"мужчина",example:"El hombre lee el periódico."},{term:"mujer",translation:"женщина",example:"La mujer cocina la cena."},{term:"manzana",translation:"яблоко",example:"Como una manzana cada día."},{term:"plátano",translation:"банан",example:"Los plátanos son amarillos y dulces."},{term:"naranja",translation:"апельсин",example:"Bebo jugo de naranja en el desayuno."},{term:"pan",translation:"хлеб",example:"Compramos pan fresco cada mañana."},{term:"leche",translation:"молоко",example:"Los niños beben leche para crecer fuertes."},{term:"café",translation:"кофе",example:"Bebo café por la mañana."},{term:"té",translation:"чай",example:"¿Te gustaría un poco de té?"},{term:"agua",translation:"вода",example:"El agua es esencial para la vida."},{term:"jugo",translation:"сок",example:"El jugo de manzana es mi favorito."},{term:"pastel",translation:"торт",example:"Comemos pastel en los cumpleaños."},{term:"pizza",translation:"пицца",example:"La pizza es popular en todo el mundo."},{term:"pollo",translation:"курица",example:"El pollo a la parrilla es saludable."},{term:"pescado",translation:"рыба",example:"El pescado es bueno para el cerebro."},{term:"arroz",translation:"рис",example:"El arroz es un alimento básico en Asia."},{term:"pasta",translation:"паста",example:"La pasta italiana es deliciosa."},{term:"perro",translation:"собака",example:"Los perros son compañeros leales."},{term:"gato",translation:"кот",example:"Los gatos son animales independientes."},{term:"pájaro",translation:"птица",example:"Los pájaros pueden volar en el cielo."},{term:"pez",translation:"рыба",example:"Los peces viven en el agua."},{term:"caballo",translation:"лошадь",example:"Los caballos son animales fuertes."},{term:"vaca",translation:"корова",example:"Las vacas nos dan leche."},{term:"cerdo",translation:"свинья",example:"Los cerdos son animales inteligentes."},{term:"oveja",translation:"овца",example:"Las ovejas proporcionan lana para la ropa."},{term:"conejo",translation:"кролик",example:"Los conejos saltan rápidamente."},{term:"ratón",translation:"мышь",example:"El ratón es muy pequeño."},{term:"casa",translation:"дом",example:"Nuestra casa tiene un jardín hermoso."},{term:"habitación",translation:"комната",example:"Mi habitación está en el segundo piso."},{term:"cocina",translation:"кухня",example:"Cocinamos las comidas en la cocina."},{term:"dormitorio",translation:"спальня",example:"Duermo en mi dormitorio."},{term:"baño",translation:"ванная",example:"El baño tiene un espejo grande."},{term:"mesa",translation:"стол",example:"Cenamos en la mesa."},{term:"silla",translation:"стул",example:"Por favor, siéntate en esta silla."},{term:"cama",translation:"кровать",example:"Duermo en una cama cómoda."},{term:"sofá",translation:"диван",example:"Vemos televisión en el sofá."},{term:"ventana",translation:"окно",example:"La ventana da al jardín."},{term:"puerta",translation:"дверь",example:"Por favor, cierra la puerta."},{term:"pared",translation:"стена",example:"La pared está pintada de azul."},{term:"suelo",translation:"пол",example:"El suelo es de madera."},{term:"techo",translation:"потолок",example:"El techo es muy alto."},{term:"lámpara",translation:"лампа",example:"Enciende la lámpara, por favor."},{term:"camisa",translation:"рубашка",example:"Lleva una camisa blanca al trabajo."},{term:"pantalones",translation:"брюки",example:"Estos pantalones son muy largos."},{term:"vestido",translation:"платье",example:"Se ve hermosa con ese vestido."},{term:"zapatos",translation:"туфли",example:"Necesito zapatos nuevos para correr."},{term:"sombrero",translation:"шляпа",example:"Usa un sombrero para protegerte del sol."},{term:"abrigo",translation:"пальто",example:"Hace frío, ponte el abrigo."},{term:"chaqueta",translation:"куртка",example:"Esta chaqueta es muy abrigada."},{term:"calcetines",translation:"носки",example:"Necesito comprar calcetines nuevos."},{term:"guantes",translation:"перчатки",example:"Usa guantes en invierno."},{term:"bufanda",translation:"шарф",example:"La bufanda mantiene caliente mi cuello."},{term:"coche",translation:"машина",example:"Mi coche es rojo y rápido."},{term:"autobús",translation:"автобус",example:"Tomo el autobús para ir al trabajo."},{term:"tren",translation:"поезд",example:"El tren llega a las 3 PM."},{term:"avión",translation:"самолёт",example:"Volamos en avión a otros países."},{term:"bicicleta",translation:"велосипед",example:"Montar en bicicleta es buen ejercicio."},{term:"barco",translation:"лодка",example:"Navegamos el barco en el lago."},{term:"taxi",translation:"такси",example:"Llama un taxi al aeropuerto."},{term:"camión",translation:"грузовик",example:"El camión transporta mercancías pesadas."},{term:"rojo",translation:"красный",example:"Las rosas son rojas y hermosas."},{term:"azul",translation:"синий",example:"El cielo está azul hoy."},{term:"verde",translation:"зелёный",example:"La hierba es verde en primavera."},{term:"amarillo",translation:"жёлтый",example:"El sol es amarillo brillante."},{term:"negro",translation:"чёрный",example:"Llevo un traje negro al trabajo."},{term:"blanco",translation:"белый",example:"La nieve es blanca y fría."},{term:"marrón",translation:"коричневый",example:"El tronco del árbol es marrón."},{term:"rosa",translation:"розовый",example:"Le encantan las flores rosas."},{term:"morado",translation:"фиолетовый",example:"El morado es un color real."},{term:"naranja",translation:"оранжевый",example:"Las hojas naranjas caen en otoño."},{term:"uno",translation:"один",example:"Tengo un hermano."},{term:"dos",translation:"два",example:"Dos más dos son cuatro."},{term:"tres",translation:"три",example:"Tengo tres gatos."},{term:"cuatro",translation:"четыре",example:"Hay cuatro estaciones."},{term:"cinco",translation:"пять",example:"Me despierto a las cinco."},{term:"seis",translation:"шесть",example:"Seis meses hacen medio año."},{term:"siete",translation:"семь",example:"Hay siete días en una semana."},{term:"ocho",translation:"восемь",example:"Duermo ocho horas cada noche."},{term:"nueve",translation:"девять",example:"Nueve más uno son diez."},{term:"diez",translation:"десять",example:"Tengo diez dedos."},{term:"mañana",translation:"утро",example:"Hago ejercicio cada mañana."},{term:"tarde",translation:"день",example:"Almorzamos por la tarde."},{term:"noche",translation:"вечер",example:"Leo libros por la noche."},{term:"noche",translation:"ночь",example:"Las estrellas brillan en la noche."},{term:"hoy",translation:"сегодня",example:"Hoy es un día hermoso."},{term:"mañana",translation:"завтра",example:"Mañana visitaré a mi amigo."},{term:"ayer",translation:"вчера",example:"Ayer estuvo muy ocupado."},{term:"lunes",translation:"понедельник",example:"El lunes es el primer día de trabajo."},{term:"martes",translation:"вторник",example:"Tengo una reunión el martes."},{term:"miércoles",translation:"среда",example:"El miércoles está en medio de la semana."},{term:"jueves",translation:"четверг",example:"El jueves viene antes del viernes."},{term:"viernes",translation:"пятница",example:"El viernes es el último día laboral."},{term:"sábado",translation:"суббота",example:"El sábado es perfecto para relajarse."},{term:"domingo",translation:"воскресенье",example:"El domingo es un día para la familia."},{term:"sol",translation:"солнце",example:"El sol nos da luz y calor."},{term:"luna",translation:"луна",example:"La luna está brillante esta noche."},{term:"estrella",translation:"звезда",example:"Las estrellas titilan en el cielo oscuro."},{term:"nube",translation:"облако",example:"Las nubes blancas flotan en el cielo."},{term:"lluvia",translation:"дождь",example:"Las plantas necesitan lluvia para crecer."},{term:"nieve",translation:"снег",example:"La nieve cubre el suelo en invierno."},{term:"viento",translation:"ветер",example:"El viento sopla las hojas."},{term:"árbol",translation:"дерево",example:"El árbol viejo da sombra."},{term:"flor",translation:"цветок",example:"Esta flor huele maravilloso."},{term:"hierba",translation:"трава",example:"La hierba verde crece en el jardín."},{term:"montaña",translation:"гора",example:"La montaña es muy alta."},{term:"río",translation:"река",example:"Los peces nadan en el río claro."},{term:"mar",translation:"море",example:"Nadamos en el mar cálido."},{term:"playa",translation:"пляж",example:"La playa tiene arena blanca."},{term:"bosque",translation:"лес",example:"Muchos animales viven en el bosque."},{term:"escuela",translation:"школа",example:"Los niños aprenden muchas cosas en la escuela."},{term:"maestro",translation:"учитель",example:"Nuestro maestro es muy paciente."},{term:"estudiante",translation:"ученик",example:"Cada estudiante tiene talentos diferentes."},{term:"libro",translation:"книга",example:"Este libro cuenta una historia emocionante."},{term:"bolígrafo",translation:"ручка",example:"Escribo con un bolígrafo azul."},{term:"lápiz",translation:"карандаш",example:"Dibuja la imagen con un lápiz."},{term:"papel",translation:"бумага",example:"Escribe tu nombre en este papel."},{term:"escritorio",translation:"парта",example:"Cada estudiante tiene su propio escritorio."},{term:"pizarra",translation:"доска",example:"El maestro escribe en la pizarra."},{term:"lección",translation:"урок",example:"La lección de hoy es sobre animales."},{term:"trabajo",translation:"работа",example:"Disfruto mucho mi trabajo."},{term:"empleo",translation:"работа",example:"Encontrar un buen empleo es importante."},{term:"médico",translation:"врач",example:"El médico ayuda a las personas enfermas."},{term:"enfermera",translation:"медсестра",example:"La enfermera cuida a los pacientes."},{term:"maestro",translation:"учитель",example:"Un maestro educa a los niños."},{term:"policía",translation:"полиция",example:"Los policías nos mantienen seguros."},{term:"cocinero",translation:"повар",example:"El cocinero hace comidas deliciosas."},{term:"conductor",translation:"водитель",example:"El conductor del autobús es muy cuidadoso."},{term:"granjero",translation:"фермер",example:"Los granjeros cultivan comida para todos."},{term:"artista",translation:"художник",example:"El artista pinta cuadros hermosos."},{term:"deporte",translation:"спорт",example:"El deporte nos mantiene sanos y fuertes."},{term:"fútbol",translation:"футбол",example:"El fútbol es popular en todo el mundo."},{term:"baloncesto",translation:"баскетбол",example:"Los jugadores de baloncesto son muy altos."},{term:"tenis",translation:"теннис",example:"El tenis requiere buena coordinación."},{term:"natación",translation:"плавание",example:"La natación es un ejercicio excelente."},{term:"correr",translation:"бег",example:"Correr ayuda a desarrollar resistencia."},{term:"bailar",translation:"танцы",example:"Bailar es divertido y artístico."},{term:"cantar",translation:"пение",example:"Cantar hace feliz a la gente."},{term:"leer",translation:"чтение",example:"Leer amplía tu conocimiento."},{term:"escribir",translation:"письмо",example:"Escribir ayuda a expresar pensamientos."},{term:"computadora",translation:"компьютер",example:"Uso una computadora para trabajar."},{term:"teléfono",translation:"телефон",example:"Mi teléfono me ayuda a mantenerme conectado."},{term:"internet",translation:"интернет",example:"Internet conecta el mundo."},{term:"correo",translation:"электронная почта",example:"Reviso mi correo cada mañana."},{term:"sitio web",translation:"веб-сайт",example:"Este sitio web tiene información útil."},{term:"cámara",translation:"камера",example:"Tomo fotos con mi cámara."},{term:"televisión",translation:"телевизор",example:"Vemos noticias en la televisión."},{term:"radio",translation:"радио",example:"Escucho música en la radio."},{term:"dinero",translation:"деньги",example:"El dinero es necesario para comprar cosas."},{term:"tienda",translation:"магазин",example:"Compro comestibles en la tienda."},{term:"mercado",translation:"рынок",example:"Las frutas frescas se venden en el mercado."},{term:"precio",translation:"цена",example:"El precio de este libro es razonable."},{term:"comprar",translation:"покупать",example:"Quiero comprar un coche nuevo."},{term:"vender",translation:"продавать",example:"Venden verduras frescas."},{term:"pagar",translation:"платить",example:"Pago con mi tarjeta de crédito."},{term:"barato",translation:"дешёвый",example:"Este restaurante es barato pero bueno."},{term:"caro",translation:"дорогой",example:"Los anillos de diamante son muy caros."},{term:"gratis",translation:"бесплатный",example:"La entrada al museo es gratis hoy."}],"es-ru-en":[{term:"madre",translation:"мама",example:"Mother is very kind."},{term:"padre",translation:"папа",example:"Father works in an office."},{term:"hermana",translation:"сестра",example:"Sister is younger than me."},{term:"hermano",translation:"брат",example:"Brother plays football."},{term:"abuela",translation:"бабушка",example:"Grandmother makes delicious cookies."},{term:"abuelo",translation:"дедушка",example:"Grandfather tells interesting stories."},{term:"bebé",translation:"малыш",example:"The baby is sleeping."},{term:"niño",translation:"ребёнок",example:"The child is playing in the park."},{term:"hombre",translation:"мужчина",example:"The man is reading a newspaper."},{term:"mujer",translation:"женщина",example:"The woman is cooking dinner."},{term:"manzana",translation:"яблоко",example:"I eat an apple every day."},{term:"plátano",translation:"банан",example:"Bananas are yellow and sweet."},{term:"naranja",translation:"апельсин",example:"I drink orange juice for breakfast."},{term:"pan",translation:"хлеб",example:"We buy fresh bread every morning."},{term:"leche",translation:"молоко",example:"Children drink milk to grow strong."},{term:"café",translation:"кофе",example:"I drink coffee in the morning."},{term:"té",translation:"чай",example:"Would you like some tea?"},{term:"agua",translation:"вода",example:"Water is essential for life."},{term:"jugo",translation:"сок",example:"Apple juice is my favorite."},{term:"pastel",translation:"торт",example:"We eat cake on birthdays."},{term:"pizza",translation:"пицца",example:"Pizza is popular around the world."},{term:"pollo",translation:"курица",example:"Grilled chicken is healthy."},{term:"pescado",translation:"рыба",example:"Fish is good for your brain."},{term:"arroz",translation:"рис",example:"Rice is a staple food in Asia."},{term:"pasta",translation:"паста",example:"Italian pasta is delicious."},{term:"perro",translation:"собака",example:"Dogs are loyal companions."},{term:"gato",translation:"кот",example:"Cats are independent animals."},{term:"pájaro",translation:"птица",example:"Birds can fly in the sky."},{term:"pez",translation:"рыба",example:"Fish live in water."},{term:"caballo",translation:"лошадь",example:"Horses are strong animals."},{term:"vaca",translation:"корова",example:"Cows give us milk."},{term:"cerdo",translation:"свинья",example:"Pigs are intelligent animals."},{term:"oveja",translation:"овца",example:"Sheep provide wool for clothing."},{term:"conejo",translation:"кролик",example:"Rabbits hop quickly."},{term:"ratón",translation:"мышь",example:"The mouse is very small."},{term:"casa",translation:"дом",example:"Our house has a beautiful garden."},{term:"habitación",translation:"комната",example:"My room is on the second floor."},{term:"cocina",translation:"кухня",example:"We cook meals in the kitchen."},{term:"dormitorio",translation:"спальня",example:"I sleep in my bedroom."},{term:"baño",translation:"ванная",example:"The bathroom has a big mirror."},{term:"sala",translation:"гостиная",example:"We watch TV in the living room."},{term:"mesa",translation:"стол",example:"The table is in the kitchen."},{term:"silla",translation:"стул",example:"I sit on the chair."},{term:"cama",translation:"кровать",example:"The bed is very comfortable."},{term:"puerta",translation:"дверь",example:"The door is open."},{term:"ventana",translation:"окно",example:"The window is closed."},{term:"escalera",translation:"лестница",example:"The stairs are steep."},{term:"rojo",translation:"красный",example:"Red is my favorite color."},{term:"azul",translation:"синий",example:"The sky is blue."},{term:"verde",translation:"зелёный",example:"Grass is green."},{term:"amarillo",translation:"жёлтый",example:"The sun is yellow."},{term:"negro",translation:"чёрный",example:"The cat is black."},{term:"blanco",translation:"белый",example:"Snow is white."},{term:"gris",translation:"серый",example:"The elephant is gray."},{term:"marrón",translation:"коричневый",example:"The tree is brown."},{term:"rosa",translation:"розовый",example:"The flower is pink."},{term:"naranja",translation:"оранжевый",example:"The carrot is orange."},{term:"uno",translation:"один",example:"I have one brother."},{term:"dos",translation:"два",example:"I have two sisters."},{term:"tres",translation:"три",example:"I have three books."},{term:"cuatro",translation:"четыре",example:"I have four pens."},{term:"cinco",translation:"пять",example:"I have five apples."},{term:"seis",translation:"шесть",example:"I have six cats."},{term:"siete",translation:"семь",example:"I have seven days."},{term:"ocho",translation:"восемь",example:"I have eight friends."},{term:"nueve",translation:"девять",example:"I have nine toys."},{term:"diez",translation:"десять",example:"I have ten fingers."}]},A2:{"ru-en":[{term:"to wake up",translation:"просыпаться",example:"I wake up at 7 AM every day."},{term:"to get dressed",translation:"одеваться",example:"I get dressed quickly in the morning."},{term:"to have breakfast",translation:"завтракать",example:"We have breakfast together as a family."},{term:"to brush teeth",translation:"чистить зубы",example:"Don't forget to brush your teeth."},{term:"to take a shower",translation:"принимать душ",example:"I take a shower every evening."},{term:"to go to bed",translation:"ложиться спать",example:"Children should go to bed early."},{term:"to do homework",translation:"делать домашнее задание",example:"Students do homework after school."},{term:"to watch TV",translation:"смотреть телевизор",example:"We watch TV in the evening."},{term:"to listen to music",translation:"слушать музыку",example:"I listen to music while working."},{term:"to play games",translation:"играть в игры",example:"Children love to play games."},{term:"to go shopping",translation:"ходить за покупками",example:"We go shopping on weekends."},{term:"to buy groceries",translation:"покупать продукты",example:"I buy groceries at the supermarket."},{term:"to cook dinner",translation:"готовить ужин",example:"Mom cooks dinner for the family."},{term:"to set the table",translation:"накрывать на стол",example:"Please help me set the table."},{term:"to wash dishes",translation:"мыть посуду",example:"I wash dishes after every meal."},{term:"to order food",translation:"заказывать еду",example:"We order food from our favorite restaurant."},{term:"to pay the bill",translation:"оплачивать счёт",example:"Dad always pays the bill at restaurants."},{term:"to try on clothes",translation:"примерять одежду",example:"I like to try on clothes before buying."},{term:"to return items",translation:"возвращать товары",example:"You can return items within 30 days."},{term:"to save money",translation:"экономить деньги",example:"It's important to save money for the future."},{term:"to travel abroad",translation:"путешествовать за границу",example:"We travel abroad once a year."},{term:"to book a hotel",translation:"бронировать отель",example:"I need to book a hotel for our trip."},{term:"to pack luggage",translation:"упаковывать багаж",example:"Don't forget to pack your luggage."},{term:"to catch a flight",translation:"успевать на рейс",example:"We need to hurry to catch our flight."},{term:"to miss the bus",translation:"опаздывать на автобус",example:"I don't want to miss the bus again."},{term:"to ask for directions",translation:"спрашивать дорогу",example:"Tourists often ask for directions."},{term:"to get lost",translation:"заблудиться",example:"It's easy to get lost in a big city."},{term:"to take photos",translation:"фотографировать",example:"Tourists love to take photos of landmarks."},{term:"to visit museums",translation:"посещать музеи",example:"We visit museums to learn about history."},{term:"to explore the city",translation:"исследовать город",example:"I love to explore new cities on foot."},{term:"to attend classes",translation:"посещать занятия",example:"Students must attend all classes."},{term:"to take notes",translation:"делать записи",example:"I take notes during important meetings."},{term:"to give a presentation",translation:"делать презентацию",example:"Tomorrow I will give a presentation."},{term:"to work overtime",translation:"работать сверхурочно",example:"Sometimes I have to work overtime."},{term:"to meet deadlines",translation:"соблюдать сроки",example:"It's important to meet all deadlines."},{term:"to apply for a job",translation:"подавать заявление на работу",example:"I want to apply for this job."},{term:"to have an interview",translation:"проходить собеседование",example:"I have an interview next week."},{term:"to get promoted",translation:"получать повышение",example:"Hard work can help you get promoted."},{term:"to retire",translation:"выходить на пенсию",example:"My grandfather will retire next year."},{term:"to earn money",translation:"зарабатывать деньги",example:"Everyone needs to earn money to live."},{term:"to feel sick",translation:"чувствовать себя больным",example:"I feel sick today, so I'll stay home."},{term:"to see a doctor",translation:"обращаться к врачу",example:"You should see a doctor about that cough."},{term:"to take medicine",translation:"принимать лекарство",example:"Take this medicine three times a day."},{term:"to exercise regularly",translation:"регулярно заниматься спортом",example:"I try to exercise regularly to stay healthy."},{term:"to join a gym",translation:"записаться в спортзал",example:"I want to join a gym near my house."},{term:"to go jogging",translation:"бегать трусцой",example:"I go jogging every morning in the park."},{term:"to play tennis",translation:"играть в теннис",example:"Do you want to play tennis this weekend?"},{term:"to swim laps",translation:"плавать дорожки",example:"I swim laps at the local pool."},{term:"to lift weights",translation:"поднимать тяжести",example:"He likes to lift weights at the gym."},{term:"to stretch muscles",translation:"растягивать мышцы",example:"Always stretch your muscles before exercising."},{term:"to make friends",translation:"заводить друзей",example:"It's easy to make friends when you're kind."},{term:"to keep in touch",translation:"поддерживать связь",example:"We keep in touch through social media."},{term:"to have an argument",translation:"ссориться",example:"Sometimes friends have arguments."},{term:"to apologize",translation:"извиняться",example:"I need to apologize for being late."},{term:"to forgive someone",translation:"прощать кого-то",example:"It's important to forgive people."},{term:"to fall in love",translation:"влюбляться",example:"They fell in love at first sight."},{term:"to get married",translation:"жениться/выходить замуж",example:"They plan to get married next summer."},{term:"to have children",translation:"иметь детей",example:"They want to have children someday."},{term:"to celebrate birthdays",translation:"праздновать дни рождения",example:"We always celebrate birthdays with cake."},{term:"to invite guests",translation:"приглашать гостей",example:"We invite guests for dinner on Sundays."},{term:"to collect stamps",translation:"коллекционировать марки",example:"My grandfather likes to collect stamps."},{term:"to play chess",translation:"играть в шахматы",example:"Chess helps develop strategic thinking."},{term:"to solve puzzles",translation:"решать головоломки",example:"I enjoy solving crossword puzzles."},{term:"to paint pictures",translation:"рисовать картины",example:"She loves to paint pictures of nature."},{term:"to play guitar",translation:"играть на гитаре",example:"I'm learning to play guitar."},{term:"to sing songs",translation:"петь песни",example:"We sing songs around the campfire."},{term:"to dance salsa",translation:"танцевать сальсу",example:"They take classes to dance salsa."},{term:"to read novels",translation:"читать романы",example:"I love to read mystery novels."},{term:"to watch movies",translation:"смотреть фильмы",example:"We watch movies every Friday night."},{term:"to go to concerts",translation:"ходить на концерты",example:"I go to concerts whenever possible."},{term:"to send emails",translation:"отправлять электронные письма",example:"I send emails to my colleagues daily."},{term:"to browse the internet",translation:"просматривать интернет",example:"I browse the internet for news."},{term:"to download files",translation:"скачивать файлы",example:"You can download files from this website."},{term:"to upload photos",translation:"загружать фотографии",example:"I upload photos to social media."},{term:"to video chat",translation:"общаться по видеосвязи",example:"We video chat with family abroad."},{term:"to use apps",translation:"использовать приложения",example:"I use apps to learn languages."},{term:"to charge devices",translation:"заряжать устройства",example:"Don't forget to charge your phone."},{term:"to backup data",translation:"создавать резервные копии данных",example:"Always backup important data."},{term:"to update software",translation:"обновлять программное обеспечение",example:"Update your software regularly."},{term:"to protect privacy",translation:"защищать конфиденциальность",example:"It's important to protect your privacy online."}],"ru-es":[{term:"despertarse",translation:"просыпаться",example:"Me despierto a las 7 AM todos los días."},{term:"vestirse",translation:"одеваться",example:"Me visto rápidamente por la mañana."},{term:"desayunar",translation:"завтракать",example:"Desayunamos juntos en familia."},{term:"cepillarse los dientes",translation:"чистить зубы",example:"No olvides cepillarte los dientes."},{term:"ducharse",translation:"принимать душ",example:"Me ducho cada noche."},{term:"acostarse",translation:"ложиться спать",example:"Los niños deben acostarse temprano."},{term:"hacer la tarea",translation:"делать домашнее задание",example:"Los estudiantes hacen la tarea después de la escuela."},{term:"ver televisión",translation:"смотреть телевизор",example:"Vemos televisión por la noche."},{term:"escuchar música",translation:"слушать музыку",example:"Escucho música mientras trabajo."},{term:"jugar juegos",translation:"играть в игры",example:"A los niños les encanta jugar juegos."},{term:"ir de compras",translation:"ходить за покупками",example:"Vamos de compras los fines de semana."},{term:"comprar comestibles",translation:"покупать продукты",example:"Compro comestibles en el supermercado."},{term:"cocinar la cena",translation:"готовить ужин",example:"Mamá cocina la cena para la familia."},{term:"poner la mesa",translation:"накрывать на стол",example:"Por favor, ayúdame a poner la mesa."},{term:"lavar los platos",translation:"мыть посуду",example:"Lavo los platos después de cada comida."},{term:"pedir comida",translation:"заказывать еду",example:"Pedimos comida de nuestro restaurante favorito."},{term:"pagar la cuenta",translation:"оплачивать счёт",example:"Papá siempre paga la cuenta en los restaurantes."},{term:"probarse ropa",translation:"примерять одежду",example:"Me gusta probarme la ropa antes de comprar."},{term:"devolver artículos",translation:"возвращать товары",example:"Puedes devolver artículos dentro de 30 días."},{term:"ahorrar dinero",translation:"экономить деньги",example:"Es importante ahorrar dinero para el futuro."},{term:"viajar al extranjero",translation:"путешествовать за границу",example:"Viajamos al extranjero una vez al año."},{term:"reservar un hotel",translation:"бронировать отель",example:"Necesito reservar un hotel para nuestro viaje."},{term:"hacer las maletas",translation:"упаковывать багаж",example:"No olvides hacer las maletas."},{term:"tomar un vuelo",translation:"успевать на рейс",example:"Necesitamos apurarnos para tomar nuestro vuelo."},{term:"perder el autobús",translation:"опаздывать на автобус",example:"No quiero perder el autobús otra vez."},{term:"pedir direcciones",translation:"спрашивать дорогу",example:"Los turistas a menudo piden direcciones."},{term:"perderse",translation:"заблудиться",example:"Es fácil perderse en una ciudad grande."},{term:"tomar fotos",translation:"фотографировать",example:"A los turistas les encanta tomar fotos de monumentos."},{term:"visitar museos",translation:"посещать музеи",example:"Visitamos museos para aprender sobre historia."},{term:"explorar la ciudad",translation:"исследовать город",example:"Me encanta explorar nuevas ciudades a pie."},{term:"asistir a clases",translation:"посещать занятия",example:"Los estudiantes deben asistir a todas las clases."},{term:"tomar notas",translation:"делать записи",example:"Tomo notas durante las reuniones importantes."},{term:"dar una presentación",translation:"делать презентацию",example:"Mañana daré una presentación."},{term:"trabajar horas extra",translation:"работать сверхурочно",example:"A veces tengo que trabajar horas extra."},{term:"cumplir plazos",translation:"соблюдать сроки",example:"Es importante cumplir todos los plazos."},{term:"solicitar un trabajo",translation:"подавать заявление на работу",example:"Quiero solicitar este trabajo."},{term:"tener una entrevista",translation:"проходить собеседование",example:"Tengo una entrevista la próxima semana."},{term:"obtener un ascenso",translation:"получать повышение",example:"El trabajo duro puede ayudarte a obtener un ascenso."},{term:"jubilarse",translation:"выходить на пенсию",example:"Mi abuelo se jubilará el próximo año."},{term:"ganar dinero",translation:"зарабатывать деньги",example:"Todos necesitan ganar dinero para vivir."},{term:"sentirse enfermo",translation:"чувствовать себя больным",example:"Me siento enfermo hoy, así que me quedaré en casa."},{term:"ver a un médico",translation:"обращаться к врачу",example:"Deberías ver a un médico por esa tos."},{term:"tomar medicina",translation:"принимать лекарство",example:"Toma esta medicina tres veces al día."},{term:"hacer ejercicio regularmente",translation:"регулярно заниматься спортом",example:"Trato de hacer ejercicio regularmente para mantenerme saludable."},{term:"inscribirse en un gimnasio",translation:"записаться в спортзал",example:"Quiero inscribirme en un gimnasio cerca de mi casa."},{term:"salir a correr",translation:"бегать трусцой",example:"Salgo a correr cada mañana en el parque."},{term:"jugar tenis",translation:"играть в теннис",example:"¿Quieres jugar tenis este fin de semana?"},{term:"nadar vueltas",translation:"плавать дорожки",example:"Nado vueltas en la piscina local."},{term:"levantar pesas",translation:"поднимать тяжести",example:"Le gusta levantar pesas en el gimnasio."},{term:"estirar músculos",translation:"растягивать мышцы",example:"Siempre estira los músculos antes de hacer ejercicio."},{term:"hacer amigos",translation:"заводить друзей",example:"Es fácil hacer amigos cuando eres amable."},{term:"mantenerse en contacto",translation:"поддерживать связь",example:"Nos mantenemos en contacto a través de las redes sociales."},{term:"tener una discusión",translation:"ссориться",example:"A veces los amigos tienen discusiones."},{term:"disculparse",translation:"извиняться",example:"Necesito disculparme por llegar tarde."},{term:"perdonar a alguien",translation:"прощать кого-то",example:"Es importante perdonar a las personas."},{term:"enamorarse",translation:"влюбляться",example:"Se enamoraron a primera vista."},{term:"casarse",translation:"жениться/выходить замуж",example:"Planean casarse el próximo verano."},{term:"tener hijos",translation:"иметь детей",example:"Quieren tener hijos algún día."},{term:"celebrar cumpleaños",translation:"праздновать дни рождения",example:"Siempre celebramos cumpleaños con pastel."},{term:"invitar huéspedes",translation:"приглашать гостей",example:"Invitamos huéspedes a cenar los domingos."},{term:"coleccionar sellos",translation:"коллекционировать марки",example:"A mi abuelo le gusta coleccionar sellos."},{term:"jugar ajedrez",translation:"играть в шахматы",example:"El ajedrez ayuda a desarrollar el pensamiento estratégico."},{term:"resolver rompecabezas",translation:"решать головоломки",example:"Disfruto resolviendo crucigramas."},{term:"pintar cuadros",translation:"рисовать картины",example:"Le encanta pintar cuadros de la naturaleza."},{term:"tocar guitarra",translation:"играть на гитаре",example:"Estoy aprendiendo a tocar guitarra."},{term:"cantar canciones",translation:"петь песни",example:"Cantamos canciones alrededor de la fogata."},{term:"bailar salsa",translation:"танцевать сальсу",example:"Toman clases para bailar salsa."},{term:"leer novelas",translation:"читать романы",example:"Me encanta leer novelas de misterio."},{term:"ver películas",translation:"смотреть фильмы",example:"Vemos películas todos los viernes por la noche."},{term:"ir a conciertos",translation:"ходить на концерты",example:"Voy a conciertos siempre que es posible."},{term:"enviar correos",translation:"отправлять электронные письма",example:"Envío correos a mis colegas diariamente."},{term:"navegar por internet",translation:"просматривать интернет",example:"Navego por internet para leer noticias."},{term:"descargar archivos",translation:"скачивать файлы",example:"Puedes descargar archivos de este sitio web."},{term:"subir fotos",translation:"загружать фотографии",example:"Subo fotos a las redes sociales."},{term:"hacer videollamadas",translation:"общаться по видеосвязи",example:"Hacemos videollamadas con la familia en el extranjero."},{term:"usar aplicaciones",translation:"использовать приложения",example:"Uso aplicaciones para aprender idiomas."},{term:"cargar dispositivos",translation:"заряжать устройства",example:"No olvides cargar tu teléfono."},{term:"respaldar datos",translation:"создавать резервные копии данных",example:"Siempre respalda los datos importantes."},{term:"actualizar software",translation:"обновлять программное обеспечение",example:"Actualiza tu software regularmente."},{term:"proteger privacidad",translation:"защищать конфиденциальность",example:"Es importante proteger tu privacidad en línea."}]},B1:{"ru-en":[{term:"to take an exam",translation:"сдавать экзамен",example:"Tomorrow I will take a math exam."},{term:"to make a decision",translation:"принимать решение",example:"It is difficult for me to make important decisions."},{term:"to achieve success",translation:"добиваться успеха",example:"To achieve success, you need to work hard."},{term:"to deal with problems",translation:"справляться с проблемами",example:"He knows how to deal with any problems."},{term:"to develop skills",translation:"развивать навыки",example:"It is important to constantly develop your skills."},{term:"to pay attention",translation:"обращать внимание",example:"You need to pay attention to details."},{term:"to express opinion",translation:"выражать мнение",example:"Everyone has the right to express their opinion."},{term:"to maintain relationships",translation:"поддерживать отношения",example:"It is important to maintain good relationships with colleagues."},{term:"to overcome difficulties",translation:"преодолевать трудности",example:"We can overcome any difficulties together."},{term:"to reach goals",translation:"достигать цели",example:"To reach goals, you need motivation."},{term:"to manage a team",translation:"управлять командой",example:"She learned to manage a team effectively."},{term:"to negotiate contracts",translation:"вести переговоры по контрактам",example:"Lawyers negotiate contracts for their clients."},{term:"to analyze data",translation:"анализировать данные",example:"Scientists analyze data to draw conclusions."},{term:"to implement strategies",translation:"внедрять стратегии",example:"Companies implement new strategies to grow."},{term:"to coordinate activities",translation:"координировать деятельность",example:"Project managers coordinate team activities."},{term:"to evaluate performance",translation:"оценивать производительность",example:"Managers evaluate employee performance annually."},{term:"to delegate responsibilities",translation:"делегировать обязанности",example:"Good leaders know how to delegate responsibilities."},{term:"to conduct research",translation:"проводить исследования",example:"Universities conduct research in various fields."},{term:"to present findings",translation:"представлять результаты",example:"Researchers present their findings at conferences."},{term:"to collaborate with others",translation:"сотрудничать с другими",example:"It's important to collaborate with team members."},{term:"to pursue education",translation:"получать образование",example:"Many adults pursue higher education."},{term:"to acquire knowledge",translation:"приобретать знания",example:"Reading helps you acquire new knowledge."},{term:"to master techniques",translation:"овладевать техниками",example:"Artists spend years mastering their techniques."},{term:"to enhance abilities",translation:"улучшать способности",example:"Practice helps enhance your abilities."},{term:"to expand understanding",translation:"расширять понимание",example:"Travel can expand your understanding of cultures."},{term:"to deepen expertise",translation:"углублять экспертизу",example:"Specialists work to deepen their expertise."},{term:"to broaden perspectives",translation:"расширять перспективы",example:"Education helps broaden your perspectives."},{term:"to cultivate talents",translation:"развивать таланты",example:"Schools should cultivate students' talents."},{term:"to refine methods",translation:"совершенствовать методы",example:"Scientists constantly refine their research methods."},{term:"to strengthen foundations",translation:"укреплять основы",example:"Basic courses strengthen academic foundations."},{term:"to build confidence",translation:"укреплять уверенность",example:"Success helps build self-confidence."},{term:"to overcome fears",translation:"преодолевать страхи",example:"Therapy can help overcome deep-seated fears."},{term:"to embrace challenges",translation:"принимать вызовы",example:"Successful people embrace new challenges."},{term:"to adapt to changes",translation:"адаптироваться к изменениям",example:"Modern workers must adapt to technological changes."},{term:"to pursue passions",translation:"следовать увлечениям",example:"It's important to pursue your passions in life."},{term:"to maintain balance",translation:"поддерживать баланс",example:"Try to maintain work-life balance."},{term:"to establish priorities",translation:"устанавливать приоритеты",example:"Busy people need to establish clear priorities."},{term:"to cultivate patience",translation:"развивать терпение",example:"Meditation helps cultivate patience and mindfulness."},{term:"to foster creativity",translation:"развивать креативность",example:"Art classes foster creativity in children."},{term:"to nurture relationships",translation:"развивать отношения",example:"It takes effort to nurture meaningful relationships."},{term:"to participate in discussions",translation:"участвовать в дискуссиях",example:"Students should participate actively in class discussions."},{term:"to contribute to society",translation:"вносить вклад в общество",example:"Volunteers contribute valuable time to society."},{term:"to influence decisions",translation:"влиять на решения",example:"Citizens can influence government decisions through voting."},{term:"to support causes",translation:"поддерживать дела",example:"Many celebrities support environmental causes."},{term:"to advocate for rights",translation:"отстаивать права",example:"Lawyers advocate for their clients' rights."},{term:"to promote awareness",translation:"повышать осведомлённость",example:"Campaigns promote awareness about health issues."},{term:"to engage communities",translation:"вовлекать сообщества",example:"Local leaders work to engage their communities."},{term:"to bridge differences",translation:"преодолевать различия",example:"Diplomats work to bridge cultural differences."},{term:"to resolve conflicts",translation:"разрешать конфликты",example:"Mediators help resolve workplace conflicts."},{term:"to build consensus",translation:"достигать консенсуса",example:"Committee members work to build consensus on issues."}],"ru-es":[{term:"hacer un examen",translation:"сдавать экзамен",example:"Mañana haré un examen de matemáticas."},{term:"tomar una decisión",translation:"принимать решение",example:"Me es difícil tomar decisiones importantes."},{term:"lograr el éxito",translation:"добиваться успеха",example:"Para lograr el éxito, hay que trabajar mucho."},{term:"lidiar con problemas",translation:"справляться с проблемами",example:"Él sabe lidiar con cualquier problema."},{term:"desarrollar habilidades",translation:"развивать навыки",example:"Es importante desarrollar constantemente las habilidades."},{term:"prestar atención",translation:"обращать внимание",example:"Hay que prestar atención a los detalles."},{term:"expresar opinión",translation:"выражать мнение",example:"Todos tienen derecho a expresar su opinión."},{term:"mantener relaciones",translation:"поддерживать отношения",example:"Es importante mantener buenas relaciones con colegas."},{term:"superar dificultades",translation:"преодолевать трудности",example:"Podemos superar cualquier dificultad juntos."},{term:"alcanzar metas",translation:"достигать цели",example:"Para alcanzar metas, necesitas motivación."},{term:"dirigir un equipo",translation:"управлять командой",example:"Ella aprendió a dirigir un equipo eficazmente."},{term:"negociar contratos",translation:"вести переговоры по контрактам",example:"Los abogados negocian contratos para sus clientes."},{term:"analizar datos",translation:"анализировать данные",example:"Los científicos analizan datos para sacar conclusiones."},{term:"implementar estrategias",translation:"внедрять стратегии",example:"Las empresas implementan nuevas estrategias para crecer."},{term:"coordinar actividades",translation:"координировать деятельность",example:"Los gerentes de proyecto coordinan las actividades del equipo."},{term:"evaluar rendimiento",translation:"оценивать производительность",example:"Los gerentes evalúan el rendimiento de los empleados anualmente."},{term:"delegar responsabilidades",translation:"делегировать обязанности",example:"Los buenos líderes saben cómo delegar responsabilidades."},{term:"realizar investigación",translation:"проводить исследования",example:"Las universidades realizan investigación en varios campos."},{term:"presentar hallazgos",translation:"представлять результаты",example:"Los investigadores presentan sus hallazgos en conferencias."},{term:"colaborar con otros",translation:"сотрудничать с другими",example:"Es importante colaborar con los miembros del equipo."},{term:"buscar educación",translation:"получать образование",example:"Muchos adultos buscan educación superior."},{term:"adquirir conocimiento",translation:"приобретать знания",example:"Leer te ayuda a adquirir nuevos conocimientos."},{term:"dominar técnicas",translation:"овладевать техниками",example:"Los artistas pasan años dominando sus técnicas."},{term:"mejorar habilidades",translation:"улучшать способности",example:"La práctica ayuda a mejorar tus habilidades."},{term:"ampliar comprensión",translation:"расширять понимание",example:"Viajar puede ampliar tu comprensión de las culturas."},{term:"profundizar experiencia",translation:"углублять экспертизу",example:"Los especialistas trabajan para profundizar su experiencia."},{term:"ampliar perspectivas",translation:"расширять перспективы",example:"La educación ayuda a ampliar tus perspectivas."},{term:"cultivar talentos",translation:"развивать таланты",example:"Las escuelas deben cultivar los talentos de los estudiantes."},{term:"refinar métodos",translation:"совершенствовать методы",example:"Los científicos refinan constantemente sus métodos de investigación."},{term:"fortalecer fundamentos",translation:"укреплять основы",example:"Los cursos básicos fortalecen los fundamentos académicos."},{term:"construir confianza",translation:"укреплять уверенность",example:"El éxito ayuda a construir autoconfianza."},{term:"superar miedos",translation:"преодолевать страхи",example:"La terapia puede ayudar a superar miedos profundos."},{term:"abrazar desafíos",translation:"принимать вызовы",example:"Las personas exitosas abrazan nuevos desafíos."},{term:"adaptarse a cambios",translation:"адаптироваться к изменениям",example:"Los trabajadores modernos deben adaptarse a cambios tecnológicos."},{term:"seguir pasiones",translation:"следовать увлечениям",example:"Es importante seguir tus pasiones en la vida."},{term:"mantener equilibrio",translation:"поддерживать баланс",example:"Trata de mantener el equilibrio trabajo-vida."},{term:"establecer prioridades",translation:"устанавливать приоритеты",example:"Las personas ocupadas necesitan establecer prioridades claras."},{term:"cultivar paciencia",translation:"развивать терпение",example:"La meditación ayuda a cultivar paciencia y atención plena."},{term:"fomentar creatividad",translation:"развивать креативность",example:"Las clases de arte fomentan la creatividad en los niños."},{term:"nutrir relaciones",translation:"развивать отношения",example:"Se necesita esfuerzo para nutrir relaciones significativas."},{term:"participar en discusiones",translation:"участвовать в дискуссиях",example:"Los estudiantes deben participar activamente en las discusiones de clase."},{term:"contribuir a la sociedad",translation:"вносить вклад в общество",example:"Los voluntarios contribuyen tiempo valioso a la sociedad."},{term:"influir en decisiones",translation:"влиять на решения",example:"Los ciudadanos pueden influir en las decisiones del gobierno votando."},{term:"apoyar causas",translation:"поддерживать дела",example:"Muchas celebridades apoyan causas ambientales."},{term:"abogar por derechos",translation:"отстаивать права",example:"Los abogados abogan por los derechos de sus clientes."},{term:"promover conciencia",translation:"повышать осведомлённость",example:"Las campañas promueven conciencia sobre temas de salud."},{term:"involucrar comunidades",translation:"вовлекать сообщества",example:"Los líderes locales trabajan para involucrar a sus comunidades."},{term:"tender puentes",translation:"преодолевать различия",example:"Los diplomáticos trabajan para tender puentes entre diferencias culturales."},{term:"resolver conflictos",translation:"разрешать конфликты",example:"Los mediadores ayudan a resolver conflictos laborales."},{term:"construir consenso",translation:"достигать консенсуса",example:"Los miembros del comité trabajan para construir consenso sobre temas."}]},B2:{"ru-en":[{term:"to weigh pros and cons",translation:"взвешивать все за и против",example:"Before buying a house, you need to weigh all the pros and cons."},{term:"to keep up with the times",translation:"идти в ногу со временем",example:"In the IT field, it is important to keep up with the times."},{term:"to take responsibility",translation:"брать на себя ответственность",example:"A leader must take responsibility for the team."},{term:"to find common ground",translation:"находить общий язык",example:"It is important to find common ground with colleagues."},{term:"to broaden horizons",translation:"расширять кругозор",example:"Travel helps broaden horizons."},{term:"to call into question",translation:"ставить под сомнение",example:"New data calls this theory into question."},{term:"to come to a conclusion",translation:"приходить к выводу",example:"After analysis, we come to the conclusion about the need for changes."},{term:"to take circumstances into account",translation:"учитывать обстоятельства",example:"When planning, you need to take all circumstances into account."},{term:"to strike a balance",translation:"найти баланс",example:"Companies must strike a balance between profit and social responsibility."},{term:"to make headway",translation:"добиваться прогресса",example:"The research team is making significant headway in cancer treatment."},{term:"to spearhead initiatives",translation:"возглавлять инициативы",example:"She was chosen to spearhead the company's sustainability initiatives."},{term:"to streamline processes",translation:"оптимизировать процессы",example:"The new software will streamline our workflow processes."},{term:"to leverage resources",translation:"эффективно использовать ресурсы",example:"Successful companies know how to leverage their resources effectively."},{term:"to foster innovation",translation:"способствовать инновациям",example:"The company culture fosters innovation and creative thinking."},{term:"to mitigate risks",translation:"снижать риски",example:"Insurance policies help mitigate financial risks."},{term:"to capitalize on opportunities",translation:"использовать возможности",example:"Smart investors capitalize on market opportunities."},{term:"to orchestrate campaigns",translation:"организовывать кампании",example:"The marketing team orchestrated a successful product launch campaign."},{term:"to navigate complexities",translation:"справляться со сложностями",example:"Experienced managers can navigate organizational complexities."},{term:"to synthesize information",translation:"синтезировать информацию",example:"Researchers must synthesize information from multiple sources."},{term:"to optimize performance",translation:"оптимизировать производительность",example:"Athletes work with coaches to optimize their performance."},{term:"to scrutinize evidence",translation:"тщательно изучать доказательства",example:"Scientists scrutinize evidence before drawing conclusions."},{term:"to substantiate claims",translation:"обосновывать утверждения",example:"You need solid data to substantiate your claims."},{term:"to extrapolate trends",translation:"экстраполировать тенденции",example:"Economists extrapolate trends to predict future market behavior."},{term:"to corroborate findings",translation:"подтверждать результаты",example:"Independent studies corroborate the original research findings."},{term:"to refute arguments",translation:"опровергать аргументы",example:"The defense lawyer attempted to refute the prosecution's arguments."},{term:"to articulate concepts",translation:"формулировать концепции",example:"Good teachers can articulate complex concepts clearly."},{term:"to elucidate principles",translation:"разъяснять принципы",example:"The textbook elucidates fundamental principles of physics."},{term:"to postulate theories",translation:"выдвигать теории",example:"Scientists postulate theories to explain natural phenomena."},{term:"to validate hypotheses",translation:"подтверждать гипотезы",example:"Experiments are designed to validate or reject hypotheses."},{term:"to contextualize information",translation:"контекстуализировать информацию",example:"Historians contextualize events within their time periods."}]},C1:{"ru-en":[{term:"to challenge established views",translation:"подвергать сомнению устоявшиеся взгляды",example:"Scientists must challenge established views to advance knowledge."},{term:"to learn from setbacks",translation:"извлекать уроки из неудач",example:"Successful entrepreneurs know how to learn from setbacks."},{term:"to adapt to changing conditions",translation:"адаптироваться к изменяющимся условиям",example:"Companies must adapt to changing market conditions."},{term:"to implement a comprehensive approach",translation:"осуществлять комплексный подход",example:"To solve environmental problems, a comprehensive approach is needed."},{term:"to promote sustainable development",translation:"способствовать устойчивому развитию",example:"New technologies should promote sustainable development."},{term:"to overcome cultural barriers",translation:"преодолевать культурные барьеры",example:"In international business, it is important to overcome cultural barriers."},{term:"to cultivate strategic partnerships",translation:"развивать стратегические партнерства",example:"Global companies cultivate strategic partnerships across continents."},{term:"to pioneer breakthrough innovations",translation:"быть пионером прорывных инноваций",example:"Tech giants pioneer breakthrough innovations that reshape industries."},{term:"to orchestrate transformational change",translation:"организовывать трансформационные изменения",example:"Visionary leaders orchestrate transformational change in organizations."},{term:"to navigate unprecedented challenges",translation:"справляться с беспрецедентными вызовами",example:"Modern leaders must navigate unprecedented global challenges."}]}};static sessionUsedWords=new Map;static generateSessionKey(t){return`${t.knownLanguageCode}-${t.learningLanguageCode}-${t.userLevel}`}static TOPIC_WORDS={"приветствия и прощания":[{term:"hola",translation:"привет",example:"¡Hola! ¿Cómo estás?"},{term:"adiós",translation:"до свидания",example:"Adiós, nos vemos mañana."},{term:"buenos días",translation:"доброе утро",example:"Buenos días, ¿cómo amaneció?"},{term:"buenas tardes",translation:"добрый день",example:"Buenas tardes, ¿cómo está?"},{term:"buenas noches",translation:"добрый вечер",example:"Buenas noches, que descanse bien."},{term:"¿qué tal?",translation:"как дела?",example:"¿Qué tal tu día?"},{term:"hasta luego",translation:"до скорого",example:"Hasta luego, cuídate mucho."},{term:"nos vemos",translation:"увидимся",example:"Nos vemos el próximo lunes."},{term:"saludos",translation:"приветы",example:"Saludos a toda la familia."},{term:"besos",translation:"поцелуи",example:"Besos y abrazos para todos."}],"знакомство и личная информация":[{term:"nombre",translation:"имя",example:"Mi nombre es María."},{term:"edad",translation:"возраст",example:"Tengo veinticinco años."},{term:"profesión",translation:"профессия",example:"Mi profesión es ingeniera."},{term:"trabajo",translation:"работа",example:"Trabajo en una empresa grande."},{term:"estudios",translation:"образование",example:"Estudio medicina en la universidad."},{term:"nacionalidad",translation:"национальность",example:"Mi nacionalidad es española."},{term:"dirección",translation:"адрес",example:"Vivo en la calle Mayor, número 15."},{term:"teléfono",translation:"телефон",example:"Mi número de teléfono es 123-456-789."},{term:"email",translation:"электронная почта",example:"Mi email es maria@ejemplo.com."},{term:"cumpleaños",translation:"день рождения",example:"Mi cumpleaños es el 15 de marzo."}],"числа, даты, время":[{term:"uno",translation:"один",example:"Tengo un hermano."},{term:"dos",translation:"два",example:"Son las dos de la tarde."},{term:"tres",translation:"три",example:"Vivo en el piso tres."},{term:"lunes",translation:"понедельник",example:"El lunes empiezo el trabajo."},{term:"martes",translation:"вторник",example:"Los martes voy al gimnasio."},{term:"enero",translation:"январь",example:"En enero hace mucho frío."},{term:"febrero",translation:"февраль",example:"Febrero es el mes más corto."},{term:"hora",translation:"час",example:"¿Qué hora es?"},{term:"minuto",translation:"минута",example:"Llego en cinco minutos."},{term:"segundo",translation:"секунда",example:"Espera un segundo, por favor."}],"семья и отношения":[{term:"familia",translation:"семья",example:"Mi familia es muy grande."},{term:"padres",translation:"родители",example:"Mis padres viven en Madrid."},{term:"hermano",translation:"брат",example:"Mi hermano es mayor que yo."},{term:"hermana",translation:"сестра",example:"Mi hermana estudia en Barcelona."},{term:"abuelos",translation:"бабушка и дедушка",example:"Mis abuelos son muy cariñosos."},{term:"primo",translation:"двоюродный брат",example:"Mi primo viene de visita."},{term:"amigo",translation:"друг",example:"Mi mejor amigo se llama Carlos."},{term:"novio",translation:"парень",example:"Mi novio es muy romántico."},{term:"novia",translation:"девушка",example:"Mi novia es muy inteligente."},{term:"hijo",translation:"сын",example:"Mi hijo tiene cinco años."}],"дом и жильё":[{term:"casa",translation:"дом",example:"Vivo en una casa grande."},{term:"apartamento",translation:"квартира",example:"Mi apartamento está en el centro."},{term:"habitación",translation:"комната",example:"Mi habitación es muy cómoda."},{term:"cocina",translation:"кухня",example:"La cocina es muy moderna."},{term:"baño",translation:"ванная",example:"El baño está muy limpio."},{term:"sala",translation:"гостиная",example:"En la sala vemos televisión."},{term:"dormitorio",translation:"спальня",example:"El dormitorio es muy tranquilo."},{term:"mesa",translation:"стол",example:"La mesa está en la cocina."},{term:"silla",translation:"стул",example:"Me siento en la silla."},{term:"cama",translation:"кровать",example:"La cama es muy cómoda."}],"еда и напитки":[{term:"desayuno",translation:"завтрак",example:"Como el desayuno a las 8 AM."},{term:"almuerzo",translation:"обед",example:"Almorzamos al mediodía."},{term:"cena",translation:"ужин",example:"La cena es a las 7 PM."},{term:"restaurante",translation:"ресторан",example:"Comemos en un restaurante bonito."},{term:"menú",translation:"меню",example:"Por favor, trae el menú."},{term:"camarero",translation:"официант",example:"El camarero es muy amable."},{term:"cuenta",translation:"счёт",example:"¿Puedo tener la cuenta, por favor?"},{term:"propina",translation:"чаевые",example:"Deja una propina por el buen servicio."},{term:"delicioso",translation:"вкусный",example:"¡Esta comida está deliciosa!"},{term:"hambriento",translation:"голодный",example:"Estoy muy hambriento."}],"магазины и покупки":[{term:"tienda",translation:"магазин",example:"Voy a la tienda a comprar pan."},{term:"supermercado",translation:"супермаркет",example:"El supermercado está abierto hasta las 10 PM."},{term:"ropa",translation:"одежда",example:"Necesito comprar ropa nueva."},{term:"precio",translation:"цена",example:"¿Cuál es el precio de esta camisa?"},{term:"talla",translation:"размер",example:"¿Qué talla necesitas?"},{term:"color",translation:"цвет",example:"Me gusta el color azul."},{term:"zapatos",translation:"обувь",example:"Estos zapatos son muy cómodos."},{term:"camisa",translation:"рубашка",example:"La camisa blanca está de moda."},{term:"pantalones",translation:"брюки",example:"Los pantalones negros son elegantes."},{term:"vestido",translation:"платье",example:"El vestido rojo es muy bonito."}],"путешествия и транспорт":[{term:"pasaporte",translation:"паспорт",example:"No olvides tu pasaporte."},{term:"billete",translation:"билет",example:"Necesito comprar un billete de avión."},{term:"hotel",translation:"отель",example:"Nos quedamos en un hotel bonito."},{term:"equipaje",translation:"багаж",example:"Mi equipaje es muy pesado."},{term:"maleta",translation:"чемодан",example:"Empaca tu maleta cuidadosamente."},{term:"aeropuerto",translation:"аэропорт",example:"El aeropuerto está muy ocupado."},{term:"vuelo",translation:"рейс",example:"Nuestro vuelo está retrasado."},{term:"vacaciones",translation:"отпуск",example:"Necesito vacaciones."},{term:"turismo",translation:"туризм",example:"El turismo es importante para la economía."},{term:"aventura",translation:"приключение",example:"Viajar es una gran aventura."}],"город и достопримечательности":[{term:"ciudad",translation:"город",example:"Madrid es una ciudad muy grande."},{term:"calle",translation:"улица",example:"Vivo en la calle Mayor."},{term:"plaza",translation:"площадь",example:"La plaza está en el centro."},{term:"parque",translation:"парк",example:"El parque es muy bonito."},{term:"iglesia",translation:"церковь",example:"La iglesia es muy antigua."},{term:"museo",translation:"музей",example:"El museo tiene muchas obras de arte."},{term:"monumento",translation:"памятник",example:"El monumento es muy famoso."},{term:"edificio",translation:"здание",example:"Este edificio es muy alto."},{term:"dirección",translation:"направление",example:"¿Puedes darme la dirección?"},{term:"mapa",translation:"карта",example:"Necesito un mapa de la ciudad."}],"здоровье и визит к врачу":[{term:"médico",translation:"врач",example:"Voy al médico mañana."},{term:"hospital",translation:"больница",example:"El hospital está cerca de aquí."},{term:"farmacia",translation:"аптека",example:"La farmacia está abierta las 24 horas."},{term:"medicina",translation:"лекарство",example:"Necesito tomar esta medicina."},{term:"dolor",translation:"боль",example:"Tengo dolor de cabeza."},{term:"enfermedad",translation:"болезнь",example:"La enfermedad es muy grave."},{term:"síntoma",translation:"симптом",example:"Los síntomas son fiebre y tos."},{term:"cita",translation:"приём",example:"Tengo cita con el dentista."},{term:"salud",translation:"здоровье",example:"La salud es lo más importante."},{term:"ejercicio",translation:"упражнение",example:"Hacer ejercicio es bueno para la salud."}],"работа и профессии":[{term:"oficina",translation:"офис",example:"Trabajo en una oficina grande."},{term:"reunión",translation:"встреча",example:"Tenemos una reunión a las 3 PM."},{term:"proyecto",translation:"проект",example:"Este proyecto es muy importante."},{term:"fecha límite",translation:"срок",example:"La fecha límite es el próximo viernes."},{term:"colega",translation:"коллега",example:"Mi colega es muy útil."},{term:"jefe",translation:"начальник",example:"Mi jefe es muy comprensivo."},{term:"salario",translation:"зарплата",example:"Recibo mi salario mensualmente."},{term:"entrevista",translation:"собеседование",example:"Tengo una entrevista mañana."},{term:"currículum",translation:"резюме",example:"Por favor, envía tu currículum."},{term:"carrera",translation:"карьера",example:"Quiero construir mi carrera."}],"учёба и языки":[{term:"escuela",translation:"школа",example:"Voy a la escuela todos los días."},{term:"universidad",translation:"университет",example:"Estudio en la universidad."},{term:"profesor",translation:"учитель",example:"Mi profesor es muy bueno."},{term:"estudiante",translation:"студент",example:"Soy estudiante de medicina."},{term:"clase",translation:"урок",example:"La clase de español es muy interesante."},{term:"examen",translation:"экзамен",example:"Tengo un examen mañana."},{term:"tarea",translation:"домашнее задание",example:"La tarea es muy difícil."},{term:"libro",translation:"книга",example:"Necesito comprar un libro nuevo."},{term:"idioma",translation:"язык",example:"El español es un idioma hermoso."},{term:"aprender",translation:"изучать",example:"Quiero aprender español."}],"хобби и свободное время":[{term:"fútbol",translation:"футбол",example:"El fútbol es muy popular."},{term:"baloncesto",translation:"баскетбол",example:"El baloncesto se juega con una pelota."},{term:"tenis",translation:"теннис",example:"Juego tenis cada fin de semana."},{term:"natación",translation:"плавание",example:"La natación es buen ejercicio."},{term:"correr",translation:"бег",example:"Correr me ayuda a mantenerme en forma."},{term:"gimnasio",translation:"спортзал",example:"Voy al gimnasio regularmente."},{term:"entrenamiento",translation:"тренировка",example:"El entrenamiento es duro pero gratificante."},{term:"competición",translation:"соревнование",example:"La competición es mañana."},{term:"campeón",translation:"чемпион",example:"Él es un campeón mundial."},{term:"medalla",translation:"медаль",example:"Ella ganó una medalla de oro."}],"погода и природа":[{term:"montaña",translation:"гора",example:"La montaña es muy alta."},{term:"bosque",translation:"лес",example:"Caminamos por el bosque."},{term:"océano",translation:"океан",example:"El océano es muy profundo."},{term:"río",translation:"река",example:"El río fluye hacia el mar."},{term:"lago",translation:"озеро",example:"El lago es muy tranquilo."},{term:"playa",translation:"пляж",example:"Nos relajamos en la playa."},{term:"desierto",translation:"пустыня",example:"El desierto es muy caliente."},{term:"isla",translation:"остров",example:"Visitamos una isla tropical."},{term:"valle",translation:"долина",example:"El valle es muy verde."},{term:"cascada",translation:"водопад",example:"La cascada es hermosa."}],"телефон и интернет":[{term:"computadora",translation:"компьютер",example:"Trabajo en mi computadora."},{term:"internet",translation:"интернет",example:"El internet es muy útil."},{term:"sitio web",translation:"веб-сайт",example:"Visito este sitio web diariamente."},{term:"correo electrónico",translation:"электронная почта",example:"Reviso mi correo electrónico regularmente."},{term:"teléfono inteligente",translation:"смартфон",example:"Mi teléfono inteligente es muy avanzado."},{term:"software",translation:"программное обеспечение",example:"Este software es fácil de usar."},{term:"aplicación",translation:"приложение",example:"Descargo una nueva aplicación."},{term:"contraseña",translation:"пароль",example:"No olvides tu contraseña."},{term:"base de datos",translation:"база данных",example:"La base de datos almacena información."},{term:"red",translation:"сеть",example:"La conexión de red es rápida."}],"эмоции и чувства":[{term:"feliz",translation:"счастливый",example:"Estoy muy feliz hoy."},{term:"triste",translation:"грустный",example:"Me siento triste por la noticia."},{term:"enojado",translation:"злой",example:"Estoy enojado con mi hermano."},{term:"nervioso",translation:"нервный",example:"Estoy nervioso por el examen."},{term:"emocionado",translation:"взволнованный",example:"Estoy emocionado por el viaje."},{term:"sorprendido",translation:"удивлённый",example:"Estoy sorprendido por la noticia."},{term:"preocupado",translation:"обеспокоенный",example:"Estoy preocupado por mi salud."},{term:"relajado",translation:"расслабленный",example:"Me siento muy relajado."},{term:"cansado",translation:"усталый",example:"Estoy muy cansado después del trabajo."},{term:"enamorado",translation:"влюблённый",example:"Estoy enamorado de mi novia."}],"описание людей":[{term:"alto",translation:"высокий",example:"Mi hermano es muy alto."},{term:"bajo",translation:"низкий",example:"Soy más bajo que mi padre."},{term:"delgado",translation:"худой",example:"Mi hermana es muy delgada."},{term:"gordo",translation:"толстый",example:"Mi tío es un poco gordo."},{term:"joven",translation:"молодой",example:"Ella es muy joven."},{term:"viejo",translation:"старый",example:"Mi abuelo es muy viejo."},{term:"bonito",translation:"красивый",example:"Ella es muy bonita."},{term:"feo",translation:"уродливый",example:"No es feo, solo diferente."},{term:"inteligente",translation:"умный",example:"Mi profesor es muy inteligente."},{term:"tonto",translation:"глупый",example:"No seas tonto, piensa bien."}],"описание предметов и мест":[{term:"grande",translation:"большой",example:"Esta casa es muy grande."},{term:"pequeño",translation:"маленький",example:"El perro es muy pequeño."},{term:"nuevo",translation:"новый",example:"Compré un coche nuevo."},{term:"viejo",translation:"старый",example:"Este libro es muy viejo."},{term:"rápido",translation:"быстрый",example:"El tren es muy rápido."},{term:"lento",translation:"медленный",example:"El autobús es muy lento."},{term:"fácil",translation:"лёгкий",example:"Este ejercicio es muy fácil."},{term:"difícil",translation:"трудный",example:"El examen es muy difícil."},{term:"barato",translation:"дешёвый",example:"Esta camisa es muy barata."},{term:"caro",translation:"дорогой",example:"El restaurante es muy caro."}],"будущее и планы":[{term:"futuro",translation:"будущее",example:"El futuro es incierto."},{term:"plan",translation:"план",example:"Tengo un plan para mañana."},{term:"sueño",translation:"мечта",example:"Mi sueño es viajar por el mundo."},{term:"meta",translation:"цель",example:"Mi meta es aprender español."},{term:"esperanza",translation:"надежда",example:"Tengo esperanza en el futuro."},{term:"intención",translation:"намерение",example:"Mi intención es ayudarte."},{term:"proyecto",translation:"проект",example:"Este proyecto es muy importante."},{term:"objetivo",translation:"цель",example:"Mi objetivo es graduarme."},{term:"ambición",translation:"амбиция",example:"Tengo mucha ambición."},{term:"deseo",translation:"желание",example:"Mi deseo es ser feliz."}],"культура и традиции":[{term:"fiesta",translation:"праздник",example:"La fiesta de cumpleaños es mañana."},{term:"tradición",translation:"традиция",example:"Esta tradición es muy antigua."},{term:"costumbre",translation:"обычай",example:"Es una costumbre local."},{term:"cultura",translation:"культура",example:"La cultura española es muy rica."},{term:"religión",translation:"религия",example:"La religión es importante para muchos."},{term:"celebración",translation:"празднование",example:"La celebración es muy alegre."},{term:"ritual",translation:"ритуал",example:"Este ritual es muy especial."},{term:"festival",translation:"фестиваль",example:"El festival de música es genial."},{term:"ceremonia",translation:"церемония",example:"La ceremonia de graduación es emocionante."},{term:"herencia",translation:"наследие",example:"Esta herencia cultural es valiosa."}],животные:[{term:"perro",translation:"собака",example:"Mi perro es muy juguetón."},{term:"gato",translation:"кот",example:"El gato duerme en el sofá."},{term:"pájaro",translation:"птица",example:"El pájaro canta en el árbol."},{term:"pez",translation:"рыба",example:"Los peces nadan en el acuario."},{term:"caballo",translation:"лошадь",example:"El caballo galopa en el campo."},{term:"vaca",translation:"корова",example:"La vaca da leche fresca."},{term:"cerdo",translation:"свинья",example:"El cerdo vive en la granja."},{term:"oveja",translation:"овца",example:"La oveja tiene lana blanca."},{term:"conejo",translation:"кролик",example:"El conejo salta muy alto."},{term:"ratón",translation:"мышь",example:"El ratón es muy pequeño."}],цвета:[{term:"rojo",translation:"красный",example:"La manzana es roja."},{term:"azul",translation:"синий",example:"El cielo es azul."},{term:"verde",translation:"зеленый",example:"La hierba es verde."},{term:"amarillo",translation:"желтый",example:"El sol es amarillo."},{term:"negro",translation:"черный",example:"La noche es negra."},{term:"blanco",translation:"белый",example:"La nieve es blanca."},{term:"gris",translation:"серый",example:"Las nubes son grises."},{term:"marrón",translation:"коричневый",example:"El árbol es marrón."},{term:"rosa",translation:"розовый",example:"La flor es rosa."},{term:"naranja",translation:"оранжевый",example:"La naranja es naranja."}],"поход в магазин":[{term:"tienda",translation:"магазин",example:"Voy a la tienda a comprar."},{term:"comprar",translation:"покупать",example:"Necesito comprar leche."},{term:"carrito",translation:"корзина",example:"Empujo el carrito por los pasillos."},{term:"caja",translation:"касса",example:"Pago en la caja registradora."},{term:"vendedor",translation:"продавец",example:"El vendedor me ayuda a encontrar productos."},{term:"precio",translation:"цена",example:"El precio está en la etiqueta."},{term:"descuento",translation:"скидка",example:"Hay un descuento del 20%."},{term:"recibo",translation:"чек",example:"Guardo el recibo de la compra."},{term:"bolsa",translation:"пакет",example:"Pongo las compras en la bolsa."},{term:"dinero",translation:"деньги",example:"Pago con dinero en efectivo."}]};static SAMPLE_IMAGES=["https://images.pexels.com/photos/102104/pexels-photo-102104.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/159711/books-bookstore-book-reading-159711.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1181533/pexels-photo-1181533.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1181316/pexels-photo-1181316.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1181354/pexels-photo-1181354.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1181467/pexels-photo-1181467.jpeg?w=400&h=300&fit=crop","https://images.pexels.com/photos/1181677/pexels-photo-1181677.jpeg?w=400&h=300&fit=crop"];static async generateWords(t){console.log("🤖 AIWordGeneratorService: Starting generation with request:",t),console.log("🤖 AIWordGeneratorService: Available levels:",Object.keys(this.WORD_TEMPLATES));try{await new Promise(n=>setTimeout(n,500));const a=this.generateSessionKey(t),r=`${t.learningLanguageCode}-${t.knownLanguageCode}-en`;console.log("🔑 Session key:",a),console.log("🌐 Language pair key (new format):",r),console.log("📚 User level:",t.userLevel);let s=[];if(t.topic){console.log(`🎯 Topic requested: "${t.topic}"`);const n=t.topic.toLowerCase().trim();if(this.TOPIC_WORDS[n])s=this.TOPIC_WORDS[n],console.log(`✅ Found ${s.length} topic words for "${n}"`);else{const o=this.findTopicByKeywords(n);o?(s=this.TOPIC_WORDS[o],console.log(`🔍 Fuzzy match found: "${n}" → "${o}" (${s.length} words)`)):console.log(`⚠️ No topic words found for "${n}", using general templates`)}}if(s.length===0){const n=this.WORD_TEMPLATES[t.userLevel];if(console.log("📖 Level templates found:",!!n),n&&n[r])s=n[r],console.log(`✅ Found ${s.length} templates for ${r} at level ${t.userLevel}`);else{console.log(`⚠️ No templates found for ${r} at level ${t.userLevel}, using fallback`);const o=this.WORD_TEMPLATES.A1;if(o&&o[r])s=o[r],console.log(`🔄 Using A1 fallback: ${s.length} templates`);else if(s=this.WORD_TEMPLATES.A1["es-ru-en"]||this.WORD_TEMPLATES.A1["ru-en"],console.log(`🔄 Using es-ru-en fallback: ${s.length} templates`),!s||s.length===0){console.log("🔄 No es-ru-en templates found, using any available A1 templates");const d=this.WORD_TEMPLATES.A1,g=Object.keys(d);g.length>0&&(s=d[g[0]],console.log(`🔄 Using ${g[0]} templates: ${s.length} templates`))}}}if(!s||s.length===0)throw console.error("❌ No templates available after fallback"),new Error("Нет доступных шаблонов слов для данной языковой пары");const l={targetLanguage:t.learningLanguage};return await this.selectAndFormatWords(s,t.existingWords,t.userLevel,a,l)}catch(a){throw console.error("❌ Error generating words:",a),new Error("Не удалось сгенерировать слова. Попробуйте позже.")}}static async selectAndFormatWords(t,a,r,s,l){console.log("📝 Selecting and formatting words from templates:",t?.length||0),console.log("🚫 Existing words to exclude:",a),this.sessionUsedWords.has(s)||this.sessionUsedWords.set(s,new Set);const n=this.sessionUsedWords.get(s);if(console.log("📋 Previously used words in this session:",Array.from(n)),!t||t.length===0)return console.error("❌ No templates available"),[];const o=[...a,...Array.from(n)];console.log("🚫 All excluded words:",o);const d=t.filter(g=>!o.some(w=>w.toLowerCase()===g.term.toLowerCase()||w.toLowerCase()===g.translation.toLowerCase()));if(console.log("✅ Available templates after filtering:",d.length),d.length<5){console.log("🔄 Not enough available templates, resetting session history"),n.clear();const g=t.filter(w=>!a.some(_=>_.toLowerCase()===w.term.toLowerCase()||_.toLowerCase()===w.translation.toLowerCase()));if(console.log("✅ Available templates after session reset:",g.length),g.length>0)return await this.formatSelectedWords(g,r,n,l)}return await this.formatSelectedWords(d,r,n,l)}static async formatSelectedWords(t,a,r,s){const l=[...t].sort(()=>Math.random()-.5),n=l.slice(0,Math.min(15,l.length));n.forEach(d=>{r.add(d.term.toLowerCase()),r.add(d.translation.toLowerCase())}),console.log("🎯 Selected words for this generation:",n.map(d=>d.term)),console.log("📚 Updated session used words:",Array.from(r)),console.log("🎨 Generating images for selected words...");const o=await Promise.all(n.map(async(d,g)=>{const w=this.extractEnglishWordFromExample(d.example);console.log(`🖼️ Generating image for "${d.term}" using English word: "${w}"`);let _=this.SAMPLE_IMAGES[g%this.SAMPLE_IMAGES.length];if(this.shouldGenerateImage(request.imageGenerationSettings))try{const y=await mt.generateImage({word:w,language:"en",style:request.imageGenerationSettings?.style||"cartoon"});y.success&&y.imageUrl?(_=y.imageUrl,console.log(`✅ Image generated for "${d.term}": ${_}`)):console.warn(`⚠️ Image generation failed for "${d.term}": ${y.error}`)}catch(y){console.warn(`⚠️ Image generation error for "${d.term}":`,y)}else console.log(`⏭️ Skipping image generation for "${d.term}" - all services disabled`);return{term:d.term,translation:d.translation,english:w,imageUrl:_,example:d.example,difficulty:a}}));return console.log("✅ Final formatted words with images:",o),o}static findTopicByKeywords(t){const a=Object.keys(this.TOPIC_WORDS),r={магазин:["магазины и покупки","поход в магазин"],покупки:["магазины и покупки","поход в магазин"],покупка:["магазины и покупки","поход в магазин"],поход:["поход в магазин"],еда:["еда и напитки"],напитки:["еда и напитки"],семья:["семья и отношения"],отношения:["семья и отношения"],дом:["дом и жильё"],жильё:["дом и жильё"],путешествия:["путешествия и транспорт"],транспорт:["путешествия и транспорт"],работа:["работа и профессии"],профессии:["работа и профессии"],учёба:["учёба и языки"],языки:["учёба и языки"],хобби:["хобби и свободное время"],"свободное время":["хобби и свободное время"],погода:["погода и природа"],природа:["погода и природа"],здоровье:["здоровье и визит к врачу"],врач:["здоровье и визит к врачу"],эмоции:["эмоции и чувства"],чувства:["эмоции и чувства"],цвета:["цвета"],животные:["животные"]};for(const[s,l]of Object.entries(r))if(t.includes(s)){const n=l.find(o=>a.includes(o));if(n)return n}for(const s of a){const l=s.split(" "),n=t.split(" ");if(l.filter(d=>n.some(g=>d.includes(g)||g.includes(d))).length>0)return s}return null}static shouldGenerateImage(t){return!t||!t.enabledServices?!0:t.enabledServices.length>0?t.enabledServices.some(s=>s!=="Fallback"&&s!=="Unsplash"&&s!=="Pexels"&&s!=="Pixabay"&&s!=="Craiyon")?!0:(console.log("🚫 Image generation disabled - only fallback services enabled"),!1):(console.log("🚫 Image generation disabled - no services enabled"),!1)}static extractEnglishWordFromExample(t){return t.toLowerCase().replace(/[.,!?;:]/g,"").split(" ").filter(r=>r.length>2).filter(r=>!["the","and","are","is","was","were","have","has","had","will","would","can","could","should","may","might"].includes(r))[0]||"object"}static getLevelDescription(t){return{A1:"Базовые слова для повседневного общения",A2:"Полезная лексика для простых ситуаций",B1:"Устойчивые выражения и фразы",B2:"Сложные конструкции и идиомы",C1:"Продвинутая лексика и фразеологизмы",C2:"Профессиональная и академическая лексика"}[t]||"Подобранная лексика для вашего уровня"}static getThemeForLevel(t){return{A1:"🏠 Дом, семья и повседневная жизнь",A2:"🌍 Путешествия, работа и хобби",B1:"💼 Профессиональная деятельность и образование",B2:"🎯 Сложные идиомы и выражения",C1:"🧠 Продвинутая профессиональная лексика",C2:"📚 Академическая и специализированная лексика"}[t]||"📖 Общая лексика"}static getAvailableTopics(){return Object.keys(this.TOPIC_WORDS)}static getTopicDescription(t){return{еда:"🍽️ Слова связанные с едой, ресторанами и кулинарией",животные:"🐾 Названия животных и связанная с ними лексика",путешествия:"✈️ Слова для путешествий, туризма и транспорта",работа:"💼 Профессиональная лексика и офисная жизнь",спорт:"⚽ Спортивные термины и физическая активность",музыка:"🎵 Музыкальные инструменты, жанры и термины",природа:"🌿 Природные объекты, пейзажи и экология",технологии:"💻 Компьютеры, интернет и современные технологии","поход в магазин":"🛒 Слова для похода в магазин и покупок"}[t]||`📚 Слова по теме "${t}"`}static resetSessionWords(t){t?(this.sessionUsedWords.delete(t),console.log(`🔄 Session words history for ${t} has been reset`)):(this.sessionUsedWords.clear(),console.log("🔄 All session words history has been reset"))}static getUsageStats(){const t={};return this.sessionUsedWords.forEach((a,r)=>{t[r]=a.size}),t}}const za=({isOpen:i,onClose:t})=>{const[a,r]=c.useState(""),[s,l]=c.useState(!1),[n,o]=c.useState(!1),[d,g]=c.useState(null),w=async()=>{if(!a.trim()){g({success:!1,message:"Пожалуйста, введите API ключ Leonardo.ai"});return}o(!0),g(null);try{localStorage.setItem("leonardo_api_key",a),g({success:!0,message:"API ключ успешно сохранен!"}),setTimeout(()=>{t()},2e3)}catch{g({success:!1,message:"Ошибка при сохранении API ключа"})}finally{o(!1)}};be("LEONARDO");const _=!!Ee("LEONARDO_API_KEY");return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Kt,{className:"w-4 h-4 text-white"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Настройка Leonardo.ai"})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-80px)]",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),"Текущий статус API"]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[_?e.jsx(_e,{className:"w-4 h-4 text-green-500"}):e.jsx(Je,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"text-sm",children:["Leonardo.ai API: ",_?"Настроен":"Не настроен"]})]})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>l(!s),className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium",children:[e.jsx(ua,{className:"w-4 h-4"}),s?"Скрыть инструкции":"Показать инструкции по настройке"]})}),s&&e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 mb-6",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-3",children:"Инструкции по настройке Leonardo.ai"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("p",{children:["1. Перейдите на ",e.jsx("a",{href:"https://leonardo.ai",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"leonardo.ai"})]}),e.jsx("p",{children:"2. Зарегистрируйтесь или войдите в аккаунт"}),e.jsx("p",{children:"3. Перейдите в раздел API и создайте новый ключ"}),e.jsx("p",{children:"4. Скопируйте ключ и вставьте в поле ниже"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leonardo.ai API Key"}),e.jsx("input",{type:"password",value:a,onChange:T=>r(T.target.value),placeholder:"Введите ваш Leonardo.ai API Key",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-400"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Получите ключ на ",e.jsx("a",{href:"https://leonardo.ai",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"leonardo.ai"})]})]})}),d&&e.jsx("div",{className:`p-4 rounded-xl border ${d.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[d.success?e.jsx(_e,{className:"w-5 h-5 text-green-600"}):e.jsx(Je,{className:"w-5 h-5 text-red-600"}),e.jsx("p",{className:`text-sm font-medium ${d.success?"text-green-800":"text-red-800"}`,children:d.message})]})}),e.jsxs("div",{className:"bg-yellow-50 rounded-xl p-4 mt-6",children:[e.jsxs("h3",{className:"font-medium text-yellow-900 mb-2 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Без API ключа"]}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Если API ключ Leonardo.ai не настроен, система будет использовать fallback изображения, подобранные по категориям слов (животные, еда, природа, предметы, люди)."})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Отмена"}),e.jsx("button",{onClick:w,disabled:!a.trim()||n,className:"flex-1 px-4 py-3 bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700 disabled:bg-gray-300 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Сохранение..."]}):"Сохранить ключ"})]})]})]})}):null};class Be{static baseUrl="https://api.openai.com/v1/chat/completions";static getApiKey(){return Ee("OPENAI_API_KEY")}static getApiStatus(){const t=!!this.getApiKey(),a=be("OPENAI");return{configured:t&&a,hasKey:t}}static async generateWords(t){console.log("🤖 ChatGPTService: Starting generation with request:",t);const a=this.getApiKey();if(!a)return console.warn("⚠️ ChatGPT API key not configured"),{words:[],success:!1,error:"API ключ не настроен"};try{const r=this.buildPrompt(t);console.log("📝 Generated prompt:",r);const s=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Ты помощник для изучения языков. Генерируй слова в формате JSON с полями: term, translation, example, difficulty."},{role:"user",content:r}],max_tokens:1e3,temperature:.7})});if(!s.ok){const d=await s.json();throw console.error("❌ ChatGPT API error:",d),new Error(`API Error: ${d.error?.message||"Unknown error"}`)}const l=await s.json();console.log("✅ ChatGPT API response:",l);const n=l.choices[0]?.message?.content;if(!n)throw new Error("No content received from ChatGPT");const o=this.parseResponse(n);return console.log("📚 Parsed words:",o),{words:o,success:!0}}catch(r){return console.error("❌ ChatGPT generation error:",r),{words:[],success:!1,error:r.message||"Ошибка генерации через ChatGPT"}}}static buildPrompt(t){const{userLevel:a,languagePair:r,topic:s,count:l,existingWords:n}=t;let o=`Сгенерируй ${l} слов для изучения языка на трех языках.

`;return o+=`Языковая пара: ${r.learning} → ${r.known} → English
`,o+=`Уровень: ${a}

`,s&&(o+=`Тема: ${s}

`),n.length>0&&(o+=`Исключи эти слова: ${n.join(", ")}

`),o+=`Требования:
`,o+=`- Слова должны соответствовать уровню ${a}
`,o+=`- Каждое слово должно быть на трех языках: ${r.learning} → ${r.known} → English
`,o+=`- Добавь пример использования на ${r.learning}
`,o+=`- Укажи сложность (A1, A2, B1, B2, C1, C2)
`,o+=`- Английское слово будет использоваться для генерации изображений

`,s&&(o+=`Фокус на теме: ${s}

`),o+=`Ответ в формате JSON:
`,o+=`[
`,o+=`  {
`,o+=`    "term": "слово на ${r.learning}",
`,o+=`    "translation": "перевод на ${r.known}",
`,o+=`    "english": "перевод на английский",
`,o+=`    "example": "пример использования на ${r.learning}",
`,o+=`    "difficulty": "уровень сложности"
`,o+=`  }
`,o+=`]

`,o+="Только JSON, без дополнительного текста.",o}static parseResponse(t){try{let a=t.trim();a.startsWith("```json")&&(a=a.replace(/```json\n?/,"").replace(/```\n?$/,"")),a.startsWith("```")&&(a=a.replace(/```\n?/,"").replace(/```\n?$/,""));const r=JSON.parse(a);if(!Array.isArray(r))throw new Error("Response is not an array");return r.map(s=>({term:s.term||"",translation:s.translation||"",english:s.english||"",example:s.example||"",difficulty:s.difficulty||"A1"}))}catch(a){console.error("❌ Error parsing ChatGPT response:",a),console.error("Raw content:",t);const r=t.match(/\[[\s\S]*\]/);if(r)try{return JSON.parse(r[0]).map(l=>({term:l.term||"",translation:l.translation||"",example:l.example||"",difficulty:l.difficulty||"A1"}))}catch(s){console.error("❌ Failed to parse extracted JSON:",s)}throw new Error("Не удалось распарсить ответ от ChatGPT")}}static async testConnection(){const t=this.getApiKey();if(!t)return{success:!1,error:"API ключ не настроен"};try{const a=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:"Hello, test message"}],max_tokens:10})});return a.ok?{success:!0}:{success:!1,error:(await a.json()).error?.message||"API Error"}}catch(a){return{success:!1,error:a.message||"Connection error"}}}}var St=(i=>(i.GEMINI="gemini",i.HUGGING_FACE="huggingface",i.COHERE="cohere",i))(St||{});class Ke{static getApiKey(t){return Ee({gemini:"GEMINI_API_KEY",huggingface:"HUGGING_FACE_API_KEY",cohere:"COHERE_API_KEY"}[t])}static getServicesStatus(){return{gemini:{configured:!!this.getApiKey("gemini")&&be("GEMINI"),hasKey:!!this.getApiKey("gemini")},huggingface:{configured:!!this.getApiKey("huggingface")&&be("HUGGING_FACE"),hasKey:!!this.getApiKey("huggingface")},cohere:{configured:!!this.getApiKey("cohere")&&be("COHERE"),hasKey:!!this.getApiKey("cohere")}}}static getServicesInfo(){return{gemini:{name:"Google Gemini",description:"Google Gemini AI для генерации слов",free:!0,url:"https://aistudio.google.com/app/apikey"},huggingface:{name:"Hugging Face",description:"Бесплатные открытые модели ИИ",free:!0,url:"https://huggingface.co/inference-api"},cohere:{name:"Cohere",description:"Бесплатный тариф до 1000 запросов/месяц",free:!0,url:"https://cohere.ai"}}}static async generateWords(t){console.log("🤖 FreeAIService: Starting generation with request:",t);const a=this.findAvailableService();if(!a)return{words:[],success:!1,error:"Нет настроенных бесплатных AI сервисов",service:"none"};try{switch(a){case"gemini":return await this.generateWithGemini(t);case"huggingface":return await this.generateWithHuggingFace(t);case"cohere":return await this.generateWithCohere(t);default:throw new Error("Unsupported service")}}catch(r){return console.error("❌ FreeAI generation error:",r),{words:[],success:!1,error:r instanceof Error?r.message:"Ошибка генерации через бесплатный AI",service:a}}}static findAvailableService(){const t=ta();console.log("🔍 FreeAIService: Service priority order:",t);for(const a of t){if(a==="OPENAI")continue;const r=this.mapServiceKeyToEnum(a);if(r){const s=this.getServicesStatus()[r];if(console.log(`🔍 FreeAIService: Checking ${a} (${r}):`,s),s.configured)return console.log(`✅ FreeAIService: Selected ${a} (${r}) as primary service`),r}}return console.log("❌ FreeAIService: No available services found"),null}static mapServiceKeyToEnum(t){return{GEMINI:"gemini",HUGGING_FACE:"huggingface",COHERE:"cohere"}[t]||null}static async generateWithGemini(t){console.log("🤖 FreeAIService: Starting Gemini generation...");const a=this.getApiKey("gemini"),r=this.buildPrompt(t);console.log("🤖 FreeAIService: Gemini API key available:",!!a),console.log("🤖 FreeAIService: Gemini prompt length:",r.length);try{const s=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:r}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:1e3}})});if(!s.ok)throw new Error(`Gemini API error: ${s.statusText}`);const l=await s.json(),n=this.parseGeminiResponse(l,t);return console.log(`✅ FreeAIService: Gemini generated ${n.length} words successfully`),{words:n,success:!0,service:"gemini"}}catch(s){const l=s instanceof Error?s.message:"Unknown error";throw new Error(`Gemini error: ${l}`)}}static async generateWithHuggingFace(t){const a=this.getApiKey("huggingface"),r=this.buildPrompt(t);try{const s=await fetch("https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:r,parameters:{max_length:500,temperature:.7}})});if(!s.ok)throw new Error(`Hugging Face API error: ${s.statusText}`);const l=await s.json();return{words:this.parseHuggingFaceResponse(l,t),success:!0,service:"huggingface"}}catch(s){const l=s instanceof Error?s.message:"Unknown error";throw new Error(`Hugging Face error: ${l}`)}}static async generateWithCohere(t){const a=this.getApiKey("cohere"),r=this.buildPrompt(t);try{const s=await fetch("https://api.cohere.ai/v1/generate",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({model:"command-light",prompt:r,max_tokens:500,temperature:.7})});if(!s.ok)throw new Error(`Cohere API error: ${s.statusText}`);const l=await s.json();return{words:this.parseCohereResponse(l,t),success:!0,service:"cohere"}}catch(s){const l=s instanceof Error?s.message:"Unknown error";throw new Error(`Cohere error: ${l}`)}}static buildPrompt(t){const{userLevel:a,languagePair:r,topic:s,count:l,existingWords:n}=t;let o=`Сгенерируй ${l} слов для изучения языка на трех языках.

`;return o+=`Языковая пара: ${r.learning} → ${r.known} → English
`,o+=`Уровень: ${a}

`,s&&(o+=`Тема: ${s}

`),n.length>0&&(o+=`Исключи эти слова: ${n.join(", ")}

`),o+=`Требования:
`,o+=`- Слова должны соответствовать уровню ${a}
`,o+=`- Каждое слово должно быть на трех языках: ${r.learning} → ${r.known} → English
`,o+=`- Добавь пример использования на ${r.learning}
`,o+=`- Укажи сложность (A1, A2, B1, B2, C1, C2)
`,o+=`- Английское слово будет использоваться для генерации изображений

`,s&&(o+=`Фокус на теме: ${s}

`),o+=`Ответ в формате JSON:
`,o+=`[
`,o+=`  {
`,o+=`    "term": "слово на ${r.learning}",
`,o+=`    "translation": "перевод на ${r.known}",
`,o+=`    "english": "перевод на английский",
`,o+=`    "example": "пример использования на ${r.learning}",
`,o+=`    "difficulty": "уровень сложности"
`,o+=`  }
`,o+=`]

`,o+="Только JSON, без дополнительного текста.",o}static parseHuggingFaceResponse(t,a){const r=t[0]?.generated_text||"";return this.parseTextResponse(r,a)}static parseGeminiResponse(t,a){const r=t.candidates?.[0]?.content?.parts?.[0]?.text||"";return this.parseTextResponse(r,a)}static parseCohereResponse(t,a){const r=t.generations?.[0]?.text||"";return this.parseTextResponse(r,a)}static parseTextResponse(t,a){try{let r=t.trim();r.startsWith("```json")&&(r=r.replace(/```json\n?/,"").replace(/```\n?$/,"")),r.startsWith("```")&&(r=r.replace(/```\n?/,"").replace(/```\n?$/,""));const s=JSON.parse(r);if(!Array.isArray(s))throw new Error("Response is not an array");return s.map(l=>({term:l.term||"",translation:l.translation||"",english:l.english||"",example:l.example||"",difficulty:l.difficulty||"A1"}))}catch(r){return console.error("❌ Error parsing AI response:",r),console.error("Raw content:",t),[]}}static async testConnection(t){const a=this.getApiKey(t);if(!a)return{success:!1,error:"API ключ не настроен"};try{switch(t){case"huggingface":return await this.testHuggingFace(a);case"cohere":return await this.testCohere(a);default:return{success:!1,error:"Unsupported service"}}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Connection error"}}}static async testHuggingFace(t){try{return{success:(await fetch("https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:"Hello, test message",parameters:{max_length:10}})})).ok}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}static async testCohere(t){try{return{success:(await fetch("https://api.cohere.ai/v1/generate",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"command-light",prompt:"Hello, test message",max_tokens:10})})).ok}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}}const qa=({isOpen:i,onClose:t})=>{if(!i)return null;const a=Be.getApiStatus(),r=Ke.getServicesStatus(),s=Wa(),l=Ma(),n=Fa(),o=w=>{switch(w){case"OPENAI":return"🤖";case"GEMINI":return"💎";case"HUGGING_FACE":return"🤗";case"COHERE":return"🔮";case"LEONARDO":return"🎨";case"GOOGLE_TRANSLATE":return"🌍";default:return"🤖"}},d=w=>{switch(w){case"OPENAI":return"from-gray-500 to-gray-600";case"GEMINI":return"from-blue-500 to-indigo-600";case"HUGGING_FACE":return"from-purple-500 to-pink-500";case"COHERE":return"from-blue-500 to-cyan-500";case"LEONARDO":return"from-purple-500 to-blue-600";case"GOOGLE_TRANSLATE":return"from-blue-500 to-green-500";default:return"from-gray-500 to-gray-600"}},g=w=>{if(w==="OPENAI")return a;if(w==="GEMINI"){const y=!!Ee("GEMINI_API_KEY"),P=be("GEMINI");return{configured:y&&P,hasKey:y}}if(w==="LEONARDO"){const y=!!Ee("LEONARDO_API_KEY"),P=be("LEONARDO");return{configured:y&&P,hasKey:y}}if(w==="GOOGLE_TRANSLATE"){const y=!!Ee("GOOGLE_TRANSLATE_API_KEY"),P=be("GOOGLE_TRANSLATE");return{configured:y&&P,hasKey:y}}const T={HUGGING_FACE:St.HUGGING_FACE,COHERE:St.COHERE}[w];return T?r[T]:{configured:!1,hasKey:!1}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(jt,{className:"w-4 h-4 text-white"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Статус AI сервисов"})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ut,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-blue-800",children:"Текущие сервисы"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Генерация слов:"})," ",l?`${s.find(w=>w.key===l)?.name||"Неизвестный сервис"}`:"Локальная система"]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Генерация изображений:"})," ",n?`${s.find(w=>w.key===n)?.name||"Leonardo.ai"}`:"Fallback изображения"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:s.map(w=>{const T=g(w.key).configured;return e.jsxs("div",{className:`p-4 border-2 rounded-xl ${T?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-10 h-10 bg-gradient-to-r ${d(w.key)} rounded-lg flex items-center justify-center text-white text-lg`,children:o(w.key)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w.name}),e.jsx("p",{className:"text-sm text-gray-600",children:w.description})]}),e.jsx("div",{className:"flex items-center gap-2",children:T?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Доступен"})]}):e.jsxs("div",{className:"flex items-center gap-1 text-gray-400",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Недоступен"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[w.key!=="OPENAI"&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"Бесплатно"}),w.key==="OPENAI"&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full",children:"Платно"})]}),!T&&e.jsx("span",{className:"text-xs text-gray-500",children:"API ключ не настроен"})]})]},w.key)})}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800 mb-2",children:"Как это работает:"}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"1. Генерация слов:"})," ChatGPT → Hugging Face → Cohere → Локальная система"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"2. Генерация изображений:"})," Leonardo.ai → Fallback изображения"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"3. Автоматический выбор:"})," Система автоматически выберет первый доступный сервис"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"4. Fallback:"})," При ошибках автоматически переключится на следующий доступный сервис"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"5. Надежность:"})," Локальная система всегда работает как последний fallback"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:[e.jsx("strong",{children:"Примечание:"})," API ключи настроены администратором и доступны всем пользователям."]})]})]})]})})},Va=({isOpen:i,onClose:t,onSave:a,currentSettings:r={style:"cartoon",enabledServices:["Unsplash","Pexels","Pixabay","Craiyon","Fallback"]}})=>{const[s,l]=c.useState(r.style),[n,o]=c.useState(r.enabledServices),d=mt.getAvailableStyles(),g=mt.getAvailableServices(),w=T=>{o(y=>y.includes(T)?y.filter(P=>P!==T):[...y,T])},_=()=>{a({style:s,enabledServices:n}),t()};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Tt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Настройки генерации изображений"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Настройте стиль и сервисы для генерации изображений"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ht,{className:"w-5 h-5 text-blue-600"}),"Стиль изображений"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:d.map(T=>e.jsxs("label",{className:`p-3 border-2 rounded-lg cursor-pointer transition-all ${s===T.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"style",value:T.value,checked:s===T.value,onChange:y=>l(y.target.value),className:"sr-only"}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"font-medium text-gray-900",children:T.label})})]},T.value))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ga,{className:"w-5 h-5 text-green-600"}),"Доступные сервисы"]}),e.jsx("div",{className:"space-y-3",children:g.map(T=>e.jsxs("label",{className:`flex items-center justify-between p-3 border-2 rounded-lg cursor-pointer transition-all ${n.includes(T.name)?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:n.includes(T.name),onChange:()=>w(T.name),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:T.name}),e.jsx("div",{className:"text-sm text-gray-600",children:T.description})]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${T.free?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:T.free?"Бесплатно":"Платно"})]},T.name))})]}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ut,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Как это работает:"}),e.jsxs("ul",{className:"space-y-1 text-blue-700",children:[e.jsx("li",{children:"• Сервисы используются по приоритету (сверху вниз)"}),e.jsx("li",{children:"• Если один сервис недоступен, автоматически используется следующий"}),e.jsx("li",{children:"• Fallback всегда доступен как резервный вариант"}),e.jsx("li",{children:"• Все сервисы бесплатные с ограничениями по количеству запросов"})]})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Отмена"}),e.jsx("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors",children:"Сохранить настройки"})]})]})}):null},aa=({isOpen:i,onClose:t,onSave:a,existingCards:r})=>{const[s,l]=c.useState(!1),[n,o]=c.useState([]),[d,g]=c.useState(0),[w,_]=c.useState(!1),[T,y]=c.useState(!1),[P,R]=c.useState(!1),[u,C]=c.useState(""),[S,h]=c.useState(!0),[I]=c.useState(()=>X.getCurrentUser()),[U]=c.useState(()=>{const W=X.getUserSettings(),V=xe.getLanguagePair();return W||V}),[O,$]=c.useState("A1"),[f,p]=c.useState(0),[E,G]=c.useState(0),[M,z]=c.useState(!1),[L,B]=c.useState(()=>{const W=localStorage.getItem("imageGenerationSettings");if(W)try{return JSON.parse(W)}catch(V){console.warn("Failed to parse saved image generation settings:",V)}return{style:"cartoon",enabledServices:["Leonardo.ai","Fallback"]}}),b=["еда и напитки","семья и друзья","дом и квартира","работа и профессии","путешествия и транспорт","покупки и магазины","здоровье и медицина","спорт и отдых","природа и животные","время и календарь","цвета и числа","одежда и мода","образование и школа","технологии и интернет","музыка и искусство"],N=()=>{const W=b.filter(V=>V!==u.trim());return W.length===0?b[Math.floor(Math.random()*b.length)]:W[Math.floor(Math.random()*W.length)]},A=async W=>{if(M){console.log("⏳ Retry already in progress, skipping...");return}z(!0);const V=N(),ee=W+1;console.log(`🔄 Retrying generation with new topic: "${V}" (attempt ${ee})`),C(V),p(ee),setTimeout(()=>{z(!1),D(ee,V)},1e3)};c.useEffect(()=>{(async()=>{try{const V=await v();$(V)}catch(V){console.warn("Error loading user level:",V);const ee=I?.level||"A1";$(ee)}})()},[U,I]);const v=async()=>{try{console.log("🔍 Getting user level from database...");const W=await X.getCurrentUserFromDB();if(W?.level)return console.log("✅ Got level from database:",W.level),W.level;const V=X.getUserSettings();if(V?.level)return console.log("✅ Got level from fresh settings:",V.level),V.level;if(U&&"level"in U&&U.level)return console.log("✅ Got level from current settings:",U.level),U.level;const ee=I?.level||"A1";return console.log("⚠️ Using fallback level:",ee),ee}catch(W){console.warn("❌ Error getting user level, using fallback:",W);const V=I?.level||"A1";return console.log("⚠️ Using fallback level after error:",V),V}},m=async W=>{console.log("🖼️ Generating images for",W.length,"words");const V=await Promise.all(W.map(async ee=>{const H=x(ee);console.log(`🖼️ Generating image for "${ee.term}" using English word: "${H}"`);let J="";try{const me=await mt.generateImage({word:H,language:"en",style:"cartoon"});me.success&&me.imageUrl?(J=me.imageUrl,console.log(`✅ Image generated for "${ee.term}": ${J}`)):(console.warn(`⚠️ Image generation failed for "${ee.term}": ${me.error}`),J="https://images.pexels.com/photos/102104/pexels-photo-102104.jpeg?w=400&h=300&fit=crop")}catch(me){console.warn(`⚠️ Image generation error for "${ee.term}":`,me),J="https://images.pexels.com/photos/102104/pexels-photo-102104.jpeg?w=400&h=300&fit=crop"}return{...ee,imageUrl:J}}));return console.log("✅ Images generated for all words"),V},x=W=>W.english&&W.english.trim()?W.english.trim():(W.example||"").toLowerCase().replace(/[.,!?;:]/g,"").split(" ").filter(H=>H.length>2).filter(H=>!["the","and","are","is","was","were","have","has","had","will","would","can","could","should","may","might","voy","a","la","el","de","en","con","por","para","que","como","muy","más","muy","bien","mal","bueno","buena","nuevo","nueva"].includes(H))[0]||"object",j=async(W=0)=>{if(s&&W===0){console.log("⏳ Generation already in progress, skipping...");return}const V=Date.now(),ee=V-E;if(ee<1e3&&W>0){console.log("⏳ Too soon since last generation, waiting..."),setTimeout(()=>{j(W)},1e3-ee);return}if(G(V),console.log("🚀 Starting AI word generation..."),console.log("Current user:",I),console.log("Current settings:",U),console.log("Existing cards count:",r.length),!I){console.error("❌ No current user found"),alert("Ошибка: не удалось получить данные пользователя");return}const H=X.getUserSettings()||xe.getLanguagePair();if(console.log("Language settings:",H),!H){console.error("❌ No language settings found"),alert("Ошибка: не удалось получить настройки языков");return}l(!0),o([]);try{const J=r.map(re=>re.term),me=n.map(re=>re.term),ae=[...J,...me];console.log("Existing words from DB:",J),console.log("Previous generated words:",me),console.log("All existing words:",ae),console.log("🎯 Using selected level for generation:",O),console.log("🎯 Selected level type:",typeof O);const he=Be.getApiStatus(),ge=Ke.getServicesStatus(),et=Object.values(ge).some(re=>re.configured);let ce=[];if(et){console.log("💎 Using Free AI services (Gemini priority) for generation...");try{const re={userLevel:O,languagePair:{learning:H.learning_language,known:H.known_language},topic:u.trim()||void 0,count:10,existingWords:ae};console.log("🚀 FreeAI request with level:",re.userLevel);const Y=await Ke.generateWords(re);if(Y.success&&Y.words.length>0){const le=Y.words.map(oe=>({term:oe.term,translation:oe.translation,english:oe.english,imageUrl:"",example:oe.example,difficulty:oe.difficulty,selected:!1}));ce=await m(le),console.log(`✅ Free AI (${Y.service}) generated words with images:`,ce.length)}else throw new Error(Y.error||"Free AI generation failed")}catch(re){if(console.warn("⚠️ Free AI error, trying ChatGPT as fallback:",re),he.configured)try{const Y={userLevel:O,languagePair:{learning:H.learning_language,known:H.known_language},topic:u.trim()||void 0,count:10,existingWords:ae};console.log("🤖 ChatGPT request with level:",Y.userLevel);const le=await Be.generateWords(Y);if(le.success&&le.words.length>0){const oe=le.words.map(Re=>({term:Re.term,translation:Re.translation,english:Re.english,imageUrl:"",example:Re.example,difficulty:Re.difficulty,selected:!1}));ce=await m(oe),console.log("✅ ChatGPT generated words with images:",ce.length)}else throw new Error(le.error||"ChatGPT generation failed")}catch(Y){console.warn("⚠️ ChatGPT error, falling back to local generation:",Y),console.log("📚 Fallback local generation with level:",O),ce=await ke.generateWords({knownLanguage:H.known_language,learningLanguage:H.learning_language,knownLanguageCode:H.known_language_code,learningLanguageCode:H.learning_language_code,userLevel:O,existingWords:ae,topic:u.trim()||void 0,imageGenerationSettings:L})}else console.log("📚 FreeAI fallback local generation with level:",O),ce=await ke.generateWords({knownLanguage:H.known_language,learningLanguage:H.learning_language,knownLanguageCode:H.known_language_code,learningLanguageCode:H.learning_language_code,userLevel:O,existingWords:ae,topic:u.trim()||void 0,imageGenerationSettings:L})}}else if(he.configured){console.log("🤖 Using ChatGPT API for generation...");try{const re={userLevel:O,languagePair:{learning:H.learning_language,known:H.known_language},topic:u.trim()||void 0,count:10,existingWords:ae};console.log("🤖 Main ChatGPT request with level:",re.userLevel);const Y=await Be.generateWords(re);if(Y.success&&Y.words.length>0){const le=Y.words.map(oe=>({term:oe.term,translation:oe.translation,english:oe.english,imageUrl:"",example:oe.example,difficulty:oe.difficulty,selected:!1}));ce=await m(le),console.log("✅ ChatGPT generated words with images:",ce.length)}else throw new Error(Y.error||"ChatGPT generation failed")}catch(re){console.warn("⚠️ ChatGPT error, falling back to local generation:",re),console.log("📚 ChatGPT fallback local generation with level:",O),ce=await ke.generateWords({knownLanguage:H.known_language,learningLanguage:H.learning_language,knownLanguageCode:H.known_language_code,learningLanguageCode:H.learning_language_code,userLevel:O,existingWords:ae,topic:u.trim()||void 0,imageGenerationSettings:L})}}else console.log("📚 Using local generation..."),console.log("📚 Local generation request with level:",O),ce=await ke.generateWords({knownLanguage:H.known_language,learningLanguage:H.learning_language,knownLanguageCode:H.known_language_code,learningLanguageCode:H.learning_language_code,userLevel:O,existingWords:ae,topic:u.trim()||void 0,imageGenerationSettings:L});if(console.log("✅ Generated words:",ce),ce.length===0){console.warn("⚠️ No words generated"),alert("Не удалось сгенерировать новые слова. Попробуйте изменить уровень или языковую пару.");return}const Pt=ae.map(re=>re.toLowerCase()),qe=ce.filter(re=>!Pt.includes(re.term.toLowerCase()));if(console.log(`📊 Generated: ${ce.length}, Unique: ${qe.length}, Duplicates: ${ce.length-qe.length}`),qe.length===0)if(console.warn("⚠️ All generated words are duplicates"),W<2){console.log(`🔄 Auto-retrying with new topic (attempt ${W+1}/3)`),await A(W);return}else{alert("Все сгенерированные слова уже есть в вашей коллекции или были в предыдущей генерации. Попробуйте изменить уровень или тему."),p(0);return}const Pe=qe.map(re=>({...re,selected:!0}));o(Pe),g(Pe.length),p(0),console.log("✅ Words set in state:",Pe.length),console.log("📊 Words by theme:",Pe.map(re=>`${re.term} -> ${re.translation}`))}catch(J){console.error("Error generating words:",J);const me=J instanceof Error?J.message:"Попробуйте позже.";alert(`Ошибка генерации слов: ${me}`)}finally{l(!1)}},D=async(W,V)=>{const ee=Date.now(),H=ee-E;if(s&&W===0){console.log("⏳ Generation already in progress, skipping...");return}if(H<1e3&&W>0){console.log("⏳ Too soon since last generation, waiting..."),setTimeout(()=>{D(W,V)},1e3-H);return}if(G(ee),console.log("🚀 Starting AI word generation with topic:",V),console.log("Current user:",I),console.log("Current settings:",U),console.log("Existing cards count:",r.length),!I){console.error("❌ No current user found"),alert("Ошибка: не удалось получить данные пользователя");return}l(!0);try{const J=U||xe.getLanguagePair();if(!J){console.error("❌ No language settings found"),alert("Ошибка: не удалось получить настройки языка");return}console.log("🌐 Language settings:",J);const me=r.map(Y=>Y.term),ae=n.map(Y=>Y.term),he=[...me,...ae];console.log("📊 Existing words count:",he.length),console.log("📊 Previous generated words:",ae.length);let ge=[];const et=Ke.getServicesStatus(),ce=Be.getApiStatus();if(console.log("🔍 Free AI services status:",et),console.log("🔍 ChatGPT status:",ce),Object.values(et).some(Y=>Y.configured)){console.log("💎 Using Free AI services (Gemini priority) for generation...");try{const Y={userLevel:O,languagePair:{learning:J.learning_language,known:J.known_language},count:10,existingWords:he,topic:V.trim()||void 0};console.log("🚀 FreeAI request with level:",Y.userLevel),console.log("🚀 FreeAI request with topic:",Y.topic),ge=(await Ke.generateWords(Y)).words.map(oe=>({...oe,selected:!0})),console.log("✅ FreeAI generated words:",ge.length)}catch(Y){if(console.warn("⚠️ FreeAI error, trying ChatGPT:",Y),ce.configured)try{const le={userLevel:O,languagePair:{learning:J.learning_language,known:J.known_language},count:10,existingWords:he,topic:V.trim()||void 0};console.log("🤖 ChatGPT request with level:",le.userLevel),console.log("🤖 ChatGPT request with topic:",le.topic),ge=(await Be.generateWords(le)).words.map(Re=>({...Re,selected:!0})),console.log("✅ ChatGPT generated words:",ge.length)}catch(le){console.warn("⚠️ ChatGPT error, falling back to local generation:",le),console.log("📚 Fallback local generation with level:",O),ge=(await ke.generateWords({knownLanguage:J.known_language,learningLanguage:J.learning_language,knownLanguageCode:J.known_language_code,learningLanguageCode:J.learning_language_code,userLevel:O,existingWords:he,topic:V.trim()||void 0,imageGenerationSettings:L})).map(Re=>({...Re,selected:!0}))}else console.log("📚 FreeAI fallback local generation with level:",O),ge=(await ke.generateWords({knownLanguage:J.known_language,learningLanguage:J.learning_language,knownLanguageCode:J.known_language_code,learningLanguageCode:J.learning_language_code,userLevel:O,existingWords:he,topic:V.trim()||void 0,imageGenerationSettings:L})).map(oe=>({...oe,selected:!0}))}}else if(ce.configured){console.log("🤖 Using ChatGPT API for generation...");try{const Y={userLevel:O,languagePair:{learning:J.learning_language,known:J.known_language},count:10,existingWords:he,topic:V.trim()||void 0};console.log("🤖 ChatGPT request with level:",Y.userLevel),console.log("🤖 ChatGPT request with topic:",Y.topic),ge=(await Be.generateWords(Y)).words.map(oe=>({...oe,selected:!0})),console.log("✅ ChatGPT generated words:",ge.length)}catch(Y){console.warn("⚠️ ChatGPT error, falling back to local generation:",Y),console.log("📚 ChatGPT fallback local generation with level:",O),ge=(await ke.generateWords({knownLanguage:J.known_language,learningLanguage:J.learning_language,knownLanguageCode:J.known_language_code,learningLanguageCode:J.learning_language_code,userLevel:O,existingWords:he,topic:V.trim()||void 0,imageGenerationSettings:L})).map(oe=>({...oe,selected:!0}))}}else console.log("📚 Using local generation..."),console.log("📚 Local generation request with level:",O),ge=(await ke.generateWords({knownLanguage:J.known_language,learningLanguage:J.learning_language,knownLanguageCode:J.known_language_code,learningLanguageCode:J.learning_language_code,userLevel:O,existingWords:he,topic:V.trim()||void 0,imageGenerationSettings:L})).map(le=>({...le,selected:!0}));if(console.log("✅ Generated words:",ge),ge.length===0){console.warn("⚠️ No words generated"),alert("Не удалось сгенерировать новые слова. Попробуйте изменить уровень или языковую пару.");return}const qe=he.map(Y=>Y.toLowerCase()),Pe=ge.filter(Y=>!qe.includes(Y.term.toLowerCase()));if(console.log(`📊 Generated: ${ge.length}, Unique: ${Pe.length}, Duplicates: ${ge.length-Pe.length}`),Pe.length===0)if(console.warn("⚠️ All generated words are duplicates"),W<2){console.log(`🔄 Auto-retrying with new topic (attempt ${W+1}/3)`),await A(W);return}else{alert("Все сгенерированные слова уже есть в вашей коллекции или были в предыдущей генерации. Попробуйте изменить уровень или тему."),p(0);return}const re=Pe.map(Y=>({...Y,selected:!0}));o(re),g(re.length),p(0),console.log("✅ Words set in state:",re.length),console.log("📊 Words by theme:",re.map(Y=>`${Y.term} -> ${Y.translation}`))}catch(J){console.error("Error generating words:",J);const me=J instanceof Error?J.message:"Попробуйте позже.";alert(`Ошибка генерации слов: ${me}`)}finally{l(!1)}},F=async()=>{p(0),await j(0)},Q=W=>{const V=[...n];V[W].selected=!V[W].selected,o(V),g(V.filter(ee=>ee.selected).length)},ne=()=>{console.log("💾 Starting to save words...");const W=n.filter(ae=>ae.selected);if(console.log("Selected words for saving:",W),W.length===0){console.warn("⚠️ No words selected"),alert("Выберите хотя бы одно слово для добавления");return}const V=r.map(ae=>ae.term.toLowerCase()),ee=W.filter(ae=>!V.includes(ae.term.toLowerCase()));if(console.log("🔍 Duplicate check:"),console.log("  - Existing cards count:",r.length),console.log("  - Existing terms:",V),console.log("  - Selected words:",W.map(ae=>ae.term)),console.log(`📊 Selected: ${W.length}, Unique: ${ee.length}, Duplicates: ${W.length-ee.length}`),ee.length===0){alert("Все выбранные слова уже есть в вашей коллекции.");return}const H=X.getUserSettings()||xe.getLanguagePair();console.log("Settings for language pair:",H);const J=H?xe.generateLanguagePairId(H.known_language_code,H.learning_language_code):"ru-es";console.log("Generated language pair ID:",J);const me=ee.map(ae=>({term:ae.term,translation:ae.translation,english:ae.english,imageUrl:ae.imageUrl,progress:0,state:se.LEARN,dueAt:new Date,reviewCount:0,successfulReviews:0,direction:Le.KNOWN_TO_LEARNING,languagePairId:J,easeFactor:2.5,intervalDays:0}));console.log("Cards to save:",me);try{a(me),console.log("✅ Cards sent to onSave callback successfully");const ae=W.length-ee.length;let he=`🎉 Успешно добавлено ${ee.length} новых слов!`;ae>0&&(he+=`

⏭️ Пропущено ${ae} дубликатов`),he+=`

Уровень: ${O}`,alert(he)}catch(ae){console.error("❌ Error saving cards:",ae),alert("Ошибка при сохранении слов. Попробуйте еще раз.");return}console.log("✅ Cards sent to onSave callback"),t(),o([]),g(0),p(0),z(!1)},ue=()=>{const W=n.map(V=>({...V,selected:!0}));o(W),g(W.length)},we=()=>{const W=n.map(V=>({...V,selected:!1}));o(W),g(0)};return i?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-4 z-50",children:[e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[95vh] sm:max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(ht,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"ИИ помощник"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>y(!0),className:"p-1.5 sm:p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Статус AI сервисов",children:e.jsx(jt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>R(!0),className:"p-1.5 sm:p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Настройки генерации изображений",children:e.jsx(Ht,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:t,className:"p-1.5 sm:p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-3 sm:p-4 mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(jt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Уровень"}),e.jsxs("select",{value:O,onChange:W=>$(W.target.value),className:"ml-auto p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:[e.jsx("option",{value:"A1",children:"A1 - Начальный"}),e.jsx("option",{value:"A2",children:"A2 - Элементарный"}),e.jsx("option",{value:"B1",children:"B1 - Средний"}),e.jsx("option",{value:"B2",children:"B2 - Средне-продвинутый"}),e.jsx("option",{value:"C1",children:"C1 - Продвинутый"}),e.jsx("option",{value:"C2",children:"C2 - Владение"})]})]})}),n.length===0&&e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("label",{htmlFor:"topic-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"Тема слов (необязательно)"}),e.jsx("input",{id:"topic-input",type:"text",value:u,onChange:W=>C(W.target.value),placeholder:"Например: еда, животные, путешествия, работа...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",disabled:s}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Укажите тему для генерации слов по конкретной области. Если оставить пустым, будут сгенерированы слова общего уровня."}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>h(!S),children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Доступные темы:"}),e.jsx("div",{className:`transform transition-transform ${S?"rotate-180":""}`,children:e.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!S&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:ke.getAvailableTopics().map(W=>e.jsx("button",{onClick:()=>C(W),className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors",title:ke.getTopicDescription(W),children:W},W))})]})]}),n.length===0&&e.jsx("button",{onClick:F,disabled:s,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:from-gray-400 disabled:to-gray-500 text-white py-2 sm:py-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all transform hover:scale-105 disabled:transform-none disabled:cursor-not-allowed",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Rt,{className:"w-5 h-5 animate-spin"}),"Генерируем слова..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"w-5 h-5"}),u.trim()?`Добавить слова по теме "${u.trim()}"`:"Добавить слова с помощью ИИ"]})}),s&&e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-gray-600",children:[e.jsx(Rt,{className:"w-5 h-5 animate-spin"}),e.jsxs("span",{children:[u.trim()?`Подбираем слова по теме "${u.trim()}" для уровня ${O}...`:`Подбираем слова для уровня ${O}...`,f>0&&e.jsxs("span",{className:"text-blue-600 ml-2",children:["(попытка ",f+1,")"]})]})]})}),n.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Выбрано: ",e.jsx("span",{className:"font-medium text-blue-600",children:d})," из ",n.length]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ue,className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"Все"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("button",{onClick:we,className:"text-xs text-gray-600 hover:text-gray-700 font-medium",children:"Ничего"})]})]}),e.jsx("div",{className:"max-h-40 sm:max-h-60 overflow-y-auto space-y-2",children:n.map((W,V)=>e.jsx("div",{onClick:()=>Q(V),className:`p-2 sm:p-3 rounded-lg border-2 cursor-pointer transition-all ${W.selected?"border-blue-200 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:W.term}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{className:"font-medium text-blue-600",children:W.translation})]}),W.example&&e.jsx("div",{className:"text-xs text-gray-500 italic",children:W.example})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${W.selected?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:W.selected&&e.jsx(pa,{className:"w-3 h-3 text-white"})})]})},V))}),u.trim()&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Тема:"}),e.jsxs("span",{className:"text-sm text-blue-700",children:['"',u.trim(),'"']})]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("button",{onClick:F,disabled:s,className:"px-4 py-2 sm:py-3 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-300 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"}),"Сгенерировать заново"]}),e.jsxs("button",{onClick:ne,disabled:d===0||s,className:"flex-1 px-4 py-2 sm:py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Добавить (",d,")"]})]})]})]})]}),e.jsx(za,{isOpen:w,onClose:()=>_(!1)}),e.jsx(qa,{isOpen:T,onClose:()=>y(!1)}),e.jsx(Va,{isOpen:P,onClose:()=>R(!1),onSave:W=>{console.log("Image generation settings saved:",W),B(W),localStorage.setItem("imageGenerationSettings",JSON.stringify(W))},currentSettings:L})]}):null},ze=()=>k!==null;class Gt{static async getUserStreak(t){if(!ze())return console.warn("⚠️ Supabase not available, using localStorage fallback"),this.getStreakFromLocalStorage(t);try{const{data:a,error:r}=await k.from("user_streak").select("*").eq("user_id",t).maybeSingle();return r?(console.error("❌ Error fetching user streak:",r),this.getStreakFromLocalStorage(t)):a?(console.log("📊 Fetched user streak from Supabase:",a),a):(console.log("📊 No streak data found, creating new record"),await this.createUserStreak(t))}catch(a){return console.error("❌ Error in getUserStreak:",a),this.getStreakFromLocalStorage(t)}}static async createUserStreak(t){if(!t||t.trim()==="")throw console.error("❌ Invalid userId provided to createUserStreak"),new Error("Invalid userId");const a=new Date().toISOString().split("T")[0],r={user_id:t,current_streak:1,longest_streak:1,last_activity_date:a,total_days_used:1};if(!ze())return console.warn("⚠️ Supabase not available, saving to localStorage"),this.saveStreakToLocalStorage(t,r),{...r,id:"local",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{const{data:s,error:l}=await k.from("user_streak").insert([r]).select().single();return l?(console.error("❌ Error creating user streak:",l),this.saveStreakToLocalStorage(t,r),{...r,id:"local",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}):(console.log("✅ Created user streak in Supabase:",s),s)}catch(s){return console.error("❌ Error in createUserStreak:",s),this.saveStreakToLocalStorage(t,r),{...r,id:"local",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}}static async updateUserStreak(t,a){if(!ze())return console.warn("⚠️ Supabase not available, updating localStorage"),this.updateStreakInLocalStorage(t,a);try{const{data:r,error:s}=await k.from("user_streak").update(a).eq("user_id",t).select().single();return s?(console.error("❌ Error updating user streak:",s),this.updateStreakInLocalStorage(t,a)):(console.log("✅ Updated user streak in Supabase:",r),r)}catch(r){return console.error("❌ Error in updateUserStreak:",r),this.updateStreakInLocalStorage(t,a)}}static async recordActivity(t){const a=new Date().toISOString().split("T")[0];try{let r=await this.getUserStreak(t);if(!r)return await this.createUserStreak(t);if(r.last_activity_date===a)return console.log("📊 Activity already recorded for today"),r;const s=new Date;s.setDate(s.getDate()-1);const l=s.toISOString().split("T")[0];let n=1,o=r.longest_streak,d=r.total_days_used+1;r.last_activity_date===l?(n=r.current_streak+1,o=Math.max(n,r.longest_streak)):r.last_activity_date&&r.last_activity_date<l&&(n=1,console.log("🔄 Streak broken, starting new streak"));const g={current_streak:n,longest_streak:o,last_activity_date:a,total_days_used:d},w=await this.updateUserStreak(t,g);return console.log("🎯 Activity recorded:",{userId:t,today:a,newCurrentStreak:n,newLongestStreak:o,newTotalDays:d}),w}catch(r){return console.error("❌ Error recording activity:",r),null}}static getStreakFromLocalStorage(t){try{const a=`user_streak_${t}`,r=localStorage.getItem(a);if(r)return JSON.parse(r)}catch(a){console.error("❌ Error reading streak from localStorage:",a)}return null}static saveStreakToLocalStorage(t,a){try{const r=`user_streak_${t}`,s={...a,id:"local",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};localStorage.setItem(r,JSON.stringify(s))}catch(r){console.error("❌ Error saving streak to localStorage:",r)}}static updateStreakInLocalStorage(t,a){try{const r=`user_streak_${t}`,s=localStorage.getItem(r);if(s){const n={...JSON.parse(s),...a,updated_at:new Date().toISOString()};return localStorage.setItem(r,JSON.stringify(n)),n}}catch(r){console.error("❌ Error updating streak in localStorage:",r)}return null}}const ra=i=>{const[t,a]=c.useState({currentStreak:0,longestStreak:0,totalDaysActive:0,lastActivityDate:null,isLoading:!0,error:null}),r=c.useCallback(async()=>{if(!i||i.trim()===""){console.log("⚠️ useStreak: No valid userId provided"),a(n=>({...n,isLoading:!1}));return}try{a(o=>({...o,isLoading:!0,error:null}));const n=await Gt.getUserStreak(i);n?(a(o=>({...o,currentStreak:n.current_streak,longestStreak:n.longest_streak,totalDaysActive:n.total_days_used,lastActivityDate:n.last_activity_date,isLoading:!1})),console.log("📊 Streak loaded:",{currentStreak:n.current_streak,longestStreak:n.longest_streak,totalDaysActive:n.total_days_used,lastActivityDate:n.last_activity_date})):a(o=>({...o,isLoading:!1}))}catch(n){console.error("❌ Error loading streak:",n),a(o=>({...o,isLoading:!1,error:n instanceof Error?n.message:"Failed to load streak"}))}},[i]),s=c.useCallback(async()=>{if(!i||i.trim()===""){console.log("⚠️ recordActivity: No valid userId provided");return}try{console.log("🎯 Recording activity for user:",i);const n=await Gt.recordActivity(i);n&&(a(o=>({...o,currentStreak:n.current_streak,longestStreak:n.longest_streak,totalDaysActive:n.total_days_used,lastActivityDate:n.last_activity_date})),console.log("✅ Activity recorded successfully:",{currentStreak:n.current_streak,longestStreak:n.longest_streak,totalDaysActive:n.total_days_used}))}catch(n){console.error("❌ Error recording activity:",n),a(o=>({...o,error:n instanceof Error?n.message:"Failed to record activity"}))}},[i]),l=c.useCallback(async()=>{await r()},[r]);return c.useEffect(()=>{r()},[r]),c.useEffect(()=>{if(i&&!t.isLoading&&t.lastActivityDate){const n=new Date().toISOString().split("T")[0];t.lastActivityDate!==n&&(console.log("🔄 First activity of the day detected, recording..."),s())}},[i,t.isLoading,t.lastActivityDate,s]),{...t,recordActivity:s,refreshStreak:l}},Ka="/assets/Games-DX3DBDXl.png",Ha=({onStartSession:i,onManageCards:t,onViewStats:a,onProfileClick:r,onNavigateToCards:s,onNavigateToLessons:l,onNavigateToSoundHunt:n})=>{const{state:o,dispatch:d}=Me(),[g,w]=Ue.useState(!1),[_,T]=Ue.useState(!1),[y,P]=Ue.useState(null),[R,u]=Ue.useState(!0),{currentStreak:C,recordActivity:S}=ra(y?.id||"");Ue.useEffect(()=>{(async()=>{try{u(!0);let N=await X.getCurrentUserFromDB();N||(N=X.getCurrentUser()),N||(N=await X.createOrUpdateUserInDB({})),N&&P(N)}catch(N){console.error("Error loading user data:",N);const A=X.getCurrentUser();A&&P(A)}finally{u(!1)}})()},[]),Ue.useEffect(()=>{if(o.cards.length===0)return;const b=o.cards.map(A=>(fe.getTimeUntilNext(A),A));b.some((A,v)=>A.state!==o.cards[v]?.state)&&d({type:"SET_CARDS",payload:b})},[o.cards,d]);const h=fe.getDueCards(o.cards),I=fe.getNextDueCard(o.cards),U=o.cards.map(b=>{const N={...b},A=new Date;return b.dueAt<=A?N.state=se.LEARN:b.progress>=10&&b.progress<70?N.state=se.REVIEW:N.state=se.SUSPENDED,N}),O=U.filter(b=>b.state===se.LEARN).length,$=U.filter(b=>b.state===se.REVIEW).length,f=U.filter(b=>b.state===se.SUSPENDED).length,p=$,E=f,G=o.cards.length>0?Math.round(o.cards.reduce((b,N)=>b+N.progress,0)/o.cards.length):0,M=b=>fe.getTimeUntilNext(b),z=async b=>{try{const N=await pe.addCardToUser(b.term,b.translation,b.languagePairId||"ru-es",b.imageUrl,b.english);if(N){d({type:"ADD_CARD",payload:N});const A=[...o.cards,N],v=A.filter(j=>j.progress>=70).length,m=A.filter(j=>j.progress>=50).length,x=fe.getDueCards(A);d({type:"UPDATE_USER_STATS",payload:{totalCards:A.length,learnedCards:m,masteredCards:v,reviewsDue:x.length}})}}catch(N){console.error("Error adding card:",N),alert("Ошибка при добавлении карточки")}},L=async()=>{await S(),i()},B=async b=>{console.log("🏠 HomeScreen: Received cards from AI:",b.length),console.log("🏠 HomeScreen: Cards data:",b),console.log("🏠 HomeScreen: Current cards count before adding:",o.cards.length);try{const N=await Promise.all(b.map(D=>pe.addCardToUser(D.term,D.translation,D.languagePairId||"ru-es",D.imageUrl,D.english)));N.forEach(D=>{D&&d({type:"ADD_CARD",payload:D})});const A=N.filter(D=>D!==null),v=[...o.cards,...A],m=v.filter(D=>D.progress>=70).length,x=v.filter(D=>D.progress>=50).length,j=fe.getDueCards(v);d({type:"UPDATE_USER_STATS",payload:{totalCards:v.length,learnedCards:x,masteredCards:m,reviewsDue:j.length}}),console.log(`✅ Successfully added ${N.filter(D=>D).length} cards to database`)}catch(N){console.error("Error adding AI cards:",N),alert("Ошибка при добавлении карточек")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen",children:[e.jsxs("div",{className:"px-4 pb-6 pt-1.5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:R?e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-8 bg-gray-200 rounded w-48"})}):`Привет, ${y?.name||"Пользователь"} 👋`}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 mt-2 hover:bg-orange-50 rounded-lg px-2 py-1 transition-colors cursor-pointer",children:[e.jsx(Jt,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:[C," дней подряд"]})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center mb-1",children:e.jsx("button",{onClick:r,className:"w-full h-full rounded-full flex items-center justify-center",children:e.jsx("img",{src:y?.avatar_url||"/assets/Foto.png",alt:"Profile",className:"w-full h-full rounded-full object-cover"})})}),e.jsx("span",{className:"text-xs text-gray-500",children:"Профиль"})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"bg-transparent overflow-hidden relative",children:e.jsx("img",{src:"/assets/intro-3.png",alt:"Learning illustration",className:"w-full h-64 object-contain"})})}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:["Сегодня прогресс ",e.jsxs("span",{className:"text-green-600",children:[G,"%"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 border-2 border-orange-200 text-center cursor-pointer hover:bg-orange-50 transition-colors",onClick:()=>s("learn"),children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-0",children:e.jsx(Te,{className:"w-4 h-4 text-orange-500"})}),e.jsx("div",{className:"text-2xl font-bold text-orange-500",children:O}),e.jsx("div",{className:"text-1xl font-bold text-orange-500",children:"Учить"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 border-2 border-blue-200 text-center cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>s("review"),children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-0",children:e.jsx(De,{className:"w-4 h-4 text-blue-500"})}),e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:p}),e.jsx("div",{className:"text-1xl font-bold text-blue-500",children:"Знаю"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 border-2 border-green-200 text-center cursor-pointer hover:bg-green-50 transition-colors",onClick:()=>s("suspended"),children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-0",children:e.jsx(kt,{className:"w-4 h-4 text-green-500"})}),e.jsx("div",{className:"text-2xl font-bold text-green-500",children:E}),e.jsx("div",{className:"text-1xl font-bold text-green-500",children:"Выучено"})]})]}),h.length>0?e.jsxs("button",{onClick:L,className:"mx-auto w-80 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-4 px-6 rounded-full font-bold text-lg flex flex-col items-center justify-center transition-all transform hover:scale-105 shadow-lg mb-6",children:[e.jsx("div",{children:"НАЧАТЬ"}),e.jsx("div",{children:"повторить слова"})]}):e.jsxs("div",{className:"text-center py-8 mb-6",children:[e.jsxs("button",{onClick:()=>T(!0),className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 rounded-full font-medium transition-all transform hover:scale-105 flex items-center justify-center gap-2 mx-auto mb-4",children:[e.jsx("span",{}),"Добавить слова"]}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Пока нечего повторять"}),I?e.jsxs("p",{className:"text-sm text-gray-600",children:["Следующая карточка появиться ",M(I)]}):e.jsx("p",{className:"text-sm text-gray-600",children:"Добавьте новые слова"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 px-4 mb-8",children:[e.jsxs("button",{onClick:l,className:"flex flex-col items-center py-3 px-2 text-gray-600 hover:text-blue-600 transition-colors",children:[e.jsx("img",{src:"/assets/Lesson.png",alt:"Уроки",className:"w-12 h-12 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Уроки"})]}),e.jsxs("button",{onClick:t,className:"flex flex-col items-center py-3 px-2 text-gray-600 hover:text-blue-600 transition-colors",children:[e.jsx("img",{src:"/assets/Cards_array.png",alt:"Карточки",className:"w-12 h-12 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Карточки"})]}),e.jsxs("button",{onClick:n,className:"flex flex-col items-center py-3 px-2 text-gray-600 hover:text-blue-600 transition-colors",children:[e.jsx("img",{src:Ka,alt:"Игры",className:"w-12 h-12 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Игры"})]})]})]}),e.jsx(Ye,{isOpen:g,onClose:()=>w(!1),onSave:z}),e.jsx(aa,{isOpen:_,onClose:()=>T(!1),onSave:B,existingCards:o.cards})]})})};class je{static validateAnswer(t,a,r={}){const{caseSensitive:s=!1,ignoreDiacritics:l=!0,ignorePunctuation:n=!0}=r;let o=t.trim(),d=a.trim();return s||(o=o.toLowerCase(),d=d.toLowerCase()),l&&(o=this.removeDiacritics(o),d=this.removeDiacritics(d)),n&&(o=this.removePunctuation(o),d=this.removePunctuation(d)),o===d}static getPartialMatch(t,a){const r=this.removeDiacritics(t.toLowerCase().trim()),s=this.removeDiacritics(a.toLowerCase().trim());let l=0;const n=Math.min(r.length,s.length);for(let o=0;o<n&&r[o]===s[o];o++)l++;return{isPartialMatch:l>0,correctChars:l,totalChars:s.length}}static removeDiacritics(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}static removePunctuation(t){return t.replace(/[^\w\s\u0400-\u04FF]/g,"")}}class ye{static baseUrl="https://texttospeech.googleapis.com/v1/text:synthesize";static checkAvailableVoices(){if("speechSynthesis"in window){const t=window.speechSynthesis.getVoices();console.log("🔊 Available voices on device:"),t.forEach(r=>{console.log(`  - ${r.name} (${r.lang}) - ${r.gender||"unknown gender"}`)});const a=t.filter(r=>r.lang.startsWith("es"));console.log("🇪🇸 Spanish voices:",a.map(r=>`${r.name} (${r.lang})`))}else console.log("❌ Speech Synthesis not supported")}static testWebSpeechAPI(){try{if("speechSynthesis"in window){const t=new SpeechSynthesisUtterance("Hola");return t.lang="es-ES",t.rate=.7,t.volume=.8,window.speechSynthesis.speak(t),console.log("🔊 Web Speech API test: SUCCESS"),!0}else return console.log("❌ Web Speech API not supported"),!1}catch(t){return console.error("❌ Web Speech API test failed:",t),!1}}static async testAPI(){try{if(console.log("🧪 Testing Google TTS API..."),!be("GOOGLE_TTS"))return console.error("❌ Google TTS service is not enabled"),!1;const t=Ee("GOOGLE_TTS_API_KEY");if(console.log("🔑 API Key:",t?"Present":"Missing"),!t)return console.error("❌ Google TTS API key is not configured"),!1;const a={input:{text:"Hola"},voice:{languageCode:"es-ES",name:"es-ES-Standard-A",ssmlGender:"FEMALE"},audioConfig:{audioEncoding:"MP3",speakingRate:.8,pitch:0,volumeGainDb:0}};console.log("📤 Test request:",a);const r=await fetch(`${this.baseUrl}?key=${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(console.log("📡 Response status:",r.status,r.statusText),!r.ok){const l=await r.json();return console.error("❌ API Error:",l),!1}const s=await r.json();return console.log("✅ API Test successful:",s),!0}catch(t){return console.error("❌ API Test failed:",t),!1}}static async synthesizeSpeech(t){try{if(console.log("🔊 Google TTS: Starting speech synthesis..."),console.log("Request:",t),!be("GOOGLE_TTS"))throw new Error("Google Text-to-Speech service is not enabled");const a=Ee("GOOGLE_TTS_API_KEY");if(console.log("🔑 API Key:",a?"Present":"Missing"),!a)throw new Error("Google Text-to-Speech API key is not configured");const r=this.getDefaultVoice(t.languageCode),s=t.voiceName||r.name,l=t.ssmlGender||r.gender,n=`${this.baseUrl}?key=${a}`;console.log("🌐 Request URL:",n);const o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:t.text},voice:{languageCode:t.languageCode,name:s,ssmlGender:l},audioConfig:{audioEncoding:"MP3",speakingRate:t.languageCode==="es-ES"?.8:.9,pitch:(t.languageCode==="es-ES",0),volumeGainDb:0}})});if(console.log("📡 Response status:",o.status,o.statusText),!o.ok){const g=await o.json();throw console.error("❌ API Error:",g),new Error(`Google TTS API error: ${g.error?.message||o.statusText}`)}const d=await o.json();return console.log("✅ Google TTS: Speech synthesis completed"),{audioContent:d.audioContent,success:!0}}catch(a){return console.error("❌ Google TTS: Speech synthesis failed:",a),{audioContent:"",success:!1,error:a instanceof Error?a.message:"Unknown error"}}}static playAudio(t){return new Promise((a,r)=>{try{const s=new Audio(`data:audio/mp3;base64,${t}`);s.preload="auto",s.volume=1,s.onended=()=>{console.log("🔊 Audio playback completed"),a()},s.onerror=n=>{console.error("❌ Audio playback failed:",n),r(n)},s.oncanplaythrough=()=>{console.log("🔊 Audio ready to play")};const l=s.play();l!==void 0&&l.then(()=>{console.log("🔊 Audio started playing")}).catch(n=>{console.error("❌ Audio play failed:",n),r(n)})}catch(s){console.error("❌ Audio creation failed:",s),r(s)}})}static async speakText(t,a){const r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);console.log("📱 Device type:",r?"Mobile":"Desktop");try{const s=await this.synthesizeSpeech({text:t,languageCode:a});return s.success&&s.audioContent?(await this.playAudio(s.audioContent),!0):(console.error("❌ Google TTS failed, trying Web Speech API:",s.error),this.speakWithWebSpeechAPI(t,a))}catch(s){return console.error("❌ Google TTS error, trying Web Speech API:",s),this.speakWithWebSpeechAPI(t,a)}}static speakWithWebSpeechAPI(t,a){try{if("speechSynthesis"in window){window.speechSynthesis.cancel();const r=new SpeechSynthesisUtterance(t),s=window.speechSynthesis.getVoices();console.log("🔊 Available voices:",s.map(n=>({name:n.name,lang:n.lang})));let l=s.find(n=>n.lang==="es-ES"||n.lang==="es");return l||(l=s.find(n=>n.lang.startsWith("es")&&(n.name.includes("Spanish")||n.name.includes("Español")||n.name.includes("es-")))),l?(r.voice=l,console.log("🔊 Using Spanish voice:",l.name,l.lang)):(r.lang="es-ES",console.log("🔊 Spanish voice not found, using language code:",r.lang)),r.rate=.7,r.pitch=1,r.volume=.8,r.onstart=()=>{console.log("🔊 Web Speech API: Speech started")},r.onend=()=>{console.log("🔊 Web Speech API: Speech ended")},r.onerror=n=>{console.error("❌ Web Speech API error:",n.error)},window.speechSynthesis.speak(r),console.log("🔊 Using Web Speech API fallback"),!0}else return console.error("❌ Web Speech API not supported"),!1}catch(r){return console.error("❌ Web Speech API error:",r),!1}}static getDefaultVoice(t){return{"es-ES":{name:"es-ES-Standard-A",gender:"FEMALE"},"es-US":{name:"es-US-Standard-A",gender:"FEMALE"},"ru-RU":{name:"ru-RU-Standard-A",gender:"FEMALE"},"en-US":{name:"en-US-Standard-A",gender:"FEMALE"},"en-GB":{name:"en-GB-Standard-A",gender:"FEMALE"},"fr-FR":{name:"fr-FR-Standard-A",gender:"FEMALE"},"de-DE":{name:"de-DE-Standard-A",gender:"FEMALE"},"it-IT":{name:"it-IT-Standard-A",gender:"FEMALE"},"pt-BR":{name:"pt-BR-Standard-A",gender:"FEMALE"},"ja-JP":{name:"ja-JP-Standard-A",gender:"FEMALE"},"ko-KR":{name:"ko-KR-Standard-A",gender:"FEMALE"},"zh-CN":{name:"zh-CN-Standard-A",gender:"FEMALE"}}[t]||{name:"en-US-Standard-A",gender:"FEMALE"}}static getLanguageCode(t,a="es"){switch(a.toLowerCase()){case"es":return"es-ES";case"en":return"en-US";case"fr":return"fr-FR";case"de":return"de-DE";case"it":return"it-IT";case"pt":return"pt-BR";case"ja":return"ja-JP";case"ko":return"ko-KR";case"zh":return"zh-CN";default:return"es-ES"}}}class Ve{static getDisplayMode(t,a=0){return K.getDisplayMode(t,a)}static getModeConfig(t){return K.getModeConfig(t)}static getModeConfigWithDifficulty(t,a="intermediate"){return K.getModeConfigWithDifficulty(t,a)}static shouldShowTranslationAutomatically(t){return K.shouldShowTranslationAutomatically(t)}static getTranslationDelay(t,a="intermediate"){return K.getTranslationDelay(t,a)}static getCardReturnDelay(t,a="intermediate"){return K.getCardReturnDelay(t,a)}static shouldShowInputField(t){return K.shouldShowInputField(t)}static shouldShowActionButtons(t){return K.shouldShowActionButtons(t)}static requireInputForButtons(t){return K.requireInputForButtons(t)}static getEnterPressesToNext(t){return K.getEnterPressesToNext(t)}static getAllModes(){return K.getAllModes()}static getGeneralSettings(){return K.getGeneralSettings()}static updateConfig(t){K.updateConfig(t)}static resetConfig(){K.resetConfig()}}const Ja=({progress:i,size:t=40,strokeWidth:a=3,className:r="",showPercentage:s=!1,color:l="#3B82F6",backgroundColor:n="#E5E7EB"})=>{const o=(t-a)/2,d=o*2*Math.PI,g=d,w=d-i/100*d;return e.jsxs("div",{className:`relative ${r}`,style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,className:"transform -rotate-90",children:[e.jsx("circle",{cx:t/2,cy:t/2,r:o,stroke:n,strokeWidth:a,fill:"none"}),e.jsx("circle",{cx:t/2,cy:t/2,r:o,stroke:l,strokeWidth:a,fill:"none",strokeDasharray:g,strokeDashoffset:w,strokeLinecap:"round",className:"transition-all duration-300 ease-in-out"})]}),s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-gray-700",children:[Math.round(i),"%"]})})]})},Ya=({card:i,displayMode:t,direction:a,onReview:r})=>{const{state:s}=Me(),[l,n]=c.useState(!1),[o,d]=c.useState(""),[g,w]=c.useState(!1),[_]=c.useState(new Date),[T,y]=c.useState(!1),[P,R]=c.useState(!1),[u,C]=c.useState(!1),[S,h]=c.useState(!1),[I,U]=c.useState(!1),[O,$]=c.useState(""),[f,p]=c.useState(!1),[E,G]=c.useState(!1),M=c.useRef(null),z=c.useRef(!1),L=a===Le.KNOWN_TO_LEARNING,B=async m=>{if(console.log("🔊 CardDisplay: playAudio called"),P){console.log("🔊 CardDisplay: Already playing, skipping");return}const x=m||i.term;console.log("🔊 CardDisplay: Spanish text to speak:",x),R(!0);try{const j="es-ES";console.log("🔊 CardDisplay: Language code:",j),"speechSynthesis"in window&&window.speechSynthesis.cancel(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(console.log("📱 Mobile device detected, adding delay"),await new Promise(Q=>setTimeout(Q,100)));const F=await ye.speakText(x,j);console.log("🔊 CardDisplay: Speech result:",F)}catch(j){console.error("❌ CardDisplay: Ошибка воспроизведения аудио:",j)}finally{R(!1)}};c.useEffect(()=>{(t===q.TRANSLATION_TO_WORD||t===q.LISTENING_2)&&M.current&&M.current.focus()},[t]),c.useEffect(()=>{const m=setTimeout(()=>{ye.checkAvailableVoices()},1e3);return()=>clearTimeout(m)},[]),c.useEffect(()=>{C(!1),h(!1),U(!1),$(""),p(!1)},[i.cardId]),c.useEffect(()=>{if(Ve.shouldShowTranslationAutomatically(t)){const m=Ve.getTranslationDelay(t),x=setTimeout(()=>n(!0),m);return()=>clearTimeout(x)}},[t]),c.useEffect(()=>{z.current=!1},[i.cardId]),c.useEffect(()=>{y(!0)},[]),c.useEffect(()=>{ye.testAPI().then(m=>{console.log("🧪 API Test result:",m)}),ye.checkAvailableVoices()},[]),c.useEffect(()=>{if((t===q.WORD||t===q.TRANSLATION_TO_WORD)&&i&&!S){console.log("🔊 WORD/TRANSLATION_TO_WORD mode: Auto-audio on card appearance");let m,x;if(t===q.TRANSLATION_TO_WORD){m=i.term;const D=s.currentLanguagePair?.learningLanguageCode||"es";x=ye.getLanguageCode(!0,D)}else{m=L?i.term:i.translation;const D=s.currentLanguagePair?.learningLanguageCode||"es";x=ye.getLanguageCode(L,D)}console.log("🔊 WORD/TRANSLATION_TO_WORD mode: Playing audio:",{spanishText:m,languageCode:x,displayMode:t});const j=setTimeout(()=>{"speechSynthesis"in window&&window.speechSynthesis.cancel(),ye.speakText(m,x).catch(console.error),h(!0)},500);return()=>clearTimeout(j)}},[t,i.cardId,L,s.currentLanguagePair?.learningLanguageCode,S]),c.useEffect(()=>{if((t===q.LISTENING_1||t===q.LISTENING_2)&&i&&!S){console.log("🔊 LISTENING mode: Auto-audio on card appearance");const m=i.term,x=s.currentLanguagePair?.learningLanguageCode||"es",j=ye.getLanguageCode(!0,x);console.log("🔊 LISTENING mode: Playing audio:",{spanishText:m,languageCode:j});const D=setTimeout(()=>{"speechSynthesis"in window&&window.speechSynthesis.cancel(),ye.speakText(m,j).catch(console.error),h(!0)},500);return()=>clearTimeout(D)}},[t,i.cardId,s.currentLanguagePair?.learningLanguageCode,S]),c.useEffect(()=>{if(l&&i&&t!==q.WORD){if(t===q.TRANSLATION&&(!u||S)){console.log("🔊 TRANSLATION mode: Skipping auto-audio",{showSpanishWord:u,audioPlayedForSpanishWord:S});return}const m=L?i.term:i.translation,x=s.currentLanguagePair?.learningLanguageCode||"es",j=ye.getLanguageCode(L,x);console.log("🔊 Auto-audio triggered:",{displayMode:t,isRevealed:l,showSpanishWord:u,audioPlayedForSpanishWord:S,spanishText:m,languageCode:j});const D=setTimeout(()=>{"speechSynthesis"in window&&window.speechSynthesis.cancel(),ye.speakText(m,j).catch(console.error),t===q.TRANSLATION&&h(!0)},500);return()=>clearTimeout(D)}},[l,i.cardId,L,s.currentLanguagePair?.learningLanguageCode,t,u,S]);const b=()=>{n(!0)},N=c.useCallback(m=>{if(z.current){console.log("🚫 Button click ignored - already processing");return}if(!T){console.log("🚫 Button click ignored - buttons disabled");return}console.log("✅ Button clicked, processing answer:",m),z.current=!0;const x=new Date().getTime()-_.getTime();if(y(!1),console.log("🔒 Buttons disabled"),t===q.WORD&&!l)console.log("📖 WORD mode: showing translation first"),n(!0),setTimeout(()=>{console.log("⏭️ WORD mode: moving to next card"),r({correct:m,timeSpent:x}),setTimeout(()=>{z.current=!1},100)},2e3);else if(t===q.TRANSLATION)if(console.log("🔄 TRANSLATION mode: showing Spanish word and playing audio"),C(!0),S)console.log("🔊 TRANSLATION mode: Skipping audio - already played for this card"),console.log("⏭️ TRANSLATION mode: Spanish word already shown, moving to next card immediately"),r({correct:m,timeSpent:x}),setTimeout(()=>{z.current=!1},100);else{const j=i.term,D="es-ES";console.log("🔊 TRANSLATION mode: Playing audio for Spanish word (first time):",{spanishText:j,languageCode:D}),"speechSynthesis"in window&&window.speechSynthesis.cancel(),ye.speakText(j,D).catch(console.error),h(!0),console.log("⏱️ TRANSLATION mode: First time showing Spanish word, waiting 2 seconds"),setTimeout(()=>{console.log("⏭️ TRANSLATION mode: moving to next card (after delay)"),r({correct:m,timeSpent:x}),setTimeout(()=>{z.current=!1},100)},2e3)}else if(t===q.TRANSLATION_TO_WORD){console.log("🔄 TRANSLATION_TO_WORD mode: checking translation correctness");const j=o.trim(),D=j==="",F=!D&&je.validateAnswer(j,i.translation);console.log("✅ TRANSLATION_TO_WORD mode: translation check result:",{userInput:j,correctAnswer:i.translation,isEmpty:D,isCorrect:F,buttonPressed:m?"Знаю":"Не знаю"}),w(!0),n(!0);let Q;m?(Q=F,console.log('✅ TRANSLATION_TO_WORD mode: "Знаю" button - result based on correctness:',Q)):(Q=!1,console.log('❌ TRANSLATION_TO_WORD mode: "Не знаю" button - always false')),setTimeout(()=>{console.log("⏭️ TRANSLATION_TO_WORD mode: moving to next card with result:",Q),r({correct:Q,timeSpent:x}),setTimeout(()=>{z.current=!1},100)},2e3)}else r({correct:m,timeSpent:x}),setTimeout(()=>{z.current=!1},100)},[T,_,r,t,l,i,S]),A=()=>{if(g)return;const m=je.validateAnswer(o.trim(),i.translation);w(!0),setTimeout(()=>{N(m)},2e3)},v=m=>{if(m.key==="Enter")if(t===q.TRANSLATION_TO_WORD)if(g){if(g){const x=o.trim(),D=!(x==="")&&je.validateAnswer(x,i.translation);N(D)}}else{console.log("🔄 TRANSLATION_TO_WORD mode: Enter - checking translation and updating progress");const x=o.trim(),j=x==="",D=!j&&je.validateAnswer(x,i.translation);console.log("✅ TRANSLATION_TO_WORD mode: Enter translation check result:",{userInput:x,correctAnswer:i.translation,isEmpty:j,isCorrect:D}),w(!0),n(!0),setTimeout(()=>{console.log("⏭️ TRANSLATION_TO_WORD mode: Enter - moving to next card with result:",D),r({correct:D,timeSpent:new Date().getTime()-_.getTime()})},2e3)}else if(t===q.LISTENING_2){if(O.trim()&&!f)p(!0);else if(f){const x=je.validateAnswer(O.trim(),i.term);N(x)}}else o.trim()&&A()};return e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-full max-w-sm mb-8",children:[e.jsx("div",{className:"absolute inset-0 transform translate-x-2 translate-y-2 opacity-40",children:e.jsx("div",{className:"bg-white rounded-3xl h-full"})}),e.jsx("div",{className:"absolute inset-0 transform translate-x-1 translate-y-1 opacity-70",children:e.jsx("div",{className:"bg-white rounded-3xl h-full"})}),e.jsxs("div",{className:"relative bg-white rounded-3xl h-[420px] flex flex-col cursor-pointer",onClick:()=>{const m=Ve.getModeConfig(t);if(t===q.TRANSLATION)l?u||(console.log("🔄 TRANSLATION mode: Second tap - showing Spanish word"),console.log("🔄 Current state:",{displayMode:t,isRevealed:l,showValidation:g,showSpanishWord:u}),C(!0)):(console.log("🔄 TRANSLATION mode: First tap - revealing translation"),b());else if(t===q.LISTENING_1&&!I)console.log("🔄 LISTENING_1 mode: Tap - showing content"),U(!0);else if(t===q.LISTENING_2&&f){console.log("🔄 LISTENING_2 mode: Tap - moving to next card");const x=je.validateAnswer(O.trim(),i.term);N(x)}else if(t===q.TRANSLATION_TO_WORD&&!l){console.log("🔄 TRANSLATION_TO_WORD mode: Tap - checking translation and updating progress");const x=o.trim(),j=x==="",D=!j&&je.validateAnswer(x,i.translation);console.log("✅ TRANSLATION_TO_WORD mode: tap translation check result:",{userInput:x,correctAnswer:i.translation,isEmpty:j,isCorrect:D}),w(!0),n(!0),setTimeout(()=>{console.log("⏭️ TRANSLATION_TO_WORD mode: tap - moving to next card with result:",D),r({correct:D,timeSpent:new Date().getTime()-_.getTime()})},2e3)}else if(!l&&!m?.showTranslationAutomatically&&!m?.showInputField)b();else if(t===q.TRANSLATION_TO_WORD&&g){const x=o.trim(),D=!(x==="")&&je.validateAnswer(x,i.translation);N(D)}},children:[K.shouldShowProgressIndicator()&&e.jsx("div",{className:"absolute top-4 left-4 z-10",children:e.jsx(Ja,{progress:i.progress,size:K.getProgressIndicatorSize(),strokeWidth:3,showPercentage:K.shouldShowProgressPercentage(),color:i.progress>=70?"#10B981":i.progress>=30?"#3B82F6":"#F59E0B",backgroundColor:"#E5E7EB"})}),e.jsxs("div",{className:"absolute top-4 right-4 z-10",children:[e.jsx("button",{onClick:()=>G(!E),className:"mb-2 bg-gray-500 hover:bg-gray-600 text-white text-xs px-2 py-1 rounded-full font-medium transition-colors",children:E?"Скрыть":t}),E&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-medium",children:t}),e.jsxs("div",{className:"text-xs text-gray-600 bg-white/80 px-2 py-1 rounded",children:[l?"revealed":"hidden"," | ",g?"validated":"input"," | ",u?"spanish":"no-spanish"," | ",S?"audio-played":"no-audio"," | ",I?"listening-content":"no-content"," | ",f?"listening-validated":"no-listening-validation"]})]})]}),e.jsxs("div",{className:"px-6 pt-2 pb-6 flex flex-col flex-1",children:[e.jsx("div",{className:"w-48 h-48 rounded-2xl flex items-center justify-center relative overflow-hidden bg-gray-100 mx-auto mb-4",children:(()=>{const m=(t!==q.LISTENING_1||I)&&(t!==q.TRANSLATION_TO_WORD||l);return m&&i.imageUrl?e.jsx("img",{src:i.imageUrl,alt:i.term,className:"w-full h-full object-cover rounded-2xl",onError:x=>{const j=x.target;j.style.display="none",j.parentElement.innerHTML=`
                        <div class="w-full h-full bg-white flex items-center justify-center">
                          <div class="w-full h-full bg-white flex items-center justify-center">
                            <span class="text-gray-300 text-sm">Нет изображения</span>
                          </div>
                        </div>
                      `}}):m?e.jsx("div",{className:"w-full h-full bg-white rounded-2xl flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full bg-white rounded-2xl flex items-center justify-center",children:e.jsx("span",{className:"text-gray-300 text-sm",children:"   "})})}):e.jsx("div",{className:"w-full h-full bg-white rounded-2xl flex items-center justify-center",children:e.jsx("div",{className:"w-full h-full bg-white rounded-2xl flex items-center justify-center",children:t!==q.TRANSLATION_TO_WORD&&e.jsx("span",{className:"text-gray-500 text-lg",children:"👂 Нажмите, чтобы показать"})})})})()}),e.jsx("div",{className:"h-16 flex items-center justify-center mb-3",children:(()=>{const m=t===q.DEMONSTRATION||t===q.WORD||t===q.TRANSLATION_TO_WORD||t===q.TRANSLATION&&u||t===q.LISTENING_1&&I;return console.log("🔍 Spanish word display check:",{displayMode:t,isRevealed:l,showSpanishWord:u,showListeningContent:I,shouldShow:m,isDemonstration:t===q.DEMONSTRATION,isWord:t===q.WORD,isTranslationWithSpanish:t===q.TRANSLATION&&u,isListening1WithContent:t===q.LISTENING_1&&I}),m})()&&e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"text-4xl font-semibold text-orange-600 text-center",children:i.term}),e.jsx("button",{onClick:()=>B(i.term),disabled:P,className:`p-1 rounded-full transition-all ${P?"bg-transparent cursor-not-allowed":"bg-transparent hover:bg-orange-100/30 cursor-pointer"}`,title:"Произнести испанское слово",children:P?e.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-2 w-2 border-b-2 border-orange-600"})}):e.jsx(We,{className:"w-3 h-3 text-orange-600"})})]})}),e.jsx("div",{className:"h-16 flex items-center justify-center mb-3",children:(Ve.shouldShowTranslationAutomatically(t)||t===q.WORD&&l||t===q.TRANSLATION_TO_WORD&&l||t===q.LISTENING_1&&I)&&e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("div",{className:"text-2xl text-gray-600 text-center",children:i.translation})})}),e.jsx("div",{className:"min-h-[56px] flex flex-col justify-center",children:(Ve.shouldShowInputField(t)||t===q.LISTENING_2)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:M,type:"text",value:t===q.LISTENING_2?O:o,onChange:m=>{t===q.LISTENING_2?$(m.target.value):d(m.target.value)},onKeyPress:v,placeholder:t===q.LISTENING_2?"Введите испанское слово...":"Введите перевод...",className:"w-full p-4 bg-transparent rounded-2xl text-center text-xl transition-all focus:outline-none",autoFocus:!0,disabled:t===q.LISTENING_2?f:g}),(g||f)&&e.jsxs("div",{className:`text-center p-3 rounded-lg ${(()=>{if(t===q.LISTENING_2)return je.validateAnswer(O.trim(),i.term);{const m=o.trim();return!(m==="")&&je.validateAnswer(m,i.translation)}})()?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:[e.jsx("div",{className:"font-medium",children:(()=>{if(t===q.LISTENING_2)return je.validateAnswer(O.trim(),i.term)?"Правильно!":"Неправильно";{const m=o.trim();return!(m==="")&&je.validateAnswer(m,i.translation)?"Правильно!":"Неправильно"}})()}),e.jsxs("div",{className:"text-sm mt-1",children:["Ответ: ",t===q.LISTENING_2?i.term:i.translation]})]})]})})]})]})]}),e.jsx("div",{className:"w-full max-w-sm mt-6 min-h-[120px] flex items-center justify-center",children:Ve.shouldShowActionButtons(t)&&e.jsxs("div",{className:`flex justify-center gap-12 transition-opacity duration-200 ${T?"opacity-100":"opacity-50"}`,children:[e.jsx("button",{onClick:()=>N(!1),className:`p-6 rounded-2xl transition-all duration-200 transform hover:scale-105 cursor-pointer bg-transparent hover:bg-white/10 ${T?"":"opacity-50 pointer-events-none"}`,disabled:!T,children:z.current?e.jsx("div",{className:"w-24 h-24 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"})}):e.jsx("img",{src:"/assets/Stop.png",alt:"Не знаю",className:"w-24 h-24 object-cover rounded-lg",onError:m=>{const x=m.target;x.style.display="none",x.parentElement.innerHTML='<div class="w-24 h-24 bg-red-500 rounded-lg flex items-center justify-center text-white font-bold text-2xl">✕</div>'}})}),e.jsx("button",{onClick:()=>N(!0),className:`p-6 rounded-2xl transition-all duration-200 transform hover:scale-105 cursor-pointer bg-transparent hover:bg-white/10 ${T?"":"opacity-50 pointer-events-none"}`,disabled:!T,children:z.current?e.jsx("div",{className:"w-24 h-24 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):e.jsx("img",{src:"/assets/run.png",alt:"Знаю",className:"w-24 h-24 object-cover rounded-lg",onError:m=>{const x=m.target;x.style.display="none",x.parentElement.innerHTML='<div class="w-24 h-24 bg-green-500 rounded-lg flex items-center justify-center text-white font-bold text-2xl">✓</div>'}})})]})})]})},Qa=({isOpen:i,onClose:t,onSave:a})=>{const[r,s]=c.useState(ie),[l,n]=c.useState("modes"),[o,d]=c.useState(!1);c.useEffect(()=>{i&&(s(ie),d(!1))},[i]);const g=(u,C)=>{const S={...r},h=u.split(".");let I=S;for(let U=0;U<h.length-1;U++)I=I[h[U]];I[h[h.length-1]]=C,s(S),d(!0)},w=()=>{K.updateConfig(r),d(!1),a?.(r)},_=()=>{s(ie),d(!0)},T=()=>e.jsx("div",{className:"space-y-6",children:Object.entries(r.modes).map(([u,C])=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800",children:C.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:C.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Минимальный прогресс (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:C.minProgress,onChange:S=>g(`modes.${u}.minProgress`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Максимальный прогресс (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:C.maxProgress,onChange:S=>g(`modes.${u}.maxProgress`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Задержка показа перевода (мс)"}),e.jsx("input",{type:"number",min:"0",value:C.translationDelay,onChange:S=>g(`modes.${u}.translationDelay`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Задержка возврата к карточке (мс)"}),e.jsx("input",{type:"number",min:"0",value:C.cardReturnDelay,onChange:S=>g(`modes.${u}.cardReturnDelay`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Нажатий Enter для следующей карточки"}),e.jsx("input",{type:"number",min:"0",value:C.enterPressesToNext,onChange:S=>g(`modes.${u}.enterPressesToNext`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.showTranslationAutomatically,onChange:S=>g(`modes.${u}.showTranslationAutomatically`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать перевод автоматически"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.showInputField,onChange:S=>g(`modes.${u}.showInputField`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать поле ввода"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.showActionButtons,onChange:S=>g(`modes.${u}.showActionButtons`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать кнопки действий"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.requireInputForButtons,onChange:S=>g(`modes.${u}.requireInputForButtons`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Требовать ввод для активации кнопок"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.showTranslationOnTap,onChange:S=>g(`modes.${u}.showTranslationOnTap`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать перевод по тапу"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.showWordOnTap,onChange:S=>g(`modes.${u}.showWordOnTap`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать слово по тапу"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.nextCardOnEnter,onChange:S=>g(`modes.${u}.nextCardOnEnter`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Переход к следующей карточке по Enter"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.nextCardOnTap,onChange:S=>g(`modes.${u}.nextCardOnTap`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Переход к следующей карточке по тапу"})]})]})]},u))}),y=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Длительность анимации (мс)"}),e.jsx("input",{type:"number",min:"0",value:r.general.animationDuration,onChange:u=>g("general.animationDuration",parseInt(u.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Интервал автосохранения (мс)"}),e.jsx("input",{type:"number",min:"1000",value:r.general.autoSaveInterval,onChange:u=>g("general.autoSaveInterval",parseInt(u.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Размер индикатора прогресса (px)"}),e.jsx("input",{type:"number",min:"20",max:"60",value:r.general.progressIndicatorSize,onChange:u=>g("general.progressIndicatorSize",parseInt(u.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.general.cardAnimation,onChange:u=>g("general.cardAnimation",u.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Анимация появления карточки"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.general.soundEffects,onChange:u=>g("general.soundEffects",u.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Звуковые эффекты"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.general.visualFeedback,onChange:u=>g("general.visualFeedback",u.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Визуальная обратная связь"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.general.autoSaveProgress,onChange:u=>g("general.autoSaveProgress",u.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Автоматическое сохранение прогресса"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.general.showProgressIndicator,onChange:u=>g("general.showProgressIndicator",u.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать индикатор прогресса на карточке"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.general.showProgressPercentage,onChange:u=>g("general.showProgressPercentage",u.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать процент в индикаторе прогресса"})]})]})]}),P=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Настройки интервальных повторений"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Задержка после неправильного ответа (мс)"}),e.jsx("input",{type:"number",min:"1000",value:r.spacedRepetition.incorrectAnswerDelay,onChange:u=>g("spacedRepetition.incorrectAnswerDelay",parseInt(u.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Время, через которое карточка вернется для повторного изучения после неправильного ответа"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Увеличение прогресса за правильный ответ (%)"}),e.jsx("input",{type:"number",min:"1",max:"50",value:r.spacedRepetition.progressIncrease,onChange:u=>g("spacedRepetition.progressIncrease",parseInt(u.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Уменьшение прогресса за неправильный ответ (%)"}),e.jsx("input",{type:"number",min:"1",max:"50",value:r.spacedRepetition.progressDecrease,onChange:u=>g("spacedRepetition.progressDecrease",parseInt(u.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Порог для сброса счетчика успешных повторений (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:r.spacedRepetition.resetSuccessfulReviewsThreshold,onChange:u=>g("spacedRepetition.resetSuccessfulReviewsThreshold",parseInt(u.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"При прогрессе ниже этого значения счетчик успешных повторений будет сброшен"})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Интервалы повторений"}),e.jsx("div",{className:"space-y-3",children:r.spacedRepetition.reviewIntervals.map((u,C)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-20",children:[C+1,"-й ответ:"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:u.minutes||0,onChange:S=>{const h=[...r.spacedRepetition.reviewIntervals];h[C]={...u,minutes:parseInt(S.target.value)||void 0},g("spacedRepetition.reviewIntervals",h)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"мин"}),e.jsx("span",{className:"text-sm text-gray-500",children:"мин"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:u.hours||0,onChange:S=>{const h=[...r.spacedRepetition.reviewIntervals];h[C]={...u,hours:parseInt(S.target.value)||void 0},g("spacedRepetition.reviewIntervals",h)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"час"}),e.jsx("span",{className:"text-sm text-gray-500",children:"час"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:u.days||0,onChange:S=>{const h=[...r.spacedRepetition.reviewIntervals];h[C]={...u,days:parseInt(S.target.value)||void 0},g("spacedRepetition.reviewIntervals",h)},className:"w-16 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"дн"}),e.jsx("span",{className:"text-sm text-gray-500",children:"дн"})]})]},C))}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Интервалы определяют, через сколько времени карточка вернется для повторного изучения после правильного ответа"})]})]}),R=()=>e.jsx("div",{className:"space-y-6",children:Object.entries(r.difficulty).map(([u,C])=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800 capitalize",children:u==="beginner"?"Начинающий":u==="intermediate"?"Средний":"Продвинутый"}),e.jsxs("div",{className:"space-y-2",children:[C.translationDelay!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Задержка показа перевода (мс)"}),e.jsx("input",{type:"number",min:"0",value:C.translationDelay,onChange:S=>g(`difficulty.${u}.translationDelay`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),C.cardReturnDelay!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Задержка возврата к карточке (мс)"}),e.jsx("input",{type:"number",min:"0",value:C.cardReturnDelay,onChange:S=>g(`difficulty.${u}.cardReturnDelay`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),C.enterPressesToNext!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Нажатий Enter для следующей карточки"}),e.jsx("input",{type:"number",min:"0",value:C.enterPressesToNext,onChange:S=>g(`difficulty.${u}.enterPressesToNext`,parseInt(S.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.showActionButtons||!1,onChange:S=>g(`difficulty.${u}.showActionButtons`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Показывать кнопки действий"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.requireInputForButtons||!1,onChange:S=>g(`difficulty.${u}.requireInputForButtons`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Требовать ввод для активации кнопок"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:C.nextCardOnEnter||!1,onChange:S=>g(`difficulty.${u}.nextCardOnEnter`,S.target.checked),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Переход к следующей карточке по Enter"})]})]})]},u))});return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Настройки отображения карточек"})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex border-b",children:[{id:"modes",label:"Режимы отображения"},{id:"general",label:"Общие настройки"},{id:"spacedRepetition",label:"Интервальные повторения"},{id:"difficulty",label:"Настройки сложности"}].map(u=>e.jsx("button",{onClick:()=>n(u.id),className:`px-6 py-3 font-medium transition-colors ${l===u.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-800"}`,children:u.label},u.id))}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[l==="modes"&&T(),l==="general"&&y(),l==="spacedRepetition"&&P(),l==="difficulty"&&R()]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t bg-gray-50",children:[e.jsxs("button",{onClick:_,className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(gt,{className:"w-4 h-4"}),"Сбросить"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Отмена"}),e.jsxs("button",{onClick:w,disabled:!o,className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${o?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(ha,{className:"w-4 h-4"}),"Сохранить"]})]})]})]})}):null},Xa=()=>{const[i,t]=c.useState(ie),[a,r]=c.useState(!1);c.useEffect(()=>{const L=localStorage.getItem("cardDisplayConfig");if(L)try{const B=JSON.parse(L);t(B),K.updateConfig(B)}catch(B){console.error("Ошибка загрузки конфигурации отображения карточек:",B)}},[]);const s=c.useCallback(L=>{t(L),K.updateConfig(L),localStorage.setItem("cardDisplayConfig",JSON.stringify(L))},[]),l=c.useCallback((L,B=0)=>K.getDisplayMode(L,B),[]),n=c.useCallback(L=>K.getModeConfig(L),[]),o=c.useCallback((L,B="intermediate")=>K.getModeConfigWithDifficulty(L,B),[]),d=c.useCallback(L=>K.shouldShowTranslationAutomatically(L),[]),g=c.useCallback((L,B="intermediate")=>K.getTranslationDelay(L,B),[]),w=c.useCallback((L,B="intermediate")=>K.getCardReturnDelay(L,B),[]),_=c.useCallback(L=>K.shouldShowInputField(L),[]),T=c.useCallback(L=>K.shouldShowActionButtons(L),[]),y=c.useCallback(L=>K.requireInputForButtons(L),[]),P=c.useCallback(L=>K.getEnterPressesToNext(L),[]),R=c.useCallback(()=>K.getAllModes(),[]),u=c.useCallback(()=>K.getGeneralSettings(),[]),C=c.useCallback(()=>K.shouldShowProgressIndicator(),[]),S=c.useCallback(()=>K.getProgressIndicatorSize(),[]),h=c.useCallback(()=>K.shouldShowProgressPercentage(),[]),I=c.useCallback(()=>K.getIncorrectAnswerDelay(),[]),U=c.useCallback(()=>K.getProgressIncrease(),[]),O=c.useCallback(()=>K.getProgressDecrease(),[]),$=c.useCallback(()=>K.getResetSuccessfulReviewsThreshold(),[]),f=c.useCallback(()=>K.getReviewIntervals(),[]),p=c.useCallback(L=>K.getNextReviewInterval(L),[]),E=c.useCallback(()=>{t(ie),K.updateConfig(ie),localStorage.removeItem("cardDisplayConfig")},[]),G=c.useCallback(()=>{r(!0)},[]),M=c.useCallback(()=>{r(!1)},[]),z=c.useCallback(L=>{s(L),M()},[s,M]);return{config:i,isModalOpen:a,getDisplayMode:l,getModeConfig:n,getModeConfigWithDifficulty:o,shouldShowTranslationAutomatically:d,getTranslationDelay:g,getCardReturnDelay:w,shouldShowInputField:_,shouldShowActionButtons:T,requireInputForButtons:y,getEnterPressesToNext:P,getAllModes:R,getGeneralSettings:u,shouldShowProgressIndicator:C,getProgressIndicatorSize:S,shouldShowProgressPercentage:h,getIncorrectAnswerDelay:I,getProgressIncrease:U,getProgressDecrease:O,getResetSuccessfulReviewsThreshold:$,getReviewIntervals:f,getNextReviewInterval:p,saveConfig:s,resetConfig:E,openSettingsModal:G,closeSettingsModal:M,handleSaveSettings:z}},Za=({onEndSession:i,onProfileClick:t})=>{const{state:a,dispatch:r}=Me(),{getDisplayMode:s,openSettingsModal:l,isModalOpen:n,closeSettingsModal:o,handleSaveSettings:d}=Xa(),[g]=c.useState(new Date),[w,_]=c.useState(q.WORD),[T,y]=c.useState(Le.KNOWN_TO_LEARNING),[P,R]=c.useState(128),[u,C]=c.useState(0),[S,h]=c.useState(!1),[I,U]=c.useState(!1),[O,$]=c.useState(!1),[f,p]=c.useState(null);c.useEffect(()=>{(async()=>{try{let N=await X.getCurrentUserFromDB();N||(N=X.getCurrentUser()),N||(N=await X.createOrUpdateUserInDB({})),N&&p(N)}catch(N){console.error("Error loading user data:",N);const A=X.getCurrentUser();A&&p(A)}})()},[]),c.useEffect(()=>{if(!a.currentCard){let b=localStorage.getItem("currentLessonId")||void 0;if(!b){const A=a.cards.filter(v=>v.lessonId&&v.lessonOrder!==null).sort((v,m)=>new Date(m.createdAt).getTime()-new Date(v.createdAt).getTime());b=A.length>0?A[0].lessonId:void 0}const N=fe.getNextCardToShow(a.cards,b);if(N){r({type:"SET_CURRENT_CARD",payload:N});const A=s(N.progress,N.reviewCount),v=fe.getReviewDirection(N);_(A),y(v)}else localStorage.getItem("currentLessonId")&&(console.log("🎯 Finished studying lesson cards, clearing currentLessonId"),localStorage.removeItem("currentLessonId")),G()}},[a.currentCard,a.cards]);const E=async b=>{if(!a.currentCard)return;b.correct&&(C(10),R(v=>v+10),setTimeout(()=>C(0),2e3));const N=fe.processReview(a.currentCard,b);r({type:"UPDATE_SESSION_STATS",payload:{cardsReviewed:a.sessionStats.cardsReviewed+1,correctAnswers:a.sessionStats.correctAnswers+(b.correct?1:0),timeSpent:a.sessionStats.timeSpent+b.timeSpent}}),r({type:"UPDATE_CARD",payload:N}),r({type:"SET_CURRENT_CARD",payload:null}),pe.updateUserCard(N).then(A=>{r({type:"UPDATE_CARD",payload:A})}).catch(A=>{console.error("Error updating card after review:",A)})},G=()=>{new Date().getTime()-g.getTime();const b=a.cards.filter(v=>v.progress>=70).length,N=a.cards.filter(v=>v.progress>=50).length,A=fe.getDueCards(a.cards);r({type:"UPDATE_USER_STATS",payload:{totalCards:a.cards.length,learnedCards:N,masteredCards:b,reviewsDue:A.length,lastSessionDate:new Date}}),r({type:"END_SESSION"}),i()},M=async b=>{if(a.currentCard)try{console.log("🔄 SessionScreen: handleEditCard called"),console.log("🔄 SessionScreen: Card ID:",a.currentCard.cardId),console.log("🔄 SessionScreen: New data:",{term:b.term,translation:b.translation,imageUrl:b.imageUrl,english:b.english}),console.log("🔄 SessionScreen: Calling CardService.updateCardContent..."),await pe.updateCardContent(a.currentCard.cardId,b.term,b.translation,b.imageUrl,b.english),console.log("✅ SessionScreen: CardService.updateCardContent completed");const N={...a.currentCard,term:b.term.trim(),translation:b.translation.trim(),imageUrl:b.imageUrl?.trim()||void 0,english:b.english?.trim()||void 0,updatedAt:new Date};console.log("🔄 SessionScreen: Updated card object:",N),console.log("🔄 SessionScreen: Dispatching UPDATE_CARD action..."),r({type:"UPDATE_CARD",payload:N}),r({type:"SET_CURRENT_CARD",payload:N}),console.log("✅ SessionScreen: UPDATE_CARD action dispatched"),console.log("✅ SessionScreen: Card updated successfully"),console.log("🔄 SessionScreen: Reloading cards to get updated data...");const A=await pe.getUserCards();r({type:"SET_CARDS",payload:A}),console.log("✅ SessionScreen: Cards reloaded:",A.length),h(!1),console.log("✅ SessionScreen: Modal closed")}catch(N){console.error("❌ SessionScreen: Error updating card:",N),console.error("❌ SessionScreen: Error details:",{message:N instanceof Error?N.message:String(N),stack:N instanceof Error?N.stack:void 0,name:N instanceof Error?N.name:void 0});const A=N instanceof Error?N.message:JSON.stringify(N);console.error("❌ SessionScreen: Alert error message:",A),alert("Ошибка при сохранении изменений карточки: "+A)}},z=async b=>{try{const N=await pe.addCardToUser(b.term,b.translation,b.languagePairId||"ru-es",b.imageUrl,b.english);N&&(r({type:"ADD_CARD",payload:N}),U(!1))}catch(N){console.error("Error adding card:",N),alert("Ошибка при добавлении карточки")}},L=()=>{a.currentCard&&(O?pe.removeCardFromUser(a.currentCard.cardId).then(()=>{const b=a.cards.filter(N=>N.cardId!==a.currentCard.cardId);r({type:"SET_CARDS",payload:b}),r({type:"SET_CURRENT_CARD",payload:null}),$(!1)}).catch(b=>{console.error("Error deleting card:",b),alert("Ошибка при удалении карточки"),$(!1)}):($(!0),setTimeout(()=>$(!1),3e3)))};return fe.getDueCards(a.cards).length-a.sessionStats.cardsReviewed,e.jsx("div",{className:"min-h-screen bg-gray-200",children:e.jsxs("div",{className:"max-w-md mx-auto bg-gray-200 min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:G,className:"p-2 text-gray-600 hover:text-gray-900",children:e.jsx(It,{className:"w-6 h-6"})}),e.jsx("button",{onClick:l,className:"p-2 text-gray-600 hover:text-gray-900",title:"Настройки отображения карточек",children:e.jsx(Tt,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-lg font-bold text-gray-800",children:["Балы ",P," 🔥"]})}),e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",children:f?.avatar_url?e.jsx("button",{onClick:t,className:"w-full h-full rounded-full overflow-hidden hover:opacity-80 transition-opacity",children:e.jsx("img",{src:f?.avatar_url,alt:"Profile",className:"w-full h-full rounded-full object-cover"})}):e.jsx("button",{onClick:t,className:"w-full h-full rounded-full flex items-center justify-center text-white text-lg font-bold hover:opacity-80 transition-opacity",children:f?.name?.charAt(0).toUpperCase()||"U"})})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center px-4 pt-4 pb-4 relative",children:a.currentCard?e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsx(Ya,{card:a.currentCard,displayMode:w,direction:T,onReview:E}),e.jsx("div",{className:"w-full max-w-sm mt-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>h(!0),className:"p-3 bg-transparent hover:bg-white/10 rounded-2xl transition-all transform hover:scale-105",disabled:!a.currentCard,children:e.jsx("img",{src:"/assets/Edit.png",alt:"Редактировать",className:"w-8 h-8 object-cover rounded-lg",onError:b=>{const N=b.target;N.style.display="none",N.parentElement.innerHTML='<span class="text-blue-600 text-xl">✏️</span>'}})}),e.jsx("button",{onClick:()=>U(!0),className:"p-3 bg-transparent hover:bg-white/10 rounded-2xl transition-all transform hover:scale-105",children:e.jsx("img",{src:"/assets/Add.png",alt:"Добавить",className:"w-8 h-8 object-cover rounded-lg",onError:b=>{const N=b.target;N.style.display="none",N.parentElement.innerHTML='<span class="text-green-600 text-xl">➕</span>'}})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:L,className:`p-3 bg-transparent hover:bg-white/10 rounded-2xl transition-all transform hover:scale-105 ${O?"animate-pulse":""}`,disabled:!a.currentCard,children:e.jsx("img",{src:"/assets/Delete.png",alt:"Удалить",className:"w-8 h-8 object-cover rounded-lg",onError:b=>{const N=b.target;N.style.display="none",N.parentElement.innerHTML='<span class="text-red-600 text-xl">🗑️</span>'}})}),O&&e.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-red-600 font-medium animate-pulse whitespace-nowrap",children:"Подтвердить"})]})]})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Загружаем следующую карточку..."})]})}),e.jsx(Ye,{isOpen:S,onClose:()=>h(!1),onSave:M,editCard:a.currentCard,existingCards:a.cards}),e.jsx(Ye,{isOpen:I,onClose:()=>U(!1),onSave:z,existingCards:a.cards}),e.jsx(Qa,{isOpen:n,onClose:o,onSave:d})]})})};class Qe{static async getLessonProgress(t){try{if(!ze())return this.getLessonProgressFromLocalStorage(t);const{data:{user:a}}=await k.auth.getUser();if(!a)return console.warn("⚠️ No authenticated user for lesson progress"),null;const{data:r,error:s}=await k.from("lesson_progress").select("*").eq("user_id",a.id).eq("lesson_id",t).single();return s?s.code==="PGRST116"?(console.log(`📊 No progress found for lesson ${t}`),null):(console.error("❌ Error fetching lesson progress:",s),null):(console.log(`📊 Retrieved lesson progress for ${t}:`,r),r)}catch(a){return console.error("❌ Error in getLessonProgress:",a),null}}static async updateLessonProgress(t,a){try{if(!ze())return this.updateLessonProgressInLocalStorage(t,a);const{data:{user:r}}=await k.auth.getUser();if(!r)return console.warn("⚠️ No authenticated user for lesson progress update"),null;const l=await this.getLessonProgress(t)||{user_id:r.id,lesson_id:t,theory_viewed:!1,dialogues_listened:!1,practice_completed:!1,practice_score:0,total_progress:0},n={...l,...a,total_progress:this.calculateTotalProgress({...l,...a})},{data:o,error:d}=await k.from("lesson_progress").upsert(n,{onConflict:"user_id,lesson_id"}).select().single();return d?(console.error("❌ Error updating lesson progress:",d),null):(console.log(`📊 Updated lesson progress for ${t}:`,o),o)}catch(r){return console.error("❌ Error in updateLessonProgress:",r),null}}static async getAllLessonProgress(){try{if(!ze())return this.getAllLessonProgressFromLocalStorage();const{data:{user:t}}=await k.auth.getUser();if(!t)return console.warn("⚠️ No authenticated user for lesson progress"),[];const{data:a,error:r}=await k.from("lesson_progress").select("*").eq("user_id",t.id).order("updated_at",{ascending:!1});return r?(console.error("❌ Error fetching all lesson progress:",r),[]):(console.log(`📊 Retrieved ${a?.length||0} lesson progress records`),a||[])}catch(t){return console.error("❌ Error in getAllLessonProgress:",t),[]}}static calculateTotalProgress(t){let a=0;return t.theory_viewed&&(a+=20),t.dialogues_listened&&(a+=30),t.practice_completed&&t.practice_score!==void 0&&(a+=Math.round(t.practice_score/100*50)),Math.min(a,100)}static async deleteLessonProgress(t){try{if(!ze())return this.deleteLessonProgressFromLocalStorage(t);const{data:{user:a}}=await k.auth.getUser();if(!a)return console.warn("⚠️ No authenticated user for lesson progress deletion"),!1;const{error:r}=await k.from("lesson_progress").delete().eq("user_id",a.id).eq("lesson_id",t);return r?(console.error("❌ Error deleting lesson progress:",r),!1):(console.log(`📊 Deleted lesson progress for ${t}`),!0)}catch(a){return console.error("❌ Error in deleteLessonProgress:",a),!1}}static getLessonProgressFromLocalStorage(t){try{const a=localStorage.getItem(`lesson-${t}-progress`);if(a){const r=JSON.parse(a);return console.log(`📊 Retrieved lesson progress from localStorage for ${t}:`,r),r}return null}catch(a){return console.error("❌ Error reading from localStorage:",a),null}}static saveLessonProgressToLocalStorage(t,a){try{localStorage.setItem(`lesson-${t}-progress`,JSON.stringify(a)),console.log(`📊 Saved lesson progress to localStorage for ${t}:`,a)}catch(r){console.error("❌ Error saving to localStorage:",r)}}static updateLessonProgressInLocalStorage(t,a){try{const r=this.getLessonProgressFromLocalStorage(t)||{user_id:"local-user",lesson_id:t,theory_viewed:!1,dialogues_listened:!1,practice_completed:!1,practice_score:0,total_progress:0},s={...r,...a,total_progress:this.calculateTotalProgress({...r,...a})};return this.saveLessonProgressToLocalStorage(t,s),s}catch(r){return console.error("❌ Error updating lesson progress in localStorage:",r),null}}static deleteLessonProgressFromLocalStorage(t){try{return localStorage.removeItem(`lesson-${t}-progress`),console.log(`📊 Deleted lesson progress from localStorage for ${t}`),!0}catch(a){return console.error("❌ Error deleting from localStorage:",a),!1}}static getAllLessonProgressFromLocalStorage(){try{const t=[];for(let a=0;a<localStorage.length;a++){const r=localStorage.key(a);if(r&&r.startsWith("lesson-")&&r.endsWith("-progress")){const s=localStorage.getItem(r);if(s){const l=JSON.parse(s);t.push(l)}}}return console.log(`📊 Retrieved ${t.length} lesson progress records from localStorage`),t}catch(t){return console.error("❌ Error reading all progress from localStorage:",t),[]}}}const er=({currentStreak:i,longestStreak:t,totalDaysActive:a,isLoading:r=!1,error:s=null,className:l=""})=>r?e.jsx("div",{className:`bg-gradient-to-r from-orange-400 to-red-500 rounded-lg p-4 text-white ${l}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-5 h-5 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Загрузка..."})]})}):s?e.jsx("div",{className:`bg-gray-100 rounded-lg p-4 text-gray-600 ${l}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Ошибка загрузки streak"})]})}):e.jsxs("div",{className:`bg-gradient-to-r from-orange-400 to-red-500 rounded-lg p-4 text-white ${l}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:i}),e.jsx("div",{className:"text-xs opacity-90",children:"дней подряд"})]})]}),e.jsx("div",{className:"h-8 w-px bg-white opacity-30"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:t}),e.jsx("div",{className:"text-xs opacity-90",children:"рекорд"})]})]}),e.jsx("div",{className:"h-8 w-px bg-white opacity-30"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:a}),e.jsx("div",{className:"text-xs opacity-90",children:"всего дней"})]})]})]}),i>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:i>=7?"🔥":i>=3?"⚡":"✨"})]})]}),i>0&&e.jsxs("div",{className:"mt-3 text-xs opacity-90",children:[i===1&&"Отличное начало! Продолжайте в том же духе! 🎉",i===2&&"Два дня подряд! Вы на правильном пути! 💪",i===3&&"Три дня подряд! Отличная мотивация! ⚡",i>=4&&i<7&&"Отличная последовательность! Продолжайте! 🚀",i>=7&&i<14&&"Неделя подряд! Вы невероятны! 🔥",i>=14&&i<30&&"Две недели подряд! Вы мастер! 🏆",i>=30&&"Месяц подряд! Вы легенда! 👑"]})]}),tr=({onBack:i})=>{const{state:t}=Me(),[a,r]=c.useState({}),[s,l]=c.useState(!1),[n,o]=c.useState(null),{currentStreak:d,longestStreak:g,totalDaysActive:w,isLoading:_,error:T}=ra(n?.id||""),y=[{id:"intro",title:"Приветствие и знакомство",description:"Основные фразы для знакомства",level:"beginner",duration:15,cardCount:22,completed:!1,progress:0,category:"basics",createdAt:new Date,updatedAt:new Date},{id:"lesson-1-nouns-gender-number",title:"Имя существительное — род",description:"Изучаем род существительных с интерактивными играми",level:"beginner",duration:25,cardCount:0,completed:!1,progress:0,category:"basics",createdAt:new Date,updatedAt:new Date}],P=t.cards.length,R=t.cards.filter(f=>f.state===se.LEARN).length,u=t.cards.filter(f=>f.state===se.REVIEW).length,C=t.cards.filter(f=>f.state===se.SUSPENDED).length,S=P>0?Math.round(t.cards.reduce((f,p)=>f+p.progress,0)/P):0,h=t.cards.reduce((f,p)=>f+p.reviewCount,0),I=h>0?Math.round(t.cards.reduce((f,p)=>f+p.successfulReviews,0)/h*100):0,U=t.cards.filter(f=>f.reviewCount>2).sort((f,p)=>f.successfulReviews/f.reviewCount-p.successfulReviews/p.reviewCount).slice(0,5),O=f=>a[f]||0,$=c.useCallback(async()=>{if(!s)try{console.log("📊 Loading lesson progress for stats");const f=await Qe.getAllLessonProgress(),p={};f.forEach(E=>{p[E.lesson_id]=E.total_progress}),r(p),l(!0),console.log("📊 Loaded lesson progress for stats:",p)}catch(f){console.error("❌ Error loading lesson progress for stats:",f),l(!0)}},[s]);return c.useEffect(()=>{$()},[$]),c.useEffect(()=>{(async()=>{try{let p=await X.getCurrentUserFromDB();p||(p=X.getCurrentUser()),p||(p=await X.createOrUpdateUserInDB({})),p&&o(p)}catch(p){console.error("Error loading user data:",p);const E=X.getCurrentUser();E&&o(E)}})()},[]),e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:i,className:"text-blue-600 font-medium",children:"← Назад"}),e.jsx("h1",{className:"font-semibold text-gray-900",children:"Статистика"}),e.jsx("div",{className:"w-12"})," "]})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(er,{currentStreak:d,longestStreak:g,totalDaysActive:w,isLoading:_,error:T}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 p-4 rounded-xl text-white",children:[e.jsx(fa,{className:"w-6 h-6 mb-2 opacity-80"}),e.jsx("div",{className:"text-2xl font-bold",children:C}),e.jsx("div",{className:"text-sm opacity-90",children:"Выучено"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 p-4 rounded-xl text-white",children:[e.jsx(De,{className:"w-6 h-6 mb-2 opacity-80"}),e.jsxs("div",{className:"text-2xl font-bold",children:[S,"%"]}),e.jsx("div",{className:"text-sm opacity-90",children:"Средний прогресс"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 p-4 rounded-xl text-white",children:[e.jsx(kt,{className:"w-6 h-6 mb-2 opacity-80"}),e.jsxs("div",{className:"text-2xl font-bold",children:[I,"%"]}),e.jsx("div",{className:"text-sm opacity-90",children:"Точность"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Распределение карточек"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Учу"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:R}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full",style:{width:`${P>0?R/P*100:0}%`}})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Знаю"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:u}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${P>0?u/P*100:0}%`}})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Выучено"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:C}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${P>0?C/P*100:0}%`}})})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Активность"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:h}),e.jsx("div",{className:"text-sm text-gray-600",children:"Всего повторений"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P}),e.jsx("div",{className:"text-sm text-gray-600",children:"Карточек добавлено"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Прогресс уроков"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.filter(f=>O(f.id)===100).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Завершено"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:y.filter(f=>O(f.id)>0&&O(f.id)<100).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"В процессе"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:y.filter(f=>O(f.id)===0).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Новые"})]})]})]}),U.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Сложные слова"}),e.jsx("div",{className:"space-y-3",children:U.map(f=>{const p=f.reviewCount>0?Math.round(f.successfulReviews/f.reviewCount*100):0;return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:f.term}),e.jsx("div",{className:"text-sm text-gray-600",children:f.translation})]}),e.jsxs("div",{className:"text-sm text-red-600 font-medium",children:[p,"%"]})]},f.cardId)})})]})]})]})})},at=[{code:"ru",name:"Russian",flag:"🇷🇺"},{code:"en",name:"English",flag:"🇺🇸"},{code:"es",name:"Español",flag:"🇪🇸"},{code:"fr",name:"Français",flag:"🇫🇷"},{code:"de",name:"Deutsch",flag:"🇩🇪"},{code:"it",name:"Italiano",flag:"🇮🇹"},{code:"pt",name:"Português",flag:"🇵🇹"},{code:"zh",name:"中文",flag:"🇨🇳"},{code:"ja",name:"日本語",flag:"🇯🇵"},{code:"ko",name:"한국어",flag:"🇰🇷"}],Wt=[{value:"Beginner",label:"Начинающий"},{value:"Elementary",label:"Элементарный"},{value:"Intermediate",label:"Средний"},{value:"Upper-Intermediate",label:"Выше среднего"},{value:"Advanced",label:"Продвинутый"},{value:"Proficient",label:"Профессиональный"}],ar=({isOpen:i,onClose:t,onSave:a,currentKnownLanguage:r,currentLearningLanguage:s,currentLevel:l})=>{const[n,o]=c.useState(r||null),[d,g]=c.useState(s||null),[w,_]=c.useState(l||"Beginner"),[T,y]=c.useState(!1),[P,R]=c.useState(!1),[u,C]=c.useState(!1);c.useEffect(()=>{i&&(o(r||at[0]),g(s||at[2]),_(l||"Beginner"))},[i,r,s,l]);const S=()=>{n&&d&&n.code!==d.code&&(a(n,d,w),t())},h=({label:I,value:U,options:O,isOpen:$,onToggle:f,onSelect:p})=>e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:I}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:f,className:"w-full flex items-center justify-between px-4 py-4 bg-white border border-gray-300 rounded-xl text-left focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:U}),e.jsx(Et,{className:`w-5 h-5 text-gray-400 transition-transform ${$?"rotate-180":""}`})]}),$&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-60 overflow-y-auto",children:O.map(E=>e.jsxs("button",{onClick:()=>{p(E),f()},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors text-left",children:[E.flag&&e.jsx("span",{className:"text-xl",children:E.flag}),e.jsx("span",{className:"font-medium text-gray-900",children:E.name||E.label})]},E.code||E.value))})]})]});return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Выбор языков"}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(h,{label:"Учу язык",value:d?.name||"Выберите язык",options:at,isOpen:P,onToggle:()=>R(!P),onSelect:I=>g(I)}),e.jsx(h,{label:"Знаю язык",value:n?.name||"Выберите язык",options:at.filter(I=>I.code!==d?.code),isOpen:T,onToggle:()=>y(!T),onSelect:I=>o(I)}),e.jsx(h,{label:"Уровень сложности",value:Wt.find(I=>I.value===w)?.label||"Начинающий",options:Wt,isOpen:u,onToggle:()=>C(!u),onSelect:I=>_(I.value)})]}),e.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[e.jsx("button",{onClick:t,className:"flex-1 px-6 py-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"Отмена"}),e.jsx("button",{onClick:S,disabled:!n||!d||n.code===d.code,className:"flex-1 px-6 py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white rounded-xl font-medium transition-colors",children:"Сохранить"})]})]})}):null},rr=({isOpen:i,onClose:t,onSave:a,currentUser:r})=>{const[s,l]=c.useState({name:"",email:"",avatar_url:"",avatarFile:null}),[n,o]=c.useState({}),[d,g]=c.useState(!1),[w,_]=c.useState("");c.useEffect(()=>{i&&r&&(l({name:r.name||"",email:r.email||"",avatar_url:r.avatar_url||"",avatarFile:null}),_(r.avatar_url||""),o({}))},[i,r]);const T=()=>{const u={};return s.name.trim()?s.name.trim().length<2&&(u.name="Имя должно содержать минимум 2 символа"):u.name="Имя обязательно",s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(u.email="Некорректный формат email"):u.email="Email обязателен",o(u),Object.keys(u).length===0},y=u=>{const C=u.target.files?.[0];if(C){if(!C.type.startsWith("image/")){o(h=>({...h,avatar:"Пожалуйста, выберите изображение"}));return}if(C.size>5*1024*1024){o(h=>({...h,avatar:"Размер файла не должен превышать 5MB"}));return}l(h=>({...h,avatarFile:C}));const S=new FileReader;S.onload=h=>{_(h.target?.result)},S.readAsDataURL(C),n.avatar&&o(h=>({...h,avatar:""}))}},P=async u=>{if(u.preventDefault(),!(!T()||d)){g(!0);try{let C=s.avatar_url;s.avatarFile&&(C=w),await a({name:s.name.trim(),email:s.email.trim(),avatar_url:C||void 0}),t()}catch(C){console.error("Error saving profile:",C)}finally{g(!1)}}},R=(u,C)=>{l(S=>({...S,[u]:C})),n[u]&&o(S=>({...S,[u]:""}))};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Редактировать профиль"}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:P,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center overflow-hidden mx-auto mb-3",children:w?e.jsx("img",{src:w,alt:"Avatar",className:"w-full h-full object-cover",onError:u=>{_("");const C=u.target;C.style.display="none"}}):e.jsx(wt,{className:"w-10 h-10 text-blue-600"})}),e.jsx("button",{type:"button",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"absolute -bottom-1 -right-1 w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-colors",children:e.jsx(ba,{className:"w-4 h-4"})}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:y,className:"hidden"})]}),n.avatar&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:n.avatar})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Имя"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"name",value:s.name,onChange:u=>R("name",u.target.value),placeholder:"Введите ваше имя",className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors ${n.name?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),n.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",id:"email",value:s.email,onChange:u=>R("email",u.target.value),placeholder:"example@email.com",className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors ${n.email?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(Xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),n.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.email})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Отмена"}),e.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Сохранение..."]}):"Сохранить"})]})]})]})}):null},sr=[{value:"Beginner",label:"Beginner • A1"},{value:"Elementary",label:"Elementary • A2"},{value:"Intermediate",label:"Intermediate • B1"},{value:"Upper-Intermediate",label:"Upper-Intermediate • B2"},{value:"Advanced",label:"Advanced • C1"},{value:"Proficient",label:"Proficient • C2"}],nr=({onBack:i,onLogout:t})=>{const{state:a}=Me(),[r,s]=c.useState(20),[l,n]=c.useState(!1),[o,d]=c.useState(!1),[g,w]=c.useState(null),[_,T]=c.useState(!0),[y,P]=c.useState(()=>{const p=X.getUserSettings()||xe.getLanguagePair();return p?{known:{code:p.known_language_code,name:p.known_language,flag:C(p.known_language_code)},learning:{code:p.learning_language_code,name:p.learning_language,flag:C(p.learning_language_code)}}:{known:{code:"ru",name:"Русский",flag:"🇷🇺"},learning:{code:"es",name:"Español",flag:"🇪🇸"}}});c.useEffect(()=>{(async()=>{try{T(!0);let p=await X.getCurrentUserFromAuth();p||(p=await X.getCurrentUserFromDB()),p||(p=X.getCurrentUser()),p||(p=await X.createOrUpdateUserInDB({})),p&&(console.log("Loaded user data:",{id:p.id,email:p.email,name:p.name,display_name:p.name}),w(p));const E=X.getUserSettings();if(E){const G={known:{code:E.known_language_code,name:E.known_language,flag:C(E.known_language_code)},learning:{code:E.learning_language_code,name:E.learning_language,flag:C(E.learning_language_code)}};P(G)}}catch(p){console.error("Error loading user data:",p);const E=X.getCurrentUser();E&&w(E)}finally{T(!1)}})()},[]);const R=a.cards.length,u=R>0?Math.round(a.cards.reduce((f,p)=>f+p.progress,0)/R):0;function C(f){return{ru:"🇷🇺",en:"🇺🇸",es:"🇪🇸",fr:"🇫🇷",de:"🇩🇪",it:"🇮🇹",pt:"🇵🇹",zh:"🇨🇳",ja:"🇯🇵",ko:"🇰🇷"}[f]||"🌐"}const S=async(f,p,E)=>{try{const G={known_language:f.name,learning_language:p.name,known_language_code:f.code,learning_language_code:p.code};await X.updateUser({level:E}),w(B=>B?{...B,level:E}:null);const M=await xe.validateLanguagePairChange(f.code,p.code);if(!M.valid){alert(M.message);return}await X.updateUserSettings(G),P({known:f,learning:p});const z=xe.generateLanguagePairId(y.known.code,y.learning.code),L=xe.generateLanguagePairId(f.code,p.code);z!==L&&await xe.updateCardsLanguagePair(z,L),M.message&&alert(M.message)}catch(G){console.error("Error saving language pair:",G),alert("Ошибка при сохранении языковой пары")}},h=async f=>{try{f.name&&f.name!==g?.name&&await X.updateUserDisplayNameInAuth(f.name);const p=await X.updateUser(f);w(p),console.log("Profile saved successfully:",{id:p.id,email:p.email,name:p.name})}catch(p){console.error("Error saving profile:",p),alert("Ошибка при сохранении профиля")}},I=f=>{s(f),X.updateUserSettings({daily_goal:f})},U=async f=>{try{await X.updateUser({level:f}),w(E=>E?{...E,level:f}:null);const p=await X.getCurrentUserFromAuth();p&&w(p)}catch(p){console.error("Error updating level:",p),alert("Ошибка при обновлении уровня языка")}},O=({icon:f,title:p,subtitle:E,rightContent:G,onClick:M})=>e.jsxs("button",{onClick:M,className:"w-full flex items-center justify-between py-4 px-0 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-blue-600",children:f}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:p}),E&&e.jsx("div",{className:"text-sm text-gray-500",children:E})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[G,e.jsx(Na,{className:"w-5 h-5 text-gray-400"})]})]}),$=({title:f})=>e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 mt-8",children:f});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-md mx-auto bg-gray-50 min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx("img",{src:"/assets/Back.png",alt:"Back",className:"w-6 h-6"})}),e.jsx("h1",{className:"font-semibold text-gray-900",children:"Профиль"}),e.jsx("div",{className:"w-12"})]})}),e.jsxs("div",{className:"p-4",children:[_?e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})]})]})}),e.jsx("div",{className:"h-3 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})]})]})}):g?e.jsxs("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center overflow-hidden",children:g.avatar_url?e.jsx("img",{src:g.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-blue-600 flex items-center justify-center text-white text-2xl font-bold",children:g.name.charAt(0).toUpperCase()})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-blue-600 rounded-full border-2 border-white"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:g.name}),e.jsx("button",{onClick:()=>d(!0),className:"p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors",children:e.jsx(wa,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-gray-600",children:g?.level||"Beginner"})]})]}),e.jsx(ya,{className:"w-8 h-8 text-gray-400"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${u}%`}})})})}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-bold text-gray-900",children:[u,"%"]}),e.jsxs("span",{className:"text-gray-600",children:["Streak: ",a.userStats.streak," days"]}),e.jsxs("span",{className:"text-gray-600",children:["Teach: ",R," words"]})]})]}):e.jsx("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full mx-auto mb-4"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 mx-auto mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 mx-auto"})]})})}),e.jsx($,{title:"Account"}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 mb-6 shadow-sm",children:[e.jsx(O,{icon:e.jsx(Xe,{className:"w-5 h-5"}),title:"Email",subtitle:g?.email||"Не указан",onClick:()=>console.log("Email settings")}),e.jsx(O,{icon:e.jsx(Kt,{className:"w-5 h-5"}),title:"Change password",onClick:()=>console.log("Change password")}),e.jsx(O,{icon:e.jsx(Te,{className:"w-5 h-5"}),title:"Уровень языка",rightContent:e.jsx("select",{value:g?.level||"Beginner",onChange:f=>U(f.target.value),className:"text-sm text-gray-500 bg-transparent border-none outline-none cursor-pointer",onClick:f=>f.stopPropagation(),children:sr.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))}),onClick:()=>{}}),e.jsx(O,{icon:e.jsx(qt,{className:"w-5 h-5"}),title:"App language",onClick:()=>console.log("App language")}),e.jsx(O,{icon:e.jsx(va,{className:"w-5 h-5"}),title:"Log out",onClick:t})]}),e.jsx($,{title:"Learning"}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 mb-6 shadow-sm",children:[e.jsx(O,{icon:e.jsx(Vt,{className:"w-5 h-5"}),title:"Content language pair",rightContent:e.jsxs("span",{className:"text-sm text-gray-500",children:[y.known.flag," ",y.known.code.toUpperCase()," → ",y.learning.flag," ",y.learning.code.toUpperCase()]}),onClick:()=>n(!0)}),e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-blue-600",children:e.jsx(De,{className:"w-5 h-5"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900",children:"Daily goal"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r," words/day"]}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"range",min:"5",max:"50",value:r,onChange:f=>I(Number(f.target.value)),className:"w-20 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"})})]})]}),e.jsx(O,{icon:e.jsx(ja,{className:"w-5 h-5"}),title:"Notifications",onClick:()=>console.log("Notifications")}),e.jsx(O,{icon:e.jsx(We,{className:"w-5 h-5"}),title:"Sound effects",onClick:()=>console.log("Sound effects")})]}),e.jsx($,{title:"Progress"}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 mb-6 shadow-sm",children:[e.jsx(O,{icon:e.jsx(Jt,{className:"w-5 h-5"}),title:"Statistics",onClick:()=>console.log("Statistics")}),e.jsx(O,{icon:e.jsx(Ze,{className:"w-5 h-5"}),title:"Sessions",rightContent:e.jsx("span",{className:"text-sm text-gray-500",children:"System"}),onClick:()=>console.log("Sessions")}),e.jsx(O,{icon:e.jsx(ut,{className:"w-5 h-5"}),title:"About",onClick:()=>console.log("About")})]})]}),e.jsx(ar,{isOpen:l,onClose:()=>n(!1),onSave:S,currentKnownLanguage:y.known,currentLearningLanguage:y.learning,currentLevel:g?.level||"Beginner"}),e.jsx(rr,{isOpen:o,onClose:()=>d(!1),onSave:h,currentUser:g||{id:"",email:"",name:"",level:"Beginner",created_at:new Date,updated_at:new Date}})]}),e.jsx("style",{children:`
        .slider::-webkit-slider-thumb {
          appearance: none;
          height: 16px;
          width: 16px;
          border-radius: 50%;
          background: #3b82f6;
          cursor: pointer;
          border: 2px solid white;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
          height: 16px;
          width: 16px;
          border-radius: 50%;
          background: #3b82f6;
          cursor: pointer;
          border: 2px solid white;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
      `})]})},or=({onBack:i,initialFilter:t="all"})=>{const{state:a,dispatch:r}=Me(),[s,l]=c.useState(t),[n,o]=c.useState(""),[d,g]=c.useState(!1),[w,_]=c.useState(!1),[T,y]=c.useState(null);Ue.useEffect(()=>{l(t)},[t]);const P=[{key:"all",label:"Все",color:"bg-gray-500"},{key:"learn",label:"Учить",color:"bg-orange-500"},{key:"review",label:"Знаю",color:"bg-blue-500"},{key:"suspended",label:"Выучено",color:"bg-green-500"}],R=c.useMemo(()=>{let E=a.cards.map(G=>{const M={...G},z=new Date;return G.dueAt<=z?M.state=se.LEARN:G.progress>=10&&G.progress<70?M.state=se.REVIEW:M.state=se.SUSPENDED,M});if(s!=="all"){const G={all:se.LEARN,learn:se.LEARN,review:se.REVIEW,suspended:se.SUSPENDED};E=E.filter(M=>M.state===G[s])}if(n.trim()){const G=n.toLowerCase().trim();E=E.filter(M=>M.term.toLowerCase().includes(G)||M.translation.toLowerCase().includes(G))}return E.sort((G,M)=>{const z=new Date,L=G.dueAt.getTime()-z.getTime(),B=M.dueAt.getTime()-z.getTime();return L<0&&B>=0?-1:L>=0&&B<0?1:L-B})},[a.cards,s,n]),C=(()=>{const p=a.cards.map(E=>{const G={...E},M=new Date;return E.dueAt<=M?G.state=se.LEARN:E.progress>=10&&E.progress<70?G.state=se.REVIEW:G.state=se.SUSPENDED,G});return{all:p.length,learn:p.filter(E=>E.state===se.LEARN).length,review:p.filter(E=>E.state===se.REVIEW).length,suspended:p.filter(E=>E.state===se.SUSPENDED).length}})(),S=async p=>{try{const E=await pe.addCardToUser(p.term,p.translation,p.languagePairId||"ru-es",p.imageUrl,p.english);if(E){r({type:"ADD_CARD",payload:E});const G=[...a.cards,E],M=G.filter(B=>B.progress>=70).length,z=G.filter(B=>B.progress>=50).length,L=fe.getDueCards(G);r({type:"UPDATE_USER_STATS",payload:{totalCards:G.length,learnedCards:z,masteredCards:M,reviewsDue:L.length}})}}catch(E){console.error("Error adding card:",E),alert("Ошибка при добавлении карточки")}},h=async p=>{try{const E=await Promise.all(p.map(b=>pe.addCardToUser(b.term,b.translation,b.languagePairId||"ru-es",b.imageUrl,b.english)));E.forEach(b=>{b&&r({type:"ADD_CARD",payload:b})});const G=E.filter(b=>b!==null),M=[...a.cards,...G],z=M.filter(b=>b.progress>=70).length,L=M.filter(b=>b.progress>=50).length,B=fe.getDueCards(M);r({type:"UPDATE_USER_STATS",payload:{totalCards:M.length,learnedCards:L,masteredCards:z,reviewsDue:B.length}})}catch(E){console.error("Error adding AI cards:",E),alert("Ошибка при добавлении карточек")}},I=async p=>{if(console.log("🔄 CardManager: handleEditCard called"),console.log("🔄 CardManager: editingCard:",T),console.log("🔄 CardManager: cardData:",p),!T){console.log("❌ CardManager: No editing card found");return}try{console.log("🔄 CardManager: Starting card update process"),console.log("🔄 CardManager: Card ID:",T.cardId),console.log("🔄 CardManager: New data:",{term:p.term,translation:p.translation,imageUrl:p.imageUrl,english:p.english}),console.log("🔄 CardManager: Calling CardService.updateCardContent..."),await pe.updateCardContent(T.cardId,p.term,p.translation,p.imageUrl,p.english),console.log("✅ CardManager: CardService.updateCardContent completed");const E={...T,term:p.term.trim(),translation:p.translation.trim(),imageUrl:p.imageUrl?.trim()||void 0,english:p.english?.trim()||void 0};console.log("🔄 CardManager: Updated card object:",E),console.log("🔄 CardManager: Dispatching UPDATE_CARD action..."),r({type:"UPDATE_CARD",payload:E}),console.log("✅ CardManager: UPDATE_CARD action dispatched"),console.log("✅ CardManager: Card updated successfully"),console.log("🔄 CardManager: Reloading cards to get updated data...");const G=await pe.getUserCards();r({type:"SET_CARDS",payload:G}),console.log("✅ CardManager: Cards reloaded:",G.length),y(null),console.log("✅ CardManager: Modal closed")}catch(E){console.error("❌ CardManager: Error updating card:",E),console.error("❌ CardManager: Error details:",{message:E instanceof Error?E.message:String(E),stack:E instanceof Error?E.stack:void 0,name:E instanceof Error?E.name:void 0});const G=E instanceof Error?E.message:JSON.stringify(E);console.error("❌ CardManager: Alert error message:",G),alert("Ошибка при сохранении изменений карточки: "+G)}},U=p=>{confirm("Вы уверены, что хотите удалить эту карточку?")&&pe.removeCardFromUser(parseInt(p)).then(()=>{const E=a.cards.filter(G=>G.cardId.toString()!==p);r({type:"SET_CARDS",payload:E})}).catch(E=>{console.error("Error deleting card:",E),alert("Ошибка при удалении карточки")})},O=p=>fe.getTimeUntilNext(p),$=p=>p<60?"text-orange-500":p<90?"text-blue-500":"text-green-500",f=p=>p<60?"bg-orange-500":p<90?"bg-blue-500":"bg-green-500";return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:i,className:"text-blue-600 font-medium",children:"← Назад"}),e.jsx("h1",{className:"font-semibold text-gray-900",children:"Карточки"}),e.jsx("button",{onClick:()=>g(!0),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(At,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Поиск карточек...",value:n,onChange:p=>o(p.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-100 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 focus:bg-white transition-colors"}),e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:P.map(p=>e.jsxs("button",{onClick:()=>l(p.key),className:`flex items-center gap-2 px-4 py-2 rounded-full whitespace-nowrap transition-colors ${s===p.key?`${p.color} text-white`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"font-medium",children:p.label}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s===p.key?"bg-white bg-opacity-20 text-white":"bg-gray-200 text-gray-600"}`,children:C[p.key]})]},p.key))})}),e.jsx("div",{className:"flex-1",children:R.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ot,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:n?"Карточки не найдены":"Нет карточек"}),e.jsx("p",{className:"text-gray-600 mb-4",children:n?"Попробуйте изменить поисковый запрос":a.cards.length===0?"Добавьте первую карточку для изучения":`Нет карточек в категории "${P.find(p=>p.key===s)?.label}"`}),!n&&(a.cards.length===0||s==="learn"&&C.learn===0)&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:()=>_(!0),className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-all transform hover:scale-105 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Добавить 10 карточек с помощью ИИ"]}),e.jsx("button",{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Добавить карточку вручную"})]})]}):e.jsx("div",{className:"p-4 space-y-3",children:R.map(p=>{const E=p.dueAt<=new Date;return e.jsxs("div",{className:`bg-white border-2 rounded-xl p-4 transition-all ${E?"border-orange-200 bg-orange-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:p.term}),e.jsx("div",{className:`w-2 h-2 rounded-full ${f(p.progress)}`})]}),e.jsx("p",{className:"text-gray-600",children:p.translation})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(p),className:"p-2 bg-transparent hover:bg-blue-50 rounded-lg transition-all transform hover:scale-105",children:e.jsx("img",{src:"/assets/Edit.png",alt:"Редактировать",className:"w-5 h-5 object-cover rounded",onError:G=>{const M=G.target;M.style.display="none",M.parentElement.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>'}})}),e.jsx("button",{onClick:()=>U(p.cardId.toString()),className:"p-2 bg-transparent hover:bg-red-50 rounded-lg transition-all transform hover:scale-105",children:e.jsx("img",{src:"/assets/Delete.png",alt:"Удалить",className:"w-5 h-5 object-cover rounded",onError:G=>{const M=G.target;M.style.display="none",M.parentElement.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>'}})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:`text-sm font-medium ${$(p.progress)}`,children:[p.progress,"%"]})}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Ze,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:E?"Просрочено":O(p)})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[p.reviewCount," повторений"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${f(p.progress)}`,style:{width:`${p.progress}%`}})})})]},p.cardId)})})}),e.jsx(Ye,{isOpen:d,onClose:()=>g(!1),onSave:S,existingCards:[]}),e.jsx(Ye,{isOpen:!!T,onClose:()=>y(null),onSave:I,editCard:T,existingCards:[]}),e.jsx(aa,{isOpen:w,onClose:()=>_(!1),onSave:h,existingCards:a.cards})]})})},lr=({onBack:i,onStartLesson:t,onUpdateLessonProgress:a})=>{const[r,s]=c.useState("all"),[l,n]=c.useState({}),[o,d]=c.useState(!1),g=[{id:"all",name:"Все",description:"Все уроки",icon:"📚",color:"bg-gray-500",lessonCount:13},{id:"basics",name:"Основы",description:"Базовые слова и фразы",icon:"🏠",color:"bg-blue-500",lessonCount:5},{id:"travel",name:"Путешествия",description:"Слова для путешествий",icon:"✈️",color:"bg-green-500",lessonCount:3},{id:"food",name:"Еда",description:"Еда и напитки",icon:"🍽️",color:"bg-orange-500",lessonCount:3},{id:"work",name:"Работа",description:"Рабочие термины",icon:"💼",color:"bg-purple-500",lessonCount:2}],w=[{id:"lesson-alphabet",title:"Испанский алфавит",description:"Интерактивный урок по изучению испанского алфавита",level:"beginner",duration:10,cardCount:27,completed:!1,progress:0,category:"basics",createdAt:new Date,updatedAt:new Date},{id:"intro",title:"Приветствие и знакомство",description:"Основные фразы для знакомства",level:"beginner",duration:15,cardCount:22,completed:!1,progress:0,category:"basics",createdAt:new Date,updatedAt:new Date},{id:"lesson-1-nouns-gender-number",title:"Имя существительное — род",description:"Изучаем род существительных с интерактивными играми",level:"beginner",duration:25,cardCount:0,completed:!1,progress:0,category:"basics",createdAt:new Date,updatedAt:new Date}],_=r==="all"?w:w.filter(h=>h.category===r),T=h=>{switch(h){case"beginner":return"bg-green-100 text-green-700";case"intermediate":return"bg-yellow-100 text-yellow-700";case"advanced":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},y=h=>{switch(h){case"beginner":return"Начинающий";case"intermediate":return"Средний";case"advanced":return"Продвинутый";default:return h}},P=h=>h===100?"bg-green-500":h>=50?"bg-blue-500":h>0?"bg-orange-500":"bg-gray-300",R=c.useCallback(async()=>{if(!o)try{console.log("📊 Loading all lesson progress from Supabase");const h=await Qe.getAllLessonProgress(),I={};h.forEach(U=>{I[U.lesson_id]=U.total_progress}),n(I),d(!0),console.log("📊 Loaded progress from Supabase:",I)}catch(h){console.error("❌ Error loading progress from Supabase:",h),d(!0)}},[o]);c.useEffect(()=>{R()},[R]);const u=c.useCallback(async(h,I)=>{console.log("📈 LessonsScreen: Updating progress for lesson",h,"to",I),n(U=>({...U,[h]:I}));try{await Qe.updateLessonProgress(h,{total_progress:I}),console.log("💾 Progress saved to Supabase")}catch(U){console.error("❌ Error updating progress in Supabase:",U)}a&&a(h,I)},[a]);Ue.useEffect(()=>{const h=async I=>{const U=I,{lessonId:O,progress:$}=U.detail;console.log("📡 Received progress update event:",{lessonId:O,progress:$}),await u(O,$)};return window.addEventListener("lessonProgressUpdated",h),()=>{window.removeEventListener("lessonProgressUpdated",h)}},[u]);const C=h=>l[h]||0,S=c.useCallback(h=>{t(h)},[t]);return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:i,className:"text-blue-600 font-medium",children:"← Назад"}),e.jsx("h1",{className:"font-semibold text-gray-900",children:"Уроки"}),e.jsx("div",{className:"w-8"})]})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:g.map(h=>e.jsxs("button",{onClick:()=>s(h.id),className:`flex items-center gap-2 px-4 py-2 rounded-full whitespace-nowrap transition-colors ${r===h.id?`${h.color} text-white`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"text-lg",children:h.icon}),e.jsx("span",{className:"font-medium",children:h.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r===h.id?"bg-white bg-opacity-20 text-white":"bg-gray-200 text-gray-600"}`,children:h.lessonCount})]},h.id))})}),e.jsx("div",{className:"flex-1",children:_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Te,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Нет уроков"}),e.jsx("p",{className:"text-gray-600",children:"В этой категории пока нет доступных уроков"})]}):e.jsx("div",{className:"p-4 space-y-4",children:_.map(h=>e.jsxs("div",{className:"bg-white border-2 rounded-xl p-4 transition-all hover:shadow-md",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("button",{onClick:()=>S(h.id),className:"font-semibold text-gray-900 hover:text-blue-600 transition-colors text-left",children:h.title}),h.completed&&e.jsx(_e,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:h.description}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${T(h.level)}`,children:y(h.level)}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Ze,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-xs",children:[h.duration," мин"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Te,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-xs",children:[h.cardCount," слов"]})]})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Прогресс"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[C(h.id),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${P(C(h.id))}`,style:{width:`${C(h.id)}%`}})})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex items-center gap-2",children:C(h.id)===100?e.jsxs("button",{onClick:()=>S(h.id),className:"flex items-center gap-1 text-green-600 hover:text-green-700 transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Завершено"})]}):C(h.id)>0?e.jsxs("button",{onClick:()=>S(h.id),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Продолжить"})]}):e.jsxs("button",{onClick:()=>S(h.id),className:"flex items-center gap-1 text-gray-600 hover:text-gray-700 transition-colors",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Начать"})]})})})})]},h.id))})})]})})},$t={id:"intro",title:"Формы приветствия и обращения",theory:`
  В испанском языке приветствия и прощания — важная часть общения. 
  Испанцы здороваются даже с незнакомыми людьми и обычно сопровождают это вопросом «¿Qué tal?» — «Как дела?».
  
  👋 Основные приветствия:
  - ¡Hola! — Привет / Здравствуйте
  - ¡Buenos días! — Доброе утро
  - ¡Buenas tardes! — Добрый день
  - ¡Buenas noches! — Добрый вечер / Спокойной ночи
  
  👋 Прощания:
  - ¡Hasta luego! — Пока
  - ¡Hasta pronto! — До скорого
  - ¡Hasta la vista! — До свидания
  - ¡Hasta mañana! — До завтра
  - ¡Adiós! — Прощай(те)
  
  🙋 Полезные выражения:
  - ¿Qué tal? — Как дела?
  - ¿Qué tal la vida? — Как жизнь?
  - ¿Qué tal la familia? — Как семья?
  - Bien, gracias. — Спасибо, хорошо
  - Todo va bien. — Всё хорошо
  - Más o menos bien. — Более или менее хорошо
  - Así así / Regular. — Так себе
  - Por favor. — Пожалуйста
  - Muchas gracias. — Большое спасибо
  - De nada. — Не за что
  `,dialogues:[{es:["— Buenos días, señorita.","— ¡Hola! ¿Qué tal?","— Bien, gracias. ¿Y tú?","— Regular. Hasta luego.","— Hasta mañana."],ru:["— Доброе утро, сеньорита.","— Привет, как дела?","— Спасибо, хорошо. А как ты?","— Так себе. Пока.","— До завтра."]},{es:["— Buenas tardes, doña Rosa.","— Hola, señor Pérez. ¿Qué tal la vida? ¿Qué tal la familia?","— Más o menos bien, gracias.","— Hasta la vista.","— Adiós, doña Rosa."],ru:["— Добрый день, донья Роза.","— Привет, сеньор Перес. Как жизнь? Как семья?","— Более или менее, спасибо.","— До свидания.","— Прощайте, донья Роза."]}],practice:[{task:"Переведите на испанский:",items:[{ru:"привет",es:"hola"},{ru:"спасибо",es:"gracias"},{ru:"как дела?",es:"¿qué tal?"},{ru:"как жизнь?",es:"¿qué tal la vida?"},{ru:"до свидания",es:"hasta la vista"},{ru:"добрый день",es:"buenas tardes"},{ru:"прощайте",es:"adiós"},{ru:"как семья?",es:"¿qué tal la familia?"}]}],games:["quiz","matching"],tips:`
  💡 Совет:
  - На вопрос «¿Qué tal?» отвечайте коротко: «Bien, gracias» или «Todo va bien».
  - В официальной обстановке используйте обращения señor, señora, señorita.
  - Перед именем можно сказать don (для мужчин) или doña (для женщин).
  `},He={id:"lesson-1-nouns-gender-number",title:"Имя существительное — род и число",theory:`Имя существительное

В испанском языке существительные имеют категорию рода. 
Все существительные делятся на мужской род (masculino) и женский род (femenino).
Большинство существительных, оканчивающихся на гласную -о, относятся к мужскому роду,
в то время как большинство существительных, оканчивающихся на гласную -а, к женскому роду:

      Основные правила:
   -o → masculino (chico, libro, perro)
  chico мальчик
  amigo друг
  hermano брат
  libro книга
  alumno ученик
  museo музей

   -a → femenino (casa, amiga, playa)
  chica девочка
  amiga подруга
  hermana сестра
  casa дом
  alumna ученица
  playa пляж
   
      Исключения:
        masculino (несмотря на -a)
    papá папа
    día день
    policía полицейский

      femenino (несмотря на -o)
    mano рука
    radio радио

    К мужскому роду относятся существительные греческого происхождения,
оканчивающиеся на -ma и -ta:
    problema
    programa
    tema
    planeta
Существительные, оканчивающиеся на гласную -е, могут быть как
мужского, так и женского рода:

  masculino
    padre отец
    café кофе
    coche автомобиль
    hombre человек / мужчина

  femenino
    madre мать
    calle улица
    noche ночь
    tarde вечер / день

Существительные, оканчивающиеся на согласную, могут быть как
мужского, так и женского рода:
 
  masculino 
    amor любовь
    sol солнце
    avión самолет
    lápiz карандаш
    país страна
    césped газон

  femenino
   flor цветок
   sal соль
   operación операция
   luz свет
   crisis кризис
   pared стена    

    К женскому роду относятся существительные, оканчивающиеся на -ción,
  -tión, -sión, -ad:
   estación станция
   ciudad город
   cuestión вопрос
   verdad правда
   pensión пенсия
   felicidad счастье

   Существительные, оканчивающиеся на -ante, -iente, -ista обозначают лиц
как мужского, так и женского пола:
estudiante m студент, estudiante f студентка
cliente m клиент, cliente f клиентка
economista m, f экономист (мужчина и женщина)
`,dialogues:[{es:["¿Es masculino o femenino?","La casa es femenino.","El libro es masculino.","¿Y el problema?","El problema es masculino también."],ru:["Это мужского или женского рода?","Дом - женского рода.","Книга - мужского рода.","А проблема?","Проблема тоже мужского рода."]}],practice:[{task:"Определите род существительных",items:[{ru:"chico",es:"masculino"},{ru:"amiga",es:"femenino"},{ru:"problema",es:"masculino"},{ru:"mano",es:"femenino"},{ru:"radio",es:"femenino"},{ru:"playa",es:"femenino"},{ru:"papá",es:"masculino"},{ru:"día",es:"masculino"}]}],games:["Игра 1: Определение рода","Игра 2: Множественное число","Игра 3: Классификация","Игра 4: Поиск ошибок"],tips:`💡 **Советы для запоминания:**

• Запоминайте исключения группами (día, papá - мужские с -a)
• Греческие слова на -ma обычно мужские
• Слова на -ción всегда женские
• При сомнениях в множественном числе: гласная +s, согласная +es`},rt={gender:{items:[{term:"chico",answer:"m",explanation:"Окончание -o → masculino"},{term:"amiga",answer:"f",explanation:"Окончание -a → femenino"},{term:"problema",answer:"m",explanation:"Греческое -ma → masculino"},{term:"mano",answer:"f",explanation:"Исключение: mano → femenino"},{term:"radio",answer:"f",explanation:"Исключение: radio → femenino"},{term:"playa",answer:"f",explanation:"Окончание -a → femenino"},{term:"papá",answer:"m",explanation:"Исключение: papá → masculino"},{term:"día",answer:"m",explanation:"Исключение: día → masculino"}]},plural:{items:[{singular:"libro",plural:"libros",rule:"Гласная +s"},{singular:"casa",plural:"casas",rule:"Гласная +s"},{singular:"ciudad",plural:"ciudades",rule:"Согласная +es"},{singular:"flor",plural:"flores",rule:"Согласная +es"},{singular:"lápiz",plural:"lápices",rule:"z → c + es"},{singular:"luz",plural:"luces",rule:"z → c + es"},{singular:"lunes",plural:"lunes",rule:"Не изменяется"},{singular:"crisis",plural:"crisis",rule:"Не изменяется"}]},sort:{items:[{term:"chico",gender:"m"},{term:"hermana",gender:"f"},{term:"radio",gender:"f"},{term:"café",gender:"m"},{term:"estudiante",gender:"x"},{term:"economista",gender:"x"},{term:"planeta",gender:"m"},{term:"ciudad",gender:"f"}]},findError:{items:[{wrong:"La mano es masculino.",right:"La mano es femenino.",explanation:"'mano' — исключение женского рода"},{wrong:"Los lápizes están en la mesa.",right:"Los lápices están en la mesa.",explanation:"z → c + es"},{wrong:"El problema es femenino.",right:"El problema es masculino.",explanation:"Греческое -ma → masculino"}]}},sa=i=>{const[t,a]=c.useState({theoryViewed:!1,dialoguesListened:!1,practiceCompleted:!1,practiceScore:0,totalProgress:0,progressLoaded:!1}),r=c.useCallback(()=>{let o=0;return t.theoryViewed&&(o+=20),t.dialoguesListened&&(o+=30),t.practiceCompleted&&(o+=Math.round(t.practiceScore/100*50)),Math.min(o,100)},[t.theoryViewed,t.dialoguesListened,t.practiceCompleted,t.practiceScore]),s=c.useCallback(async()=>{if(!(!i||t.progressLoaded))try{console.log("📊 Loading progress from Supabase for lesson:",i);const o=await Qe.getLessonProgress(i);o?(a(d=>({...d,theoryViewed:o.theory_viewed,dialoguesListened:o.dialogues_listened,practiceCompleted:o.practice_completed,practiceScore:o.practice_score,totalProgress:o.total_progress,progressLoaded:!0})),console.log("📊 Loaded progress from Supabase:",o)):a(d=>({...d,progressLoaded:!0}))}catch(o){console.error("❌ Error loading progress from Supabase:",o),a(d=>({...d,progressLoaded:!0}))}},[i,t.progressLoaded]),l=c.useCallback(async o=>{if(!(!i||!t.progressLoaded))try{const d={...t,...o},g=r();console.log("💾 Saving progress to Supabase:",{lessonId:i,updates:o,totalProgress:g}),await Qe.updateLessonProgress(i,{theory_viewed:d.theoryViewed,dialogues_listened:d.dialoguesListened,practice_completed:d.practiceCompleted,practice_score:d.practiceScore,total_progress:g}),console.log("✅ Progress saved to Supabase")}catch(d){console.error("❌ Error saving progress to Supabase:",d)}},[i,t,r,t.progressLoaded]),n={markTheoryViewed:c.useCallback(()=>{t.theoryViewed||(console.log("✅ Theory viewed!"),a(o=>({...o,theoryViewed:!0})),l({theoryViewed:!0}))},[t.theoryViewed,l]),markDialoguesListened:c.useCallback(()=>{t.dialoguesListened||(console.log("🎧 Dialogues listened!"),a(o=>({...o,dialoguesListened:!0})),l({dialoguesListened:!0}))},[t.dialoguesListened,l]),markPracticeCompleted:c.useCallback(o=>{console.log("📝 Practice completed with score:",o),a(d=>({...d,practiceCompleted:!0,practiceScore:o})),l({practiceCompleted:!0,practiceScore:o})},[l]),resetProgress:c.useCallback(()=>{console.log("🔄 Resetting progress"),a(o=>({...o,theoryViewed:!1,dialoguesListened:!1,practiceCompleted:!1,practiceScore:0,totalProgress:0})),l({theoryViewed:!1,dialoguesListened:!1,practiceCompleted:!1,practiceScore:0,totalProgress:0})},[l])};return c.useEffect(()=>{s()},[s]),c.useEffect(()=>{if(t.progressLoaded){const o=r();o!==t.totalProgress&&a(d=>({...d,totalProgress:o}))}},[t.theoryViewed,t.dialoguesListened,t.practiceCompleted,t.practiceScore,t.progressLoaded,r,t.totalProgress]),{...t,...n,calculateProgress:r}},na=({activeSection:i,theorySection:t,onTheoryViewed:a,delay:r=3e3})=>{const s=c.useCallback(()=>{console.log("⏰ Starting theory timer...");const l=setTimeout(()=>{console.log("✅ Theory viewed!"),a()},r);return()=>clearTimeout(l)},[a,r]);c.useEffect(()=>{if(i===t)return s()},[i,t,s])},oa=({onDialoguesListened:i,languageCode:t="es-ES"})=>({playAudio:c.useCallback(async r=>{try{console.log("🔊 Playing audio for:",r),await ye.speakText(r,t)?(console.log("🎧 Dialogues listened!"),i()):console.warn("⚠️ Audio playback failed, but continuing...")}catch(s){console.error("❌ Error playing audio:",s)}},[i,t])}),ir=[{term:"hola",translation:"привет",english:"hello"},{term:"buenos días",translation:"доброе утро",english:"good morning"},{term:"buenas tardes",translation:"добрый день",english:"good afternoon"},{term:"buenas noches",translation:"добрый вечер",english:"good evening"},{term:"hasta luego",translation:"пока",english:"see you later"},{term:"hasta pronto",translation:"до скорого",english:"see you soon"},{term:"hasta la vista",translation:"до свидания",english:"goodbye"},{term:"hasta mañana",translation:"до завтра",english:"see you tomorrow"},{term:"adiós",translation:"прощай(те)",english:"goodbye"},{term:"qué tal",translation:"как дела",english:"how are you"},{term:"qué tal la vida",translation:"как жизнь",english:"how is life"},{term:"qué tal la familia",translation:"как семья",english:"how is the family"},{term:"bien",translation:"хорошо",english:"good"},{term:"gracias",translation:"спасибо",english:"thank you"},{term:"bien, gracias",translation:"спасибо, хорошо",english:"good, thank you"},{term:"todo va bien",translation:"всё хорошо",english:"everything is fine"},{term:"más o menos bien",translation:"более или менее хорошо",english:"more or less good"},{term:"así así",translation:"так себе",english:"so-so"},{term:"regular",translation:"так себе",english:"regular"},{term:"por favor",translation:"пожалуйста",english:"please"},{term:"muchas gracias",translation:"большое спасибо",english:"thank you very much"},{term:"de nada",translation:"не за что",english:"you're welcome"},{term:"señor",translation:"сеньор",english:"sir/mr."},{term:"señora",translation:"сеньора",english:"madam/mrs."},{term:"señorita",translation:"сеньорита",english:"miss"},{term:"y tú",translation:"а как ты",english:"and you"}],cr=[{term:"chico",translation:"мальчик",english:"boy"},{term:"amigo",translation:"друг",english:"friend (male)"},{term:"hermano",translation:"брат",english:"brother"},{term:"libro",translation:"книга",english:"book"},{term:"alumno",translation:"ученик",english:"student (male)"},{term:"museo",translation:"музей",english:"museum"},{term:"papá",translation:"папа",english:"dad"},{term:"día",translation:"день",english:"day"},{term:"policía",translation:"полицейский",english:"police officer"},{term:"problema",translation:"проблема",english:"problem"},{term:"sistema",translation:"система",english:"system"},{term:"tema",translation:"тема",english:"topic"},{term:"programa",translation:"программа",english:"program"},{term:"clima",translation:"климат",english:"climate"},{term:"drama",translation:"драма",english:"drama"},{term:"poema",translation:"поэма",english:"poem"},{term:"planeta",translation:"планета",english:"planet"},{term:"idioma",translation:"язык",english:"language"},{term:"mapa",translation:"карта",english:"map"},{term:"sofá",translation:"диван",english:"sofa"},{term:"café",translation:"кофе",english:"coffee"},{term:"bebé",translation:"малыш",english:"baby"},{term:"pie",translation:"нога",english:"foot"},{term:"mano",translation:"рука",english:"hand"},{term:"chica",translation:"девочка",english:"girl"},{term:"amiga",translation:"подруга",english:"friend (female)"},{term:"hermana",translation:"сестра",english:"sister"},{term:"casa",translation:"дом",english:"house"},{term:"alumna",translation:"ученица",english:"student (female)"},{term:"playa",translation:"пляж",english:"beach"},{term:"mamá",translation:"мама",english:"mom"},{term:"noche",translation:"ночь",english:"night"},{term:"policía",translation:"полицейская",english:"police officer (female)"},{term:"mesa",translation:"стол",english:"table"},{term:"silla",translation:"стул",english:"chair"},{term:"ventana",translation:"окно",english:"window"},{term:"puerta",translation:"дверь",english:"door"},{term:"cocina",translation:"кухня",english:"kitchen"},{term:"habitación",translation:"комната",english:"room"},{term:"ciudad",translation:"город",english:"city"},{term:"calle",translation:"улица",english:"street"},{term:"plaza",translation:"площадь",english:"square"},{term:"escuela",translation:"школа",english:"school"},{term:"universidad",translation:"университет",english:"university"},{term:"biblioteca",translation:"библиотека",english:"library"},{term:"farmacia",translation:"аптека",english:"pharmacy"},{term:"tienda",translation:"магазин",english:"shop"},{term:"restaurante",translation:"ресторан",english:"restaurant"},{term:"lápiz",translation:"карандаш",english:"pencil"},{term:"lápices",translation:"карандаши",english:"pencils"},{term:"el lunes",translation:"понедельник",english:"Monday"},{term:"los lunes",translation:"понедельники",english:"Mondays"},{term:"el jueves",translation:"четверг",english:"Thursday"},{term:"los jueves",translation:"четверги",english:"Thursdays"},{term:"el crisis",translation:"кризис",english:"crisis"},{term:"los  crisis",translation:"кризисы",english:"crises"},{term:"el análisis",translation:"анализ",english:"analysis"},{term:"los análisis",translation:"анализы",english:"analyses"},{term:"el tésis",translation:"тезис",english:"thesis"},{term:"los tésis",translation:"тезисы",english:"theses"},{term:"agua",translation:"вода",english:"water"},{term:"foto",translation:"фото",english:"photo"},{term:"moto",translation:"мотоцикл",english:"motorcycle"},{term:"radio",translation:"радио",english:"radio"},{term:"video",translation:"видео",english:"video"},{term:"disco",translation:"диск",english:"disk"},{term:"solo",translation:"соло",english:"solo"},{term:"piano",translation:"пианино",english:"piano"},{term:"banco",translation:"банк",english:"bank"},{term:"parque",translation:"парк",english:"park"}],la=i=>{switch(i){case"intro":return ir;case"lesson-1":case"lesson1":case"lesson-1-nouns-gender-number":return cr;default:return console.warn(`No words found for lesson: ${i}`),[]}},dr=({lessonId:i,onBack:t,onUpdateProgress:a,onStartLearning:r})=>{const{dispatch:s}=Me(),[l,n]=c.useState("theory"),[o,d]=c.useState([]),[g,w]=c.useState(!1),[_,T]=c.useState(!1),[y,P]=c.useState(!1),[R,u]=c.useState(""),S=(A=>{switch(A){case"intro":return $t;case"lesson-1":case"lesson1":return He;default:return $t}})(i),{totalProgress:h,progressLoaded:I,markTheoryViewed:U,markDialoguesListened:O,markPracticeCompleted:$}=sa(i);na({activeSection:l,theorySection:"theory",onTheoryViewed:U}),oa({onDialoguesListened:O});const f=(A,v)=>{const m=[...o];m[A]=v,d(m)},p=()=>{w(!0);const A=G();$(A)},E=A=>A?A.toLowerCase().trim().replace(/[¿¡?!.,;:()]/g,"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim():"",G=()=>{if(!S.practice[0])return 0;const A=S.practice[0].items.filter((v,m)=>{const x=E(o[m]||""),j=E(v.es||v.ru||"");return x===j});return Math.round(A.length/S.practice[0].items.length*100)};c.useEffect(()=>{a&&I&&a(h)},[h,a,I]);const M=()=>{const A=[];if(i)try{const v=la(i);A.push(...v),console.log(`📚 Loaded ${v.length} words for lesson: ${i}`)}catch(v){console.warn(`Failed to load words for lesson ${i}:`,v),S.practice.forEach(m=>{m.items.forEach(x=>{const j=x.es||x.ru,D=x.ru||x.es;j&&D&&!A.find(F=>F.term===j)&&A.push({term:j,translation:D})})})}return A},z=async()=>{if(!_){T(!0),u("");try{const A=M();Z("📚 Extracted words from lesson:",A.length,"LessonScreen");const v=await pe.addCardsFromLesson(A,"ru-es",i);P(!0),u(`✅ Добавлено ${v.added} слов${v.skipped>0?`, пропущено ${v.skipped} дубликатов`:""}`);try{const m=await pe.getUserCards();Z("📚 Cards reloaded after adding lesson words:",m.length,"LessonScreen"),s({type:"SET_CARDS",payload:m}),Z("📚 Context updated with new cards",null,"LessonScreen"),i&&(localStorage.setItem("currentLessonId",i),Z("📚 Current lesson ID stored:",i,"LessonScreen"))}catch(m){console.error("Error reloading cards:",m)}}catch(A){console.error("Error adding words from lesson:",A),u("❌ Ошибка при добавлении слов")}finally{T(!1)}}},L=()=>{r&&r()},B=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Теория"})]}),e.jsx("button",{onClick:y?L:z,disabled:_,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-105 ${y?"bg-green-600 text-white hover:bg-green-700":"bg-blue-600 text-white hover:bg-blue-700"} disabled:bg-gray-300 disabled:cursor-not-allowed disabled:transform-none`,children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Добавляем..."]}):y?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4"}),"Перейти к изучению слов"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-4 h-4"}),"Добавить слова из урока"]})})]}),e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("pre",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed font-sans",children:S.theory})}),R&&e.jsx("div",{className:`mt-4 p-3 rounded-lg text-sm font-medium ${R.includes("✅")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:R})]})}),b=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(it,{className:"w-5 h-5 text-green-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Диалоги"})]}),S.dialogues&&S.dialogues.map((A,v)=>e.jsx("div",{className:"mb-6 last:mb-0",children:e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:A.es.map((m,x)=>e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-800 font-medium mb-1",children:m}),e.jsx("div",{className:"text-gray-600 text-sm",children:A.ru[x]})]}),e.jsx("button",{onClick:()=>{console.log("Playing audio for:",m)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-blue-600 transition-colors",children:e.jsx(We,{className:"w-4 h-4"})})]},x))})},v))]})}),N=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(De,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Практика"})]}),S.practice[0]&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-orange-50 rounded-lg p-4",children:e.jsx("h3",{className:"font-medium text-orange-800 mb-2",children:S.practice[0].task})}),e.jsx("div",{className:"space-y-4",children:S.practice[0].items.map((A,v)=>{const m=A.ru||A.es,x=A.es||A.ru;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-medium text-gray-900",children:m}),g&&e.jsx("div",{className:"flex items-center gap-2",children:E(o[v]||"")===E(x)?e.jsx(_e,{className:"w-5 h-5 text-green-500"}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-red-500 text-sm",children:"✗"}),e.jsx("span",{className:"text-green-600 text-sm font-medium",children:x})]})})]}),e.jsx("input",{type:"text",value:o[v]||"",onChange:j=>f(v,j.target.value),placeholder:"Введите ответ...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:g})]},v)})}),g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600 mb-2",children:[G(),"%"]}),e.jsxs("div",{className:"text-gray-600",children:["Правильных ответов: ",S.practice[0].items.filter((A,v)=>{const m=E(o[v]||""),x=E(A.es||A.ru||"");return m===x}).length," из ",S.practice[0].items.length]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{onClick:y?L:z,disabled:_,className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all transform hover:scale-105 mx-auto ${y?"bg-green-600 text-white hover:bg-green-700":"bg-purple-600 text-white hover:bg-purple-700"} disabled:bg-gray-300 disabled:cursor-not-allowed disabled:transform-none`,children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Добавляем..."]}):y?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4"}),"Перейти к изучению слов"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-4 h-4"}),"Добавить слова из урока"]})}),R&&e.jsx("div",{className:`mt-3 p-3 rounded-lg text-sm font-medium ${R.includes("✅")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:R})]})]}):e.jsx("button",{onClick:p,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Проверить ответы"})]})]})});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(ve,{className:"w-5 h-5"}),"Назад"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:S.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Прогресс: ",h,"%"]})]})]})})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"flex gap-2 mb-8",children:[{id:"theory",label:"Теория",icon:Te},{id:"dialogues",label:"Диалоги",icon:it},{id:"practice",label:"Практика",icon:De}].map(({id:A,label:v,icon:m})=>e.jsxs("button",{onClick:()=>n(A),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${l===A?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(m,{className:"w-4 h-4"}),v]},A))}),l==="theory"&&B(),l==="dialogues"&&b(),l==="practice"&&N()]})]})},mr=({lessonId:i,onBack:t,onUpdateProgress:a})=>{const[r,s]=c.useState("theory"),[l,n]=c.useState("gender"),[o,d]=c.useState(0),[g,w]=c.useState([]),[_,T]=c.useState({}),[y,P]=c.useState(!1),[R,u]=c.useState(!1),[C,S]=c.useState(!1),[h,I]=c.useState(!1),[U,O]=c.useState(!1),[$,f]=c.useState(""),{totalProgress:p,progressLoaded:E,markTheoryViewed:G,markDialoguesListened:M}=sa(i);na({activeSection:r,theorySection:"theory",onTheoryViewed:G}),oa({onDialoguesListened:M}),c.useEffect(()=>{a&&E&&a(p)},[p,a,E]);const z=()=>{switch(l){case"gender":return rt.gender.items;case"plural":return rt.plural.items;case"sort":return rt.sort.items;case"findError":return rt.findError.items;default:return[]}},L=()=>{const F=z();if(o<F.length-1)d(o+1),P(!1),u(!1);else{const Q=["gender","plural","sort","findError"],ne=Q.indexOf(l);ne<Q.length-1?(n(Q[ne+1]),d(0),P(!1),u(!1)):s("practice")}},B=()=>{const F=[];if(i)try{const Q=la(i);F.push(...Q),console.log(`📚 Loaded ${Q.length} words for lesson: ${i}`)}catch(Q){console.warn(`Failed to load words for lesson ${i}:`,Q);const ne=[{term:"chico",translation:"мальчик"},{term:"amigo",translation:"друг"},{term:"hermano",translation:"брат"},{term:"libro",translation:"книга"},{term:"alumno",translation:"ученик"},{term:"museo",translation:"музей"},{term:"chica",translation:"девочка"},{term:"amiga",translation:"подруга"},{term:"hermana",translation:"сестра"},{term:"casa",translation:"дом"},{term:"alumna",translation:"ученица"},{term:"playa",translation:"пляж"},{term:"papá",translation:"папа"},{term:"día",translation:"день"},{term:"policía",translation:"полицейский"},{term:"mano",translation:"рука"},{term:"radio",translation:"радио"},{term:"problema",translation:"проблема"},{term:"programa",translation:"программа"},{term:"tema",translation:"тема"},{term:"planeta",translation:"планета"},{term:"padre",translation:"отец"},{term:"café",translation:"кофе"},{term:"coche",translation:"автомобиль"},{term:"hombre",translation:"человек / мужчина"},{term:"madre",translation:"мать"},{term:"calle",translation:"улица"},{term:"noche",translation:"ночь"},{term:"tarde",translation:"вечер / день"},{term:"amor",translation:"любовь"},{term:"sol",translation:"солнце"},{term:"avión",translation:"самолет"},{term:"lápiz",translation:"карандаш"},{term:"país",translation:"страна"},{term:"césped",translation:"газон"},{term:"flor",translation:"цветок"},{term:"sal",translation:"соль"},{term:"operación",translation:"операция"},{term:"luz",translation:"свет"},{term:"crisis",translation:"кризис"},{term:"pared",translation:"стена"},{term:"estación",translation:"станция"},{term:"ciudad",translation:"город"},{term:"cuestión",translation:"вопрос"},{term:"verdad",translation:"правда"},{term:"pensión",translation:"пенсия"},{term:"felicidad",translation:"счастье"},{term:"estudiante",translation:"студент/студентка"},{term:"cliente",translation:"клиент/клиентка"},{term:"economista",translation:"экономист"}];F.push(...ne)}return F},b=async()=>{if(!h){I(!0),f("");try{const F=B();console.log("📚 Extracted words from lesson:",F.length);const Q=await pe.addCardsFromLesson(F,"ru-es");O(!0),f(`✅ Добавлено ${Q.added} слов${Q.skipped>0?`, пропущено ${Q.skipped} дубликатов`:""}`),setTimeout(()=>{O(!1),f("")},3e3)}catch(F){console.error("Error adding words from lesson:",F),f("❌ Ошибка при добавлении слов")}finally{I(!1)}}},N=F=>F?F.toLowerCase().trim().replace(/[¿¡?!.,;:()]/g,"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim():"",A=F=>{const ne=z()[o];let ue=!1;l==="gender"?ue=F===ne.answer:l==="plural"&&(ue=N(F)===N(ne.plural)),u(ue),P(!0);const we=[...g];we[o]||(we[o]={correct:0,total:0,percentage:0}),ue&&we[o].correct++,we[o].total++,we[o].percentage=Math.round(we[o].correct/we[o].total*100),w(we),T(W=>({...W,[o]:F})),setTimeout(()=>{L()},2e3)},v=()=>{n("gender"),d(0),w([]),T({}),P(!1),u(!1),S(!1)},m=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Теория"})]}),e.jsx("button",{onClick:b,disabled:h,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-105 ${U?"bg-green-100 text-green-700 hover:bg-green-200":"bg-blue-600 text-white hover:bg-blue-700"} disabled:bg-gray-300 disabled:cursor-not-allowed disabled:transform-none`,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Добавляем..."]}):U?e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4"}),"Слова добавлены"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-4 h-4"}),"Добавить слова из урока"]})})]}),e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed font-sans",children:He.theory})}),$&&e.jsx("div",{className:`mt-4 p-3 rounded-lg text-sm font-medium ${$.includes("✅")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:$})]})}),x=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(it,{className:"w-5 h-5 text-green-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Диалоги"})]}),He.dialogues&&He.dialogues.map((F,Q)=>e.jsx("div",{className:"mb-6 last:mb-0",children:e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:F.es.map((ne,ue)=>e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-800 font-medium mb-1",children:ne}),e.jsx("div",{className:"text-gray-600 text-sm",children:F.ru[ue]})]}),e.jsx("button",{onClick:()=>{console.log("Playing audio for:",ne)},className:"flex-shrink-0 p-2 text-gray-400 hover:text-blue-600 transition-colors",children:e.jsx(We,{className:"w-4 h-4"})})]},ue))})},Q))]})}),j=()=>{const F=z(),Q=F[o];return Q?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(De,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[l==="gender"&&"Определите род",l==="plural"&&"Образуйте множественное число",l==="sort"&&"Сортировка по роду",l==="findError"&&"Найдите ошибку"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Вопрос ",o+1," из ",F.length]})]}),e.jsxs("div",{className:"text-center space-y-6",children:[l==="gender"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-4",children:Q.term}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>A("m"),disabled:y,className:`px-8 py-4 rounded-lg font-medium text-lg transition-colors ${y&&R&&_[o]==="m"?"bg-green-500 text-white":y&&!R&&_[o]==="m"?"bg-red-500 text-white":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:"🚹 Masculino"}),e.jsx("button",{onClick:()=>A("f"),disabled:y,className:`px-8 py-4 rounded-lg font-medium text-lg transition-colors ${y&&R&&_[o]==="f"?"bg-green-500 text-white":y&&!R&&_[o]==="f"?"bg-red-500 text-white":"bg-pink-100 text-pink-700 hover:bg-pink-200"}`,children:"🚺 Femenino"})]}),y&&e.jsxs("div",{className:`mt-6 p-4 rounded-lg ${R?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e.jsx("div",{className:"font-medium",children:R?"✅ Правильно!":"❌ Неправильно"}),e.jsxs("div",{className:"text-sm mt-1",children:["Правильный ответ: ",e.jsx("strong",{children:Q.answer==="m"?"Masculino":"Femenino"})]})]})]}),l==="plural"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-4",children:Q.singular}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsx("input",{type:"text",value:_[o]||"",onChange:ne=>T(ue=>({...ue,[o]:ne.target.value})),onKeyPress:ne=>ne.key==="Enter"&&A(_[o]||""),placeholder:"Введите множественную форму...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-center text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:y})}),e.jsx("button",{onClick:()=>A(_[o]||""),disabled:y||!_[o],className:"mt-4 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:bg-gray-300",children:"Проверить"}),y&&e.jsxs("div",{className:`mt-6 p-4 rounded-lg ${R?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e.jsx("div",{className:"font-medium",children:R?"✅ Правильно!":"❌ Неправильно"}),e.jsxs("div",{className:"text-sm mt-1",children:["Правильный ответ: ",e.jsx("strong",{children:Q.plural})]})]})]})]})]})}):null},D=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-green-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Результаты"})]}),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(gt,{className:"w-4 h-4"}),"Начать заново"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:["gender","plural","sort","findError"].map((F,Q)=>{const ne=z(),ue=g.filter((ee,H)=>Math.floor(H/ne.length)===Q),we=ue.reduce((ee,H)=>ee+H.correct,0),W=ue.reduce((ee,H)=>ee+H.total,0),V=W>0?Math.round(we/W*100):0;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[F==="gender"&&"Род",F==="plural"&&"Множественное число",F==="sort"&&"Сортировка",F==="findError"&&"Поиск ошибок"]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[V,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[we,"/",W]})]},F)})}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{onClick:b,disabled:h,className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all transform hover:scale-105 mx-auto ${U?"bg-green-100 text-green-700 hover:bg-green-200":"bg-purple-600 text-white hover:bg-purple-700"} disabled:bg-gray-300 disabled:cursor-not-allowed disabled:transform-none`,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Добавляем..."]}):U?e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4"}),"Слова добавлены"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-4 h-4"}),"Добавить слова из урока"]})}),$&&e.jsx("div",{className:`mt-3 p-3 rounded-lg text-sm font-medium ${$.includes("✅")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:$})]})]})});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(ve,{className:"w-5 h-5"}),"Назад"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:He.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Прогресс: ",p,"%"]})]})]})})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"flex gap-2 mb-8",children:[{id:"theory",label:"Теория",icon:Te},{id:"dialogues",label:"Диалоги",icon:it},{id:"practice",label:"Практика",icon:De}].map(({id:F,label:Q,icon:ne})=>e.jsxs("button",{onClick:()=>s(F),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${r===F?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(ne,{className:"w-4 h-4"}),Q]},F))}),r==="theory"&&m(),r==="dialogues"&&x(),r==="practice"&&(C?D():j())]})]})},ur=({lessonId:i,onBack:t,onUpdateProgress:a})=>{const r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],s={A:"A",B:"Be",C:"Ce",D:"De",E:"E",F:"Efe",G:"Ge",H:"Hache",I:"I",J:"Jota",K:"Ka",L:"Ele",M:"Eme",N:"Ene",Ñ:"Eñe",O:"O",P:"Pe",Q:"Cu",R:"Erre",S:"Ese",T:"Te",U:"U",V:"Uve",W:"Doble uve",X:"Equis",Y:"I griega",Z:"Zeta"},l=n=>{const o=s[n];if("speechSynthesis"in window){window.speechSynthesis.cancel();const d=new SpeechSynthesisUtterance(o);d.lang="es-ES",d.rate=.8,d.pitch=1,window.speechSynthesis.speak(d)}};return Ue.useEffect(()=>{a(100)},[a]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6",children:[e.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white p-2 sm:p-3 rounded-full transition-colors mb-4 inline-flex items-center gap-2",title:"Назад к урокам",children:e.jsx(ve,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Испанский алфавит"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"📋 27 букв"}),e.jsx("p",{className:"text-gray-600",children:"Испанский алфавит содержит 27 букв, включая уникальную букву Ñ (eñe)."}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-9 gap-3 mt-4",children:r.map(n=>e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white p-4 rounded-xl text-center font-bold text-lg cursor-pointer transition-transform transform hover:scale-110",title:`${n} - ${s[n]}`,onClick:()=>l(n),children:n},n))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"🔊 Произношение"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Нажмите на букву, чтобы услышать её произношение."}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400",children:[e.jsx("strong",{className:"text-blue-800",children:"Особенности испанского алфавита:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-gray-700 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Ñ (eñe)"})," - уникальная буква испанского алфавита"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"H (hache)"})," - не произносится в большинстве случаев"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"LL (elle)"})," - раньше считалась отдельной буквой, сейчас произносится как 'й'"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CH (che)"})," - раньше считалась отдельной буквой, произносится как 'ч'"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"RR (erre doble)"})," - двойная R для сильного раскатистого звука 'р'"]})]})]})]})]})]})})},st=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","Ñ","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Mt=["bg-red-500","bg-blue-500","bg-green-500","bg-yellow-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-orange-500","bg-cyan-500","bg-lime-500","bg-amber-500"],gr={A:"A",B:"Be",C:"Ce",D:"De",E:"E",F:"Efe",G:"Ge",H:"Hache",I:"I",J:"Jota",K:"Ka",L:"Ele",M:"Eme",N:"Ene",Ñ:"Eñe",O:"O",P:"Pe",Q:"Cu",R:"Erre",S:"Ese",T:"Te",U:"U",V:"Uve",W:"Doble uve",X:"Equis",Y:"I griega",Z:"Zeta"},pr=({onNavigateToHome:i,onNavigateToNumbersHunt:t,onNavigateToArticulosRoulette:a})=>{const[r,s]=c.useState("menu"),[l,n]=c.useState(""),[o,d]=c.useState([]),[g,w]=c.useState(null),[_,T]=c.useState(0),[y,P]=c.useState({score:0,correctAnswers:0,totalAnswers:0,averageReactionTime:0,combo:0,maxCombo:0}),[R,u]=c.useState({level:1,timeLimit:10,letterCount:4,difficulty:"easy"}),[C,S]=c.useState(0),[h,I]=c.useState(null),[U,O]=c.useState(0),[$,f]=c.useState([]),p=c.useRef(null),E=c.useCallback(()=>{s("playing"),P(m=>({...m,score:0,correctAnswers:0,totalAnswers:0,combo:0})),f([]),O(Date.now()),M()},[]),G=c.useCallback(()=>{s("gameOver");const m=$.length>0?$.reduce((x,j)=>x+j,0)/$.length:0;P(x=>({...x,averageReactionTime:m}))},[U,$]),M=c.useCallback(()=>{const m=st[Math.floor(Math.random()*st.length)];n(m);const x=[m];for(;x.length<R.letterCount;){const D=st[Math.floor(Math.random()*st.length)];x.includes(D)||x.push(D)}const j=x.sort(()=>Math.random()-.5);d(j),w(null),T(R.timeLimit),S(Date.now()),I(null),z(m)},[R.letterCount,R.timeLimit]),z=c.useCallback(m=>{const x=gr[m]||m;if("speechSynthesis"in window){window.speechSynthesis.cancel();const j=new SpeechSynthesisUtterance(x);j.lang="es-ES",j.rate=.8,j.pitch=1,window.speechSynthesis.speak(j)}},[]),L=c.useCallback(m=>{if(g||r!=="playing")return;w(m);const x=Date.now()-C;m===l?(I("correct"),P(D=>({...D,score:D.score+Math.max(1,Math.floor((R.timeLimit-x/1e3)*10)),correctAnswers:D.correctAnswers+1,totalAnswers:D.totalAnswers+1,combo:D.combo+1,maxCombo:Math.max(D.maxCombo,D.combo+1)})),f(D=>[...D,x]),B()):(I("incorrect"),P(D=>({...D,totalAnswers:D.totalAnswers+1,combo:0})),T(D=>Math.max(0,D-2)),b()),setTimeout(()=>{r==="playing"&&M()},1500)},[g,r,l,C,R.timeLimit,M]),B=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const m=new(window.AudioContext||window.webkitAudioContext),x=m.createOscillator(),j=m.createGain();x.connect(j),j.connect(m.destination),x.frequency.setValueAtTime(523.25,m.currentTime),x.frequency.setValueAtTime(659.25,m.currentTime+.1),x.frequency.setValueAtTime(783.99,m.currentTime+.2),j.gain.setValueAtTime(.3,m.currentTime),j.gain.exponentialRampToValueAtTime(.01,m.currentTime+.3),x.start(m.currentTime),x.stop(m.currentTime+.3)}},[]),b=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const m=new(window.AudioContext||window.webkitAudioContext),x=m.createOscillator(),j=m.createGain();x.connect(j),j.connect(m.destination),x.frequency.setValueAtTime(200,m.currentTime),x.frequency.setValueAtTime(150,m.currentTime+.1),j.gain.setValueAtTime(.2,m.currentTime),j.gain.exponentialRampToValueAtTime(.01,m.currentTime+.2),x.start(m.currentTime),x.stop(m.currentTime+.2)}},[]);c.useEffect(()=>(r==="playing"&&_>0?p.current=setTimeout(()=>{T(m=>m-.1)},100):_<=0&&r==="playing"&&(P(m=>({...m,totalAnswers:m.totalAnswers+1,combo:0})),setTimeout(()=>{G()},1e3)),()=>{p.current&&clearTimeout(p.current)}),[r,_,M,G]),c.useEffect(()=>{const m=Math.floor(y.correctAnswers/5)+1;m!==R.level&&u(x=>({...x,level:m,letterCount:Math.min(9,3+Math.floor(m/2)),timeLimit:Math.max(5,10-Math.floor(m/3)),difficulty:m<=3?"easy":m<=6?"medium":"hard"}))},[y.correctAnswers,R.level]);const N=c.useCallback(()=>{s("playing"),P(m=>({...m,combo:0})),M()},[M]),A=c.useCallback(()=>{s("stats")},[]),v=c.useCallback(()=>{s("menu")},[]);return r==="menu"?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen flex flex-col p-4",children:[e.jsx("div",{className:"flex justify-start pt-4 pb-2",children:e.jsx("button",{onClick:i,className:"bg-gray-500 hover:bg-gray-600 text-white p-2 sm:p-3 rounded-full transition-colors",title:"На главную",children:e.jsx(It,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 sm:p-8 w-full text-center",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2",children:"Игры"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Выбери игру для изучения"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onClick:E,className:"bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl p-6 cursor-pointer hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"🔤"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Звуковая охота: буквы"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Изучай испанский алфавит"})]})]}),e.jsx("div",{className:"text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),t&&e.jsx("div",{onClick:t,className:"bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl p-6 cursor-pointer hover:from-green-600 hover:to-teal-700 transition-all transform hover:scale-105 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"🔢"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Звуковая охота: числа"}),e.jsx("p",{className:"text-green-100 text-sm",children:"Изучай испанские числа"})]})]}),e.jsx("div",{className:"text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),a&&e.jsx("div",{onClick:a,className:"bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl p-6 cursor-pointer hover:from-purple-600 hover:to-pink-700 transition-all transform hover:scale-105 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"🎰"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Artículos Roulette"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Изучай испанские артикли"})]})]}),e.jsx("div",{className:"text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),e.jsx("div",{className:"space-y-2 pt-2",children:e.jsx("button",{onClick:A,className:"w-full bg-gray-100 text-gray-700 py-2 px-4 rounded-xl font-medium hover:bg-gray-200 transition-colors text-sm",children:"📊 Статистика"})})]})]})})]})}):r==="stats"?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsx("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 sm:p-8 w-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx($e,{className:"w-10 h-10 sm:w-12 sm:h-12 text-yellow-500 mx-auto mb-3"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:"Статистика"})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-xl",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700",children:"Очки:"}),e.jsx("span",{className:"font-bold text-blue-600",children:y.score})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-xl",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700",children:"Правильных ответов:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[y.correctAnswers,"/",y.totalAnswers]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-50 rounded-xl",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700",children:"Точность:"}),e.jsxs("span",{className:"font-bold text-purple-600",children:[y.totalAnswers>0?Math.round(y.correctAnswers/y.totalAnswers*100):0,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-orange-50 rounded-xl",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700",children:"Максимальное комбо:"}),e.jsx("span",{className:"font-bold text-orange-600",children:y.maxCombo})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-teal-50 rounded-xl",children:[e.jsx("span",{className:"text-sm sm:text-base text-gray-700",children:"Средняя скорость:"}),e.jsxs("span",{className:"font-bold text-teal-600",children:[Math.round(y.averageReactionTime),"мс"]})]})]}),e.jsx("button",{onClick:v,className:"w-full mt-4 bg-gray-100 text-gray-700 py-2 sm:py-3 px-6 rounded-2xl font-medium hover:bg-gray-200 transition-colors text-sm sm:text-base",children:"← Назад в меню"})]})})}):r==="gameOver"?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsx("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 sm:p-8 w-full text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx($e,{className:"w-14 h-14 sm:w-16 sm:h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-2",children:"Игра завершена!"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Отличная работа!"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-4 sm:p-6 mb-6",children:[e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-blue-600 mb-2",children:y.score}),e.jsx("div",{className:"text-sm sm:text-base text-gray-600",children:"Очков набрано"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:E,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-2 sm:py-3 px-6 rounded-2xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all text-sm sm:text-base",children:"🎮 Играть снова"}),e.jsx("button",{onClick:A,className:"w-full bg-gray-100 text-gray-700 py-2 sm:py-3 px-6 rounded-2xl font-medium hover:bg-gray-200 transition-colors text-sm sm:text-base",children:"📊 Посмотреть статистику"}),e.jsx("button",{onClick:v,className:"w-full bg-gray-100 text-gray-700 py-2 sm:py-3 px-6 rounded-2xl font-medium hover:bg-gray-200 transition-colors text-sm sm:text-base",children:"← Главное меню"})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsx("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen",children:e.jsxs("div",{className:"px-4 pb-6 pt-1.5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:v,className:"bg-gray-500 hover:bg-gray-600 text-white p-2 sm:p-3 rounded-full transition-colors",title:"Назад",children:e.jsx(ve,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx("button",{onClick:()=>z(l),className:"bg-blue-500 hover:bg-blue-600 text-white p-2 sm:p-3 rounded-full transition-colors",children:e.jsx(We,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx("button",{onClick:G,className:"bg-red-500 hover:bg-red-600 text-white p-2 sm:p-3 rounded-full transition-colors",title:"Завершить игру",children:e.jsx(Ae,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600"}),e.jsxs("div",{className:"relative w-10 h-10 sm:w-12 sm:h-12",children:[e.jsxs("svg",{className:"w-10 h-10 sm:w-12 sm:h-12 transform -rotate-90",viewBox:"0 0 36 36",children:[e.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#e5e7eb",strokeWidth:"3"}),e.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#3b82f6",strokeWidth:"3",strokeDasharray:`${_/R.timeLimit*100}, 100`})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-gray-700",children:Math.ceil(_)})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600"}),e.jsx("span",{className:"text-base sm:text-lg font-bold text-gray-800",children:y.score})]})]})]}),e.jsx("div",{className:"flex justify-center mb-8 px-4",children:e.jsx("div",{className:`grid gap-3 ${R.letterCount<=4?"grid-cols-2":(R.letterCount<=6,"grid-cols-3")}`,children:o.map((m,x)=>{const j=g===m,D=m===l&&j,F=m!==l&&j;return e.jsx("button",{onClick:()=>L(m),disabled:g!==null,className:`
                      w-16 h-16 sm:w-20 sm:h-20 rounded-2xl text-white font-bold text-xl sm:text-2xl
                      transition-all duration-300 transform hover:scale-105
                      ${Mt[x%Mt.length]}
                      ${j?"scale-95":"hover:scale-105"}
                      ${D?"ring-4 ring-green-400 bg-green-500":""}
                      ${F?"ring-4 ring-red-400 bg-red-500":""}
                      ${g&&!j?"opacity-50":""}
                      disabled:cursor-not-allowed
                    `,children:m},`${m}-${x}`)})})}),h&&e.jsx("div",{className:"text-center mb-6 px-4",children:e.jsx("div",{className:`
                inline-block px-4 py-2 sm:px-6 sm:py-3 rounded-2xl font-bold text-base sm:text-lg
                ${h==="correct"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}
              `,children:h==="correct"?"✅ Правильно!":"❌ Неправильно"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center px-4 space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsx("div",{className:"bg-blue-500 text-white px-3 py-2 sm:px-4 rounded-full",children:e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:["Уровень ",R.level," • ",y.correctAnswers,"/10"]})}),y.combo>0&&e.jsx("div",{className:"bg-orange-500 text-white px-3 py-2 sm:px-4 rounded-full",children:e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:["🔥 Комбо x",y.combo]})})]}),e.jsx("button",{onClick:N,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 p-2 sm:p-3 rounded-full transition-colors",children:e.jsx(gt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})})})},hr=({onNavigateToHome:i,onNavigateToNumbersHunt:t,onNavigateToArticulosRoulette:a})=>e.jsx("div",{className:"min-h-screen",children:e.jsx(pr,{onNavigateToHome:i,onNavigateToNumbersHunt:t,onNavigateToArticulosRoulette:a})}),Ge={1:"uno",2:"dos",3:"tres",4:"cuatro",5:"cinco",6:"seis",7:"siete",8:"ocho",9:"nueve",10:"diez",11:"once",12:"doce",13:"trece",14:"catorce",15:"quince",16:"dieciséis",17:"diecisiete",18:"dieciocho",19:"diecinueve",20:"veinte",30:"treinta",40:"cuarenta",50:"cincuenta",60:"sesenta",70:"setenta",80:"ochenta",90:"noventa",100:"cien",200:"doscientos",300:"trescientos",400:"cuatrocientos",500:"quinientos",600:"seiscientos",700:"setecientos",800:"ochocientos",900:"novecientos",1e3:"mil"},Ct=i=>{if(i<=0||i>1e3)return i.toString();if(Ge[i])return Ge[i];if(i>=21&&i<=29){const t=i-20;return`veinti${Ge[t]}`}if(i>=31&&i<=99){const t=Math.floor(i/10)*10,a=i%10;return a===0?Ge[t]:`${Ge[t]} y ${Ge[a]}`}if(i>=101&&i<=999){const t=Math.floor(i/100)*100,a=i%100;if(a===0)return Ge[t];const r=Ge[t],s=Ct(a);return`${r} ${s}`}return i.toString()},Ft=["bg-red-500","bg-blue-500","bg-green-500","bg-yellow-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-orange-500","bg-cyan-500","bg-lime-500","bg-amber-500"],xr=({onNavigateBack:i})=>{const[t,a]=c.useState("menu"),[r,s]=c.useState(0),[l,n]=c.useState([]),[o,d]=c.useState(null),[g,w]=c.useState(0),[_,T]=c.useState({score:0,correctAnswers:0,totalAnswers:0,averageReactionTime:0,combo:0,maxCombo:0}),[y,P]=c.useState({level:1,timeLimit:5,numberCount:3,difficulty:"easy",mode:"time-hunt"}),[R,u]=c.useState(new Date),[C,S]=c.useState([]),[h,I]=c.useState("time-hunt"),[U,O]=c.useState(""),$=c.useRef(null),f=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const v=new(window.AudioContext||window.webkitAudioContext),m=v.createOscillator(),x=v.createGain();m.connect(x),x.connect(v.destination),m.frequency.setValueAtTime(523.25,v.currentTime),m.frequency.setValueAtTime(659.25,v.currentTime+.1),m.frequency.setValueAtTime(783.99,v.currentTime+.2),x.gain.setValueAtTime(.3,v.currentTime),x.gain.exponentialRampToValueAtTime(.01,v.currentTime+.3),m.start(v.currentTime),m.stop(v.currentTime+.3)}},[]),p=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const v=new(window.AudioContext||window.webkitAudioContext),m=v.createOscillator(),x=v.createGain();m.connect(x),x.connect(v.destination),m.frequency.setValueAtTime(200,v.currentTime),m.frequency.setValueAtTime(150,v.currentTime+.1),x.gain.setValueAtTime(.2,v.currentTime),x.gain.exponentialRampToValueAtTime(.01,v.currentTime+.2),m.start(v.currentTime),m.stop(v.currentTime+.2)}},[]),E=c.useCallback((v,m)=>{let x=1,j=10;switch(m){case"easy":x=1,j=10;break;case"medium":x=1,j=100;break;case"hard":x=1,j=1e3;break;case"super-hard":x=1,j=1e3;break}const D=[];for(;D.length<v;){const F=Math.floor(Math.random()*(j-x+1))+x;D.includes(F)||D.push(F)}return D},[]),G=c.useCallback(v=>{const m=Ct(v),x=[`Tienes ${m} manzanas`,`En la mesa hay ${m} libros`,`Tengo ${m} años`,`Hay ${m} gatos`,`Compré ${m} flores`,`En el jardín hay ${m} árboles`,`Tengo ${m} hermanos`,`En la clase hay ${m} estudiantes`,`Compré ${m} lápices`,`En la nevera hay ${m} huevos`,`Tengo ${m} monedas`,`En el parque hay ${m} pájaros`];return x[Math.floor(Math.random()*x.length)]},[]),M=c.useCallback(v=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();const m=Ct(v),x=new SpeechSynthesisUtterance(m);x.lang="es-ES",x.rate=.8,x.volume=1,window.speechSynthesis.speak(x)}},[]),z=c.useCallback(v=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();const m=new SpeechSynthesisUtterance(v);m.lang="es-ES",m.rate=.7,window.speechSynthesis.speak(m)}},[]),L=c.useCallback(()=>{let v=[],m,x=null;switch(h){case"context":let j=1,D=20;switch(y.difficulty){case"easy":j=1,D=20;break;case"medium":j=1,D=100;break;case"hard":j=20,D=1e3;break;case"super-hard":j=20,D=1e3;break}m=Math.floor(Math.random()*(D-j+1))+j;const F=G(m);O(F),x=F,v=E(y.numberCount,y.difficulty),v.includes(m)||(v[0]=m);break;case"time-hunt":default:v=E(y.numberCount,y.difficulty),m=v[Math.floor(Math.random()*v.length)]}s(m),n(v.sort(()=>Math.random()-.5)),d(null),u(new Date),w(y.timeLimit),setTimeout(()=>{h==="context"&&x?z(x):M(m)},500)},[y,h,E,G,M,z]),B=c.useCallback(v=>{if(o!==null)return;const m=new Date().getTime()-R.getTime();d(v),S(j=>[...j,m]),v===r?(T(j=>({...j,score:j.score+(h==="time-hunt"?Math.max(100-Math.floor(m/100),10):100),correctAnswers:j.correctAnswers+1,totalAnswers:j.totalAnswers+1,combo:j.combo+1,maxCombo:Math.max(j.maxCombo,j.combo+1)})),f()):(T(j=>({...j,score:Math.max(0,j.score-50),totalAnswers:j.totalAnswers+1,combo:0})),p()),setTimeout(()=>{L()},1500)},[o,R,h,r,L,f,p]),b=c.useCallback(()=>{a("playing"),T({score:0,correctAnswers:0,totalAnswers:0,averageReactionTime:0,combo:0,maxCombo:0}),S([]),h==="time-hunt"?P(v=>({...v,timeLimit:5,numberCount:v.difficulty==="easy"?3:v.difficulty==="medium"?5:(v.difficulty==="hard",8),mode:"time-hunt"})):h==="context"&&P(v=>({...v,timeLimit:10,numberCount:v.difficulty==="easy"?3:v.difficulty==="medium"?5:(v.difficulty==="hard",8),mode:"context"})),L()},[L,h]),N=c.useCallback(()=>{a("gameOver"),$.current&&clearTimeout($.current)},[]),A=c.useCallback(()=>{a("menu")},[]);if(c.useEffect(()=>(t==="playing"&&g>0?$.current=setTimeout(()=>{w(v=>v-1)},1e3):g===0&&t==="playing"&&N(),()=>{$.current&&clearTimeout($.current)}),[t,g,N]),t==="menu")return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen flex flex-col p-4",children:[e.jsx("div",{className:"flex justify-start pt-4 pb-2",children:e.jsx("button",{onClick:i,className:"bg-gray-500 hover:bg-gray-600 text-white p-2 sm:p-3 rounded-full transition-colors",title:"Назад",children:e.jsx(ve,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 sm:p-8 w-full text-center",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-white text-2xl",children:"🔢"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2",children:"Звуковая охота: Числа"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Изучай испанские числа!"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Уровень сложности"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsx("button",{onClick:()=>P(v=>({...v,difficulty:"easy"})),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${y.difficulty==="easy"?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Легкий"}),e.jsx("button",{onClick:()=>P(v=>({...v,difficulty:"medium"})),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${y.difficulty==="medium"?"bg-yellow-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Средний"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>P(v=>({...v,difficulty:"hard"})),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${y.difficulty==="hard"?"bg-red-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Сложный"}),e.jsx("button",{onClick:()=>P(v=>({...v,difficulty:"super-hard"})),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${y.difficulty==="super-hard"?"bg-purple-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Супер сложный"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 text-center",children:[y.difficulty==="easy"&&"Числа 1-10, 3 варианта",y.difficulty==="medium"&&"Числа 1-100, 5 вариантов",y.difficulty==="hard"&&"Числа 1-1000, 8 вариантов",y.difficulty==="super-hard"&&"Числа 1-1000, 8 вариантов, только звук"]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("button",{onClick:()=>{I("time-hunt"),b()},className:"w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 sm:py-4 px-6 rounded-2xl font-semibold text-base sm:text-lg hover:from-orange-600 hover:to-red-700 transition-all transform hover:scale-105",children:"⏰ Охота на время"}),e.jsx("button",{onClick:()=>{I("context"),b()},className:"w-full bg-gradient-to-r from-teal-500 to-cyan-600 text-white py-3 sm:py-4 px-6 rounded-2xl font-semibold text-base sm:text-lg hover:from-teal-600 hover:to-cyan-700 transition-all transform hover:scale-105",children:"📝 Контекст"})]})]})})]})});if(t==="stats"){const v=_.totalAnswers>0?Math.round(_.correctAnswers/_.totalAnswers*100):0,m=C.length>0?Math.round(C.reduce((x,j)=>x+j,0)/C.length):0;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsx("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 sm:p-8 w-full text-center",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx($e,{className:"w-10 h-10 sm:w-12 sm:h-12 text-yellow-500 mx-auto mb-3"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-2",children:"Статистика"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:_.score}),e.jsx("div",{className:"text-sm text-gray-600",children:"Очки"})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-3",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[v,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Точность"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:_.maxCombo}),e.jsx("div",{className:"text-sm text-gray-600",children:"Макс. серия"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[m,"мс"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Скорость"})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("button",{onClick:A,className:"w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-2xl font-semibold transition-colors",children:"В меню"})})]})})})}return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-blue-50",children:e.jsxs("div",{className:"max-w-md mx-auto bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen",children:[e.jsx("div",{className:"px-4 pb-6 pt-1.5",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:A,className:"bg-gray-500 hover:bg-gray-600 text-white p-2 sm:p-3 rounded-full transition-colors",title:"Назад",children:e.jsx(ve,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx("button",{onClick:()=>{h==="context"?z(U):M(r)},className:"bg-blue-500 hover:bg-blue-600 text-white p-2 sm:p-3 rounded-full transition-colors",children:e.jsx(We,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx("button",{onClick:N,className:"bg-red-500 hover:bg-red-600 text-white p-2 sm:p-3 rounded-full transition-colors",title:"Завершить игру",children:e.jsx(Ae,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600"}),e.jsxs("div",{className:"relative w-10 h-10 sm:w-12 sm:h-12",children:[e.jsx("svg",{className:"w-10 h-10 sm:w-12 sm:h-12 transform -rotate-90",viewBox:"0 0 36 36",children:e.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:`${g/y.timeLimit*100}, 100`,className:"text-gray-300"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-gray-600",children:g})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600"}),e.jsx("span",{className:"text-lg font-bold text-gray-800",children:_.score})]})]})]})}),e.jsx("div",{className:"px-4 pb-6",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-6 sm:p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:[h==="time-hunt"&&"Охота на время",h==="context"&&y.difficulty==="super-hard"&&"Контекст (только звук)",h==="context"&&y.difficulty!=="super-hard"&&"Контекст"]}),h==="context"&&U&&y.difficulty!=="super-hard"&&e.jsxs("p",{className:"text-sm text-gray-600 italic",children:['"',U,'"']}),h==="context"&&y.difficulty==="super-hard"&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:"Слушайте фразу и выбирайте правильное число"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4",children:l.map((v,m)=>{const x=o===v,j=v===r,D=Ft[m%Ft.length];return e.jsx("button",{onClick:()=>B(v),disabled:o!==null,className:`
                      ${D} text-white font-bold text-2xl sm:text-3xl py-4 sm:py-6 rounded-2xl
                      transition-all transform hover:scale-105 active:scale-95
                      ${x?j?"ring-4 ring-green-400":"ring-4 ring-red-400":""}
                      ${o!==null?"opacity-50":"hover:shadow-lg"}
                    `,children:v},`${v}-${m}`)})}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["Правильных: ",_.correctAnswers," / ",_.totalAnswers]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${_.totalAnswers>0?_.correctAnswers/_.totalAnswers*100:0}%`}})})]})]})})]})})},fr=({onNavigateBack:i})=>e.jsx("div",{className:"min-h-screen",children:e.jsx(xr,{onNavigateBack:i})}),Bt=200,_t=-1,br=[5,10,20,50,100,_t],wr=()=>{const[i,t]=c.useState({balance:Bt,currentWord:null,currentArticle:null,currentTranslation:null,selectedBet:0,selectedArticle:null,gamePhase:"menu",isSpinning:!1,spinResult:null,lastResult:null,totalGames:0,wins:0,losses:0,wrongWords:[],records:[],wordStats:{}});c.useEffect(()=>{const u=localStorage.getItem("articulos-roulette-state");if(u)try{const C=JSON.parse(u);t(S=>({...S,...C,gamePhase:"menu",isSpinning:!1,spinResult:null,lastResult:null}))}catch(C){console.error("Error loading saved state:",C)}},[]),c.useEffect(()=>{const u={balance:i.balance,totalGames:i.totalGames,wins:i.wins,losses:i.losses,wrongWords:i.wrongWords,records:i.records,wordStats:i.wordStats};localStorage.setItem("articulos-roulette-state",JSON.stringify(u))},[i.balance,i.totalGames,i.wins,i.losses,i.wrongWords,i.records,i.wordStats]);const a=c.useCallback(()=>{t(u=>({...u,gamePhase:"betting",selectedBet:0,selectedArticle:null,currentWord:null,currentArticle:null,currentTranslation:null}))},[]),r=c.useCallback(u=>{if(u>i.balance&&u!==_t)return;const C=u===_t?i.balance:u;t(S=>({...S,selectedBet:C}))},[i.balance]),s=c.useCallback(u=>{t(C=>({...C,selectedArticle:u}))},[]),l=c.useCallback((u,C,S)=>{t(h=>({...h,currentWord:u,currentArticle:C,currentTranslation:S}))},[]),n=c.useCallback(()=>{!i.selectedBet||!i.selectedArticle||!i.currentWord||t(u=>({...u,gamePhase:"spinning",isSpinning:!0,spinResult:null}))},[i.selectedBet,i.selectedArticle,i.currentWord]),o=c.useCallback(u=>{const C=u===i.selectedArticle,S=C?i.balance+i.selectedBet:i.balance-i.selectedBet,h=C?i.wrongWords:[...i.wrongWords,i.currentWord],I=[...i.records];S>Math.max(...I,0)&&I.push(S),t(U=>({...U,gamePhase:"result",isSpinning:!1,spinResult:u,lastResult:C?"win":"lose",balance:S,totalGames:U.totalGames+1,wins:C?U.wins+1:U.wins,losses:C?U.losses:U.losses+1,wrongWords:h,records:I}))},[i.selectedArticle,i.selectedBet,i.balance,i.currentWord,i.wrongWords,i.records]),d=c.useCallback(u=>{const C=u===i.selectedArticle;t(S=>({...S,isSpinning:!1,spinResult:u,lastResult:C?"win":"lose"}))},[i.selectedArticle]),g=c.useCallback(()=>{if(!i.spinResult||!i.selectedArticle)return;const u=i.spinResult===i.selectedArticle,C=u?i.balance+i.selectedBet:i.balance-i.selectedBet,S=u?i.wrongWords:[...i.wrongWords,i.currentWord],h=[...i.records];C>Math.max(...h,0)&&h.push(C);const I={...i.wordStats};u&&i.currentWord&&(I[i.currentWord]=(I[i.currentWord]||0)+1),t(U=>({...U,balance:C,totalGames:U.totalGames+1,wins:u?U.wins+1:U.wins,losses:u?U.losses:U.losses+1,wrongWords:S,records:h,wordStats:I}))},[i.spinResult,i.selectedArticle,i.selectedBet,i.balance,i.currentWord,i.wrongWords,i.records,i.wordStats]),w=c.useCallback(()=>{i.balance<=0?t(u=>({...u,gamePhase:"gameOver"})):t(u=>({...u,gamePhase:"betting",selectedBet:0,selectedArticle:null,currentWord:null,currentArticle:null,currentTranslation:null,spinResult:null,lastResult:null}))},[i.balance]),_=c.useCallback(()=>{t({balance:Bt,currentWord:null,currentArticle:null,currentTranslation:null,selectedBet:0,selectedArticle:null,gamePhase:"menu",isSpinning:!1,spinResult:null,lastResult:null,totalGames:0,wins:0,losses:0,wrongWords:[],records:[],wordStats:{}})},[]),T=c.useCallback(()=>{t(u=>({...u,gamePhase:"menu",selectedBet:0,selectedArticle:null,currentWord:null,currentArticle:null,currentTranslation:null,spinResult:null,lastResult:null,isSpinning:!1}))},[]),y=c.useCallback(()=>{t(u=>({...u,gamePhase:"records"}))},[]),P=c.useCallback(()=>{t(u=>({...u,gamePhase:"dictionary"}))},[]),R=c.useCallback(()=>{t(u=>({...u,gamePhase:"betting",isSpinning:!1,selectedBet:0,selectedArticle:null}))},[]);return{gameState:i,BET_AMOUNTS:br,startGame:a,selectBet:r,selectArticle:s,setCurrentWord:l,startSpin:n,finishSpin:o,completeSpin:d,updateBalanceOnResult:g,nextRound:w,resetGame:_,backToMenu:T,showRecords:y,showDictionary:P,cancelSpin:R}},yr=[{word:"casa",article:"la",translation:"дом"},{word:"libro",article:"el",translation:"книга"},{word:"mano",article:"la",translation:"рука"},{word:"día",article:"el",translation:"день"},{word:"planeta",article:"el",translation:"планета"},{word:"radio",article:"la",translation:"радио"},{word:"agua",article:"el",translation:"вода"},{word:"problema",article:"el",translation:"проблема"},{word:"sistema",article:"el",translation:"система"},{word:"programa",article:"el",translation:"программа"},{word:"tema",article:"el",translation:"тема"},{word:"clima",article:"el",translation:"климат"},{word:"drama",article:"el",translation:"драма"},{word:"poema",article:"el",translation:"поэма"},{word:"idioma",article:"el",translation:"язык"},{word:"mujer",article:"la",translation:"женщина"},{word:"hombre",article:"el",translation:"мужчина"},{word:"niño",article:"el",translation:"мальчик"},{word:"niña",article:"la",translation:"девочка"},{word:"perro",article:"el",translation:"собака"},{word:"gato",article:"el",translation:"кот"},{word:"mesa",article:"la",translation:"стол"},{word:"silla",article:"la",translation:"стул"},{word:"ventana",article:"la",translation:"окно"},{word:"puerta",article:"la",translation:"дверь"},{word:"coche",article:"el",translation:"машина"},{word:"bicicleta",article:"la",translation:"велосипед"},{word:"avión",article:"el",translation:"самолет"},{word:"barco",article:"el",translation:"корабль"},{word:"tren",article:"el",translation:"поезд"},{word:"árbol",article:"el",translation:"дерево"},{word:"flor",article:"la",translation:"цветок"},{word:"sol",article:"el",translation:"солнце"},{word:"luna",article:"la",translation:"луна"},{word:"estrella",article:"la",translation:"звезда"},{word:"cielo",article:"el",translation:"небо"},{word:"tierra",article:"la",translation:"земля"},{word:"mar",article:"el",translation:"море"},{word:"río",article:"el",translation:"река"},{word:"montaña",article:"la",translation:"гора"},{word:"ciudad",article:"la",translation:"город"},{word:"pueblo",article:"el",translation:"деревня"},{word:"calle",article:"la",translation:"улица"},{word:"plaza",article:"la",translation:"площадь"},{word:"parque",article:"el",translation:"парк"},{word:"escuela",article:"la",translation:"школа"},{word:"hospital",article:"el",translation:"больница"},{word:"tienda",article:"la",translation:"магазин"},{word:"restaurante",article:"el",translation:"ресторан"},{word:"hotel",article:"el",translation:"отель"},{word:"banco",article:"el",translation:"банк"},{word:"museo",article:"el",translation:"музей"},{word:"teatro",article:"el",translation:"театр"},{word:"cine",article:"el",translation:"кинотеатр"},{word:"biblioteca",article:"la",translation:"библиотека"},{word:"iglesia",article:"la",translation:"церковь"},{word:"comida",article:"la",translation:"еда"},{word:"agua",article:"el",translation:"вода"},{word:"leche",article:"la",translation:"молоко"},{word:"pan",article:"el",translation:"хлеб"},{word:"carne",article:"la",translation:"мясо"},{word:"pescado",article:"el",translation:"рыба"},{word:"fruta",article:"la",translation:"фрукт"},{word:"verdura",article:"la",translation:"овощ"},{word:"arroz",article:"el",translation:"рис"},{word:"pasta",article:"la",translation:"паста"},{word:"pizza",article:"la",translation:"пицца"},{word:"hamburguesa",article:"la",translation:"гамбургер"},{word:"ensalada",article:"la",translation:"салат"},{word:"sopa",article:"la",translation:"суп"},{word:"café",article:"el",translation:"кофе"},{word:"té",article:"el",translation:"чай"},{word:"cerveza",article:"la",translation:"пиво"},{word:"vino",article:"el",translation:"вино"},{word:"zapato",article:"el",translation:"ботинок"},{word:"camisa",article:"la",translation:"рубашка"},{word:"pantalón",article:"el",translation:"брюки"},{word:"vestido",article:"el",translation:"платье"},{word:"chaqueta",article:"la",translation:"пиджак"},{word:"sombrero",article:"el",translation:"шляпа"},{word:"reloj",article:"el",translation:"часы"},{word:"teléfono",article:"el",translation:"телефон"},{word:"computadora",article:"la",translation:"компьютер"},{word:"televisión",article:"la",translation:"телевизор"},{word:"música",article:"la",translation:"музыка"},{word:"película",article:"la",translation:"фильм"},{word:"libro",article:"el",translation:"книга"},{word:"revista",article:"la",translation:"журнал"},{word:"periódico",article:"el",translation:"газета"},{word:"deporte",article:"el",translation:"спорт"},{word:"fútbol",article:"el",translation:"футбол"},{word:"baloncesto",article:"el",translation:"баскетбол"},{word:"tenis",article:"el",translation:"теннис"},{word:"natación",article:"la",translation:"плавание"},{word:"carrera",article:"la",translation:"бег"},{word:"vacación",article:"la",translation:"отпуск"},{word:"viaje",article:"el",translation:"путешествие"},{word:"aventura",article:"la",translation:"приключение"},{word:"amistad",article:"la",translation:"дружба"},{word:"amor",article:"el",translation:"любовь"},{word:"familia",article:"la",translation:"семья"},{word:"trabajo",article:"el",translation:"работа"},{word:"estudio",article:"el",translation:"учеба"},{word:"dinero",article:"el",translation:"деньги"},{word:"tiempo",article:"el",translation:"время"},{word:"vida",article:"la",translation:"жизнь"},{word:"muerte",article:"la",translation:"смерть"},{word:"salud",article:"la",translation:"здоровье"},{word:"enfermedad",article:"la",translation:"болезнь"},{word:"médico",article:"el",translation:"врач"},{word:"enfermera",article:"la",translation:"медсестра"},{word:"medicina",article:"la",translation:"лекарство"},{word:"casa",article:"la",translation:"дом"},{word:"apartamento",article:"el",translation:"квартира"},{word:"habitación",article:"la",translation:"комната"},{word:"cocina",article:"la",translation:"кухня"},{word:"baño",article:"el",translation:"ванная"},{word:"dormitorio",article:"el",translation:"спальня"},{word:"sala",article:"la",translation:"гостиная"},{word:"jardín",article:"el",translation:"сад"},{word:"garaje",article:"el",translation:"гараж"},{word:"animal",article:"el",translation:"животное"},{word:"color",article:"el",translation:"цвет"},{word:"número",article:"el",translation:"число"},{word:"cuerpo",article:"el",translation:"тело"},{word:"cabeza",article:"la",translation:"голова"},{word:"brazo",article:"el",translation:"рука (от плеча)"},{word:"pierna",article:"la",translation:"нога"},{word:"corazón",article:"el",translation:"сердце"},{word:"sangre",article:"la",translation:"кровь"},{word:"ojo",article:"el",translation:"глаз"},{word:"boca",article:"la",translation:"рот"},{word:"nariz",article:"la",translation:"нос"},{word:"oreja",article:"la",translation:"ухо"},{word:"pelo",article:"el",translation:"волосы"},{word:"dedo",article:"el",translation:"палец"},{word:"pie",article:"el",translation:"стопа"},{word:"espalda",article:"la",translation:"спина"},{word:"semana",article:"la",translation:"неделя"},{word:"mes",article:"el",translation:"месяц"},{word:"año",article:"el",translation:"год"},{word:"hora",article:"la",translation:"час"},{word:"minuto",article:"el",translation:"минута"},{word:"segundo",article:"el",translation:"секунда"},{word:"hoy",article:"el",translation:"сегодня"},{word:"mañana",article:"la",translation:"утро/завтра"},{word:"ayer",article:"el",translation:"вчера"},{word:"luz",article:"la",translation:"свет"},{word:"fuego",article:"el",translation:"огонь"},{word:"viento",article:"el",translation:"ветер"},{word:"lluvia",article:"la",translation:"дождь"},{word:"nieve",article:"la",translation:"снег"},{word:"mapa",article:"el",translation:"карта"},{word:"sofá",article:"el",translation:"диван"},{word:"norte",article:"el",translation:"север"},{word:"sur",article:"el",translation:"юг"},{word:"este",article:"el",translation:"восток"},{word:"oeste",article:"el",translation:"запад"},{word:"papel",article:"el",translation:"бумага"},{word:"lápiz",article:"el",translation:"карандаш"},{word:"pluma",article:"la",translation:"ручка"},{word:"pregunta",article:"la",translation:"вопрос"},{word:"respuesta",article:"la",translation:"ответ"},{word:"idea",article:"la",translation:"идея"},{word:"razón",article:"la",translation:"причина/разум"},{word:"verdad",article:"la",translation:"правда"},{word:"mentira",article:"la",translation:"ложь"},{word:"paz",article:"la",translation:"мир"},{word:"guerra",article:"la",translation:"война"},{word:"rey",article:"el",translation:"король"},{word:"reina",article:"la",translation:"королева"},{word:"príncipe",article:"el",translation:"принц"},{word:"princesa",article:"la",translation:"принцесса"},{word:"juego",article:"el",translation:"игра"},{word:"canción",article:"la",translation:"песня"},{word:"voz",article:"la",translation:"голос"},{word:"sonido",article:"el",translation:"звук"},{word:"imagen",article:"la",translation:"изображение"},{word:"foto",article:"la",translation:"фотография"},{word:"aire",article:"el",translation:"воздух"},{word:"fin",article:"el",translation:"конец"},{word:"principio",article:"el",translation:"начало"},{word:"lado",article:"el",translation:"сторона"},{word:"centro",article:"el",translation:"центр"},{word:"punto",article:"el",translation:"точка"},{word:"línea",article:"la",translation:"линия"},{word:"forma",article:"la",translation:"форма"},{word:"círculo",article:"el",translation:"круг"},{word:"cuadrado",article:"el",translation:"квадрат"},{word:"dolor",article:"el",translation:"боль"},{word:"placer",article:"el",translation:"удовольствие"},{word:"miedo",article:"el",translation:"страх"},{word:"alegría",article:"la",translation:"радость"},{word:"tristeza",article:"la",translation:"грусть"},{word:"sorpresa",article:"la",translation:"сюрприз"},{word:"hambre",article:"la",translation:"голод"},{word:"sed",article:"la",translation:"жажда"},{word:"sueño",article:"el",translation:"сон"},{word:"suerte",article:"la",translation:"удача"},{word:"éxito",article:"el",translation:"успех"},{word:"fracaso",article:"el",translation:"неудача"},{word:"error",article:"el",translation:"ошибка"}],vr={words:yr},jr=()=>{const[i,t]=c.useState([]);c.useEffect(()=>{t(vr.words)},[]);const a=c.useCallback((s={})=>{if(i.length===0)return null;let l=i.filter(d=>(s[d.word]||0)<5);l.length===0&&(l=i);const n=Math.floor(Math.random()*l.length);return l[n]},[i]),r=c.useCallback(s=>i.find(l=>l.word===s)||null,[i]);return{words:i,getRandomWord:a,getWordByText:r}},Nr=()=>{const i=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const n=new(window.AudioContext||window.webkitAudioContext),o=n.createOscillator(),d=n.createGain();o.connect(d),d.connect(n.destination),o.frequency.setValueAtTime(800,n.currentTime),o.frequency.setValueAtTime(600,n.currentTime+.05),d.gain.setValueAtTime(.2,n.currentTime),d.gain.exponentialRampToValueAtTime(.01,n.currentTime+.1),o.start(n.currentTime),o.stop(n.currentTime+.1)}},[]),t=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const n=new(window.AudioContext||window.webkitAudioContext),o=n.createOscillator(),d=n.createGain();o.connect(d),d.connect(n.destination),o.frequency.setValueAtTime(200,n.currentTime),o.frequency.setValueAtTime(150,n.currentTime+.1),o.frequency.setValueAtTime(100,n.currentTime+.2),d.gain.setValueAtTime(.3,n.currentTime),d.gain.exponentialRampToValueAtTime(.01,n.currentTime+.3),o.start(n.currentTime),o.stop(n.currentTime+.3)}},[]),a=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const n=new(window.AudioContext||window.webkitAudioContext),o=n.createOscillator(),d=n.createGain();o.connect(d),d.connect(n.destination),o.frequency.setValueAtTime(523.25,n.currentTime),o.frequency.setValueAtTime(659.25,n.currentTime+.1),o.frequency.setValueAtTime(783.99,n.currentTime+.2),o.frequency.setValueAtTime(1046.5,n.currentTime+.3),d.gain.setValueAtTime(.4,n.currentTime),d.gain.exponentialRampToValueAtTime(.01,n.currentTime+.5),o.start(n.currentTime),o.stop(n.currentTime+.5)}},[]),r=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const n=new(window.AudioContext||window.webkitAudioContext),o=n.createOscillator(),d=n.createGain();o.connect(d),d.connect(n.destination),o.frequency.setValueAtTime(150,n.currentTime),o.frequency.setValueAtTime(100,n.currentTime+.1),o.frequency.setValueAtTime(80,n.currentTime+.2),d.gain.setValueAtTime(.2,n.currentTime),d.gain.exponentialRampToValueAtTime(.01,n.currentTime+.3),o.start(n.currentTime),o.stop(n.currentTime+.3)}},[]),s=c.useCallback(()=>{if(typeof window<"u"&&window.AudioContext){const n=new(window.AudioContext||window.webkitAudioContext),o=n.createOscillator(),d=n.createGain();o.connect(d),d.connect(n.destination),o.frequency.setValueAtTime(1e3,n.currentTime),o.frequency.setValueAtTime(800,n.currentTime+.05),d.gain.setValueAtTime(.1,n.currentTime),d.gain.exponentialRampToValueAtTime(.01,n.currentTime+.1),o.start(n.currentTime),o.stop(n.currentTime+.1)}},[]),l=c.useCallback(n=>{if(console.log("speakSpanishWord called with:",n),typeof window<"u"&&"speechSynthesis"in window){window.speechSynthesis.cancel();const o=new SpeechSynthesisUtterance(n);o.lang="es-ES",o.rate=.8,o.pitch=1,o.volume=.7;const g=window.speechSynthesis.getVoices().find(w=>w.lang.startsWith("es")&&w.name.includes("Spanish"));g?(o.voice=g,console.log("Using Spanish voice:",g.name)):console.log("No Spanish voice found, using default"),console.log("Speaking utterance:",o),window.speechSynthesis.speak(o)}else console.log("Speech synthesis not available")},[]);return{playChipSound:i,playSpinSound:t,playWinSound:a,playLoseSound:r,playButtonClick:s,speakSpanishWord:l}},Sr="_screen_wm47w_1",Cr="_backButton_wm47w_44",_r="_title_wm47w_81",Er="_center_wm47w_124",Tr="_play_wm47w_127",Ar="_credits_wm47w_181",kr="_bottom_wm47w_205",Ir="_secondary_wm47w_229",Lr="_framed_wm47w_274",Ie={screen:Sr,backButton:Cr,title:_r,center:Er,play:Tr,credits:Ar,bottom:kr,secondary:Ir,framed:Lr},zt=({balance:i,onStartGame:t,onShowRecords:a,onShowDictionary:r,onNavigateBack:s,playButtonClick:l})=>e.jsx("div",{className:"app-bg",children:e.jsxs("div",{className:`${Ie.screen} ${Ie.framed}`,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx("button",{onClick:()=>{l(),s()},className:Ie.backButton,title:"Назад",children:e.jsx(ve,{className:"w-6 h-6"})})}),e.jsxs("h1",{className:Ie.title,children:["ARTÍCULOS",e.jsx("br",{}),"ROULETTE"]}),e.jsx("main",{className:Ie.center,children:e.jsx("button",{className:Ie.play,onClick:()=>{l(),t()},children:"JUGAR"})}),e.jsxs("footer",{children:[e.jsxs("div",{className:Ie.credits,children:[i," CRÉDITOS"]}),e.jsxs("div",{className:Ie.bottom,children:[e.jsx("button",{className:Ie.secondary,onClick:()=>{l(),a()},children:"RÉCORDS"}),e.jsx("button",{className:Ie.secondary,onClick:()=>{l(),r()},children:"DICCIONARIO"})]})]})]})}),Pr="_wrap_i0gk3_1",Rr="_container_i0gk3_5",Ur="_credits_i0gk3_15",Dr="_word_i0gk3_45",Or="_bettingContainer_i0gk3_56",Gr="_betSelector_i0gk3_64",Wr="_betControlButton_i0gk3_75",$r="_betDisplay_i0gk3_94",Mr="_allInButton_i0gk3_109",Fr="_allInSelected_i0gk3_120",Br="_actions_i0gk3_126",zr="_bigBtn_i0gk3_133",qr="_el_i0gk3_168",Vr="_la_i0gk3_171",Kr="_backButton_i0gk3_204",Hr="_disabled_i0gk3_217",de={wrap:Pr,container:Rr,credits:Ur,word:Dr,bettingContainer:Or,betSelector:Gr,betControlButton:Wr,betDisplay:$r,allInButton:Mr,allInSelected:Fr,actions:Br,bigBtn:zr,el:qr,la:Vr,backButton:Kr,disabled:Hr},Jr=({balance:i,currentWord:t,selectedBet:a,selectedArticle:r,betAmounts:s,onSelectBet:l,onSelectArticle:n,onStartSpin:o,onBackToMenu:d,playChipSound:g,playButtonClick:w,speakSpanishWord:_})=>{const[T,y]=c.useState(0);c.useEffect(()=>{if(t){const h=setTimeout(()=>_(t),500);return()=>clearTimeout(h)}},[t,_]),c.useEffect(()=>{if(r&&a>0){const h=setTimeout(()=>o(),50);return()=>clearTimeout(h)}},[r,a,o]),c.useEffect(()=>{const h=s[T];if(h!==-1&&h<=i)l(h);else if(h===-1)i>0&&l(i);else{const I=s.slice(0,-1).reverse().findIndex(U=>U<=i);I!==-1?y(s.length-2-I):l(0)}},[T,i,s,l]);const P=h=>{g();let I=T;h==="increase"?I=(T+1)%s.length:I=(T-1+s.length)%s.length;const U=s[I];if(U>i&&U!==-1)if(h==="increase"){const O=s.findIndex(($,f)=>f>I&&($<=i||$===-1));I=O!==-1?O:s.length-1}else{const O=s.slice(0,I).reverse().findIndex($=>$<=i);I=O!==-1?I-1-O:0}y(I)},R=()=>{g(),y(s.length-1),l(i)},u=h=>{a>0&&(w(),n(h))},C=s[T]===-1?"TODO":s[T],S=s[T]===-1;return e.jsx("div",{className:"app-bg",children:e.jsx("div",{className:de.wrap,children:e.jsxs("div",{className:de.container,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx("button",{onClick:()=>{w(),d()},className:de.backButton,title:"Назад",children:e.jsx(ve,{className:"w-6 h-6"})})}),e.jsxs("div",{className:de.credits,children:[i," CRÉDITOS"]}),e.jsx("div",{className:de.word,children:t}),e.jsxs("div",{className:de.bettingContainer,children:[e.jsxs("div",{className:de.betSelector,children:[e.jsx("button",{onClick:()=>P("decrease"),className:de.betControlButton,children:e.jsx(Sa,{size:24})}),e.jsx("div",{className:de.betDisplay,children:e.jsx("span",{children:C})}),e.jsx("button",{onClick:()=>P("increase"),className:de.betControlButton,children:e.jsx(At,{size:24})})]}),e.jsx("button",{onClick:R,className:`${de.allInButton} ${S?de.allInSelected:""}`,children:"POR TODO"})]}),e.jsxs("div",{className:de.actions,children:[e.jsx("button",{className:`${de.bigBtn} ${de.el} ${a?"":de.disabled}`,onClick:()=>u("el"),disabled:!a,"aria-label":"Elegir EL",children:e.jsx("span",{children:"EL"})}),e.jsx("button",{className:`${de.bigBtn} ${de.la} ${a?"":de.disabled}`,onClick:()=>u("la"),disabled:!a,"aria-label":"Elegir LA",children:e.jsx("span",{children:"LA"})})]})]})})})},Yr="_wrap_1ir0g_1",Qr="_clickable_1ir0g_14",Xr="_plate_1ir0g_46",Zr="_rim_1ir0g_84",es="_wheel_1ir0g_90",ts="_rouletteImage_1ir0g_96",as="_pin_1ir0g_105",rs="_spinning_1ir0g_113",ss="_spinBtn_1ir0g_122",ns="_frameWrap_1ir0g_179",os="_credits_1ir0g_198",ls="_nextBtn_1ir0g_219",is="_backButton_1ir0g_276",cs="_resultDisplay_1ir0g_345",ds="_correctWord_1ir0g_391",ms="_translationText_1ir0g_423",us="_resultInfo_1ir0g_458",gs="_resultText_1ir0g_483",ps="_resultWin_1ir0g_490",hs="_resultLose_1ir0g_495",xs="_resultDetails_1ir0g_500",fs="_tapHint_1ir0g_507",bs="_mobileHint_1ir0g_557",te={wrap:Yr,clickable:Qr,plate:Xr,rim:Zr,wheel:es,rouletteImage:ts,pin:as,spinning:rs,spinBtn:ss,frameWrap:ns,credits:os,nextBtn:ls,backButton:is,resultDisplay:cs,correctWord:ds,translationText:ms,resultInfo:us,resultText:gs,resultWin:ps,resultLose:hs,resultDetails:xs,tapHint:fs,mobileHint:bs},ws="/assets/Rouletos-C9x2QxbA.png",ys=({balance:i,isSpinning:t,onSpinComplete:a,onUpdateBalance:r,onNextWord:s,onBackToMenu:l,playSpinSound:n,playButtonClick:o,currentWord:d,currentTranslation:g,currentArticle:w,selectedArticle:_,spinResult:T,lastResult:y,speakSpanishWord:P})=>{const[R,u]=c.useState(0),[C,S]=c.useState(0),[h,I]=c.useState(!1),[U,O]=c.useState(1600),[$,f]=c.useState(!1),[p,E]=c.useState(!1),[G,M]=c.useState(!1),[z,L]=c.useState(0),[B,b]=c.useState(null);c.useEffect(()=>{if(console.log("RouletteWheel useEffect для озвучивания:",{showNextButton:$,currentWord:d,spinResult:T,hasSpoken:p,hasUpdatedBalance:G,speakSpanishWord:!!P}),$&&d&&T&&!p){const j=`${T} ${d}`;console.log("RouletteWheel: Готовимся озвучить слово:",j),G||(console.log("RouletteWheel: Обновляем баланс"),r(),M(!0));const D=setTimeout(()=>{console.log("RouletteWheel: Вызываем speakSpanishWord с:",j),P(j),E(!0),console.log("RouletteWheel: Озвучивание завершено")},1e3);return()=>clearTimeout(D)}else console.log("RouletteWheel: Условия для озвучивания не выполнены")},[$,d,T,P,p,G,r]),c.useEffect(()=>()=>{B&&clearTimeout(B)},[B]),c.useEffect(()=>{if(t&&!h){console.log("RouletteWheel: Начинаем новый спин, сбрасываем состояния"),S(R),I(!0),f(!1),E(!1),M(!1),console.log("RouletteWheel: Состояния сброшены для нового спина"),n();const j=2e3+Math.random()*5e3;O(j);const D=w||"el",F=5+Math.random()*5,Q=Math.random()*360,ne=C+F*360+Q;u(ne),setTimeout(()=>{console.log("RouletteWheel: Спин завершен, устанавливаем showNextButton = true"),I(!1),f(!0),a(D),console.log("RouletteWheel: showNextButton установлен, correctArticle:",D)},j)}},[t,h,R,a,n,w,C]);const N=()=>{console.log("RouletteWheel: handleNextWord вызван, сбрасываем состояния"),o(),f(!1),E(!1),M(!1),console.log("RouletteWheel: Состояния сброшены, вызываем onNextWord"),s()},A=()=>{o(),l()},v=j=>{$&&!j.target.closest(`.${te.backButton}`)&&!j.target.closest(`.${te.nextBtn}`)&&N()},m=j=>{L(Date.now()),B&&clearTimeout(B);const D=setTimeout(()=>{$&&!j.target.closest(`.${te.backButton}`)&&!j.target.closest(`.${te.nextBtn}`)&&(console.log("RouletteWheel: Touch timeout triggered, calling handleNextWord"),N())},100);b(D)},x=j=>{const D=Date.now()-z;console.log("RouletteWheel: Touch end event:",{touchDuration:D,showNextButton:$,target:j.target,isBackButton:!!j.target.closest(`.${te.backButton}`),isNextButton:!!j.target.closest(`.${te.nextBtn}`)}),B&&(clearTimeout(B),b(null)),D<500&&$&&!j.target.closest(`.${te.backButton}`)&&!j.target.closest(`.${te.nextBtn}`)?(console.log("RouletteWheel: Touch tap detected, calling handleNextWord"),j.preventDefault(),j.stopPropagation(),N()):console.log("RouletteWheel: Touch tap conditions not met")};return e.jsx("div",{className:"app-bg",children:e.jsx("div",{className:te.frameWrap,children:e.jsxs("div",{className:`${te.wrap} ${$?te.clickable:""}`,onClick:v,onTouchStart:m,onTouchEnd:x,children:[e.jsx("div",{className:"flex justify-start w-full",children:e.jsx("button",{onClick:A,className:te.backButton,title:"Назад",children:e.jsx(ve,{className:"w-4 h-4 sm:w-6 sm:h-6"})})}),e.jsxs("div",{className:te.credits,children:[i," CRÉDITOS"]}),e.jsxs("div",{className:te.plate,children:[e.jsx("div",{className:te.rim}),e.jsx("div",{className:te.pin}),e.jsx("div",{className:`${te.wheel} ${h?te.spinning:""}`,style:{"--offsetdeg":`${R}deg`,"--current-rotation":`${C}deg`,"--animation-duration":`${U}ms`,transform:h?void 0:`rotate(${R}deg)`},children:e.jsx("img",{src:ws,alt:"Roulette Wheel",className:te.rouletteImage})})]}),$&&T&&y&&e.jsxs("div",{className:te.resultDisplay,children:[e.jsxs("div",{className:te.correctWord,children:[T.toUpperCase()," ",d?.toUpperCase()]}),g&&e.jsx("div",{className:te.translationText,children:g}),e.jsxs("div",{className:te.resultInfo,children:[e.jsx("div",{className:`${te.resultText} ${y==="win"?te.resultWin:te.resultLose}`,children:y==="win"?"¡GANASTE!":"¡PERDISTE!"}),e.jsxs("div",{className:te.resultDetails,children:["Tu apuesta: ",_?.toUpperCase(),e.jsx("br",{}),"Resultado: ",T.toUpperCase()]})]})]}),!$&&e.jsx("button",{className:te.spinBtn,disabled:h,onClick:()=>{h||o()},children:"SPIN"}),$&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:te.nextBtn,onClick:N,children:"SIGUIENTE"}),e.jsx("div",{className:te.tapHint,children:"Toca la pantalla para continuar"}),e.jsx("div",{className:te.mobileHint,children:"📱 Tap anywhere to continue"})]})]})})})},vs="_container_19ooj_1",js="_result_19ooj_51",Ns="_resultIcon_19ooj_93",Ss="_resultTitle_19ooj_133",Cs="_winText_19ooj_149",_s="_loseText_19ooj_159",Es="_resultDetails_19ooj_169",Ts="_actions_19ooj_271",As="_nextButton_19ooj_285",Ce={container:vs,result:js,resultIcon:Ns,resultTitle:Ss,winText:Cs,loseText:_s,resultDetails:Es,actions:Ts,nextButton:As},ks=({isWin:i,spinResult:t,selectedArticle:a,selectedBet:r,newBalance:s,currentWord:l,onNextRound:n,onBackToMenu:o,playButtonClick:d,speakSpanishWord:g})=>{const[w,_]=c.useState(!1);return c.useEffect(()=>{_(!1)},[l]),c.useEffect(()=>{if(console.log("ResultScreen useEffect:",{currentWord:l,spinResult:t,hasSpoken:w}),l&&t&&!w&&g){const T=`${t} ${l}`;console.log("Speaking word:",T);const y=setTimeout(()=>{console.log("About to call speakSpanishWord with:",T),g(T),_(!0)},1e3);return()=>clearTimeout(y)}else console.log("Conditions not met for speaking:",{hasCurrentWord:!!l,hasSpinResult:!!t,hasNotSpoken:!w,hasSpeakFunction:!!g})},[l,t,g,w]),e.jsx("div",{className:"app-bg",children:e.jsxs("div",{className:Ce.container,children:[e.jsx("div",{className:"flex justify-start",children:e.jsx("button",{onClick:()=>{d(),o()},className:"bg-gray-500 hover:bg-gray-600 text-white p-2 sm:p-3 rounded-full transition-colors",title:"Назад",children:e.jsx(ve,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsxs("div",{className:Ce.result,children:[e.jsx("div",{className:`${Ce.resultIcon} ${i?Ce.win:Ce.lose}`,children:i?"🎉":"😞"}),e.jsx("h2",{className:`${Ce.resultTitle} ${i?Ce.winText:Ce.loseText}`,children:i?"¡GANASTE!":"¡PERDISTE!"}),e.jsxs("div",{className:Ce.resultDetails,children:[e.jsxs("p",{children:["Tu apuesta: ",e.jsx("strong",{children:a.toUpperCase()})]}),e.jsxs("p",{children:["Resultado: ",e.jsx("strong",{children:t.toUpperCase()})]}),e.jsxs("p",{children:["Apuesta: ",e.jsxs("strong",{children:[r," créditos"]})]}),e.jsxs("p",{children:["Nuevo balance: ",e.jsxs("strong",{children:[s," créditos"]})]})]})]}),e.jsx("div",{className:Ce.actions,children:e.jsx("button",{className:Ce.nextButton,onClick:()=>{d(),n()},children:"Siguiente palabra"})})]})})},Is=({finalBalance:i,totalGames:t,wins:a,losses:r,accuracy:s,maxBalance:l,onPlayAgain:n,onBackToMenu:o,playButtonClick:d})=>e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-green-800 rounded-3xl shadow-2xl p-8 w-full max-w-md border-4 border-yellow-400",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-yellow-400",children:e.jsx($e,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-red-400 mb-2",children:"¡JUEGO TERMINADO!"}),e.jsx("p",{className:"text-yellow-400 text-lg",children:"Se acabaron los créditos"})]}),e.jsxs("div",{className:"bg-green-700 rounded-xl p-6 mb-8 border-2 border-yellow-400",children:[e.jsx("h2",{className:"text-yellow-400 font-bold text-xl mb-4 text-center",children:"ESTADÍSTICAS FINALES"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Partidas jugadas:"}),e.jsx("span",{className:"text-white font-bold",children:t})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Victorias:"}),e.jsx("span",{className:"text-green-400 font-bold",children:a})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Derrotas:"}),e.jsx("span",{className:"text-red-400 font-bold",children:r})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Precisión:"}),e.jsxs("span",{className:"text-yellow-400 font-bold",children:[s,"%"]})]}),e.jsx("div",{className:"border-t border-yellow-400 pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Máximo balance:"}),e.jsxs("span",{className:"text-yellow-400 font-bold text-lg",children:[l," créditos"]})]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{d(),n()},className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl border-2 border-yellow-400 transition-all duration-200 transform hover:scale-105",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(gt,{className:"w-5 h-5"}),e.jsx("span",{children:"JUGAR DE NUEVO"})]})}),e.jsx("button",{onClick:()=>{d(),o()},className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-xl border-2 border-yellow-400 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(It,{className:"w-5 h-5"}),e.jsx("span",{children:"MENÚ PRINCIPAL"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-gray-300 text-sm",children:"¡No te rindas! Cada partida te hace mejor."})}),e.jsx("div",{className:"mt-6 flex justify-center space-x-2",children:[...Array(7)].map((g,w)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${w%2===0?"bg-red-500":"bg-black"}`},w))})]})}),Ls=({records:i,totalGames:t,wins:a,losses:r,accuracy:s,onBackToMenu:l,playButtonClick:n})=>{const o=i.slice(-5).reverse();return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-green-800 rounded-3xl shadow-2xl p-8 w-full max-w-md border-4 border-yellow-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:()=>{n(),l()},className:"bg-gray-600 hover:bg-gray-700 text-white p-2 rounded-full transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"text-2xl font-bold text-yellow-400 flex items-center space-x-2",children:[e.jsx($e,{className:"w-6 h-6"}),e.jsx("span",{children:"RÉCORDS"})]}),e.jsx("div",{className:"w-9"})," "]}),e.jsxs("div",{className:"bg-green-700 rounded-xl p-6 mb-6 border-2 border-yellow-400",children:[e.jsx("h2",{className:"text-yellow-400 font-bold text-lg mb-4 text-center",children:"ESTADÍSTICAS GENERALES"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-bold text-2xl",children:t}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Partidas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-green-400 font-bold text-2xl",children:a}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Victorias"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-400 font-bold text-2xl",children:r}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Derrotas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-yellow-400 font-bold text-2xl",children:[s,"%"]}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Precisión"})]})]})]}),e.jsxs("div",{className:"bg-green-700 rounded-xl p-6 border-2 border-yellow-400",children:[e.jsx("h2",{className:"text-yellow-400 font-bold text-lg mb-4 text-center",children:"TOP 5 RÉCORDS"}),o.length>0?e.jsx("div",{className:"space-y-3",children:o.map((d,g)=>e.jsxs("div",{className:"flex items-center justify-between bg-green-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[g===0&&e.jsx(ft,{className:"w-5 h-5 text-yellow-400"}),g===1&&e.jsx(ft,{className:"w-5 h-5 text-gray-300"}),g===2&&e.jsx(ft,{className:"w-5 h-5 text-amber-600"}),g>2&&e.jsxs("div",{className:"w-5 h-5 flex items-center justify-center text-gray-400 font-bold text-sm",children:["#",g+1]}),e.jsx("span",{className:"text-white font-semibold",children:g===0?"Mejor récord":`Récord #${g+1}`})]}),e.jsxs("span",{className:"text-yellow-400 font-bold text-lg",children:[d," créditos"]})]},g))}):e.jsxs("div",{className:"text-center text-gray-300 py-4",children:[e.jsx($e,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aún no tienes récords"}),e.jsx("p",{className:"text-sm",children:"¡Juega para establecer tu primer récord!"})]})]}),e.jsx("div",{className:"mt-6 flex justify-center space-x-2",children:[...Array(5)].map((d,g)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${g%2===0?"bg-red-500":"bg-black"}`},g))})]})})},Ps=({wrongWords:i,onBackToMenu:t,playButtonClick:a})=>{const[r,s]=c.useState(""),l=i.filter(n=>n.toLowerCase().includes(r.toLowerCase()));return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-green-800 rounded-3xl shadow-2xl p-6 w-full max-w-lg border-4 border-yellow-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:()=>{a(),t()},className:"bg-gray-600 hover:bg-gray-700 text-white p-2 rounded-full transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"text-2xl font-bold text-yellow-400 flex items-center space-x-2",children:[e.jsx(Te,{className:"w-6 h-6"}),e.jsx("span",{children:"DICCIONARIO"})]}),e.jsx("div",{className:"w-9"})," "]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Buscar palabras...",value:r,onChange:n=>s(n.target.value),className:"w-full bg-green-700 text-white placeholder-gray-400 py-3 pl-10 pr-10 rounded-xl border-2 border-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-400"}),r&&e.jsx("button",{onClick:()=>s(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:e.jsx(Ae,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"bg-green-700 rounded-xl p-4 mb-6 border-2 border-yellow-400",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-yellow-400 font-bold text-lg",children:[i.length," palabras estudiadas"]}),e.jsxs("div",{className:"text-gray-300 text-sm",children:[l.length," ",r?"encontradas":"en total"]})]})}),e.jsx("div",{className:"bg-green-700 rounded-xl p-4 border-2 border-yellow-400 max-h-96 overflow-y-auto",children:l.length>0?e.jsx("div",{className:"space-y-2",children:l.map((n,o)=>e.jsxs("div",{className:"bg-green-600 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"!"})}),e.jsx("span",{className:"text-white font-semibold text-lg",children:n})]}),e.jsx("div",{className:"text-gray-300 text-sm",children:"Palabra difícil"})]},o))}):e.jsx("div",{className:"text-center text-gray-300 py-8",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No se encontraron palabras"}),e.jsx("p",{className:"text-sm",children:"Intenta con otro término de búsqueda"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No hay palabras en el diccionario"}),e.jsx("p",{className:"text-sm",children:"Las palabras que falles aparecerán aquí"})]})})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-gray-300 text-sm",children:"Las palabras que falles se guardan aquí para que puedas repasarlas"})}),e.jsx("div",{className:"mt-6 flex justify-center space-x-2",children:[...Array(5)].map((n,o)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${o%2===0?"bg-red-500":"bg-black"}`},o))})]})})},Rs=({onNavigateBack:i})=>{const{gameState:t,BET_AMOUNTS:a,startGame:r,selectBet:s,selectArticle:l,setCurrentWord:n,startSpin:o,completeSpin:d,updateBalanceOnResult:g,nextRound:w,resetGame:_,backToMenu:T,showRecords:y,showDictionary:P,cancelSpin:R}=wr(),{getRandomWord:u}=jr(),{playChipSound:C,playSpinSound:S,playWinSound:h,playLoseSound:I,playButtonClick:U,speakSpanishWord:O}=Nr();c.useEffect(()=>{if(t.gamePhase==="betting"&&!t.currentWord){const b=u(t.wordStats);b&&n(b.word,b.article,b.translation)}},[t.gamePhase,t.currentWord,u,n,t.wordStats]),c.useEffect(()=>{if(t.gamePhase==="spinning"&&t.isSpinning){const b=t.currentArticle||"el";t.selectedArticle===b?h():I(),d(b)}},[t.gamePhase,t.isSpinning,t.selectedArticle,t.currentArticle,d,h,I]);const $=()=>{U(),r()},f=()=>{S(),o()},p=()=>{U(),w()},E=()=>{U(),w()},G=()=>{U(),t.gamePhase==="betting"?T():t.gamePhase==="spinning"?R():t.gamePhase==="result"?w():t.gamePhase==="records"||t.gamePhase==="dictionary"?T():i()},M=()=>{U(),y()},z=()=>{U(),P()},L=t.totalGames>0?Math.round(t.wins/t.totalGames*100):0,B=t.records.length>0?Math.max(...t.records):t.balance;switch(t.gamePhase){case"menu":return e.jsx(zt,{balance:t.balance,onStartGame:$,onShowRecords:M,onShowDictionary:z,onNavigateBack:G,playButtonClick:U});case"betting":return e.jsx(Jr,{balance:t.balance,currentWord:t.currentWord||"",currentTranslation:t.currentTranslation||"",selectedBet:t.selectedBet,selectedArticle:t.selectedArticle,betAmounts:a,onSelectBet:s,onSelectArticle:l,onStartSpin:f,onBackToMenu:G,playChipSound:C,playButtonClick:U,speakSpanishWord:O});case"spinning":return e.jsx(ys,{balance:t.balance,isSpinning:t.isSpinning,onSpinComplete:d,onUpdateBalance:g,onNextWord:p,onBackToMenu:G,playSpinSound:S,playButtonClick:U,currentWord:t.currentWord,currentTranslation:t.currentTranslation,currentArticle:t.currentArticle,selectedArticle:t.selectedArticle,spinResult:t.spinResult,lastResult:t.lastResult,speakSpanishWord:O});case"result":return e.jsx(ks,{isWin:t.lastResult==="win",spinResult:t.spinResult||"",selectedArticle:t.selectedArticle||"",selectedBet:t.selectedBet,newBalance:t.balance,currentWord:t.currentWord,onNextRound:E,onBackToMenu:G,playButtonClick:U,speakSpanishWord:O});case"gameOver":return e.jsx(Is,{finalBalance:t.balance,totalGames:t.totalGames,wins:t.wins,losses:t.losses,accuracy:L,maxBalance:B,onPlayAgain:_,onBackToMenu:G,playButtonClick:U});case"records":return e.jsx(Ls,{records:t.records,totalGames:t.totalGames,wins:t.wins,losses:t.losses,accuracy:L,onBackToMenu:G,playButtonClick:U});case"dictionary":return e.jsx(Ps,{wrongWords:t.wrongWords,onBackToMenu:G,playButtonClick:U});default:return e.jsx(zt,{balance:t.balance,onStartGame:$,onShowRecords:M,onShowDictionary:z,onNavigateBack:G,playButtonClick:U})}},Us=({onNavigateBack:i})=>e.jsx("div",{className:"min-h-screen",children:e.jsx(Rs,{onNavigateBack:i})});function bt(i,t){const[a,r]=c.useState(()=>{try{const l=window.localStorage.getItem(i);return l?JSON.parse(l):t}catch(l){return console.error(`Error reading localStorage key "${i}":`,l),t}});return[a,l=>{try{const n=l instanceof Function?l(a):l;r(n),window.localStorage.setItem(i,JSON.stringify(n))}catch(n){console.error(`Error setting localStorage key "${i}":`,n)}}]}const Ds=({onLogin:i,onSwitchToRegister:t})=>{const[a,r]=c.useState(()=>{const R=localStorage.getItem("savedEmail")||"",u=localStorage.getItem("savedPassword")||"";return{email:R,password:u}}),[s,l]=c.useState(!1),[n,o]=c.useState(()=>localStorage.getItem("rememberMe")==="true"),[d,g]=c.useState({}),[w,_]=c.useState(!1),T=()=>{const R={};return a.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(R.email="Некорректный формат email"):R.email="Email обязателен",a.password||(R.password="Пароль обязателен"),g(R),Object.keys(R).length===0},y=async R=>{if(R.preventDefault(),!(!T()||w)){_(!0);try{await new Promise(u=>setTimeout(u,1e3)),n?(localStorage.setItem("savedEmail",a.email.trim()),localStorage.setItem("savedPassword",a.password),localStorage.setItem("rememberMe","true")):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"),localStorage.setItem("rememberMe","false")),i({email:a.email.trim(),password:a.password})}catch(u){console.error("Login error:",u),g({general:"Неверный email или пароль"})}finally{_(!1)}}},P=(R,u)=>{r(C=>({...C,[R]:u})),d[R]&&g(C=>({...C,[R]:""}))};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-64 h-64 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("img",{src:"/Logo AmigosCards.png",alt:"AmigosCards Logo",className:"w-48 h-48 object-contain"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Добро пожаловать!"}),e.jsx("p",{className:"text-gray-600",children:"Войдите в свой аккаунт"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[d.general&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:d.general})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",id:"email",value:a.email,onChange:R=>P("email",R.target.value),placeholder:"example@email.com",className:`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-black ${d.email?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(Xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),d.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:s?"text":"password",id:"password",value:a.password,onChange:R=>P("password",R.target.value),placeholder:"Введите пароль",className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors text-black ${d.password?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("button",{type:"button",onClick:()=>l(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:s?e.jsx(vt,{className:"w-4 h-4"}):e.jsx(ot,{className:"w-4 h-4"})})]}),d.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.password})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 transition-colors",children:"Забыли пароль?"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-me",type:"checkbox",checked:n,onChange:R=>o(R.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-700",children:"Запомнить меня"})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors mt-6",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Входим..."]}):"Войти"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Нет аккаунта?"," ",e.jsx("button",{onClick:t,className:"text-blue-600 hover:text-blue-700 font-medium transition-colors",children:"Создать аккаунт"})]})})]}),e.jsxs("p",{className:"text-center text-xs text-gray-500 mt-6",children:["Входя в систему, вы соглашаетесь с"," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Условиями использования"})," ","и"," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Политикой конфиденциальности"})]})]})})},Os=({email:i,onBackToLogin:t,onVerificationComplete:a,onRedirectToLogin:r})=>{const[s,l]=c.useState(!1),[n,o]=c.useState(!1),[d,g]=c.useState(""),[w,_]=c.useState(0),[T,y]=c.useState(!1);c.useEffect(()=>{const u=async()=>{if(k)try{const{data:{session:S},error:h}=await k.auth.getSession();if(h){console.error("Error checking verification status:",h);return}if(S?.user?.email_confirmed_at){console.log("Email confirmed via session:",S.user.email),r();return}const{data:{user:I},error:U}=await k.auth.getUser();if(U){console.error("Error getting user:",U);return}I?.email_confirmed_at&&(console.log("Email confirmed via user check:",I.email),r())}catch(S){console.error("Error checking verification:",S)}};u();const C=setInterval(u,3e3);return()=>clearInterval(C)},[a]),c.useEffect(()=>{if(w>0){const u=setTimeout(()=>_(w-1),1e3);return()=>clearTimeout(u)}},[w]);const P=async()=>{if(!(!k||w>0)){l(!0),g(""),o(!1);try{const{error:u}=await k.auth.resend({type:"signup",email:i});u?(console.error("Error resending email:",u),g("Ошибка при отправке письма. Попробуйте еще раз.")):(o(!0),_(60))}catch(u){console.error("Resend email error:",u),g("Произошла ошибка. Попробуйте еще раз.")}finally{l(!1)}}},R=()=>{y(!0),g(""),o(!0),setTimeout(()=>{r()},1500)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("img",{src:"/assets/Logo AmigosCards.png",alt:"AmigosCards Logo",className:"w-10 h-10",onError:u=>{const C=u.target;C.style.display="none",C.parentElement.innerHTML='<svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg>'}})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Подтвердите email"}),e.jsx("p",{className:"text-gray-600",children:"Мы отправили письмо на ваш адрес"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Xe,{className:"w-10 h-10 text-blue-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Проверьте почту"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Мы отправили письмо с подтверждением на адрес:"}),e.jsx("p",{className:"text-blue-600 font-medium mt-1",children:i})]}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Что делать дальше:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-blue-700",children:[e.jsx("li",{children:"Откройте письмо в почтовом ящике"}),e.jsx("li",{children:"Нажмите на ссылку подтверждения"}),e.jsx("li",{children:"Вернитесь в приложение"})]})]})]})}),d&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-700",children:d})]})}),n&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-green-700",children:"Отлично! Перенаправляем на страницу входа..."})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:R,disabled:T,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Перенаправляем..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4"}),"Я подтвердил email"]})}),e.jsx("button",{onClick:P,disabled:s||w>0,className:"w-full bg-gray-100 hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 text-gray-700 py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400"}),"Отправляем..."]}):w>0?e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"w-4 h-4"}),"Отправить повторно (",w,"с)"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"w-4 h-4"}),"Отправить письмо повторно"]})}),e.jsxs("button",{onClick:t,className:"w-full text-gray-600 hover:text-gray-800 py-2 font-medium flex items-center justify-center gap-2 transition-colors",children:[e.jsx(ve,{className:"w-4 h-4"}),"Вернуться к входу"]})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-xs text-gray-500",children:'Не получили письмо? Проверьте папку "Спам" или попробуйте отправить повторно.'})})]})})};function Gs(){const{state:i,dispatch:t}=Me(),[a,r]=c.useState("login"),[s,l]=c.useState("login"),[n,o]=c.useState("all"),[d,g]=c.useState(""),[w,_]=c.useState(""),[T,y]=c.useState(()=>!1),[P,R]=bt("spaced-repetition-cards",[]),[u,C]=bt("current-language-pair",{id:"ru-es",knownLanguage:"Русский",learningLanguage:"Español",knownLanguageCode:"ru",learningLanguageCode:"es"}),[S,h]=bt("user-stats",{streak:5,totalCards:0,learnedCards:0,masteredCards:0,reviewsDue:0,lastSessionDate:new Date});c.useEffect(()=>{(async()=>{try{if(!k){console.log("⚠️ Supabase not configured, skipping authentication check"),y(!1),r("login");return}const{data:{session:F},error:Q}=await k.auth.getSession();if(Q){console.error("Error checking auth session:",Q),(Q.message?.includes("Invalid Refresh Token")||Q.message?.includes("Refresh Token Not Found"))&&(console.log("🔄 Refresh token invalid, clearing session"),await k.auth.signOut()),y(!1),r("login");return}if(F?.user)y(!0),r("home"),console.log("Auto-login successful for:",F.user.email||"Anonymous user"),await I();else{console.log("🔄 No session found, attempting anonymous sign-in...");const{data:ne,error:ue}=await k.auth.signInAnonymously();ue?(console.error("Error signing in anonymously:",ue),y(!1),r("login")):(console.log("✅ Anonymous sign-in successful:",ne.user.id),y(!0),r("home"),await I())}}catch(F){console.error("Error checking authentication:",F),k&&await k.auth.signOut(),y(!1),r("login")}})(),X.initializeDefaultUser().catch(console.error),I();const j=X.getUserSettings()||xe.getLanguagePair();if(j){const F={id:xe.generateLanguagePairId(j.known_language_code,j.learning_language_code),knownLanguage:j.known_language,learningLanguage:j.learning_language,knownLanguageCode:j.known_language_code,learningLanguageCode:j.learning_language_code};t({type:"SET_CURRENT_LANGUAGE_PAIR",payload:F})}else t({type:"SET_CURRENT_LANGUAGE_PAIR",payload:u});const D={...S,lastSessionDate:new Date(S.lastSessionDate)};t({type:"UPDATE_USER_STATS",payload:D})},[]);const I=async()=>{Z("🔄 loadCardsFromDatabase: Starting...",null,"App");try{if(!k){dt("⚠️ Supabase not configured, using empty cards",null,"App"),t({type:"SET_CARDS",payload:[]});return}Z("✅ loadCardsFromDatabase: Supabase configured",null,"App");const{data:{session:m}}=await k.auth.getSession();if(!m?.user){dt("❌ loadCardsFromDatabase: User not authenticated, using empty cards",null,"App"),t({type:"SET_CARDS",payload:[]});return}Z("✅ loadCardsFromDatabase: User authenticated:",m.user.id,"App"),Z("🔄 loadCardsFromDatabase: Calling CardService.getUserCards...",null,"App");const x=await pe.getUserCards();Z(`📚 loadCardsFromDatabase: Loaded ${x.length} existing cards for user`,null,"App"),t({type:"SET_CARDS",payload:x})}catch(m){console.error("Error loading cards from database:",m),console.log("Using empty cards as fallback"),t({type:"SET_CARDS",payload:[]})}};c.useEffect(()=>{i.cards.length>0&&R(i.cards)},[i.cards,R]),c.useEffect(()=>{i.currentLanguagePair&&C(i.currentLanguagePair)},[i.currentLanguagePair,C]),c.useEffect(()=>{h(i.userStats)},[i.userStats,h]);const U=async m=>{try{if(!k){alert("Supabase не настроен. Приложение работает в режиме демо.");return}const{data:{user:x},error:j}=await k.auth.getUser();if(j||!x||!x.email_confirmed_at){console.error("User not confirmed or error getting user:",j),alert("Email еще не подтвержден. Проверьте почту и перейдите по ссылке.");return}const D=localStorage.getItem("temp_language_settings");let F=null;D&&(F=JSON.parse(D),localStorage.removeItem("temp_language_settings")),m?.name&&await X.updateUserDisplayNameInAuth(m.name),await X.saveUser({email:m?.email||x.email,name:m?.name||x.user_metadata?.name||x.user_metadata?.display_name||"Пользователь",level:F?.level||x.user_metadata?.level||"Beginner"}),await X.saveUserSettings({known_language:F?.knownLanguage?.name||x.user_metadata?.known_language||"Русский",learning_language:F?.learningLanguage?.name||x.user_metadata?.learning_language||"Español",known_language_code:F?.knownLanguage?.code||x.user_metadata?.known_language_code||"ru",learning_language_code:F?.learningLanguage?.code||x.user_metadata?.learning_language_code||"es",daily_goal:20,notifications_enabled:!0,sound_effects_enabled:!0,app_language:"ru"}),console.log("User email verified and setup completed:",m),y(!0),r("home"),_(""),await I()}catch(x){console.error("Error completing email verification:",x),alert("Ошибка при завершении регистрации. Попробуйте войти в систему.")}},O=async m=>{try{if(!k){alert("Supabase не настроен. Приложение работает в режиме демо.");return}const{data:x,error:j}=await k.auth.signUp({email:m.email,password:m.password,options:{data:{name:m.name,display_name:m.name,known_language:m.knownLanguage.name,learning_language:m.learningLanguage.name,known_language_code:m.knownLanguage.code,learning_language_code:m.learningLanguage.code,level:m.level}}});if(j){console.error("Supabase registration error:",j),alert("Ошибка при регистрации: "+j.message);return}x.user&&(localStorage.setItem("temp_language_settings",JSON.stringify({knownLanguage:m.knownLanguage,learningLanguage:m.learningLanguage,level:m.level})),x.user.email_confirmed_at?await U(m):(_(m.email),r("email-verification"),console.log("User registered, email verification required:",m.email)))}catch(x){console.error("Registration error:",x),alert("Ошибка при регистрации. Попробуйте еще раз.")}},$=async m=>{try{if(!k){alert("Supabase не настроен. Приложение работает в режиме демо.");return}const{data:x,error:j}=await k.auth.signInWithPassword({email:m.email,password:m.password});if(j){console.error("Supabase login error:",j),alert("Ошибка входа: "+j.message);return}x.user&&(console.log("User login successful:",m),y(!0),r("home"),await I())}catch(x){console.error("Login error:",x),alert("Неверный email или пароль")}},f=()=>{r("registration")},p=()=>{r("login")},E=()=>{_(""),r("login")},G=()=>{_(""),r("login")},M=async()=>{try{if(!k||!w)return;const{data:{user:m},error:x}=await k.auth.getUser();if(x){console.error("Error getting user for verification:",x),alert("Ошибка при проверке статуса. Попробуйте войти в систему.");return}if(m&&m.email_confirmed_at){const j=m.user_metadata?.name||m.user_metadata?.display_name||"Пользователь";console.log("Email verification completed for user:",m.email,"Name:",j),await U({email:w,name:j,password:""})}else console.log("User not found or email not confirmed. User:",m?.email,"Confirmed at:",m?.email_confirmed_at),alert("Email еще не подтвержден. Проверьте почту и перейдите по ссылке.")}catch(m){console.error("Error completing email verification:",m),alert("Ошибка при завершении верификации. Попробуйте войти в систему.")}},z=async()=>{try{if(k){const{error:m}=await k.auth.signOut();m&&console.error("Logout error:",m)}X.clearUserData(),y(!1),L("login")}catch(m){console.error("Logout error:",m),y(!1),L("login")}},L=m=>{l(a),r(m)},B=()=>{t({type:"START_SESSION"}),L("session")},b=()=>{t({type:"END_SESSION"}),L("home")},N=()=>{L("profile")},A=()=>{L(s)},v=()=>{switch(a){case"login":return e.jsx(Ds,{onLogin:$,onSwitchToRegister:f});case"registration":return e.jsx(Ua,{onRegister:O,onSwitchToLogin:p});case"email-verification":return e.jsx(Os,{email:w,onBackToLogin:E,onVerificationComplete:M,onRedirectToLogin:G});case"session":return e.jsx(Za,{onEndSession:b,onProfileClick:N});case"stats":return e.jsx(tr,{onBack:()=>L("home")});case"profile":return e.jsx(nr,{onBack:()=>L("home"),onLogout:z});case"cards":return e.jsx(or,{onBack:()=>L("home"),initialFilter:n});case"lessons":return e.jsx(lr,{onBack:()=>L("home"),onStartLesson:m=>{g(m),L(m==="lesson-1-nouns-gender-number"?"lesson1":m==="lesson-alphabet"?"lesson-alphabet":"lesson")},onUpdateLessonProgress:(m,x)=>{console.log(`📊 Lesson ${m} progress updated to ${x}%`)}});case"lesson":return e.jsx(dr,{lessonId:d,onBack:()=>L("lessons"),onUpdateProgress:m=>{console.log(`📊 Lesson progress updated to ${m}%`)},onStartLearning:()=>{console.log("🎯 Starting learning session from lesson"),L("session")}});case"lesson1":return e.jsx(mr,{lessonId:d,onBack:()=>L("lessons"),onUpdateProgress:m=>{console.log(`📊 Lesson progress updated to ${m}%`)}});case"lesson-alphabet":return e.jsx(ur,{lessonId:d,onBack:()=>L("lessons"),onUpdateProgress:m=>{console.log(`📊 Alphabet lesson progress updated to ${m}%`)}});case"sound-hunt":return e.jsx(hr,{onNavigateToHome:()=>L("home"),onNavigateToNumbersHunt:()=>L("numbers-hunt"),onNavigateToArticulosRoulette:()=>L("articulos-roulette")});case"numbers-hunt":return e.jsx(fr,{onNavigateBack:A});case"articulos-roulette":return e.jsx(Us,{onNavigateBack:A});default:return e.jsx(Ha,{onStartSession:B,onManageCards:()=>L("cards"),onViewStats:()=>L("stats"),onProfileClick:N,onNavigateToCards:m=>{o(m),L("cards")},onNavigateToLessons:()=>L("lessons"),onNavigateToSoundHunt:()=>L("sound-hunt")})}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:v()})}function Ws(){return e.jsx(Ra,{children:e.jsx(Gs,{})})}class $s{static async testConnection(){try{console.log("🔍 Testing database connection...");const{data:t,error:a}=await k.from("cards").select("count").limit(1);return a?(console.error("❌ Database connection failed:",a),!1):(console.log("✅ Database connection successful"),!0)}catch(t){return console.error("❌ Database connection error:",t),!1}}static async checkAuth(){try{const{data:{user:t},error:a}=await k.auth.getUser();if(a){console.error("❌ Auth check failed:",a);return}t?console.log("✅ User authenticated:",{id:t.id,email:t.email,created_at:t.created_at}):console.log("❌ No authenticated user")}catch(t){console.error("❌ Auth check error:",t)}}static async testCRUD(){try{console.log("🧪 Testing CRUD operations...");const{data:t,error:a}=await k.from("cards").select("*").limit(5);if(a){console.error("❌ Read test failed:",a);return}console.log("✅ Read test successful, found cards:",t?.length||0);const{data:r,error:s}=await k.from("user_settings").select("*").limit(1);s?console.error("❌ Settings read test failed:",s):console.log("✅ Settings read test successful")}catch(t){console.error("❌ CRUD test error:",t)}}static enableVerboseLogging(){console.log("🔊 Enabling verbose database logging...");const t=console.log,a=console.error;console.log=(...r)=>{r[0]?.includes?.("CardService")||r[0]?.includes?.("UserService")?t("📊 [DB]",...r):t(...r)},console.error=(...r)=>{r[0]?.includes?.("CardService")||r[0]?.includes?.("UserService")?a("🚨 [DB ERROR]",...r):a(...r)}}static async runAllTests(){console.log("🚀 Running all database debug tests..."),await this.testConnection(),await this.checkAuth(),await this.testCRUD(),console.log("🏁 Debug tests completed")}}typeof window<"u"&&(window.dbDebug=$s,console.log("🛠️ Database debugger available as window.dbDebug"));Xt(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Ws,{})}));

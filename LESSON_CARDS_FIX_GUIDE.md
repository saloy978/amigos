# Исправление проблемы с пустыми карточками из уроков

## Проблема
При добавлении карточек из уроков создавались пустые карточки без содержимого.

## Причина
1. Метод `addCardToUser` не поддерживал поле `english`
2. В базе данных отсутствовало поле `english` в таблице `cards`
3. Функции базы данных не были обновлены для работы с полем `english`

## Исправления

### 1. Обновлен CardService
- ✅ Добавлен параметр `english` в метод `addCardToUser`
- ✅ Обновлены все вызовы `addCardToUser` в приложении
- ✅ Исправлен маппинг данных для включения поля `english`

### 2. Обновлены типы
- ✅ Добавлено поле `english?: string` в интерфейс `UserCardWithContent`

### 3. Создана миграция базы данных
- ✅ Добавлено поле `english` в таблицу `cards`
- ✅ Обновлены функции `get_or_create_card`, `add_card_to_user`
- ✅ Обновлены представления `user_cards_with_content`, `cards_due_for_review`

## Как применить исправления

### Автоматическое применение (рекомендуется)
Если у вас есть доступ к Supabase CLI:
```bash
.\supabase.exe db push
```

### Ручное применение
Если CLI недоступен, выполните SQL код из файла:
`supabase/migrations/20250113000006_add_english_field.sql`

## Проверка исправлений

1. **Запустите приложение**:
   ```bash
   npm run dev
   ```

2. **Протестируйте добавление карточек из урока**:
   - Откройте урок (например, "Формы приветствия и обращения")
   - Нажмите "Добавить слова из урока"
   - Проверьте, что карточки создаются с правильным содержимым

3. **Проверьте содержимое карточек**:
   - Перейдите в раздел "Карточки"
   - Убедитесь, что карточки содержат:
     - Испанское слово (`term`)
     - Русский перевод (`translation`)
     - Английское слово (`english`) - если доступно

## Ожидаемый результат

После применения исправлений:
- ✅ Карточки из уроков добавляются с полным содержимым
- ✅ Поле `english` сохраняется для генерации изображений
- ✅ Нет пустых карточек
- ✅ Все функции добавления карточек работают корректно

## Поддержка

Если проблемы остаются:
1. Проверьте логи в консоли браузера
2. Убедитесь, что миграция применена успешно
3. Проверьте, что пользователь аутентифицирован
4. Убедитесь, что Supabase настроен корректно






